/*
 @license
    Slip.js 1.2.0

    ? 2014 Kornel Lesi?ski <kornel@geekhood.net>. All rights reserved.

    Redistribution and use in source and binary forms, with or without modification,
    are permitted provided that the following conditions are met:

    1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

    2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and
       the following disclaimer in the documentation and/or other materials provided with the distribution.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES,
    INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
    DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR
    SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
    WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE
    USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
*/
window.Slip=function(){function n(a,b){"string"===typeof a&&(a=document.querySelector(a));if(!a||!a.addEventListener)throw Error("Please specify DOM node to attach to");if(!this||this===window)return new n(a,b);this.options=b=b||{};this.options.keepSwipingPercent=b.keepSwipingPercent||0;this.options.minimumSwipeVelocity=b.minimumSwipeVelocity||1;this.options.minimumSwipeTime=b.minimumSwipeTime||110;this.cancel=this.setState.bind(this,this.states.idle);this.onTouchStart=this.onTouchStart.bind(this);
this.onTouchMove=this.onTouchMove.bind(this);this.onTouchEnd=this.onTouchEnd.bind(this);this.onMouseDown=this.onMouseDown.bind(this);this.onMouseMove=this.onMouseMove.bind(this);this.onMouseUp=this.onMouseUp.bind(this);this.onMouseLeave=this.onMouseLeave.bind(this);this.onSelection=this.onSelection.bind(this);this.onContainerFocus=this.onContainerFocus.bind(this);this.setState(this.states.idle);this.attach(a)}function r(a){var b=a.style[e];return b?{value:b,original:b}:window.getComputedStyle&&(a=
window.getComputedStyle(a).getPropertyValue(p))&&"none"!==a?{value:a,original:""}:{value:"",original:""}}function v(a,b){for(var c=0,d=0,f=0;f<b.length;f++)1===b[f].nodeType&&(d++,b[f]===a.node&&(c=d-1));return c}var t=/Chrome\/[3-5]/.test(navigator.userAgent),g=document.createElement("div").style,h="transition"in g?"transition":"webkitTransition",e="transform"in g?"transform":"webkitTransform",p="webkitTransform"===e?"-webkit-transform":"transform",w="userSelect"in g?"userSelect":"webkitUserSelect";
g[e]="translateZ(0)";var m=g[e]?"translateZ(0) ":"",y=g[e]?"translateZ(1px) ":"",g=null,u=0,q=!1,x=function(){};n.prototype={container:null,options:{},state:null,target:null,usingTouch:!1,mouseHandlersAttached:!1,startPosition:null,latestPosition:null,previousPosition:null,canPreventScrolling:!1,states:{idle:function(){this.removeMouseHandlers();this.target&&(this.target.node.style.willChange="",this.target=null);this.usingTouch=!1;return{allowTextSelection:!0}},undecided:function(){var a;this.target.height=
this.target.node.offsetHeight;this.target.node.style[h]="";this.dispatch(this.target.originalTarget,"beforewait")?a=setTimeout(function(){var a=this.getAbsoluteMovement();this.canPreventScrolling&&15>a.x&&25>a.y&&this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder)}.bind(this),300):this.dispatch(this.target.originalTarget,"beforereorder")&&this.setState(this.states.reorder);return{leaveState:function(){clearTimeout(a)},onMove:function(){var a=this.getAbsoluteMovement();
if(20<a.x&&a.y<Math.max(100,this.target.height)){if(this.dispatch(this.target.originalTarget,"beforeswipe",{directionX:a.directionX,directionY:a.directionY}))return this.setState(this.states.swipe),!1;this.setState(this.states.idle)}20<a.y&&this.setState(this.states.idle);if(a.x>1.2*a.y)return!1},onLeave:function(){this.setState(this.states.idle)},onEnd:function(){var a=this.dispatch(this.target.originalTarget,"tap");this.setState(this.states.idle);return a}}},swipe:function(){function a(){c.classList.remove("slip-swiping-container")}
var b=!1,c=this.container,d=v(this.target,this.container.childNodes);c.classList.add("slip-swiping-container");this.target.height=this.target.node.offsetHeight;return{leaveState:function(){b?this.animateSwipe(function(b){b.node.style[e]=b.baseTransform.original;b.node.style[h]="";if(this.dispatch(b.node,"afterswipe"))return a(),!0;this.animateToZero(void 0,b)}.bind(this)):this.animateToZero(a)},onMove:function(){var a=this.getTotalMovement();if(Math.abs(a.y)<this.target.height+20)return this.dispatch(this.target.node,
"animateswipe",{x:a.x,originalIndex:d})&&(this.target.node.style[e]="translate("+a.x+"px,0) "+m+this.target.baseTransform.value),!1;this.dispatch(this.target.node,"cancelswipe");this.setState(this.states.idle)},onLeave:function(){this.state.onEnd.call(this)},onEnd:function(){var a=this.getAbsoluteMovement(),c=100*Math.abs((this.startPosition.x-this.previousPosition.x)/this.container.clientWidth);(c=a.x/a.time>this.options.minimumSwipeVelocity&&a.time>this.options.minimumSwipeTime||this.options.keepSwipingPercent&&
c>this.options.keepSwipingPercent)?this.dispatch(this.target.node,"swipe",{direction:a.directionX,originalIndex:d})&&(b=!0):this.dispatch(this.target.node,"cancelswipe");this.setState(this.states.idle);return!c}}},reorder:function(){function a(){this.updateScrolling();d&&(clearTimeout(d),d=null);var a=this.getTotalMovement();this.target.node.style[e]="translate(0,"+a.y+"px) "+y+this.target.baseTransform.value;var b=this.target.height;k.forEach(function(c){var d=0;0>c.pos&&0>a.y&&c.pos>a.y?d=b:0<c.pos&&
0<a.y&&c.pos<a.y&&(d=-b);c.node.style[e]=d?"translate(0,"+d+"px) "+m+c.baseTransform.value:c.baseTransform.original});return!1}this.target.height=this.target.node.offsetHeight;for(var b=this.container.childNodes,c=v(this.target,b),d,f=this.target.node.offsetTop+this.target.height/2,k=[],l=0;l<b.length;l++)if(1==b[l].nodeType&&b[l]!==this.target.node){var g=b[l].offsetTop;b[l].style[h]=p+" 0.2s ease-in-out";k.push({node:b[l],baseTransform:r(b[l]),pos:g+(g<f?b[l].offsetHeight:0)-f})}this.target.node.classList.add("slip-reordering");
this.target.node.style.zIndex="99999";this.target.node.style[w]="none";t&&(this.container.style.webkitTransformStyle="preserve-3d");a.call(this);return{leaveState:function(){d&&clearTimeout(d);t&&(this.container.style.webkitTransformStyle="");this.target.node.classList.remove("slip-reordering");this.target.node.style[w]="";this.animateToZero(function(a){a.node.style.zIndex=""});k.forEach(function(a){a.node.style[e]=a.baseTransform.original;a.node.style[h]=""})},onMove:a,onLeave:function(){d&&clearTimeout(d);
d=setTimeout(function(){d=null;this.cancel()}.bind(this),700)},onEnd:function(){var a=this.getTotalMovement(),b;if(0>a.y){for(b=0;b<k.length&&!(k[b].pos>a.y);b++);a=b}else{for(b=k.length-1;0<=b&&!(k[b].pos<a.y);b--);a=b+1}this.dispatch(this.target.node,"reorder",{spliceIndex:a,originalIndex:c,insertBefore:k[a]?k[a].node:null});this.setState(this.states.idle);return!1}}}},attach:function(a){u++;this.container&&this.detach();!q&&t&&(q=!0,document.body.addEventListener("touchstart",x,!1));this.container=
a;this.container.tabIndex=0;this.container.setAttribute("aria-role","listbox");this.setChildNodesAriaRoles();this.container.addEventListener("focus",this.onContainerFocus,!1);this.otherNodes=[];document.addEventListener("selectionchange",this.onSelection,!1);this.container.addEventListener("touchcancel",this.cancel,!1);this.container.addEventListener("touchstart",this.onTouchStart,!1);this.container.addEventListener("touchmove",this.onTouchMove,!1);this.container.addEventListener("touchend",this.onTouchEnd,
!1);this.container.addEventListener("mousedown",this.onMouseDown,!1)},detach:function(){this.cancel();this.container.removeEventListener("mousedown",this.onMouseDown,!1);this.container.removeEventListener("touchend",this.onTouchEnd,!1);this.container.removeEventListener("touchmove",this.onTouchMove,!1);this.container.removeEventListener("touchstart",this.onTouchStart,!1);this.container.removeEventListener("touchcancel",this.cancel,!1);document.removeEventListener("selectionchange",this.onSelection,
!1);this.container.removeAttribute("tabIndex");this.container.removeAttribute("aria-role");this.unSetChildNodesAriaRoles();u--;!u&&q&&(q=!1,document.body.removeEventListener("touchstart",x,!1))},setState:function(a){if(this.state){if(this.state.ctor===a)return;this.state.leaveState&&this.state.leaveState.call(this)}var b=this.state,c=a.call(this);this.state===b&&(c.ctor=a,this.state=c)},findTargetNode:function(a){for(;a&&a.parentNode!==this.container;)a=a.parentNode;return a},onContainerFocus:function(a){this.setChildNodesAriaRoles()},
setChildNodesAriaRoles:function(){for(var a=this.container.childNodes,b=0;b<a.length;b++)1==a[b].nodeType&&(a[b].setAttribute("aria-role","option"),a[b].tabIndex=-1)},unSetChildNodesAriaRoles:function(){for(var a=this.container.childNodes,b=0;b<a.length;b++)1==a[b].nodeType&&(a[b].removeAttribute("aria-role"),a[b].removeAttribute("tabIndex"))},onSelection:function(a){var b=a.target===document||this.findTargetNode(a),c=/(iPhone|iPad|iPod)/i.test(navigator.userAgent)&&!/(Android|Windows)/i.test(navigator.userAgent);
b&&(c?this.setState(this.states.idle):this.state.allowTextSelection||a.preventDefault())},addMouseHandlers:function(){this.mouseHandlersAttached||(this.mouseHandlersAttached=!0,document.documentElement.addEventListener("mouseleave",this.onMouseLeave,!1),window.addEventListener("mousemove",this.onMouseMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),window.addEventListener("blur",this.cancel,!1))},removeMouseHandlers:function(){this.mouseHandlersAttached&&(this.mouseHandlersAttached=!1,
document.documentElement.removeEventListener("mouseleave",this.onMouseLeave,!1),window.removeEventListener("mousemove",this.onMouseMove,!0),window.removeEventListener("mouseup",this.onMouseUp,!0),window.removeEventListener("blur",this.cancel,!1))},onMouseLeave:function(a){this.usingTouch||(a.target===document.documentElement||a.relatedTarget===document.documentElement)&&this.state.onLeave&&this.state.onLeave.call(this)},onMouseDown:function(a){!this.usingTouch&&0==a.button&&this.setTarget(a)&&(this.addMouseHandlers(),
this.canPreventScrolling=!0,this.startAtPosition({x:a.clientX,y:a.clientY,time:a.timeStamp}))},onTouchStart:function(a){this.canPreventScrolling=this.usingTouch=!0;1<a.touches.length?this.setState(this.states.idle):this.setTarget(a)&&this.startAtPosition({x:a.touches[0].clientX,y:a.touches[0].clientY,time:a.timeStamp})},setTarget:function(a){var b=this.findTargetNode(a.target);if(!b)return this.setState(this.states.idle),!1;for(var c=b.parentNode;c&&c!=document.body&&!(c.scrollHeight>c.clientHeight&&
"visible"!=window.getComputedStyle(c)["overflow-y"]);)c=c.parentNode;c=c||document.body;this.target={originalTarget:a.target,node:b,scrollContainer:c,origScrollTop:c.scrollTop,origScrollHeight:c.scrollHeight,baseTransform:r(b)};return!0},startAtPosition:function(a){this.startPosition=this.previousPosition=this.latestPosition=a;this.setState(this.states.undecided)},updatePosition:function(a,b){null!=this.target&&(this.latestPosition=b,this.state.onMove&&!1===this.state.onMove.call(this)&&a.preventDefault(),
100<this.latestPosition.time-this.previousPosition.time&&(this.previousPosition=this.latestPosition))},onMouseMove:function(a){this.updatePosition(a,{x:a.clientX,y:a.clientY,time:a.timeStamp})},onTouchMove:function(a){this.updatePosition(a,{x:a.touches[0].clientX,y:a.touches[0].clientY,time:a.timeStamp});this.canPreventScrolling=!1},onMouseUp:function(a){this.usingTouch||0!==a.button||this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},onTouchEnd:function(a){1<a.touches.length?
this.cancel():this.state.onEnd&&!1===this.state.onEnd.call(this)&&a.preventDefault()},getTotalMovement:function(){return{x:this.latestPosition.x-this.startPosition.x,y:this.latestPosition.y-this.startPosition.y+(this.target.scrollContainer.scrollTop-this.target.origScrollTop),time:this.latestPosition.time-this.startPosition.time}},getAbsoluteMovement:function(){var a=this.getTotalMovement();return{x:Math.abs(a.x),y:Math.abs(a.y),time:a.time,directionX:0>a.x?"left":"right",directionY:0>a.y?"up":"down"}},
updateScrolling:function(){var a=0,b=this.target.scrollContainer,c=b.getBoundingClientRect(),d=this.target.node.getBoundingClientRect(),f=Math.min(c.bottom,window.innerHeight)-d.bottom,c=d.top-Math.max(c.top,0),d=this.target.origScrollHeight-Math.min(b.clientHeight,window.innerHeight);40>f?a=Math.min(40,40-f):40>c&&(a=Math.max(-40,c-40));b.scrollTop=Math.max(0,Math.min(d,b.scrollTop+a))},dispatch:function(a,b,c){var d=document.createEvent("CustomEvent");d&&d.initCustomEvent?d.initCustomEvent("slip:"+
b,!0,!0,c):(d=document.createEvent("Event"),d.initEvent("slip:"+b,!0,!0),d.detail=c);return a.dispatchEvent(d)},getSiblings:function(a){var b=[];for(a=a.node.nextSibling;a;)1==a.nodeType&&b.push({node:a,baseTransform:r(a)}),a=a.nextSibling;return b},animateToZero:function(a,b){b=b||this.target;b.node.style[h]=p+" 0.1s ease-out";b.node.style[e]="translate(0,0) "+m+b.baseTransform.value;setTimeout(function(){b.node.style[h]="";b.node.style[e]=b.baseTransform.original;a&&a.call(this,b)}.bind(this),101)},
animateSwipe:function(a){var b=this.target,c=this.getSiblings(b),d="translate(0,"+this.target.height+"px) "+m+" ";b.node.style[h]="all 0.1s linear";b.node.style[e]=" translate("+(0<this.getTotalMovement().x?"":"-")+"100%,0) "+m+b.baseTransform.value;setTimeout(function(){a.call(this,b)&&(c.forEach(function(a){a.node.style[h]="";a.node.style[e]=d+a.baseTransform.value}),setTimeout(function(){c.forEach(function(a){a.node.style[h]=p+" 0.1s ease-in-out";a.node.style[e]="translate(0,0) "+m+a.baseTransform.value});
setTimeout(function(){c.forEach(function(a){a.node.style[h]="";a.node.style[e]=a.baseTransform.original})},101)},1))}.bind(this),101)}};"function"===typeof define&&define.amd&&define(function(){return n});"object"===typeof module&&module.exports&&(module.exports=n);return n}();
