!function(){"use strict";function o(){return function(){throw new Error("Unimplemented abstract method.")}()}var e=0;function bt(t){return t.ol_uid||(t.ol_uid=String(++e))}var t="latest",n=function(i){function t(t){var e="Assertion failed. See https://openlayers.org/en/latest/doc/errors/#"+t+" for details.";i.call(this,e);this.code=t;this.name="AssertionError";this.message=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Error),a={ADD:"add",REMOVE:"remove"},s={PROPERTYCHANGE:"propertychange"},y="function"==typeof Object.assign?Object.assign:function(t,e){var i=arguments;if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,o=arguments.length;n<o;++n){var s=i[n];if(null!=s)for(var a in s)s.hasOwnProperty(a)&&(r[a]=s[a])}return r};function _(t){for(var e in t)delete t[e]}var h="function"==typeof Object.values?Object.values:function(t){var e=[];for(var i in t)e.push(t[i]);return e};function Mt(t){var e;for(e in t)return!1;return!e}function l(r){var t=function(t){var e=r.listener,i=r.bindTo||r.target;r.callOnce&&g(r);return e.call(i,t)};return r.boundListener=t}function u(t,e,i,r){for(var n,o=0,s=t.length;o<s;++o)if((n=t[o]).listener===e&&n.bindTo===i){r&&(n.deleteIndex=o);return n}}function c(t,e){var i=p(t);return i?i[e]:void 0}function p(t,e){var i=t.ol_lm;!i&&e&&(i=t.ol_lm={});return i}function r(t,e){var i=c(t,e);if(i){for(var r=0,n=i.length;r<n;++r){t.removeEventListener(e,i[r].boundListener);_(i[r])}i.length=0;var o=p(t);if(o){delete o[e];0===Object.keys(o).length&&delete t.ol_lm}}}function m(t,e,i,r,n){var o=p(t,!0),s=o[e];s||(s=o[e]=[]);var a=u(s,i,r,!1);if(a)n||(a.callOnce=!1);else{a={bindTo:r,callOnce:!!n,listener:i,target:t,type:e};t.addEventListener(e,l(a));s.push(a)}return a}function d(t,e,i,r){return m(t,e,i,r,!0)}function f(t,e,i,r){var n=c(t,e);if(n){var o=u(n,i,r,!0);o&&g(o)}}function g(t){if(t&&t.target){t.target.removeEventListener(t.type,t.boundListener);var e=c(t.target,t.type);if(e){var i="deleteIndex"in t?t.deleteIndex:e.indexOf(t);-1!==i&&e.splice(i,1);0===e.length&&r(t.target,t.type)}_(t)}}function v(t){var e=p(t);if(e)for(var i in e)r(t,i)}var i=function(){this.disposed_=!1};i.prototype.dispose=function(){if(!this.disposed_){this.disposed_=!0;this.disposeInternal()}};i.prototype.disposeInternal=function(){};function E(){return!0}function T(){return!1}function L(){}var S=function(t){this.propagationStopped;this.type=t;this.target=null};S.prototype.preventDefault=function(){this.propagationStopped=!0};S.prototype.stopPropagation=function(){this.propagationStopped=!0};function x(t){t.stopPropagation()}var R=function(t){function e(){t.call(this);this.pendingRemovals_={};this.dispatching_={};this.listeners_={}}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.addEventListener=function(t,e){var i=this.listeners_[t];i||(i=this.listeners_[t]=[]);-1===i.indexOf(e)&&i.push(e)};e.prototype.dispatchEvent=function(t){var e,i="string"==typeof t?new S(t):t,r=i.type,n=(i.target=this).listeners_[r];if(n){if(!(r in this.dispatching_)){this.dispatching_[r]=0;this.pendingRemovals_[r]=0}++this.dispatching_[r];for(var o=0,s=n.length;o<s;++o)if(!1===n[o].call(this,i)||i.propagationStopped){e=!1;break}--this.dispatching_[r];if(0===this.dispatching_[r]){var a=this.pendingRemovals_[r];delete this.pendingRemovals_[r];for(;a--;)this.removeEventListener(r,L);delete this.dispatching_[r]}return e}};e.prototype.disposeInternal=function(){v(this)};e.prototype.getListeners=function(t){return this.listeners_[t]};e.prototype.hasListener=function(t){return t?t in this.listeners_:0<Object.keys(this.listeners_).length};e.prototype.removeEventListener=function(t,e){var i=this.listeners_[t];if(i){var r=i.indexOf(e);if(t in this.pendingRemovals_){i[r]=L;++this.pendingRemovals_[t]}else{i.splice(r,1);0===i.length&&delete this.listeners_[t]}}};return e}(i),C={CHANGE:"change",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",ERROR:"error",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",MOUSEDOWN:"mousedown",MOUSEMOVE:"mousemove",MOUSEOUT:"mouseout",MOUSEUP:"mouseup",MOUSEWHEEL:"mousewheel",MSPOINTERDOWN:"MSPointerDown",RESIZE:"resize",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",WHEEL:"wheel"},w=function(t){function e(){t.call(this);this.revision_=0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.changed=function(){++this.revision_;this.dispatchEvent(C.CHANGE)};e.prototype.getRevision=function(){return this.revision_};e.prototype.on=function(t,e){if(Array.isArray(t)){for(var i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=m(this,t[n],e);return r}return m(this,t,e)};e.prototype.once=function(t,e){if(Array.isArray(t)){for(var i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=d(this,t[n],e);return r}return d(this,t,e)};e.prototype.un=function(t,e){if(Array.isArray(t))for(var i=0,r=t.length;i<r;++i)f(this,t[i],e);else f(this,t,e)};return e}(R);var I=function(r){function t(t,e,i){r.call(this,t);this.key=e;this.oldValue=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),O=function(e){function t(t){e.call(this);bt(this);this.values_={};void 0!==t&&this.setProperties(t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.get=function(t){var e;this.values_.hasOwnProperty(t)&&(e=this.values_[t]);return e};t.prototype.getKeys=function(){return Object.keys(this.values_)};t.prototype.getProperties=function(){return y({},this.values_)};t.prototype.notify=function(t,e){var i;i=b(t);this.dispatchEvent(new I(i,t,e));i=s.PROPERTYCHANGE;this.dispatchEvent(new I(i,t,e))};t.prototype.set=function(t,e,i){if(i)this.values_[t]=e;else{var r=this.values_[t];r!==(this.values_[t]=e)&&this.notify(t,r)}};t.prototype.setProperties=function(t,e){for(var i in t)this.set(i,t[i],e)};t.prototype.unset=function(t,e){if(t in this.values_){var i=this.values_[t];delete this.values_[t];e||this.notify(t,i)}};return t}(w),P={};function b(t){return P.hasOwnProperty(t)?P[t]:P[t]="change:"+t}var M="length",F=function(r){function t(t,e,i){r.call(this,t);this.element=e;this.index=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),N=function(o){function t(t,e){o.call(this);var i=e||{};this.unique_=!!i.unique;this.array_=t||[];if(this.unique_)for(var r=0,n=this.array_.length;r<n;++r)this.assertUnique_(this.array_[r],r);this.updateLength_()}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.clear=function(){for(;0<this.getLength();)this.pop()};t.prototype.extend=function(t){for(var e=0,i=t.length;e<i;++e)this.push(t[e]);return this};t.prototype.forEach=function(t){for(var e=this.array_,i=0,r=e.length;i<r;++i)t(e[i],i,e)};t.prototype.getArray=function(){return this.array_};t.prototype.item=function(t){return this.array_[t]};t.prototype.getLength=function(){return this.get(M)};t.prototype.insertAt=function(t,e){this.unique_&&this.assertUnique_(e);this.array_.splice(t,0,e);this.updateLength_();this.dispatchEvent(new F(a.ADD,e,t))};t.prototype.pop=function(){return this.removeAt(this.getLength()-1)};t.prototype.push=function(t){this.unique_&&this.assertUnique_(t);var e=this.getLength();this.insertAt(e,t);return this.getLength()};t.prototype.remove=function(t){for(var e=this.array_,i=0,r=e.length;i<r;++i)if(e[i]===t)return this.removeAt(i)};t.prototype.removeAt=function(t){var e=this.array_[t];this.array_.splice(t,1);this.updateLength_();this.dispatchEvent(new F(a.REMOVE,e,t));return e};t.prototype.setAt=function(t,e){var i=this.getLength();if(t<i){this.unique_&&this.assertUnique_(e,t);var r=this.array_[t];this.array_[t]=e;this.dispatchEvent(new F(a.REMOVE,r,t));this.dispatchEvent(new F(a.ADD,e,t))}else{for(var n=i;n<t;++n)this.insertAt(n,void 0);this.insertAt(t,e)}};t.prototype.updateLength_=function(){this.set(M,this.array_.length)};t.prototype.assertUnique_=function(t,e){for(var i=0,r=this.array_.length;i<r;++i)if(this.array_[i]===t&&i!==e)throw new n(58)};return t}(O);function A(t,e){if(!t)throw new n(e)}var G=function(r){function n(t){r.call(this);this.id_=void 0;this.geometryName_="geometry";this.style_=null;this.styleFunction_=void 0;this.geometryChangeKey_=null;m(this,b(this.geometryName_),this.handleGeometryChanged_,this);if(t)if("function"==typeof t.getSimplifiedGeometry){var e=t;this.setGeometry(e)}else{var i=t;this.setProperties(i)}}r&&(n.__proto__=r);((n.prototype=Object.create(r&&r.prototype)).constructor=n).prototype.clone=function(){var t=new n(this.getProperties());t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var i=this.getStyle();i&&t.setStyle(i);return t};n.prototype.getGeometry=function(){return this.get(this.geometryName_)};n.prototype.getId=function(){return this.id_};n.prototype.getGeometryName=function(){return this.geometryName_};n.prototype.getStyle=function(){return this.style_};n.prototype.getStyleFunction=function(){return this.styleFunction_};n.prototype.handleGeometryChange_=function(){this.changed()};n.prototype.handleGeometryChanged_=function(){if(this.geometryChangeKey_){g(this.geometryChangeKey_);this.geometryChangeKey_=null}var t=this.getGeometry();t&&(this.geometryChangeKey_=m(t,C.CHANGE,this.handleGeometryChange_,this));this.changed()};n.prototype.setGeometry=function(t){this.set(this.geometryName_,t)};n.prototype.setStyle=function(t){this.style_=t;this.styleFunction_=t?D(t):void 0;this.changed()};n.prototype.setId=function(t){this.id_=t;this.changed()};n.prototype.setGeometryName=function(t){f(this,b(this.geometryName_),this.handleGeometryChanged_,this);this.geometryName_=t;m(this,b(this.geometryName_),this.handleGeometryChanged_,this);this.handleGeometryChanged_()};return n}(O);function D(t){if("function"==typeof t)return t;var e;if(Array.isArray(t))e=t;else{A("function"==typeof t.getZIndex,41);e=[t]}return function(){return e}}function k(t,e,i){for(var r,n,o=i||j,s=0,a=t.length,h=!1;s<a;)if((n=+o(t[r=s+(a-s>>1)],e))<0)s=r+1;else{a=r;h=!n}return h?s:~s}function j(t,e){return e<t?1:t<e?-1:0}function U(t,e){return 0<=t.indexOf(e)}function Y(t,e,i){var r,n=t.length;if(t[0]<=e)return 0;if(e<=t[n-1])return n-1;if(0<i){for(r=1;r<n;++r)if(t[r]<e)return r-1}else if(i<0){for(r=1;r<n;++r)if(t[r]<=e)return r}else for(r=1;r<n;++r){if(t[r]==e)return r;if(t[r]<e)return t[r-1]-e<e-t[r]?r-1:r}return n-1}function X(t,e,i){for(;e<i;){var r=t[e];t[e]=t[i];t[i]=r;++e;--i}}function B(t,e){for(var i=Array.isArray(e)?e:[e],r=i.length,n=0;n<r;n++)t[t.length]=i[n]}function z(t,e){var i=t.indexOf(e),r=-1<i;r&&t.splice(i,1);return r}function V(t,e){for(var i,r=t.length>>>0,n=0;n<r;n++)if(e(i=t[n],n,t))return i;return null}function Ft(t,e){var i=t.length;if(i!==e.length)return!1;for(var r=0;r<i;r++)if(t[r]!==e[r])return!1;return!0}function W(i,r){var n;return!i.every(function(t,e){return!r(t,n=e,i)})?n:-1}function K(r,t,n){var o=t||j;return r.every(function(t,e){if(0===e)return!0;var i=o(r[e-1],t);return!(0<i||n&&0===i)})}var H={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Z={UNKNOWN:0,INTERSECTING:1,ABOVE:2,RIGHT:4,BELOW:8,LEFT:16};function q(t){for(var e=nt(),i=0,r=t.length;i<r;++i)pt(e,t[i]);return e}function J(t,e,i){if(i){i[0]=t[0]-e;i[1]=t[1]-e;i[2]=t[2]+e;i[3]=t[3]+e;return i}return[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function Q(t,e){if(e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}return t.slice()}function $(t,e,i){var r,n;return(r=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*r+(n=i<t[1]?t[1]-i:t[3]<i?i-t[3]:0)*n}function tt(t,e){return it(t,e[0],e[1])}function et(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function it(t,e,i){return t[0]<=e&&e<=t[2]&&t[1]<=i&&i<=t[3]}function rt(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=e[0],a=e[1],h=Z.UNKNOWN;s<i?h|=Z.LEFT:n<s&&(h|=Z.RIGHT);a<r?h|=Z.BELOW:o<a&&(h|=Z.ABOVE);h===Z.UNKNOWN&&(h=Z.INTERSECTING);return h}function nt(){return[1/0,1/0,-1/0,-1/0]}function ot(t,e,i,r,n){if(n){n[0]=t;n[1]=e;n[2]=i;n[3]=r;return n}return[t,e,i,r]}function st(t){return ot(1/0,1/0,-1/0,-1/0,t)}function at(t,e){var i=t[0],r=t[1];return ot(i,r,i,r,e)}function ht(t,e){return dt(st(e),t)}function lt(t,e,i,r,n){return ft(st(n),t,e,i,r)}function ut(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function ct(t,e){e[0]<t[0]&&(t[0]=e[0]);e[2]>t[2]&&(t[2]=e[2]);e[1]<t[1]&&(t[1]=e[1]);e[3]>t[3]&&(t[3]=e[3]);return t}function pt(t,e){e[0]<t[0]&&(t[0]=e[0]);e[0]>t[2]&&(t[2]=e[0]);e[1]<t[1]&&(t[1]=e[1]);e[1]>t[3]&&(t[3]=e[1])}function dt(t,e){for(var i=0,r=e.length;i<r;++i)pt(t,e[i]);return t}function ft(t,e,i,r,n){for(;i<r;i+=n)gt(t,e[i],e[i+1]);return t}function _t(t,e){for(var i=0,r=e.length;i<r;++i)dt(t,e[i]);return t}function gt(t,e,i){t[0]=Math.min(t[0],e);t[1]=Math.min(t[1],i);t[2]=Math.max(t[2],e);t[3]=Math.max(t[3],i)}function yt(t,e,i){var r;return(r=e.call(i,vt(t)))?r:(r=e.call(i,Et(t)))?r:(r=e.call(i,It(t)))?r:(r=e.call(i,wt(t)))||!1}function mt(t){var e=0;Ot(t)||(e=Lt(t)*Rt(t));return e}function vt(t){return[t[0],t[1]]}function Et(t){return[t[2],t[1]]}function Tt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function St(t,e){var i;e===H.BOTTOM_LEFT?i=vt(t):e===H.BOTTOM_RIGHT?i=Et(t):e===H.TOP_LEFT?i=wt(t):e===H.TOP_RIGHT?i=It(t):A(!1,13);return i}function xt(t,e,i,r,n){var o=e*r[0]/2,s=e*r[1]/2,a=Math.cos(i),h=Math.sin(i),l=o*a,u=o*h,c=s*a,p=s*h,d=t[0],f=t[1],_=d-l+p,g=d-l-p,y=d+l-p,m=d+l+p,v=f-u-c,E=f-u+c,T=f+u+c,S=f+u-c;return ot(Math.min(_,g,y,m),Math.min(v,E,T,S),Math.max(_,g,y,m),Math.max(v,E,T,S),n)}function Rt(t){return t[3]-t[1]}function Ct(t,e,i){var r=i||[1/0,1/0,-1/0,-1/0];if(Nt(t,e)){t[0]>e[0]?r[0]=t[0]:r[0]=e[0];t[1]>e[1]?r[1]=t[1]:r[1]=e[1];t[2]<e[2]?r[2]=t[2]:r[2]=e[2];t[3]<e[3]?r[3]=t[3]:r[3]=e[3]}else st(r);return r}function wt(t){return[t[0],t[3]]}function It(t){return[t[2],t[3]]}function Lt(t){return t[2]-t[0]}function Nt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Ot(t){return t[2]<t[0]||t[3]<t[1]}function Pt(t,e){if(e){e[0]=t[0];e[1]=t[1];e[2]=t[2];e[3]=t[3];return e}return t}function At(t,e){var i=(t[2]-t[0])/2*(e-1),r=(t[3]-t[1])/2*(e-1);t[0]-=i;t[2]+=i;t[1]-=r;t[3]+=r}function Gt(t,e,i){var r=!1,n=rt(t,e),o=rt(t,i);if(n===Z.INTERSECTING||o===Z.INTERSECTING)r=!0;else{var s,a,h=t[0],l=t[1],u=t[2],c=t[3],p=e[0],d=e[1],f=i[0],_=i[1],g=(_-d)/(f-p);o&Z.ABOVE&&!(n&Z.ABOVE)&&(r=h<=(s=f-(_-c)/g)&&s<=u);r||!(o&Z.RIGHT)||n&Z.RIGHT||(r=l<=(a=_-(f-u)*g)&&a<=c);r||!(o&Z.BELOW)||n&Z.BELOW||(r=h<=(s=f-(_-l)/g)&&s<=u);r||!(o&Z.LEFT)||n&Z.LEFT||(r=l<=(a=_-(f-h)*g)&&a<=c)}return r}function Dt(t,e,i){var r,n,o,s=[t[0],t[1],t[0],t[3],t[2],t[1],t[2],t[3]];e(s,s,2);return r=[s[0],s[2],s[4],s[6]],n=[s[1],s[3],s[5],s[7]],o=i,ot(Math.min.apply(null,r),Math.min.apply(null,n),Math.max.apply(null,r),Math.max.apply(null,n),o)}var kt={XY:"XY",XYZ:"XYZ",XYM:"XYM",XYZM:"XYZM"},jt={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};function Ut(t,e,i,r,n,o){for(var s=o||[],a=0,h=e;h<i;h+=r){var l=t[h],u=t[h+1];s[a++]=n[0]*l+n[2]*u+n[4];s[a++]=n[1]*l+n[3]*u+n[5]}o&&s.length!=a&&(s.length=a);return s}function Yt(t,e,i,r,n,o,s){for(var a=s||[],h=Math.cos(n),l=Math.sin(n),u=o[0],c=o[1],p=0,d=e;d<i;d+=r){var f=t[d]-u,_=t[d+1]-c;a[p++]=u+f*h-_*l;a[p++]=c+f*l+_*h;for(var g=d+2;g<d+r;++g)a[p++]=t[g]}s&&a.length!=p&&(a.length=p);return a}function Xt(t,e,i,r,n,o,s,a){for(var h=a||[],l=s[0],u=s[1],c=0,p=e;p<i;p+=r){var d=t[p]-l,f=t[p+1]-u;h[c++]=l+n*d;h[c++]=u+o*f;for(var _=p+2;_<p+r;++_)h[c++]=t[_]}a&&h.length!=c&&(h.length=c);return h}function Bt(t,e,i,r,n,o,s){for(var a=s||[],h=0,l=e;l<i;l+=r){a[h++]=t[l]+n;a[h++]=t[l+1]+o;for(var u=l+2;u<l+r;++u)a[h++]=t[u]}s&&a.length!=h&&(a.length=h);return a}function zt(t,e,i){return Math.min(Math.max(t,e),i)}var Vt="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2};function Wt(t,e,i,r,n,o){var s=n-i,a=o-r;if(0!==s||0!==a){var h=((t-i)*s+(e-r)*a)/(s*s+a*a);if(1<h){i=n;r=o}else if(0<h){i+=s*h;r+=a*h}}return Kt(t,e,i,r)}function Kt(t,e,i,r){var n=i-t,o=r-e;return n*n+o*o}function Ht(t){for(var e=t.length,i=0;i<e;i++){for(var r=i,n=Math.abs(t[i][i]),o=i+1;o<e;o++){var s=Math.abs(t[o][i]);if(n<s){n=s;r=o}}if(0===n)return null;var a=t[r];t[r]=t[i];t[i]=a;for(var h=i+1;h<e;h++)for(var l=-t[h][i]/t[i][i],u=i;u<e+1;u++)i==u?t[h][u]=0:t[h][u]+=l*t[i][u]}for(var c=new Array(e),p=e-1;0<=p;p--){c[p]=t[p][e]/t[p][p];for(var d=p-1;0<=d;d--)t[d][e]-=t[d][p]*c[p]}return c}function Zt(t){return 180*t/Math.PI}function qt(t){return t*Math.PI/180}function Jt(t,e){var i=t%e;return i*e<0?i+e:i}function Qt(t,e,i){return t+i*(e-t)}var $t=6371008.8;function te(t,e,i){var r=i||$t,n=qt(t[1]),o=qt(e[1]),s=(o-n)/2,a=qt(e[0]-t[0])/2,h=Math.sin(s)*Math.sin(s)+Math.sin(a)*Math.sin(a)*Math.cos(n)*Math.cos(o);return 2*r*Math.atan2(Math.sqrt(h),Math.sqrt(1-h))}function ee(t,e){for(var i=0,r=0,n=t.length;r<n-1;++r)i+=te(t[r],t[r+1],e);return i}function ie(t,e){for(var i=0,r=t.length,n=t[r-1][0],o=t[r-1][1],s=0;s<r;s++){var a=t[s][0],h=t[s][1];i+=qt(a-n)*(2+Math.sin(qt(o))+Math.sin(qt(h)));n=a;o=h}return i*e*e/2}function re(t,e,i,r){var n=r||$t,o=qt(t[1]),s=qt(t[0]),a=e/n,h=Math.asin(Math.sin(o)*Math.cos(a)+Math.cos(o)*Math.sin(a)*Math.cos(i));return[Zt(s+Math.atan2(Math.sin(i)*Math.sin(a)*Math.cos(o),Math.cos(a)-Math.sin(o)*Math.sin(h))),Zt(h)]}var ne={DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"},oe={};oe[ne.DEGREES]=2*Math.PI*6370997/360;oe[ne.FEET]=.3048;oe[ne.METERS]=1;oe[ne.USFEET]=1200/3937;var se=function(t){this.code_=t.code;this.units_=t.units;this.extent_=void 0!==t.extent?t.extent:null;this.worldExtent_=void 0!==t.worldExtent?t.worldExtent:null;this.axisOrientation_=void 0!==t.axisOrientation?t.axisOrientation:"enu";this.global_=void 0!==t.global&&t.global;this.canWrapX_=!(!this.global_||!this.extent_);this.getPointResolutionFunc_=t.getPointResolution;this.defaultTileGrid_=null;this.metersPerUnit_=t.metersPerUnit};se.prototype.canWrapX=function(){return this.canWrapX_};se.prototype.getCode=function(){return this.code_};se.prototype.getExtent=function(){return this.extent_};se.prototype.getUnits=function(){return this.units_};se.prototype.getMetersPerUnit=function(){return this.metersPerUnit_||oe[this.units_]};se.prototype.getWorldExtent=function(){return this.worldExtent_};se.prototype.getAxisOrientation=function(){return this.axisOrientation_};se.prototype.isGlobal=function(){return this.global_};se.prototype.setGlobal=function(t){this.global_=t;this.canWrapX_=!(!t||!this.extent_)};se.prototype.getDefaultTileGrid=function(){return this.defaultTileGrid_};se.prototype.setDefaultTileGrid=function(t){this.defaultTileGrid_=t};se.prototype.setExtent=function(t){this.extent_=t;this.canWrapX_=!(!this.global_||!t)};se.prototype.setWorldExtent=function(t){this.worldExtent_=t};se.prototype.setGetPointResolution=function(t){this.getPointResolutionFunc_=t};se.prototype.getPointResolutionFunc=function(){return this.getPointResolutionFunc_};var ae=6378137,he=Math.PI*ae,le=[-he,-he,he,he],ue=[-180,-85,180,85],ce=function(e){function t(t){e.call(this,{code:t,units:ne.METERS,extent:le,global:!0,worldExtent:ue,getPointResolution:function(t,e){return t/Vt(e[1]/ae)}})}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(se),pe=[new ce("EPSG:3857"),new ce("EPSG:102100"),new ce("EPSG:102113"),new ce("EPSG:900913"),new ce("urn:ogc:def:crs:EPSG:6.18:3:3857"),new ce("urn:ogc:def:crs:EPSG::3857"),new ce("http://www.opengis.net/gml/srs/epsg.xml#3857")];function de(t,e,i){var r=t.length,n=1<i?i:2,o=e;void 0===o&&(o=2<n?t.slice():new Array(r));for(var s=he,a=0;a<r;a+=n){o[a]=s*t[a]/180;var h=ae*Math.log(Math.tan(Math.PI*(t[a+1]+90)/360));s<h?h=s:h<-s&&(h=-s);o[a+1]=h}return o}function fe(t,e,i){var r=t.length,n=1<i?i:2,o=e;void 0===o&&(o=2<n?t.slice():new Array(r));for(var s=0;s<r;s+=n){o[s]=180*t[s]/he;o[s+1]=360*Math.atan(Math.exp(t[s+1]/ae))/Math.PI-90}return o}var _e=[-180,-90,180,90],ge=6378137*Math.PI/180,ye=function(i){function t(t,e){i.call(this,{code:t,units:ne.DEGREES,extent:_e,axisOrientation:e,global:!0,metersPerUnit:ge,worldExtent:_e})}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(se),me=[new ye("CRS:84"),new ye("EPSG:4326","neu"),new ye("urn:ogc:def:crs:EPSG::4326","neu"),new ye("urn:ogc:def:crs:EPSG:6.6:4326","neu"),new ye("urn:ogc:def:crs:OGC:1.3:CRS84"),new ye("urn:ogc:def:crs:OGC:2:84"),new ye("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new ye("urn:x-ogc:def:crs:EPSG:4326","neu")],ve={};function Ee(){ve={}}function Te(t){return ve[t]||null}function Se(t,e){ve[t]=e}var xe={};function Re(){xe={}}function Ce(t,e,i){var r=t.getCode(),n=e.getCode();r in xe||(xe[r]={});xe[r][n]=i}function we(t,e){var i;t in xe&&e in xe[t]&&(i=xe[t][e]);return i}function Ie(t,e,i){var r;if(void 0!==e){for(var n=0,o=t.length;n<o;++n)e[n]=t[n];r=e}else r=t.slice();return r}function Le(t,e,i){if(void 0!==e&&t!==e){for(var r=0,n=t.length;r<n;++r)e[r]=t[r];t=e}return t}function Oe(t){Se(t.getCode(),t);Ce(t,t,Ie)}function Pe(t){t.forEach(Oe)}function be(t){return"string"==typeof t?Te(t):t||null}function Me(t,e,i,r){var n,o=(t=be(t)).getPointResolutionFunc();if(o)n=o(e,i);else{if(t.getUnits()==ne.DEGREES&&!r||r==ne.DEGREES)n=e;else{var s=je(t,be("EPSG:4326")),a=[i[0]-e/2,i[1],i[0]+e/2,i[1],i[0],i[1]-e/2,i[0],i[1]+e/2];n=(te((a=s(a,a,2)).slice(0,2),a.slice(2,4))+te(a.slice(4,6),a.slice(6,8)))/2;var h=r?oe[r]:t.getMetersPerUnit();void 0!==h&&(n/=h)}}return n}function Fe(t){Pe(t);t.forEach(function(e){t.forEach(function(t){e!==t&&Ce(e,t,Ie)})})}function Ne(t,i,r,n){t.forEach(function(e){i.forEach(function(t){Ce(e,t,r);Ce(t,e,n)})})}function Ae(t,e){return t?"string"==typeof t?be(t):t:be(e)}function Ge(l){return function(t,e,i){for(var r=t.length,n=void 0!==i?i:2,o=void 0!==e?e:new Array(r),s=0;s<r;s+=n){var a=l([t[s],t[s+1]]);o[s]=a[0];o[s+1]=a[1];for(var h=n-1;2<=h;--h)o[s+h]=t[s+h]}return o}}function De(t,e,i,r){var n=be(t),o=be(e);Ce(n,o,Ge(i));Ce(o,n,Ge(r))}function ke(t,e){if(t===e)return!0;var i=t.getUnits()===e.getUnits();return t.getCode()===e.getCode()?i:je(t,e)===Ie&&i}function je(t,e){var i=we(t.getCode(),e.getCode());i||(i=Le);return i}function Ue(t,e){return je(be(t),be(e))}function Ye(t,e,i){return Ue(e,i)(t,void 0,t.length)}function Xe(t,e,i){return Dt(t,Ue(e,i))}function Be(){Fe(pe);Fe(me);Ne(me,pe,de,fe)}Be();var ze=new Array(6);function Ve(){return[1,0,0,1,0,0]}function We(t){return He(t,1,0,0,1,0,0)}function Ke(t,e){var i=t[0],r=t[1],n=t[2],o=t[3],s=t[4],a=t[5],h=e[0],l=e[1],u=e[2],c=e[3],p=e[4],d=e[5];t[0]=i*h+n*l;t[1]=r*h+o*l;t[2]=i*u+n*c;t[3]=r*u+o*c;t[4]=i*p+n*d+s;t[5]=r*p+o*d+a;return t}function He(t,e,i,r,n,o,s){t[0]=e;t[1]=i;t[2]=r;t[3]=n;t[4]=o;t[5]=s;return t}function Ze(t,e){t[0]=e[0];t[1]=e[1];t[2]=e[2];t[3]=e[3];t[4]=e[4];t[5]=e[5];return t}function qe(t,e){var i=e[0],r=e[1];e[0]=t[0]*i+t[2]*r+t[4];e[1]=t[1]*i+t[3]*r+t[5];return e}function Je(t,e){var i=Math.cos(e),r=Math.sin(e);return Ke(t,He(ze,i,r,-r,i,0,0))}function Qe(t,e,i){return Ke(t,He(ze,e,0,0,i,0,0))}function $e(t,e,i){return He(t,e,0,0,i,0,0)}function ti(t,e,i){return Ke(t,He(ze,1,0,0,1,e,i))}function ei(t,e,i,r,n,o,s,a){var h=Math.sin(o),l=Math.cos(o);t[0]=r*l;t[1]=n*h;t[2]=-r*h;t[3]=n*l;t[4]=s*r*l-a*r*h+e;t[5]=s*n*h+a*n*l+i;return t}function ii(t,e){var i=ri(e);A(0!==i,32);var r=e[0],n=e[1],o=e[2],s=e[3],a=e[4],h=e[5];t[0]=s/i;t[1]=-n/i;t[2]=-o/i;t[3]=r/i;t[4]=(o*h-s*a)/i;t[5]=-(r*h-n*a)/i;return t}function ri(t){return t[0]*t[3]-t[1]*t[2]}function ni(t){return"matrix("+t.join(", ")+")"}var oi=[1,0,0,1,0,0],si=function(t){function e(){t.call(this);this.extent_=[1/0,1/0,-1/0,-1/0];this.extentRevision_=-1;this.simplifiedGeometryCache={};this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.clone=function(){return o()};e.prototype.closestPointXY=function(t,e,i,r){return o()};e.prototype.containsXY=function(t,e){var i=this.getClosestPoint([t,e]);return i[0]===t&&i[1]===e};e.prototype.getClosestPoint=function(t,e){var i=e||[NaN,NaN];this.closestPointXY(t[0],t[1],i,1/0);return i};e.prototype.intersectsCoordinate=function(t){return this.containsXY(t[0],t[1])};e.prototype.computeExtent=function(t){return o()};e.prototype.getExtent=function(t){if(this.extentRevision_!=this.getRevision()){this.extent_=this.computeExtent(this.extent_);this.extentRevision_=this.getRevision()}return Pt(this.extent_,t)};e.prototype.rotate=function(t,e){o()};e.prototype.scale=function(t,e,i){o()};e.prototype.simplify=function(t){return this.getSimplifiedGeometry(t*t)};e.prototype.getSimplifiedGeometry=function(t){return o()};e.prototype.getType=function(){return o()};e.prototype.applyTransform=function(t){o()};e.prototype.intersectsExtent=function(t){return o()};e.prototype.translate=function(t,e){o()};e.prototype.transform=function(t,s){var a=be(t),e=a.getUnits()==ne.TILE_PIXELS?function(t,e,i){var r=a.getExtent(),n=a.getWorldExtent(),o=Rt(n)/Rt(r);ei(oi,n[0],n[3],o,-o,0,0,0);Ut(t,0,t.length,i,oi,e);return Ue(a,s)(t,e,i)}:Ue(a,s);this.applyTransform(e);return this};return e}(O),ai=function(t){function e(){t.call(this);this.layout=kt.XY;this.stride=2;this.flatCoordinates=null}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.computeExtent=function(t){return lt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};e.prototype.getCoordinates=function(){return o()};e.prototype.getFirstCoordinate=function(){return this.flatCoordinates.slice(0,this.stride)};e.prototype.getFlatCoordinates=function(){return this.flatCoordinates};e.prototype.getLastCoordinate=function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)};e.prototype.getLayout=function(){return this.layout};e.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()){_(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];var i=this.getSimplifiedGeometryInternal(t);if(i.getFlatCoordinates().length<this.flatCoordinates.length)return this.simplifiedGeometryCache[e]=i;this.simplifiedGeometryMaxMinSquaredTolerance=t;return this};e.prototype.getSimplifiedGeometryInternal=function(t){return this};e.prototype.getStride=function(){return this.stride};e.prototype.setFlatCoordinates=function(t,e){this.stride=hi(t);this.layout=t;this.flatCoordinates=e};e.prototype.setCoordinates=function(t,e){o()};e.prototype.setLayout=function(t,e,i){var r;if(t)r=hi(t);else{for(var n=0;n<i;++n){if(0===e.length){this.layout=kt.XY;this.stride=2;return}e=e[0]}t=function(t){var e;2==t?e=kt.XY:3==t?e=kt.XYZ:4==t&&(e=kt.XYZM);return e}(r=e.length)}this.layout=t;this.stride=r};e.prototype.applyTransform=function(t){if(this.flatCoordinates){t(this.flatCoordinates,this.flatCoordinates,this.stride);this.changed()}};e.prototype.rotate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();Yt(i,0,i.length,r,t,e,i);this.changed()}};e.prototype.scale=function(t,e,i){var r=e;void 0===r&&(r=t);var n=i;n||(n=Tt(this.getExtent()));var o=this.getFlatCoordinates();if(o){var s=this.getStride();Xt(o,0,o.length,s,t,r,n,o);this.changed()}};e.prototype.translate=function(t,e){var i=this.getFlatCoordinates();if(i){var r=this.getStride();Bt(i,0,i.length,r,t,e,i);this.changed()}};return e}(si);function hi(t){var e;t==kt.XY?e=2:t==kt.XYZ||t==kt.XYM?e=3:t==kt.XYZM&&(e=4);return e}function li(t,e,i){var r=t.getFlatCoordinates();if(r){var n=t.getStride();return Ut(r,0,r.length,n,e,i)}return null}function ui(t,e,i,r){for(var n=0,o=t[i-r],s=t[i-r+1];e<i;e+=r){var a=t[e],h=t[e+1];n+=s*a-o*h;o=a;s=h}return n/2}function ci(t,e,i,r){for(var n=0,o=0,s=i.length;o<s;++o){var a=i[o];n+=ui(t,e,a,r);e=a}return n}function pi(t,e,i,r){for(var n=0,o=0,s=i.length;o<s;++o){var a=i[o];n+=ci(t,e,a,r);e=a[a.length-1]}return n}function di(t,e,i,r,n,o,s){var a,h=t[e],l=t[e+1],u=t[i]-h,c=t[i+1]-l;if(0===u&&0===c)a=e;else{var p=((n-h)*u+(o-l)*c)/(u*u+c*c);if(1<p)a=i;else{if(0<p){for(var d=0;d<r;++d)s[d]=Qt(t[e+d],t[i+d],p);s.length=r;return}a=e}}for(var f=0;f<r;++f)s[f]=t[a+f];s.length=r}function fi(t,e,i,r,n){var o=t[e],s=t[e+1];for(e+=r;e<i;e+=r){var a=t[e],h=t[e+1],l=Kt(o,s,a,h);n<l&&(n=l);o=a;s=h}return n}function _i(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o){var a=i[o];n=fi(t,e,a,r,n);e=a}return n}function gi(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o){var a=i[o];n=_i(t,e,a,r,n);e=a[a.length-1]}return n}function yi(t,e,i,r,n,o,s,a,h,l,u){if(e==i)return l;var c,p;if(0===n){if((p=Kt(s,a,t[e],t[e+1]))<l){for(c=0;c<r;++c)h[c]=t[e+c];h.length=r;return p}return l}for(var d=u||[NaN,NaN],f=e+r;f<i;){di(t,f-r,f,r,s,a,d);if((p=Kt(s,a,d[0],d[1]))<l){l=p;for(c=0;c<r;++c)h[c]=d[c];f+=h.length=r}else f+=r*Math.max((Math.sqrt(p)-Math.sqrt(l))/n|0,1)}if(o){di(t,i-r,e,r,s,a,d);if((p=Kt(s,a,d[0],d[1]))<l){l=p;for(c=0;c<r;++c)h[c]=d[c];h.length=r}}return l}function mi(t,e,i,r,n,o,s,a,h,l,u){for(var c=u||[NaN,NaN],p=0,d=i.length;p<d;++p){var f=i[p];l=yi(t,e,f,r,n,o,s,a,h,l,c);e=f}return l}function vi(t,e,i,r,n,o,s,a,h,l,u){for(var c=u||[NaN,NaN],p=0,d=i.length;p<d;++p){var f=i[p];l=mi(t,e,f,r,n,o,s,a,h,l,c);e=f[f.length-1]}return l}function Ei(t,e,i,r){for(var n=0,o=i.length;n<o;++n)t[e++]=i[n];return e}function Ti(t,e,i,r){for(var n=0,o=i.length;n<o;++n)for(var s=i[n],a=0;a<r;++a)t[e++]=s[a];return e}function Si(t,e,i,r,n){for(var o=n||[],s=0,a=0,h=i.length;a<h;++a){var l=Ti(t,e,i[a],r);e=o[s++]=l}o.length=s;return o}function xi(t,e,i,r,n){for(var o=n||[],s=0,a=0,h=i.length;a<h;++a){var l=Si(t,e,i[a],r,o[s]);e=(o[s++]=l)[l.length-1]}o.length=s;return o}function Ri(t,e,i,r,n){for(var o=void 0!==n?n:[],s=0,a=e;a<i;a+=r)o[s++]=t.slice(a,a+r);o.length=s;return o}function Ci(t,e,i,r,n){for(var o=void 0!==n?n:[],s=0,a=0,h=i.length;a<h;++a){var l=i[a];o[s++]=Ri(t,e,l,r,o[s]);e=l}o.length=s;return o}function wi(t,e,i,r,n){for(var o=void 0!==n?n:[],s=0,a=0,h=i.length;a<h;++a){var l=i[a];o[s++]=Ci(t,e,l,r,o[s]);e=l[l.length-1]}o.length=s;return o}function Ii(t,e,i,r,n,o,s){var a=(i-e)/r;if(a<3){for(;e<i;e+=r){o[s++]=t[e];o[s++]=t[e+1]}return s}var h=new Array(a);h[0]=1;h[a-1]=1;for(var l=[e,i-r],u=0;0<l.length;){for(var c=l.pop(),p=l.pop(),d=0,f=t[p],_=t[p+1],g=t[c],y=t[c+1],m=p+r;m<c;m+=r){var v=Wt(t[m],t[m+1],f,_,g,y);if(d<v){u=m;d=v}}if(n<d){h[(u-e)/r]=1;p+r<u&&l.push(p,u);u+r<c&&l.push(u,c)}}for(var E=0;E<a;++E)if(h[E]){o[s++]=t[e+E*r];o[s++]=t[e+E*r+1]}return s}function Li(t,e,i,r,n,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h];s=Ii(t,e,u,r,n,o,s);a.push(s);e=u}return s}function Oi(t,e,i,r,n,o,s){if(i<=e+r){for(;e<i;e+=r){o[s++]=t[e];o[s++]=t[e+1]}return s}var a=t[e],h=t[e+1],l=o[s++]=a,u=o[s++]=h;for(e+=r;e<i;e+=r)if(Kt(a,h,l=t[e],u=t[e+1])>n){a=o[s++]=l;h=o[s++]=u}if(l!=a||u!=h){o[s++]=l;o[s++]=u}return s}function Pi(t,e){return e*Math.round(t/e)}function bi(t,e,i,r,n,o,s){if(e==i)return s;var a,h,l=Pi(t[e],n),u=Pi(t[e+1],n);e+=r;o[s++]=l;o[s++]=u;do{a=Pi(t[e],n);h=Pi(t[e+1],n);if((e+=r)==i){o[s++]=a;o[s++]=h;return s}}while(a==l&&h==u);for(;e<i;){var c=Pi(t[e],n),p=Pi(t[e+1],n);e+=r;if(c!=a||p!=h){var d=a-l,f=h-u,_=c-l,g=p-u;if(d*g==f*_&&(d<0&&_<d||d==_||0<d&&d<_)&&(f<0&&g<f||f==g||0<f&&f<g)){a=c;h=p}else{l=o[s++]=a;u=o[s++]=h;a=c;h=p}}}o[s++]=a;o[s++]=h;return s}function Mi(t,e,i,r,n,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h];s=bi(t,e,u,r,n,o,s);a.push(s);e=u}return s}function Fi(t,e,i,r,n,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h],c=[];s=Mi(t,e,u,r,n,o,s,c);a.push(c);e=u[u.length-1]}return s}var Ni=function(i){function r(t,e){i.call(this);this.maxDelta_=-1;this.maxDeltaRevision_=-1;void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}i&&(r.__proto__=i);((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)};r.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,i,r)};r.prototype.getArea=function(){return ui(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getCoordinates=function(){return Ri(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];e.length=Ii(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0);return new r(e,kt.XY)};r.prototype.getType=function(){return jt.LINEAR_RING};r.prototype.intersectsExtent=function(t){return!1};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=Ti(this.flatCoordinates,0,t,this.stride);this.changed()};return r}(ai),Ai=function(i){function t(t,e){i.call(this);this.setCoordinates(t,e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)};t.prototype.closestPointXY=function(t,e,i,r){var n=this.flatCoordinates,o=Kt(t,e,n[0],n[1]);if(o<r){for(var s=this.stride,a=0;a<s;++a)i[a]=n[a];i.length=s;return o}return r};t.prototype.getCoordinates=function(){return this.flatCoordinates?this.flatCoordinates.slice():[]};t.prototype.computeExtent=function(t){return at(this.flatCoordinates,t)};t.prototype.getType=function(){return jt.POINT};t.prototype.intersectsExtent=function(t){return it(t,this.flatCoordinates[0],this.flatCoordinates[1])};t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,0);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=Ei(this.flatCoordinates,0,t,this.stride);this.changed()};return t}(ai);function Gi(e,i,r,n,t){return!yt(t,function(t){return!Di(e,i,r,n,t[0],t[1])})}function Di(t,e,i,r,n,o){for(var s=0,a=t[i-r],h=t[i-r+1];e<i;e+=r){var l=t[e],u=t[e+1];h<=o?o<u&&0<(l-a)*(o-h)-(n-a)*(u-h)&&s++:u<=o&&(l-a)*(o-h)-(n-a)*(u-h)<0&&s--;a=l;h=u}return 0!==s}function ki(t,e,i,r,n,o){if(0===i.length)return!1;if(!Di(t,e,i[0],r,n,o))return!1;for(var s=1,a=i.length;s<a;++s)if(Di(t,i[s-1],i[s],r,n,o))return!1;return!0}function ji(t,e,i,r,n,o){if(0===i.length)return!1;for(var s=0,a=i.length;s<a;++s){var h=i[s];if(ki(t,e,h,r,n,o))return!0;e=h[h.length-1]}return!1}function Ui(t,e,i,r,n,o,s){for(var a,h,l,u,c,p,d,f=n[o+1],_=[],g=0,y=i.length;g<y;++g){var m=i[g];u=t[m-r];p=t[m-r+1];for(a=e;a<m;a+=r){c=t[a];d=t[a+1];if(f<=p&&d<=f||p<=f&&f<=d){l=(f-p)/(d-p)*(c-u)+u;_.push(l)}u=c;p=d}}var v=NaN,E=-1/0;_.sort(j);u=_[0];for(a=1,h=_.length;a<h;++a){c=_[a];var T=Math.abs(c-u);if(E<T&&ki(t,e,i,r,l=(u+c)/2,f)){v=l;E=T}u=c}isNaN(v)&&(v=n[o]);if(s){s.push(v,f,E);return s}return[v,f,E]}function Yi(t,e,i,r,n){for(var o=[],s=0,a=i.length;s<a;++s){var h=i[s];o=Ui(t,e,h,r,n,2*s,o);e=h[h.length-1]}return o}function Xi(t,e,i,r,n,o){for(var s,a=[t[e],t[e+1]],h=[];e+r<i;e+=r){h[0]=t[e+r];h[1]=t[e+r+1];if(s=n.call(o,a,h))return s;a[0]=h[0];a[1]=h[1]}return!1}function Bi(t,e,i,r,n){var o=ft([1/0,1/0,-1/0,-1/0],t,e,i,r);return!!Nt(n,o)&&(!!et(n,o)||(o[0]>=n[0]&&o[2]<=n[2]||(o[1]>=n[1]&&o[3]<=n[3]||Xi(t,e,i,r,function(t,e){return Gt(n,t,e)}))))}function zi(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o){if(Bi(t,e,i[o],r,n))return!0;e=i[o]}return!1}function Vi(t,e,i,r,n){return!!Bi(t,e,i,r,n)||(!!Di(t,e,i,r,n[0],n[1])||(!!Di(t,e,i,r,n[0],n[3])||(!!Di(t,e,i,r,n[2],n[1])||!!Di(t,e,i,r,n[2],n[3]))))}function Wi(t,e,i,r,n){if(!Vi(t,e,i[0],r,n))return!1;if(1===i.length)return!0;for(var o=1,s=i.length;o<s;++o)if(Gi(t,i[o-1],i[o],r,n)&&!Bi(t,i[o-1],i[o],r,n))return!1;return!0}function Ki(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o){var a=i[o];if(Wi(t,e,a,r,n))return!0;e=a[a.length-1]}return!1}function Hi(t,e,i,r){for(;e<i-r;){for(var n=0;n<r;++n){var o=t[e+n];t[e+n]=t[i-r+n];t[i-r+n]=o}e+=r;i-=r}}function Zi(t,e,i,r){for(var n=0,o=t[i-r],s=t[i-r+1];e<i;e+=r){var a=t[e],h=t[e+1];n+=(a-o)*(h+s);o=a;s=h}return 0<n}function qi(t,e,i,r,n){for(var o=void 0!==n&&n,s=0,a=i.length;s<a;++s){var h=i[s],l=Zi(t,e,h,r);if(0===s){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;e=h}return!0}function Ji(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o)if(!qi(t,e,i[o],r,n))return!1;return!0}function Qi(t,e,i,r,n){for(var o=void 0!==n&&n,s=0,a=i.length;s<a;++s){var h=i[s],l=Zi(t,e,h,r);(0===s?o&&l||!o&&!l:o&&!l||!o&&l)&&Hi(t,e,h,r);e=h}return e}function $i(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o)e=Qi(t,e,i[o],r,n);return e}var tr=function(r){function n(t,e,i){r.call(this);this.ends_=[];this.flatInteriorPointRevision_=-1;this.flatInteriorPoint_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.ends_=i}else this.setCoordinates(t,e)}r&&(n.__proto__=r);((n.prototype=Object.create(r&&r.prototype)).constructor=n).prototype.appendLinearRing=function(t){this.flatCoordinates?B(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};n.prototype.clone=function(){return new n(this.flatCoordinates.slice(),this.layout,this.ends_.slice())};n.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(_i(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return mi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,i,r)};n.prototype.containsXY=function(t,e){return ki(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)};n.prototype.getArea=function(){return ci(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)};n.prototype.getCoordinates=function(t){var e;void 0!==t?Qi(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates;return Ci(e,0,this.ends_,this.stride)};n.prototype.getEnds=function(){return this.ends_};n.prototype.getFlatInteriorPoint=function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Tt(this.getExtent());this.flatInteriorPoint_=Ui(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0);this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_};n.prototype.getInteriorPoint=function(){return new Ai(this.getFlatInteriorPoint(),kt.XYM)};n.prototype.getLinearRingCount=function(){return this.ends_.length};n.prototype.getLinearRing=function(t){return t<0||this.ends_.length<=t?null:new Ni(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)};n.prototype.getLinearRings=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.ends_,r=[],n=0,o=0,s=i.length;o<s;++o){var a=i[o],h=new Ni(e.slice(n,a),t);r.push(h);n=a}return r};n.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;if(qi(t,0,this.ends_,this.stride))this.orientedFlatCoordinates_=t;else{this.orientedFlatCoordinates_=t.slice();this.orientedFlatCoordinates_.length=Qi(this.orientedFlatCoordinates_,0,this.ends_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};n.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=Mi(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,i);return new n(e,kt.XY,i)};n.prototype.getType=function(){return jt.POLYGON};n.prototype.intersectsExtent=function(t){return Wi(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)};n.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2);this.flatCoordinates||(this.flatCoordinates=[]);var i=Si(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1];this.changed()};return n}(ai);function er(t,e,i,r){for(var n=i||32,o=[],s=0;s<n;++s)B(o,re(t,e,2*Math.PI*s/n,r));o.push(o[0],o[1]);return new tr(o,kt.XY,[o.length])}function ir(t){var e=t[0],i=t[1],r=t[2],n=t[3],o=[e,i,e,n,r,n,r,i,e,i];return new tr(o,kt.XY,[o.length])}function rr(t,e,i){for(var r=e||32,n=t.getStride(),o=t.getLayout(),s=t.getCenter(),a=n*(r+1),h=new Array(a),l=0;l<a;l+=n){h[l]=0;h[l+1]=0;for(var u=2;u<n;u++)h[l+u]=s[u]}var c=[h.length],p=new tr(h,o,c);nr(p,s,t.getRadius(),i);return p}function nr(t,e,i,r){for(var n=t.getFlatCoordinates(),o=t.getStride(),s=n.length/o-1,a=r||0,h=0;h<=s;++h){var l=h*o,u=a+2*Jt(h,s)*Math.PI/s;n[l]=e[0]+i*Math.cos(u);n[l+1]=e[1]+i*Math.sin(u)}t.changed()}var or=35048,sr=5126,ar=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function hr(t,e){for(var i=ar.length,r=0;r<i;++r)try{var n=t.getContext(ar[r],e);if(n)return n}catch(t){}return null}var lr,ur;if("undefined"!=typeof window&&"WebGLRenderingContext"in window)try{var cr=hr(document.createElement("canvas"));if(cr){lr=cr.getParameter(cr.MAX_TEXTURE_SIZE);ur=cr.getSupportedExtensions()}}catch(t){}var pr="undefined"!=typeof navigator?navigator.userAgent.toLowerCase():"",dr=-1!==pr.indexOf("firefox"),fr=-1!==pr.indexOf("safari")&&-1==pr.indexOf("chrom"),_r=-1!==pr.indexOf("webkit")&&-1==pr.indexOf("edge"),gr=-1!==pr.indexOf("macintosh"),yr=window.devicePixelRatio||1,mr="geolocation"in navigator,vr="ontouchstart"in window,Er="PointerEvent"in window,Tr=!!navigator.msPointerEnabled,Sr="accuracy",xr="accuracyGeometry",Rr="altitude",Cr="altitudeAccuracy",wr="heading",Ir="position",Lr="projection",Or="speed",Pr="tracking",br="trackingOptions",Mr=function(e){function t(t){e.call(this,C.ERROR);this.code=t.code;this.message=t.message}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(S),Fr=function(i){function t(t){i.call(this);var e=t||{};this.position_=null;this.transform_=Le;this.watchId_=void 0;m(this,b(Lr),this.handleProjectionChanged_,this);m(this,b(Pr),this.handleTrackingChanged_,this);void 0!==e.projection&&this.setProjection(e.projection);void 0!==e.trackingOptions&&this.setTrackingOptions(e.trackingOptions);this.setTracking(void 0!==e.tracking&&e.tracking)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.disposeInternal=function(){this.setTracking(!1);i.prototype.disposeInternal.call(this)};t.prototype.handleProjectionChanged_=function(){var t=this.getProjection();if(t){this.transform_=je(be("EPSG:4326"),t);this.position_&&this.set(Ir,this.transform_(this.position_))}};t.prototype.handleTrackingChanged_=function(){if(mr){var t=this.getTracking();if(t&&void 0===this.watchId_)this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions());else if(!t&&void 0!==this.watchId_){navigator.geolocation.clearWatch(this.watchId_);this.watchId_=void 0}}};t.prototype.positionChange_=function(t){var e=t.coords;this.set(Sr,e.accuracy);this.set(Rr,null===e.altitude?void 0:e.altitude);this.set(Cr,null===e.altitudeAccuracy?void 0:e.altitudeAccuracy);this.set(wr,null===e.heading?void 0:qt(e.heading));if(this.position_){this.position_[0]=e.longitude;this.position_[1]=e.latitude}else this.position_=[e.longitude,e.latitude];var i=this.transform_(this.position_);this.set(Ir,i);this.set(Or,null===e.speed?void 0:e.speed);var r=er(this.position_,e.accuracy);r.applyTransform(this.transform_);this.set(xr,r);this.changed()};t.prototype.positionError_=function(t){this.setTracking(!1);this.dispatchEvent(new Mr(t))};t.prototype.getAccuracy=function(){return this.get(Sr)};t.prototype.getAccuracyGeometry=function(){return this.get(xr)||null};t.prototype.getAltitude=function(){return this.get(Rr)};t.prototype.getAltitudeAccuracy=function(){return this.get(Cr)};t.prototype.getHeading=function(){return this.get(wr)};t.prototype.getPosition=function(){return this.get(Ir)};t.prototype.getProjection=function(){return this.get(Lr)};t.prototype.getSpeed=function(){return this.get(Or)};t.prototype.getTracking=function(){return this.get(Pr)};t.prototype.getTrackingOptions=function(){return this.get(br)};t.prototype.setProjection=function(t){this.set(Lr,be(t))};t.prototype.setTracking=function(t){this.set(Pr,t)};t.prototype.setTrackingOptions=function(t){this.set(br,t)};return t}(O),Nr=function(n){function t(t,e,i,r){n.call(this);this.extent=t;this.pixelRatio_=i;this.resolution=e;this.state=r}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.changed=function(){this.dispatchEvent(C.CHANGE)};t.prototype.getExtent=function(){return this.extent};t.prototype.getImage=function(){return o()};t.prototype.getPixelRatio=function(){return this.pixelRatio_};t.prototype.getResolution=function(){return this.resolution};t.prototype.getState=function(){return this.state};t.prototype.load=function(){o()};return t}(R),Ar={IDLE:0,LOADING:1,LOADED:2,ERROR:3},Gr=function(s){function t(t,e,i,r,n,o){s.call(this,t,e,i,Ar.IDLE);this.src_=r;this.image_=new Image;null!==n&&(this.image_.crossOrigin=n);this.imageListenerKeys_=null;this.state=Ar.IDLE;this.imageLoadFunction_=o}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getImage=function(){return this.image_};t.prototype.handleImageError_=function(){this.state=Ar.ERROR;this.unlistenImage_();this.changed()};t.prototype.handleImageLoad_=function(){void 0===this.resolution&&(this.resolution=Rt(this.extent)/this.image_.height);this.state=Ar.LOADED;this.unlistenImage_();this.changed()};t.prototype.load=function(){if(this.state==Ar.IDLE||this.state==Ar.ERROR){this.state=Ar.LOADING;this.changed();this.imageListenerKeys_=[d(this.image_,C.ERROR,this.handleImageError_,this),d(this.image_,C.LOAD,this.handleImageLoad_,this)];this.imageLoadFunction_(this,this.src_)}};t.prototype.setImage=function(t){this.image_=t};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(Nr),Dr=function(s){function t(t,e,i,r,n){var o=void 0!==n?Ar.IDLE:Ar.LOADED;s.call(this,t,e,i,o);this.loader_=void 0!==n?n:null;this.canvas_=r;this.error_=null}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getError=function(){return this.error_};t.prototype.handleLoad_=function(t){if(t){this.error_=t;this.state=Ar.ERROR}else this.state=Ar.LOADED;this.changed()};t.prototype.load=function(){if(this.state==Ar.IDLE){this.state=Ar.LOADING;this.changed();this.loader_(this.handleLoad_.bind(this))}};t.prototype.getImage=function(){return this.canvas_};return t}(Nr),kr={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4,ABORT:5};function jr(t){return Math.pow(t,3)}function Ur(t){return 1-jr(1-t)}function Yr(t){return 3*t*t-2*t*t*t}function Xr(t){return t}var Br=function(n){function t(t,e,i){n.call(this);var r=i||{};this.tileCoord=t;this.state=e;this.interimTile=null;this.key="";this.transition_=void 0===r.transition?250:r.transition;this.transitionStarts_={}}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.changed=function(){this.dispatchEvent(C.CHANGE)};t.prototype.getKey=function(){return this.key+"/"+this.tileCoord};t.prototype.getInterimTile=function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==kr.LOADED)return t;t=t.interimTile}while(t);return this};t.prototype.refreshInterimChain=function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==kr.LOADED){t.interimTile=null;break}t.getState()==kr.LOADING?e=t:t.getState()==kr.IDLE?e.interimTile=t.interimTile:e=t;t=e.interimTile}while(t)}};t.prototype.getTileCoord=function(){return this.tileCoord};t.prototype.getState=function(){return this.state};t.prototype.setState=function(t){this.state=t;this.changed()};t.prototype.load=function(){};t.prototype.getAlpha=function(t,e){if(!this.transition_)return 1;var i=this.transitionStarts_[t];if(i){if(-1===i)return 1}else{i=e;this.transitionStarts_[t]=i}var r=e-i+1e3/60;return r>=this.transition_?1:jr(r/this.transition_)};t.prototype.inTransition=function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]};t.prototype.endTransition=function(t){this.transition_&&(this.transitionStarts_[t]=-1)};return t}(R);function zr(t,e){var i=document.createElement("canvas");t&&(i.width=t);e&&(i.height=e);return i.getContext("2d")}function Vr(t){var e=t.offsetWidth,i=getComputedStyle(t);return e+=parseInt(i.marginLeft,10)+parseInt(i.marginRight,10)}function Wr(t){var e=t.offsetHeight,i=getComputedStyle(t);return e+=parseInt(i.marginTop,10)+parseInt(i.marginBottom,10)}function Kr(t,e){var i=e.parentNode;i&&i.replaceChild(t,e)}function Hr(t){return t&&t.parentNode?t.parentNode.removeChild(t):null}function Zr(t){for(;t.lastChild;)t.removeChild(t.lastChild)}function qr(t,e){for(var i=t.childNodes,r=0;;++r){var n=i[r],o=e[r];if(!n&&!o)break;if(n!==o)if(n)if(o)t.insertBefore(o,n);else{t.removeChild(n);--r}else t.appendChild(o)}}var Jr=function(s){function t(t,e,i,r,n,o){s.call(this,t,e,o);this.crossOrigin_=r;this.src_=i;this.image_=new Image;null!==r&&(this.image_.crossOrigin=r);this.imageListenerKeys_=null;this.tileLoadFunction_=n}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.disposeInternal=function(){if(this.state==kr.LOADING){this.unlistenImage_();this.image_=Qr()}this.interimTile&&this.interimTile.dispose();this.state=kr.ABORT;this.changed();s.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.image_};t.prototype.getKey=function(){return this.src_};t.prototype.handleImageError_=function(){this.state=kr.ERROR;this.unlistenImage_();this.image_=Qr();this.changed()};t.prototype.handleImageLoad_=function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=kr.LOADED:this.state=kr.EMPTY;this.unlistenImage_();this.changed()};t.prototype.load=function(){if(this.state==kr.ERROR){this.state=kr.IDLE;this.image_=new Image;null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}if(this.state==kr.IDLE){this.state=kr.LOADING;this.changed();this.imageListenerKeys_=[d(this.image_,C.ERROR,this.handleImageError_,this),d(this.image_,C.LOAD,this.handleImageLoad_,this)];this.tileLoadFunction_(this,this.src_)}};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(Br);function Qr(){var t=zr(1,1);t.fillStyle="rgba(0,0,0,0)";t.fillRect(0,0,1,1);return t.canvas}var $r=function(t,e,i){this.decay_=t;this.minVelocity_=e;this.delay_=i;this.points_=[];this.angle_=0;this.initialVelocity_=0};$r.prototype.begin=function(){this.points_.length=0;this.angle_=0;this.initialVelocity_=0};$r.prototype.update=function(t,e){this.points_.push(t,e,Date.now())};$r.prototype.end=function(){if(this.points_.length<6)return!1;var t=Date.now()-this.delay_,e=this.points_.length-3;if(this.points_[e+2]<t)return!1;for(var i=e-3;0<i&&this.points_[i+2]>t;)i-=3;var r=this.points_[e+2]-this.points_[i+2];if(r<1e3/60)return!1;var n=this.points_[e]-this.points_[i],o=this.points_[e+1]-this.points_[i+1];this.angle_=Math.atan2(o,n);this.initialVelocity_=Math.sqrt(n*n+o*o)/r;return this.initialVelocity_>this.minVelocity_};$r.prototype.getDistance=function(){return(this.minVelocity_-this.initialVelocity_)/this.decay_};$r.prototype.getAngle=function(){return this.angle_};var tn=function(r){function t(t,e,i){r.call(this,t);this.map=e;this.frameState=void 0!==i?i:null}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),en=function(o){function t(t,e,i,r,n){o.call(this,t,e,n);this.originalEvent=i;this.pixel=e.getEventPixel(i);this.coordinate=e.getCoordinateFromPixel(this.pixel);this.dragging=void 0!==r&&r}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.preventDefault=function(){o.prototype.preventDefault.call(this);this.originalEvent.preventDefault()};t.prototype.stopPropagation=function(){o.prototype.stopPropagation.call(this);this.originalEvent.stopPropagation()};return t}(tn),rn={SINGLECLICK:"singleclick",CLICK:C.CLICK,DBLCLICK:C.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},nn=function(o){function t(t,e,i,r,n){o.call(this,t,e,i.originalEvent,r,n);this.pointerEvent=i}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(en),on={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},sn=function(t,e){this.dispatcher=t;this.mapping_=e};sn.prototype.getEvents=function(){return Object.keys(this.mapping_)};sn.prototype.getHandlerForEvent=function(t){return this.mapping_[t]};var an=1,hn="mouse";function ln(t){if(!this.isEventSimulatedFromTouch_(t)){an.toString()in this.pointerMap&&this.cancel(t);var e=_n(t,this.dispatcher);this.pointerMap[an.toString()]=t;this.dispatcher.down(e,t)}}function un(t){if(!this.isEventSimulatedFromTouch_(t)){var e=_n(t,this.dispatcher);this.dispatcher.move(e,t)}}function cn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=this.pointerMap[an.toString()];if(e&&e.button===t.button){var i=_n(t,this.dispatcher);this.dispatcher.up(i,t);this.cleanupMouse()}}}function pn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=_n(t,this.dispatcher);this.dispatcher.enterOver(e,t)}}function dn(t){if(!this.isEventSimulatedFromTouch_(t)){var e=_n(t,this.dispatcher);this.dispatcher.leaveOut(e,t)}}var fn=function(i){function t(t){var e={mousedown:ln,mousemove:un,mouseup:cn,mouseover:pn,mouseout:dn};i.call(this,t,e);this.pointerMap=t.pointerMap;this.lastTouches=[]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.isEventSimulatedFromTouch_=function(t){for(var e=this.lastTouches,i=t.clientX,r=t.clientY,n=0,o=e.length,s=void 0;n<o&&(s=e[n]);n++){var a=Math.abs(i-s[0]),h=Math.abs(r-s[1]);if(a<=25&&h<=25)return!0}return!1};t.prototype.cancel=function(t){var e=_n(t,this.dispatcher);this.dispatcher.cancel(e,t);this.cleanupMouse()};t.prototype.cleanupMouse=function(){delete this.pointerMap[an.toString()]};return t}(sn);function _n(t,e){var i=e.cloneEvent(t,t),r=i.preventDefault;i.preventDefault=function(){t.preventDefault();r()};i.pointerId=an;i.isPrimary=!0;i.pointerType=hn;return i}var gn=["","unavailable","touch","pen","mouse"];function yn(t){this.pointerMap[t.pointerId.toString()]=t;var e=this.prepareEvent_(t);this.dispatcher.down(e,t)}function mn(t){var e=this.prepareEvent_(t);this.dispatcher.move(e,t)}function vn(t){var e=this.prepareEvent_(t);this.dispatcher.up(e,t);this.cleanup(t.pointerId)}function En(t){var e=this.prepareEvent_(t);this.dispatcher.leaveOut(e,t)}function Tn(t){var e=this.prepareEvent_(t);this.dispatcher.enterOver(e,t)}function Sn(t){var e=this.prepareEvent_(t);this.dispatcher.cancel(e,t);this.cleanup(t.pointerId)}function xn(t){var e=this.dispatcher.makeEvent("lostpointercapture",t,t);this.dispatcher.dispatchEvent(e)}function Rn(t){var e=this.dispatcher.makeEvent("gotpointercapture",t,t);this.dispatcher.dispatchEvent(e)}var Cn=function(i){function t(t){var e={MSPointerDown:yn,MSPointerMove:mn,MSPointerUp:vn,MSPointerOut:En,MSPointerOver:Tn,MSPointerCancel:Sn,MSGotPointerCapture:Rn,MSLostPointerCapture:xn};i.call(this,t,e);this.pointerMap=t.pointerMap}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.prepareEvent_=function(t){var e=t;"number"==typeof t.pointerType&&((e=this.dispatcher.cloneEvent(t,t)).pointerType=gn[t.pointerType]);return e};t.prototype.cleanup=function(t){delete this.pointerMap[t.toString()]};return t}(sn);function wn(t){this.dispatcher.fireNativeEvent(t)}function In(t){this.dispatcher.fireNativeEvent(t)}function Ln(t){this.dispatcher.fireNativeEvent(t)}function On(t){this.dispatcher.fireNativeEvent(t)}function Pn(t){this.dispatcher.fireNativeEvent(t)}function bn(t){this.dispatcher.fireNativeEvent(t)}function Mn(t){this.dispatcher.fireNativeEvent(t)}function Fn(t){this.dispatcher.fireNativeEvent(t)}var Nn=function(i){function t(t){var e={pointerdown:wn,pointermove:In,pointerup:Ln,pointerout:On,pointerover:Pn,pointercancel:bn,gotpointercapture:Fn,lostpointercapture:Mn};i.call(this,t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(sn),An=!1,Gn=function(n){function t(t,e,i){n.call(this,t);this.originalEvent=e;var r=i||{};this.buttons=function(t){var e;if(t.buttons||An)e=t.buttons;else switch(t.which){case 1:e=1;break;case 2:e=4;break;case 3:e=2;break;default:e=0}return e}(r);this.pressure=function(t,e){var i=0;i=t.pressure?t.pressure:e?.5:0;return i}(r,this.buttons);this.bubbles="bubbles"in r&&r.bubbles;this.cancelable="cancelable"in r&&r.cancelable;this.view="view"in r?r.view:null;this.detail="detail"in r?r.detail:null;this.screenX="screenX"in r?r.screenX:0;this.screenY="screenY"in r?r.screenY:0;this.clientX="clientX"in r?r.clientX:0;this.clientY="clientY"in r?r.clientY:0;this.ctrlKey="ctrlKey"in r&&r.ctrlKey;this.altKey="altKey"in r&&r.altKey;this.shiftKey="shiftKey"in r&&r.shiftKey;this.metaKey="metaKey"in r&&r.metaKey;this.button="button"in r?r.button:0;this.relatedTarget="relatedTarget"in r?r.relatedTarget:null;this.pointerId="pointerId"in r?r.pointerId:0;this.width="width"in r?r.width:0;this.height="height"in r?r.height:0;this.tiltX="tiltX"in r?r.tiltX:0;this.tiltY="tiltY"in r?r.tiltY:0;this.pointerType="pointerType"in r?r.pointerType:"";this.hwTimestamp="hwTimestamp"in r?r.hwTimestamp:0;this.isPrimary="isPrimary"in r&&r.isPrimary;e.preventDefault&&(this.preventDefault=function(){e.preventDefault()})}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(S);!function(){try{var t=new MouseEvent("click",{buttons:1});An=1===t.buttons}catch(t){}}();function Dn(t){this.vacuumTouches_(t);this.setPrimaryTouch_(t.changedTouches[0]);this.dedupSynthMouse_(t);this.clickCount_++;this.processTouches_(t,this.overDown_)}function kn(t){this.processTouches_(t,this.moveOverOut_)}function jn(t){this.dedupSynthMouse_(t);this.processTouches_(t,this.upOut_)}function Un(t){this.processTouches_(t,this.cancelOut_)}var Yn=function(r){function t(t,e){var i={touchstart:Dn,touchmove:kn,touchend:jn,touchcancel:Un};r.call(this,t,i);this.pointerMap=t.pointerMap;this.mouseSource=e;this.firstTouchId_=void 0;this.clickCount_=0;this.resetId_;this.dedupTimeout_=2500}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.isPrimaryTouch_=function(t){return this.firstTouchId_===t.identifier};t.prototype.setPrimaryTouch_=function(t){var e=Object.keys(this.pointerMap).length;if(0===e||1===e&&an.toString()in this.pointerMap){this.firstTouchId_=t.identifier;this.cancelResetClickCount_()}};t.prototype.removePrimaryPointer_=function(t){if(t.isPrimary){this.firstTouchId_=void 0;this.resetClickCount_()}};t.prototype.resetClickCount_=function(){this.resetId_=setTimeout(this.resetClickCountHandler_.bind(this),200)};t.prototype.resetClickCountHandler_=function(){this.clickCount_=0;this.resetId_=void 0};t.prototype.cancelResetClickCount_=function(){void 0!==this.resetId_&&clearTimeout(this.resetId_)};t.prototype.touchToPointer_=function(t,e){var i=this.dispatcher.cloneEvent(t,e);i.pointerId=e.identifier+2;i.bubbles=!0;i.cancelable=!0;i.detail=this.clickCount_;i.button=0;i.buttons=1;i.width=e.radiusX||0;i.height=e.radiusY||0;i.pressure=e.force||.5;i.isPrimary=this.isPrimaryTouch_(e);i.pointerType="touch";i.clientX=e.clientX;i.clientY=e.clientY;i.screenX=e.screenX;i.screenY=e.screenY;return i};t.prototype.processTouches_=function(t,e){var i=Array.prototype.slice.call(t.changedTouches),r=i.length;function n(){t.preventDefault()}for(var o=0;o<r;++o){var s=this.touchToPointer_(t,i[o]);s.preventDefault=n;e.call(this,t,s)}};t.prototype.findTouch_=function(t,e){for(var i=t.length,r=0;r<i;r++){if(t[r].identifier===e)return!0}return!1};t.prototype.vacuumTouches_=function(t){var e=t.touches,i=Object.keys(this.pointerMap),r=i.length;if(r>=e.length){for(var n=[],o=0;o<r;++o){var s=Number(i[o]),a=this.pointerMap[s];s==an||this.findTouch_(e,s-2)||n.push(a.out)}for(var h=0;h<n.length;++h)this.cancelOut_(t,n[h])}};t.prototype.overDown_=function(t,e){this.pointerMap[e.pointerId]={target:e.target,out:e,outTarget:e.target};this.dispatcher.over(e,t);this.dispatcher.enter(e,t);this.dispatcher.down(e,t)};t.prototype.moveOverOut_=function(t,e){var i=e,r=this.pointerMap[i.pointerId];if(r){var n=r.out,o=r.outTarget;this.dispatcher.move(i,t);if(n&&o!==i.target){n.relatedTarget=i.target;i.relatedTarget=o;n.target=o;if(i.target){this.dispatcher.leaveOut(n,t);this.dispatcher.enterOver(i,t)}else{i.target=o;i.relatedTarget=null;this.cancelOut_(t,i)}}r.out=i;r.outTarget=i.target}};t.prototype.upOut_=function(t,e){this.dispatcher.up(e,t);this.dispatcher.out(e,t);this.dispatcher.leave(e,t);this.cleanUpPointer_(e)};t.prototype.cancelOut_=function(t,e){this.dispatcher.cancel(e,t);this.dispatcher.out(e,t);this.dispatcher.leave(e,t);this.cleanUpPointer_(e)};t.prototype.cleanUpPointer_=function(t){delete this.pointerMap[t.pointerId];this.removePrimaryPointer_(t)};t.prototype.dedupSynthMouse_=function(t){var e=this.mouseSource.lastTouches,i=t.changedTouches[0];if(this.isPrimaryTouch_(i)){var r=[i.clientX,i.clientY];e.push(r);setTimeout(function(){z(e,r)},this.dedupTimeout_)}};return t}(sn),Xn=[["bubbles",!1],["cancelable",!1],["view",null],["detail",null],["screenX",0],["screenY",0],["clientX",0],["clientY",0],["ctrlKey",!1],["altKey",!1],["shiftKey",!1],["metaKey",!1],["button",0],["relatedTarget",null],["buttons",0],["pointerId",0],["width",0],["height",0],["pressure",0],["tiltX",0],["tiltY",0],["pointerType",""],["hwTimestamp",0],["isPrimary",!1],["type",""],["target",null],["currentTarget",null],["which",0]],Bn=function(e){function t(t){e.call(this);this.element_=t;this.pointerMap={};this.eventMap_={};this.eventSourceList_=[];this.registerSources()}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.registerSources=function(){if(Er)this.registerSource("native",new Nn(this));else if(Tr)this.registerSource("ms",new Cn(this));else{var t=new fn(this);this.registerSource("mouse",t);vr&&this.registerSource("touch",new Yn(this,t))}this.register_()};t.prototype.registerSource=function(t,e){var i=e,r=i.getEvents();if(r){r.forEach(function(t){var e=i.getHandlerForEvent(t);e&&(this.eventMap_[t]=e.bind(i))}.bind(this));this.eventSourceList_.push(i)}};t.prototype.register_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var i=this.eventSourceList_[e];this.addEvents_(i.getEvents())}};t.prototype.unregister_=function(){for(var t=this.eventSourceList_.length,e=0;e<t;e++){var i=this.eventSourceList_[e];this.removeEvents_(i.getEvents())}};t.prototype.eventHandler_=function(t){var e=t.type,i=this.eventMap_[e];i&&i(t)};t.prototype.addEvents_=function(t){t.forEach(function(t){m(this.element_,t,this.eventHandler_,this)}.bind(this))};t.prototype.removeEvents_=function(t){t.forEach(function(t){f(this.element_,t,this.eventHandler_,this)}.bind(this))};t.prototype.cloneEvent=function(t,e){for(var i={},r=0,n=Xn.length;r<n;r++){var o=Xn[r][0];i[o]=t[o]||e[o]||Xn[r][1]}return i};t.prototype.down=function(t,e){this.fireEvent(on.POINTERDOWN,t,e)};t.prototype.move=function(t,e){this.fireEvent(on.POINTERMOVE,t,e)};t.prototype.up=function(t,e){this.fireEvent(on.POINTERUP,t,e)};t.prototype.enter=function(t,e){t.bubbles=!1;this.fireEvent(on.POINTERENTER,t,e)};t.prototype.leave=function(t,e){t.bubbles=!1;this.fireEvent(on.POINTERLEAVE,t,e)};t.prototype.over=function(t,e){t.bubbles=!0;this.fireEvent(on.POINTEROVER,t,e)};t.prototype.out=function(t,e){t.bubbles=!0;this.fireEvent(on.POINTEROUT,t,e)};t.prototype.cancel=function(t,e){this.fireEvent(on.POINTERCANCEL,t,e)};t.prototype.leaveOut=function(t,e){this.out(t,e);this.contains_(t.target,t.relatedTarget)||this.leave(t,e)};t.prototype.enterOver=function(t,e){this.over(t,e);this.contains_(t.target,t.relatedTarget)||this.enter(t,e)};t.prototype.contains_=function(t,e){return!(!t||!e)&&t.contains(e)};t.prototype.makeEvent=function(t,e,i){return new Gn(t,i,e)};t.prototype.fireEvent=function(t,e,i){var r=this.makeEvent(t,e,i);this.dispatchEvent(r)};t.prototype.fireNativeEvent=function(t){var e=this.makeEvent(t.type,t,t);this.dispatchEvent(e)};t.prototype.wrapMouseEvent=function(t,e){return this.makeEvent(t,_n(e,this),e)};t.prototype.disposeInternal=function(){this.unregister_();e.prototype.disposeInternal.call(this)};return t}(R),zn=function(r){function t(t,e){r.call(this);this.map_=t;this.clickTimeoutId_;this.dragging_=!1;this.dragListenerKeys_=[];this.moveTolerance_=e?e*yr:yr;this.down_=null;var i=this.map_.getViewport();this.activePointers_=0;this.trackedTouches_={};this.pointerEventHandler_=new Bn(i);this.documentPointerEventHandler_=null;this.pointerdownListenerKey_=m(this.pointerEventHandler_,on.POINTERDOWN,this.handlePointerDown_,this);this.relayedListenerKey_=m(this.pointerEventHandler_,on.POINTERMOVE,this.relayEvent_,this)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.emulateClick_=function(e){var t=new nn(rn.CLICK,this.map_,e);this.dispatchEvent(t);if(void 0!==this.clickTimeoutId_){clearTimeout(this.clickTimeoutId_);this.clickTimeoutId_=void 0;t=new nn(rn.DBLCLICK,this.map_,e);this.dispatchEvent(t)}else this.clickTimeoutId_=setTimeout(function(){this.clickTimeoutId_=void 0;var t=new nn(rn.SINGLECLICK,this.map_,e);this.dispatchEvent(t)}.bind(this),250)};t.prototype.updateActivePointers_=function(t){var e=t;e.type==rn.POINTERUP||e.type==rn.POINTERCANCEL?delete this.trackedTouches_[e.pointerId]:e.type==rn.POINTERDOWN&&(this.trackedTouches_[e.pointerId]=!0);this.activePointers_=Object.keys(this.trackedTouches_).length};t.prototype.handlePointerUp_=function(t){this.updateActivePointers_(t);var e=new nn(rn.POINTERUP,this.map_,t);this.dispatchEvent(e);e.propagationStopped||this.dragging_||!this.isMouseActionButton_(t)||this.emulateClick_(this.down_);if(0===this.activePointers_){this.dragListenerKeys_.forEach(g);this.dragListenerKeys_.length=0;this.dragging_=!1;this.down_=null;this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}};t.prototype.isMouseActionButton_=function(t){return 0===t.button};t.prototype.handlePointerDown_=function(t){this.updateActivePointers_(t);var e=new nn(rn.POINTERDOWN,this.map_,t);this.dispatchEvent(e);this.down_=t;if(0===this.dragListenerKeys_.length){this.documentPointerEventHandler_=new Bn(document);this.dragListenerKeys_.push(m(this.documentPointerEventHandler_,rn.POINTERMOVE,this.handlePointerMove_,this),m(this.documentPointerEventHandler_,rn.POINTERUP,this.handlePointerUp_,this),m(this.pointerEventHandler_,rn.POINTERCANCEL,this.handlePointerUp_,this))}};t.prototype.handlePointerMove_=function(t){if(this.isMoving_(t)){this.dragging_=!0;var e=new nn(rn.POINTERDRAG,this.map_,t,this.dragging_);this.dispatchEvent(e)}t.preventDefault()};t.prototype.relayEvent_=function(t){var e=!(!this.down_||!this.isMoving_(t));this.dispatchEvent(new nn(t.type,this.map_,t,e))};t.prototype.isMoving_=function(t){return this.dragging_||Math.abs(t.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(t.clientY-this.down_.clientY)>this.moveTolerance_};t.prototype.disposeInternal=function(){if(this.relayedListenerKey_){g(this.relayedListenerKey_);this.relayedListenerKey_=null}if(this.pointerdownListenerKey_){g(this.pointerdownListenerKey_);this.pointerdownListenerKey_=null}this.dragListenerKeys_.forEach(g);this.dragListenerKeys_.length=0;if(this.documentPointerEventHandler_){this.documentPointerEventHandler_.dispose();this.documentPointerEventHandler_=null}if(this.pointerEventHandler_){this.pointerEventHandler_.dispose();this.pointerEventHandler_=null}r.prototype.disposeInternal.call(this)};return t}(R),Vn={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend"},Wn={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"},Kn={PRERENDER:"prerender",POSTRENDER:"postrender",PRECOMPOSE:"precompose",POSTCOMPOSE:"postcompose",RENDERCOMPLETE:"rendercomplete"},Hn=function(t,e){this.priorityFunction_=t;this.keyFunction_=e;this.elements_=[];this.priorities_=[];this.queuedElements_={}};Hn.prototype.clear=function(){this.elements_.length=0;this.priorities_.length=0;_(this.queuedElements_)};Hn.prototype.dequeue=function(){var t=this.elements_,e=this.priorities_,i=t[0];if(1==t.length){t.length=0;e.length=0}else{t[0]=t.pop();e[0]=e.pop();this.siftUp_(0)}var r=this.keyFunction_(i);delete this.queuedElements_[r];return i};Hn.prototype.enqueue=function(t){A(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);if(e==1/0)return!1;this.elements_.push(t);this.priorities_.push(e);this.queuedElements_[this.keyFunction_(t)]=!0;this.siftDown_(0,this.elements_.length-1);return!0};Hn.prototype.getCount=function(){return this.elements_.length};Hn.prototype.getLeftChildIndex_=function(t){return 2*t+1};Hn.prototype.getRightChildIndex_=function(t){return 2*t+2};Hn.prototype.getParentIndex_=function(t){return t-1>>1};Hn.prototype.heapify_=function(){var t;for(t=(this.elements_.length>>1)-1;0<=t;t--)this.siftUp_(t)};Hn.prototype.isEmpty=function(){return 0===this.elements_.length};Hn.prototype.isKeyQueued=function(t){return t in this.queuedElements_};Hn.prototype.isQueued=function(t){return this.isKeyQueued(this.keyFunction_(t))};Hn.prototype.siftUp_=function(t){for(var e=this.elements_,i=this.priorities_,r=e.length,n=e[t],o=i[t],s=t;t<r>>1;){var a=this.getLeftChildIndex_(t),h=this.getRightChildIndex_(t),l=h<r&&i[h]<i[a]?h:a;e[t]=e[l];i[t]=i[l];t=l}e[t]=n;i[t]=o;this.siftDown_(s,t)};Hn.prototype.siftDown_=function(t,e){for(var i=this.elements_,r=this.priorities_,n=i[e],o=r[e];t<e;){var s=this.getParentIndex_(e);if(!(r[s]>o))break;i[e]=i[s];r[e]=r[s];e=s}i[e]=n;r[e]=o};Hn.prototype.reprioritize=function(){var t,e,i,r=this.priorityFunction_,n=this.elements_,o=this.priorities_,s=0,a=n.length;for(e=0;e<a;++e)if((i=r(t=n[e]))==1/0)delete this.queuedElements_[this.keyFunction_(t)];else{o[s]=i;n[s++]=t}n.length=s;o.length=s;this.heapify_()};var Zn=function(i){function t(e,t){i.call(this,function(t){return e.apply(null,t)},function(t){return t[0].getKey()});this.tileChangeCallback_=t;this.tilesLoading_=0;this.tilesLoadingKeys_={}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.enqueue=function(t){var e=i.prototype.enqueue.call(this,t);if(e){m(t[0],C.CHANGE,this.handleTileChange,this)}return e};t.prototype.getTilesLoading=function(){return this.tilesLoading_};t.prototype.handleTileChange=function(t){var e=t.target,i=e.getState();if(i===kr.LOADED||i===kr.ERROR||i===kr.EMPTY||i===kr.ABORT){f(e,C.CHANGE,this.handleTileChange,this);var r=e.getKey();if(r in this.tilesLoadingKeys_){delete this.tilesLoadingKeys_[r];--this.tilesLoading_}this.tileChangeCallback_()}};t.prototype.loadMoreTiles=function(t,e){for(var i,r,n,o=0,s=!1;this.tilesLoading_<t&&o<e&&0<this.getCount();){n=(r=this.dequeue()[0]).getKey();if((i=r.getState())===kr.ABORT)s=!0;else if(i===kr.IDLE&&!(n in this.tilesLoadingKeys_)){this.tilesLoadingKeys_[n]=!0;++this.tilesLoading_;++o;r.load()}}0===o&&s&&this.tileChangeCallback_()};return t}(Hn),qn=42,Jn=256;function Qn(e){return function(t){return t?[zt(t[0],e[0],e[2]),zt(t[1],e[1],e[3])]:void 0}}function $n(t){return t}function to(s){return function(t,e,i){if(void 0!==t){var r=Y(s,t,i);r=zt(r+e,0,s.length-1);var n=Math.floor(r);if(r!=n&&n<s.length-1){var o=s[n]/s[n+1];return s[n]/Math.pow(o,r-n)}return s[n]}}}function eo(s,a,h){return function(t,e,i){if(void 0!==t){var r=-i/2+.5,n=Math.floor(Math.log(a/t)/Math.log(s)+r),o=Math.max(n+e,0);void 0!==h&&(o=Math.min(o,h));return a/Math.pow(s,o)}}}function io(t,e){return void 0!==t?0:void 0}function ro(t,e){return void 0!==t?t+e:void 0}function no(t){var i=2*Math.PI/t;return function(t,e){return void 0!==t?t=Math.floor((t+e)/i+.5)*i:void 0}}function oo(t){var i=t||qt(5);return function(t,e){return void 0!==t?Math.abs(t+e)<=i?0:t+e:void 0}}var so={ANIMATING:0,INTERACTING:1},ao={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};function ho(t,e,i){var r=void 0!==i?t.toFixed(i):""+t,n=r.indexOf(".");return e<(n=-1===n?r.length:n)?r:new Array(1+e-n).join("0")+r}function lo(t,e){for(var i=(""+t).split("."),r=(""+e).split("."),n=0;n<Math.max(i.length,r.length);n++){var o=parseInt(i[n]||"0",10),s=parseInt(r[n]||"0",10);if(s<o)return 1;if(o<s)return-1}return 0}function uo(t,e){t[0]+=e[0];t[1]+=e[1];return t}function co(t,e){var i=e.getRadius(),r=e.getCenter(),n=r[0],o=r[1],s=t[0]-n,a=t[1]-o;0===s&&0===a&&(s=1);var h=Math.sqrt(s*s+a*a);return[n+i*s/h,o+i*a/h]}function po(t,e){var i,r,n=t[0],o=t[1],s=e[0],a=e[1],h=s[0],l=s[1],u=a[0],c=a[1],p=u-h,d=c-l,f=0===p&&0===d?0:(p*(n-h)+d*(o-l))/(p*p+d*d||0);if(f<=0){i=h;r=l}else if(1<=f){i=u;r=c}else{i=h+f*p;r=l+f*d}return[i,r]}function fo(t,e,i){var r=Jt(e+180,360)-180,n=Math.abs(3600*r),o=i||0,s=Math.pow(10,o),a=Math.floor(n/3600),h=Math.floor((n-3600*a)/60),l=n-3600*a-60*h;if(60<=(l=Math.ceil(l*s)/s)){l=0;h+=1}if(60<=h){h=0;a+=1}return a+" "+ho(h,2)+" "+ho(l,2,o)+""+(0==r?"":" "+t.charAt(r<0?1:0))}function _o(t,e,i){return t?e.replace("{x}",t[0].toFixed(i)).replace("{y}",t[1].toFixed(i)):""}function go(t,e){for(var i=!0,r=t.length-1;0<=r;--r)if(t[r]!=e[r]){i=!1;break}return i}function yo(t,e){var i=Math.cos(e),r=Math.sin(e),n=t[0]*i-t[1]*r,o=t[1]*i+t[0]*r;t[0]=n;t[1]=o;return t}function mo(t,e){t[0]*=e;t[1]*=e;return t}function vo(t,e){var i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function Eo(t,e){return Math.sqrt(vo(t,e))}function To(t,e){return vo(t,po(t,e))}function So(t,e){return _o(t,"{x}, {y}",e)}var xo=function(i){function t(t){i.call(this);var e=y({},t);this.hints_=[0,0];this.animations_=[];this.updateAnimationKey_;this.updateAnimations_=this.updateAnimations_.bind(this);this.projection_=Ae(e.projection,"EPSG:3857");this.applyOptions_(e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.applyOptions_=function(t){var e={};e[ao.CENTER]=void 0!==t.center?t.center:null;var i=wo(t);this.maxResolution_=i.maxResolution;this.minResolution_=i.minResolution;this.zoomFactor_=i.zoomFactor;this.resolutions_=t.resolutions;this.minZoom_=i.minZoom;var r=Co(t),n=i.constraint,o=Io(t);this.constraints_={center:r,resolution:n,rotation:o};if(void 0!==t.resolution)e[ao.RESOLUTION]=t.resolution;else if(void 0!==t.zoom){e[ao.RESOLUTION]=this.constrainResolution(this.maxResolution_,t.zoom-this.minZoom_);this.resolutions_&&(e[ao.RESOLUTION]=zt(Number(this.getResolution()||e[ao.RESOLUTION]),this.minResolution_,this.maxResolution_))}e[ao.ROTATION]=void 0!==t.rotation?t.rotation:0;this.setProperties(e);this.options_=t};t.prototype.getUpdatedOptions_=function(t){var e=y({},this.options_);void 0!==e.resolution?e.resolution=this.getResolution():e.zoom=this.getZoom();e.center=this.getCenter();e.rotation=this.getRotation();return y({},e,t)};t.prototype.animate=function(t){var e,i=arguments,r=arguments.length;if(1<r&&"function"==typeof arguments[r-1]){e=arguments[r-1];--r}if(this.isDef()){for(var n=Date.now(),o=this.getCenter().slice(),s=this.getResolution(),a=this.getRotation(),h=[],l=0;l<r;++l){var u=i[l],c={start:n,complete:!1,anchor:u.anchor,duration:void 0!==u.duration?u.duration:1e3,easing:u.easing||Yr,callback:e};if(u.center){c.sourceCenter=o;c.targetCenter=u.center;o=c.targetCenter}if(void 0!==u.zoom){c.sourceResolution=s;c.targetResolution=this.constrainResolution(this.maxResolution_,u.zoom-this.minZoom_,0);s=c.targetResolution}else if(u.resolution){c.sourceResolution=s;c.targetResolution=u.resolution;s=c.targetResolution}if(void 0!==u.rotation){c.sourceRotation=a;var p=Jt(u.rotation-a+Math.PI,2*Math.PI)-Math.PI;c.targetRotation=a+p;a=c.targetRotation}Lo(c)?c.complete=!0:n+=c.duration;h.push(c)}this.animations_.push(h);this.setHint(so.ANIMATING,1);this.updateAnimations_()}else{var d=arguments[r-1];d.center&&this.setCenter(d.center);void 0!==d.zoom&&this.setZoom(d.zoom);void 0!==d.rotation&&this.setRotation(d.rotation);e&&Ro(e,!0)}};t.prototype.getAnimating=function(){return 0<this.hints_[so.ANIMATING]};t.prototype.getInteracting=function(){return 0<this.hints_[so.INTERACTING]};t.prototype.cancelAnimations=function(){this.setHint(so.ANIMATING,-this.hints_[so.ANIMATING]);for(var t=0,e=this.animations_.length;t<e;++t){var i=this.animations_[t];i[0].callback&&Ro(i[0].callback,!1)}this.animations_.length=0};t.prototype.updateAnimations_=function(){if(void 0!==this.updateAnimationKey_){cancelAnimationFrame(this.updateAnimationKey_);this.updateAnimationKey_=void 0}if(this.getAnimating()){for(var t=Date.now(),e=!1,i=this.animations_.length-1;0<=i;--i){for(var r=this.animations_[i],n=!0,o=0,s=r.length;o<s;++o){var a=r[o];if(!a.complete){var h=t-a.start,l=0<a.duration?h/a.duration:1;if(1<=l){a.complete=!0;l=1}else n=!1;var u=a.easing(l);if(a.sourceCenter){var c=a.sourceCenter[0],p=a.sourceCenter[1],d=c+u*(a.targetCenter[0]-c),f=p+u*(a.targetCenter[1]-p);this.set(ao.CENTER,[d,f])}if(a.sourceResolution&&a.targetResolution){var _=1===u?a.targetResolution:a.sourceResolution+u*(a.targetResolution-a.sourceResolution);a.anchor&&this.set(ao.CENTER,this.calculateCenterZoom(_,a.anchor));this.set(ao.RESOLUTION,_)}if(void 0!==a.sourceRotation&&void 0!==a.targetRotation){var g=1===u?Jt(a.targetRotation+Math.PI,2*Math.PI)-Math.PI:a.sourceRotation+u*(a.targetRotation-a.sourceRotation);a.anchor&&this.set(ao.CENTER,this.calculateCenterRotate(g,a.anchor));this.set(ao.ROTATION,g)}e=!0;if(!a.complete)break}}if(n){this.animations_[i]=null;this.setHint(so.ANIMATING,-1);var y=r[0].callback;y&&Ro(y,!0)}}this.animations_=this.animations_.filter(Boolean);e&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_))}};t.prototype.calculateCenterRotate=function(t,e){var i,r=this.getCenter();if(void 0!==r){yo(i=[r[0]-e[0],r[1]-e[1]],t-this.getRotation());uo(i,e)}return i};t.prototype.calculateCenterZoom=function(t,e){var i,r=this.getCenter(),n=this.getResolution();if(void 0!==r&&void 0!==n){i=[e[0]-t*(e[0]-r[0])/n,e[1]-t*(e[1]-r[1])/n]}return i};t.prototype.getSizeFromViewport_=function(){var t=[100,100],e='.ol-viewport[data-view="'+bt(this)+'"]',i=document.querySelector(e);if(i){var r=getComputedStyle(i);t[0]=parseInt(r.width,10);t[1]=parseInt(r.height,10)}return t};t.prototype.constrainCenter=function(t){return this.constraints_.center(t)};t.prototype.constrainResolution=function(t,e,i){var r=e||0,n=i||0;return this.constraints_.resolution(t,r,n)};t.prototype.constrainRotation=function(t,e){var i=e||0;return this.constraints_.rotation(t,i)};t.prototype.getCenter=function(){return this.get(ao.CENTER)};t.prototype.getConstraints=function(){return this.constraints_};t.prototype.getHints=function(t){if(void 0===t)return this.hints_.slice();t[0]=this.hints_[0];t[1]=this.hints_[1];return t};t.prototype.calculateExtent=function(t){var e=t||this.getSizeFromViewport_(),i=this.getCenter();A(i,1);var r=this.getResolution();A(void 0!==r,2);var n=this.getRotation();A(void 0!==n,3);return xt(i,r,n,e)};t.prototype.getMaxResolution=function(){return this.maxResolution_};t.prototype.getMinResolution=function(){return this.minResolution_};t.prototype.getMaxZoom=function(){return this.getZoomForResolution(this.minResolution_)};t.prototype.setMaxZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({maxZoom:t}))};t.prototype.getMinZoom=function(){return this.getZoomForResolution(this.maxResolution_)};t.prototype.setMinZoom=function(t){this.applyOptions_(this.getUpdatedOptions_({minZoom:t}))};t.prototype.getProjection=function(){return this.projection_};t.prototype.getResolution=function(){return this.get(ao.RESOLUTION)};t.prototype.getResolutions=function(){return this.resolutions_};t.prototype.getResolutionForExtent=function(t,e){var i=e||this.getSizeFromViewport_(),r=Lt(t)/i[0],n=Rt(t)/i[1];return Math.max(r,n)};t.prototype.getResolutionForValueFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,n=Math.log(i/r)/Math.log(e);return function(t){return i/Math.pow(e,t*n)}};t.prototype.getRotation=function(){return this.get(ao.ROTATION)};t.prototype.getValueForResolutionFunction=function(t){var e=t||2,i=this.maxResolution_,r=this.minResolution_,n=Math.log(i/r)/Math.log(e);return function(t){return Math.log(i/t)/Math.log(e)/n}};t.prototype.getState=function(t){var e=this.getCenter(),i=this.getProjection(),r=this.getResolution(),n=r/t,o=this.getRotation();return{center:[Math.round(e[0]/n)*n,Math.round(e[1]/n)*n],projection:void 0!==i?i:null,resolution:r,rotation:o,zoom:this.getZoom()}};t.prototype.getZoom=function(){var t,e=this.getResolution();void 0!==e&&(t=this.getZoomForResolution(e));return t};t.prototype.getZoomForResolution=function(t){var e,i,r=this.minZoom_||0;if(this.resolutions_){var n=Y(this.resolutions_,t,1);r=n;e=this.resolutions_[n];i=n==this.resolutions_.length-1?2:e/this.resolutions_[n+1]}else{e=this.maxResolution_;i=this.zoomFactor_}return r+Math.log(e/t)/Math.log(i)};t.prototype.getResolutionForZoom=function(t){return this.constrainResolution(this.maxResolution_,t-this.minZoom_,0)};t.prototype.fit=function(t,e){var i,r=e||{},n=r.size;n||(n=this.getSizeFromViewport_());A(Array.isArray(t)||"function"==typeof t.getSimplifiedGeometry,24);if(Array.isArray(t)){A(!Ot(t),25);i=ir(t)}else t.getType()===jt.CIRCLE?(i=ir(t=t.getExtent())).rotate(this.getRotation(),Tt(t)):i=t;var o,s=void 0!==r.padding?r.padding:[0,0,0,0],a=void 0===r.constrainResolution||r.constrainResolution,h=void 0!==r.nearest&&r.nearest;o=void 0!==r.minResolution?r.minResolution:void 0!==r.maxZoom?this.constrainResolution(this.maxResolution_,r.maxZoom-this.minZoom_,0):0;for(var l=i.getFlatCoordinates(),u=this.getRotation(),c=Math.cos(-u),p=Math.sin(-u),d=1/0,f=1/0,_=-1/0,g=-1/0,y=i.getStride(),m=0,v=l.length;m<v;m+=y){var E=l[m]*c-l[m+1]*p,T=l[m]*p+l[m+1]*c;d=Math.min(d,E);f=Math.min(f,T);_=Math.max(_,E);g=Math.max(g,T)}var S=this.getResolutionForExtent([d,f,_,g],[n[0]-s[1]-s[3],n[1]-s[0]-s[2]]);S=isNaN(S)?o:Math.max(S,o);if(a){var x=this.constrainResolution(S,0,0);!h&&x<S&&(x=this.constrainResolution(x,-1,0));S=x}p=-p;var R=(d+_)/2,C=(f+g)/2,w=[(R+=(s[1]-s[3])/2*S)*c-(C+=(s[0]-s[2])/2*S)*p,C*c+R*p],I=r.callback?r.callback:L;if(void 0!==r.duration)this.animate({resolution:S,center:w,duration:r.duration,easing:r.easing},I);else{this.setResolution(S);this.setCenter(w);Ro(I,!0)}};t.prototype.centerOn=function(t,e,i){var r=this.getRotation(),n=Math.cos(-r),o=Math.sin(-r),s=t[0]*n-t[1]*o,a=t[1]*n+t[0]*o,h=this.getResolution(),l=(s+=(e[0]/2-i[0])*h)*n-(a+=(i[1]-e[1]/2)*h)*(o=-o),u=a*n+s*o;this.setCenter([l,u])};t.prototype.isDef=function(){return!!this.getCenter()&&void 0!==this.getResolution()};t.prototype.rotate=function(t,e){if(void 0!==e){var i=this.calculateCenterRotate(t,e);this.setCenter(i)}this.setRotation(t)};t.prototype.setCenter=function(t){this.set(ao.CENTER,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setHint=function(t,e){this.hints_[t]+=e;this.changed();return this.hints_[t]};t.prototype.setResolution=function(t){this.set(ao.RESOLUTION,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setRotation=function(t){this.set(ao.ROTATION,t);this.getAnimating()&&this.cancelAnimations()};t.prototype.setZoom=function(t){this.setResolution(this.getResolutionForZoom(t))};return t}(O);function Ro(t,e){setTimeout(function(){t(e)},0)}function Co(t){return void 0!==t.extent?Qn(t.extent):$n}function wo(t){var e,i,r,n=void 0!==t.minZoom?t.minZoom:0,o=void 0!==t.maxZoom?t.maxZoom:28,s=void 0!==t.zoomFactor?t.zoomFactor:2;if(void 0!==t.resolutions){var a=t.resolutions;i=a[n];r=void 0!==a[o]?a[o]:a[a.length-1];e=to(a)}else{var h=Ae(t.projection,"EPSG:3857"),l=h.getExtent(),u=(l?Math.max(Lt(l),Rt(l)):360*oe[ne.DEGREES]/h.getMetersPerUnit())/Jn/Math.pow(2,0),c=u/Math.pow(2,28);void 0!==(i=t.maxResolution)?n=0:i=u/Math.pow(s,n);void 0===(r=t.minResolution)&&(r=void 0!==t.maxZoom?void 0!==t.maxResolution?i/Math.pow(s,o):u/Math.pow(s,o):c);o=n+Math.floor(Math.log(i/r)/Math.log(s));r=i/Math.pow(s,o-n);e=eo(s,i,o-n)}return{constraint:e,maxResolution:i,minResolution:r,minZoom:n,zoomFactor:s}}function Io(t){if(void 0===t.enableRotation||t.enableRotation){var e=t.constrainRotation;return void 0===e||!0===e?oo():!1===e?ro:"number"==typeof e?no(e):ro}return io}function Lo(t){return!(t.sourceCenter&&t.targetCenter&&!go(t.sourceCenter,t.targetCenter))&&(t.sourceResolution===t.targetResolution&&t.sourceRotation===t.targetRotation)}var Oo={OPACITY:"opacity",VISIBLE:"visible",EXTENT:"extent",Z_INDEX:"zIndex",MAX_RESOLUTION:"maxResolution",MIN_RESOLUTION:"minResolution",SOURCE:"source"},Po=function(i){function t(t){i.call(this);var e=y({},t);e[Oo.OPACITY]=void 0!==t.opacity?t.opacity:1;e[Oo.VISIBLE]=void 0===t.visible||t.visible;e[Oo.Z_INDEX]=t.zIndex;e[Oo.MAX_RESOLUTION]=void 0!==t.maxResolution?t.maxResolution:1/0;e[Oo.MIN_RESOLUTION]=void 0!==t.minResolution?t.minResolution:0;this.className_=void 0!==e.className?t.className:"ol-layer";delete e.className;this.setProperties(e);this.state_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getClassName=function(){return this.className_};t.prototype.getLayerState=function(){var t=this.state_||{layer:this,managed:!0};t.opacity=zt(this.getOpacity(),0,1);t.sourceState=this.getSourceState();t.visible=this.getVisible();t.extent=this.getExtent();t.zIndex=this.getZIndex()||0;t.maxResolution=this.getMaxResolution();t.minResolution=Math.max(this.getMinResolution(),0);return this.state_=t};t.prototype.getLayersArray=function(t){return o()};t.prototype.getLayerStatesArray=function(t){return o()};t.prototype.getExtent=function(){return this.get(Oo.EXTENT)};t.prototype.getMaxResolution=function(){return this.get(Oo.MAX_RESOLUTION)};t.prototype.getMinResolution=function(){return this.get(Oo.MIN_RESOLUTION)};t.prototype.getOpacity=function(){return this.get(Oo.OPACITY)};t.prototype.getSourceState=function(){return o()};t.prototype.getVisible=function(){return this.get(Oo.VISIBLE)};t.prototype.getZIndex=function(){return this.get(Oo.Z_INDEX)};t.prototype.setExtent=function(t){this.set(Oo.EXTENT,t)};t.prototype.setMaxResolution=function(t){this.set(Oo.MAX_RESOLUTION,t)};t.prototype.setMinResolution=function(t){this.set(Oo.MIN_RESOLUTION,t)};t.prototype.setOpacity=function(t){this.set(Oo.OPACITY,t)};t.prototype.setVisible=function(t){this.set(Oo.VISIBLE,t)};t.prototype.setZIndex=function(t){this.set(Oo.Z_INDEX,t)};return t}(O),bo={UNDEFINED:"undefined",LOADING:"loading",READY:"ready",ERROR:"error"},Mo="layers",Fo=function(n){function t(t){var e=t||{},i=y({},e);delete i.layers;var r=e.layers;n.call(this,i);this.layersListenerKeys_=[];this.listenerKeys_={};m(this,b(Mo),this.handleLayersChanged_,this);r?Array.isArray(r)?r=new N(r.slice(),{unique:!0}):A("function"==typeof r.getArray,43):r=new N(void 0,{unique:!0});this.setLayers(r)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.handleLayerChange_=function(){this.changed()};t.prototype.handleLayersChanged_=function(){this.layersListenerKeys_.forEach(g);this.layersListenerKeys_.length=0;var t=this.getLayers();this.layersListenerKeys_.push(m(t,a.ADD,this.handleLayersAdd_,this),m(t,a.REMOVE,this.handleLayersRemove_,this));for(var e in this.listenerKeys_)this.listenerKeys_[e].forEach(g);_(this.listenerKeys_);for(var i=t.getArray(),r=0,n=i.length;r<n;r++){var o=i[r];this.listenerKeys_[bt(o)]=[m(o,s.PROPERTYCHANGE,this.handleLayerChange_,this),m(o,C.CHANGE,this.handleLayerChange_,this)]}this.changed()};t.prototype.handleLayersAdd_=function(t){var e=t.element;this.listenerKeys_[bt(e)]=[m(e,s.PROPERTYCHANGE,this.handleLayerChange_,this),m(e,C.CHANGE,this.handleLayerChange_,this)];this.changed()};t.prototype.handleLayersRemove_=function(t){var e=bt(t.element);this.listenerKeys_[e].forEach(g);delete this.listenerKeys_[e];this.changed()};t.prototype.getLayers=function(){return this.get(Mo)};t.prototype.setLayers=function(t){this.set(Mo,t)};t.prototype.getLayersArray=function(t){var e=void 0!==t?t:[];this.getLayers().forEach(function(t){t.getLayersArray(e)});return e};t.prototype.getLayerStatesArray=function(t){var e=void 0!==t?t:[],i=e.length;this.getLayers().forEach(function(t){t.getLayerStatesArray(e)});for(var r=this.getLayerState(),n=i,o=e.length;n<o;n++){var s=e[n];s.opacity*=r.opacity;s.visible=s.visible&&r.visible;s.maxResolution=Math.min(s.maxResolution,r.maxResolution);s.minResolution=Math.max(s.minResolution,r.minResolution);void 0!==r.extent&&(void 0!==s.extent?s.extent=Ct(s.extent,r.extent):s.extent=r.extent)}return e};t.prototype.getSourceState=function(){return bo.READY};return t}(Po);function No(t,e,i){void 0===i&&(i=[0,0]);i[0]=t[0]+2*e;i[1]=t[1]+2*e;return i}function Ao(t){return 0<t[0]&&0<t[1]}function Go(t,e,i){void 0===i&&(i=[0,0]);i[0]=t[0]*e+.5|0;i[1]=t[1]*e+.5|0;return i}function Do(t,e){if(Array.isArray(t))return t;void 0===e?e=[t,t]:e[0]=e[1]=t;return e}var ko=function(r){function t(t){r.call(this);var e=function(t){var e=null;void 0!==t.keyboardEventTarget&&(e="string"==typeof t.keyboardEventTarget?document.getElementById(t.keyboardEventTarget):t.keyboardEventTarget);var i,r,n,o={},s=t.layers&&"function"==typeof t.layers.getLayers?t.layers:new Fo({layers:t.layers});o[Wn.LAYERGROUP]=s;o[Wn.TARGET]=t.target;o[Wn.VIEW]=void 0!==t.view?t.view:new xo;if(void 0!==t.controls)if(Array.isArray(t.controls))i=new N(t.controls.slice());else{A("function"==typeof t.controls.getArray,47);i=t.controls}if(void 0!==t.interactions)if(Array.isArray(t.interactions))r=new N(t.interactions.slice());else{A("function"==typeof t.interactions.getArray,48);r=t.interactions}if(void 0!==t.overlays)if(Array.isArray(t.overlays))n=new N(t.overlays.slice());else{A("function"==typeof t.overlays.getArray,49);n=t.overlays}else n=new N;return{controls:i,interactions:r,keyboardEventTarget:e,overlays:n,values:o}}(t);this.maxTilesLoading_=void 0!==t.maxTilesLoading?t.maxTilesLoading:16;this.loadTilesWhileAnimating_=void 0!==t.loadTilesWhileAnimating&&t.loadTilesWhileAnimating;this.loadTilesWhileInteracting_=void 0!==t.loadTilesWhileInteracting&&t.loadTilesWhileInteracting;this.pixelRatio_=void 0!==t.pixelRatio?t.pixelRatio:yr;this.animationDelayKey_;this.animationDelay_=function(){this.animationDelayKey_=void 0;this.renderFrame_(Date.now())}.bind(this);this.coordinateToPixelTransform_=[1,0,0,1,0,0];this.pixelToCoordinateTransform_=[1,0,0,1,0,0];this.frameIndex_=0;this.frameState_=null;this.previousExtent_=null;this.viewPropertyListenerKey_=null;this.viewChangeListenerKey_=null;this.layerGroupPropertyListenerKeys_=null;this.viewport_=document.createElement("div");this.viewport_.className="ol-viewport"+(vr?" ol-touch":"");this.viewport_.style.position="relative";this.viewport_.style.overflow="hidden";this.viewport_.style.width="100%";this.viewport_.style.height="100%";this.viewport_.style.msTouchAction="none";this.viewport_.style.touchAction="none";this.overlayContainer_=document.createElement("div");this.overlayContainer_.style.position="absolute";this.overlayContainer_.style.zIndex="0";this.overlayContainer_.style.width="100%";this.overlayContainer_.style.height="100%";this.overlayContainer_.className="ol-overlaycontainer";this.viewport_.appendChild(this.overlayContainer_);this.overlayContainerStopEvent_=document.createElement("div");this.overlayContainerStopEvent_.style.position="absolute";this.overlayContainerStopEvent_.style.zIndex="0";this.overlayContainerStopEvent_.style.width="100%";this.overlayContainerStopEvent_.style.height="100%";this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";this.viewport_.appendChild(this.overlayContainerStopEvent_);this.mapBrowserEventHandler_=new zn(this,t.moveTolerance);for(var i in rn)m(this.mapBrowserEventHandler_,rn[i],this.handleMapBrowserEvent,this);this.keyboardEventTarget_=e.keyboardEventTarget;this.keyHandlerKeys_=null;m(this.viewport_,C.CONTEXTMENU,this.handleBrowserEvent,this);m(this.viewport_,C.WHEEL,this.handleBrowserEvent,this);m(this.viewport_,C.MOUSEWHEEL,this.handleBrowserEvent,this);this.controls=e.controls||new N;this.interactions=e.interactions||new N;this.overlays_=e.overlays;this.overlayIdIndex_={};this.renderer_=this.createRenderer();this.handleResize_;this.focus_=null;this.postRenderFunctions_=[];this.tileQueue_=new Zn(this.getTilePriority.bind(this),this.handleTileChange_.bind(this));this.skippedFeatureUids_={};m(this,b(Wn.LAYERGROUP),this.handleLayerGroupChanged_,this);m(this,b(Wn.VIEW),this.handleViewChanged_,this);m(this,b(Wn.SIZE),this.handleSizeChanged_,this);m(this,b(Wn.TARGET),this.handleTargetChanged_,this);this.setProperties(e.values);this.controls.forEach(function(t){t.setMap(this)}.bind(this));m(this.controls,a.ADD,function(t){t.element.setMap(this)},this);m(this.controls,a.REMOVE,function(t){t.element.setMap(null)},this);this.interactions.forEach(function(t){t.setMap(this)}.bind(this));m(this.interactions,a.ADD,function(t){t.element.setMap(this)},this);m(this.interactions,a.REMOVE,function(t){t.element.setMap(null)},this);this.overlays_.forEach(this.addOverlayInternal_.bind(this));m(this.overlays_,a.ADD,function(t){this.addOverlayInternal_(t.element)},this);m(this.overlays_,a.REMOVE,function(t){var e=t.element.getId();void 0!==e&&delete this.overlayIdIndex_[e.toString()];t.element.setMap(null)},this)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.createRenderer=function(){throw new Error("Use a map type that has a createRenderer method")};t.prototype.addControl=function(t){this.getControls().push(t)};t.prototype.addInteraction=function(t){this.getInteractions().push(t)};t.prototype.addLayer=function(t){this.getLayerGroup().getLayers().push(t)};t.prototype.addOverlay=function(t){this.getOverlays().push(t)};t.prototype.addOverlayInternal_=function(t){var e=t.getId();void 0!==e&&(this.overlayIdIndex_[e.toString()]=t);t.setMap(this)};t.prototype.disposeInternal=function(){this.mapBrowserEventHandler_.dispose();f(this.viewport_,C.CONTEXTMENU,this.handleBrowserEvent,this);f(this.viewport_,C.WHEEL,this.handleBrowserEvent,this);f(this.viewport_,C.MOUSEWHEEL,this.handleBrowserEvent,this);if(void 0!==this.handleResize_){removeEventListener(C.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}if(this.animationDelayKey_){cancelAnimationFrame(this.animationDelayKey_);this.animationDelayKey_=void 0}this.setTarget(null);r.prototype.disposeInternal.call(this)};t.prototype.forEachFeatureAtPixel=function(t,e,i){if(this.frameState_){var r=this.getCoordinateFromPixel(t),n=void 0!==(i=void 0!==i?i:{}).hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,o=void 0!==i.layerFilter?i.layerFilter:E;return this.renderer_.forEachFeatureAtCoordinate(r,this.frameState_,n,e,null,o,null)}};t.prototype.getFeaturesAtPixel=function(t,e){var i=null;this.forEachFeatureAtPixel(t,function(t){i||(i=[]);i.push(t)},e);return i};t.prototype.forEachLayerAtPixel=function(t,e,i){if(this.frameState_){var r=i||{},n=void 0!==r.hitTolerance?i.hitTolerance*this.frameState_.pixelRatio:0,o=r.layerFilter||E;return this.renderer_.forEachLayerAtPixel(t,this.frameState_,n,e,o)}};t.prototype.hasFeatureAtPixel=function(t,e){if(!this.frameState_)return!1;var i=this.getCoordinateFromPixel(t),r=void 0!==(e=void 0!==e?e:{}).layerFilter?e.layerFilter:E,n=void 0!==e.hitTolerance?e.hitTolerance*this.frameState_.pixelRatio:0;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,n,r,null)};t.prototype.getEventCoordinate=function(t){return this.getCoordinateFromPixel(this.getEventPixel(t))};t.prototype.getEventPixel=function(t){var e=this.viewport_.getBoundingClientRect(),i="changedTouches"in t?t.changedTouches[0]:t;return[i.clientX-e.left,i.clientY-e.top]};t.prototype.getTarget=function(){return this.get(Wn.TARGET)};t.prototype.getTargetElement=function(){var t=this.getTarget();return void 0!==t?"string"==typeof t?document.getElementById(t):t:null};t.prototype.getCoordinateFromPixel=function(t){var e=this.frameState_;return e?qe(e.pixelToCoordinateTransform,t.slice()):null};t.prototype.getControls=function(){return this.controls};t.prototype.getOverlays=function(){return this.overlays_};t.prototype.getOverlayById=function(t){var e=this.overlayIdIndex_[t.toString()];return void 0!==e?e:null};t.prototype.getInteractions=function(){return this.interactions};t.prototype.getLayerGroup=function(){return this.get(Wn.LAYERGROUP)};t.prototype.getLayers=function(){return this.getLayerGroup().getLayers()};t.prototype.getPixelFromCoordinate=function(t){var e=this.frameState_;return e?qe(e.coordinateToPixelTransform,t.slice(0,2)):null};t.prototype.getRenderer=function(){return this.renderer_};t.prototype.getSize=function(){return this.get(Wn.SIZE)};t.prototype.getView=function(){return this.get(Wn.VIEW)};t.prototype.getViewport=function(){return this.viewport_};t.prototype.getOverlayContainer=function(){return this.overlayContainer_};t.prototype.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_};t.prototype.getTilePriority=function(t,e,i,r){var n=this.frameState_;if(!(n&&e in n.wantedTiles))return 1/0;if(!n.wantedTiles[e][t.getKey()])return 1/0;var o=i[0]-n.focus[0],s=i[1]-n.focus[1];return 65536*Math.log(r)+Math.sqrt(o*o+s*s)/r};t.prototype.handleBrowserEvent=function(t,e){var i=e||t.type,r=new en(i,this,t);this.handleMapBrowserEvent(r)};t.prototype.handleMapBrowserEvent=function(t){if(this.frameState_){for(var e=t.originalEvent.target;e instanceof HTMLElement;){if(e.parentElement===this.overlayContainerStopEvent_)return;e=e.parentElement}this.focus_=t.coordinate;t.frameState=this.frameState_;var i=this.getInteractions().getArray();if(!1!==this.dispatchEvent(t))for(var r=i.length-1;0<=r;r--){var n=i[r];if(n.getActive()){if(!n.handleEvent(t))break}}}};t.prototype.handlePostRender=function(){var t=this.frameState_,e=this.tileQueue_;if(!e.isEmpty()){var i=this.maxTilesLoading_,r=i;if(t){var n=t.viewHints;if(n[so.ANIMATING]){i=this.loadTilesWhileAnimating_?8:0;r=2}if(n[so.INTERACTING]){i=this.loadTilesWhileInteracting_?8:0;r=2}}if(e.getTilesLoading()<i){e.reprioritize();e.loadMoreTiles(i,r)}}!t||!this.hasListener(Kn.RENDERCOMPLETE)||t.animate||this.tileQueue_.getTilesLoading()||function t(e){for(var i=0,r=e.length;i<r;++i){var n=e[i];if("function"==typeof n.getLayers)return t(n.getLayers().getArray());var o=n.getSource();if(o&&o.loading)return!0}return!1}(this.getLayers().getArray())||this.renderer_.dispatchRenderEvent(Kn.RENDERCOMPLETE,t);for(var o=this.postRenderFunctions_,s=0,a=o.length;s<a;++s)o[s](this,t);o.length=0};t.prototype.handleSizeChanged_=function(){this.render()};t.prototype.handleTargetChanged_=function(){var t;this.getTarget()&&(t=this.getTargetElement());if(this.keyHandlerKeys_){for(var e=0,i=this.keyHandlerKeys_.length;e<i;++e)g(this.keyHandlerKeys_[e]);this.keyHandlerKeys_=null}if(t){t.appendChild(this.viewport_);var r=this.keyboardEventTarget_?this.keyboardEventTarget_:t;this.keyHandlerKeys_=[m(r,C.KEYDOWN,this.handleBrowserEvent,this),m(r,C.KEYPRESS,this.handleBrowserEvent,this)];if(!this.handleResize_){this.handleResize_=this.updateSize.bind(this);addEventListener(C.RESIZE,this.handleResize_,!1)}}else{this.renderer_.removeLayerRenderers();Hr(this.viewport_);if(void 0!==this.handleResize_){removeEventListener(C.RESIZE,this.handleResize_,!1);this.handleResize_=void 0}}this.updateSize()};t.prototype.handleTileChange_=function(){this.render()};t.prototype.handleViewPropertyChanged_=function(){this.render()};t.prototype.handleViewChanged_=function(){if(this.viewPropertyListenerKey_){g(this.viewPropertyListenerKey_);this.viewPropertyListenerKey_=null}if(this.viewChangeListenerKey_){g(this.viewChangeListenerKey_);this.viewChangeListenerKey_=null}var t=this.getView();if(t){this.viewport_.setAttribute("data-view",bt(t));this.viewPropertyListenerKey_=m(t,s.PROPERTYCHANGE,this.handleViewPropertyChanged_,this);this.viewChangeListenerKey_=m(t,C.CHANGE,this.handleViewPropertyChanged_,this)}this.render()};t.prototype.handleLayerGroupChanged_=function(){if(this.layerGroupPropertyListenerKeys_){this.layerGroupPropertyListenerKeys_.forEach(g);this.layerGroupPropertyListenerKeys_=null}var t=this.getLayerGroup();t&&(this.layerGroupPropertyListenerKeys_=[m(t,s.PROPERTYCHANGE,this.render,this),m(t,C.CHANGE,this.render,this)]);this.render()};t.prototype.isRendered=function(){return!!this.frameState_};t.prototype.renderSync=function(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_);this.animationDelay_()};t.prototype.render=function(){void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))};t.prototype.removeControl=function(t){return this.getControls().remove(t)};t.prototype.removeInteraction=function(t){return this.getInteractions().remove(t)};t.prototype.removeLayer=function(t){return this.getLayerGroup().getLayers().remove(t)};t.prototype.removeOverlay=function(t){return this.getOverlays().remove(t)};t.prototype.renderFrame_=function(t){var e,i=this.getSize(),r=this.getView(),n=[1/0,1/0,-1/0,-1/0],o=this.frameState_,s=null;if(void 0!==i&&Ao(i)&&r&&r.isDef()){for(var a=r.getHints(this.frameState_?this.frameState_.viewHints:void 0),h=this.getLayerGroup().getLayerStatesArray(),l={},u=0,c=h.length;u<c;++u)l[bt(h[u].layer)]=h[u];e=r.getState(this.pixelRatio_);s={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,extent:n,focus:this.focus_?this.focus_:e.center,index:this.frameIndex_++,layerStates:l,layerStatesArray:h,pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:i,skippedFeatureUids:this.skippedFeatureUids_,tileQueue:this.tileQueue_,time:t,usedTiles:{},viewState:e,viewHints:a,wantedTiles:{}}}s&&(s.extent=xt(e.center,e.resolution,e.rotation,s.size,n));this.frameState_=s;this.renderer_.renderFrame(s);if(s){s.animate&&this.render();Array.prototype.push.apply(this.postRenderFunctions_,s.postRenderFunctions);if(o){if(!this.previousExtent_||!Ot(this.previousExtent_)&&!ut(s.extent,this.previousExtent_)){this.dispatchEvent(new tn(Vn.MOVESTART,this,o));this.previousExtent_=st(this.previousExtent_)}}if(this.previousExtent_&&!s.viewHints[so.ANIMATING]&&!s.viewHints[so.INTERACTING]&&!ut(s.extent,this.previousExtent_)){this.dispatchEvent(new tn(Vn.MOVEEND,this,s));Q(s.extent,this.previousExtent_)}}this.dispatchEvent(new tn(Vn.POSTRENDER,this,s));setTimeout(this.handlePostRender.bind(this),0)};t.prototype.setLayerGroup=function(t){this.set(Wn.LAYERGROUP,t)};t.prototype.setSize=function(t){this.set(Wn.SIZE,t)};t.prototype.setTarget=function(t){this.set(Wn.TARGET,t)};t.prototype.setView=function(t){this.set(Wn.VIEW,t)};t.prototype.skipFeature=function(t){this.skippedFeatureUids_[bt(t)]=!0;this.render()};t.prototype.updateSize=function(){var t=this.getTargetElement();if(t){var e=getComputedStyle(t);this.setSize([t.offsetWidth-parseFloat(e.borderLeftWidth)-parseFloat(e.paddingLeft)-parseFloat(e.paddingRight)-parseFloat(e.borderRightWidth),t.offsetHeight-parseFloat(e.borderTopWidth)-parseFloat(e.paddingTop)-parseFloat(e.paddingBottom)-parseFloat(e.borderBottomWidth)])}else this.setSize(void 0)};t.prototype.unskipFeature=function(t){delete this.skippedFeatureUids_[bt(t)];this.render()};return t}(O);var jo,Uo,Yo=function(e){function t(t){e.call(this);this.element=t.element?t.element:null;this.target_=null;this.map_=null;this.listenerKeys=[];this.render=t.render?t.render:L;t.target&&this.setTarget(t.target)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){Hr(this.element);e.prototype.disposeInternal.call(this)};t.prototype.getMap=function(){return this.map_};t.prototype.setMap=function(t){this.map_&&Hr(this.element);for(var e=0,i=this.listenerKeys.length;e<i;++e)g(this.listenerKeys[e]);this.listenerKeys.length=0;this.map_=t;if(this.map_){(this.target_?this.target_:t.getOverlayContainerStopEvent()).appendChild(this.element);this.render!==L&&this.listenerKeys.push(m(t,Vn.POSTRENDER,this.render,this));t.render()}};t.prototype.setTarget=function(t){this.target_="string"==typeof t?document.getElementById(t):t};return t}(O),Xo="ol-hidden",Bo="ol-selectable",zo="ol-unselectable",Vo="ol-unsupported",Wo="ol-control",Ko="ol-collapsed",Ho=(Uo={},function(t){jo||(jo=document.createElement("div").style);if(!(t in Uo)){jo.font=t;var e=jo.fontFamily;jo.font="";if(!e)return null;Uo[t]=e.split(/,\s?/)}return Uo[t]}),Zo=function(r){function t(t){var e=y({},t);delete e.source;r.call(this,e);this.mapPrecomposeKey_=null;this.mapRenderKey_=null;this.sourceChangeKey_=null;this.renderer_=null;t.map&&this.setMap(t.map);m(this,b(Oo.SOURCE),this.handleSourcePropertyChange_,this);var i=t.source?t.source:null;this.setSource(i)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getLayersArray=function(t){var e=t||[];e.push(this);return e};t.prototype.getLayerStatesArray=function(t){var e=t||[];e.push(this.getLayerState());return e};t.prototype.getSource=function(){return this.get(Oo.SOURCE)||null};t.prototype.getSourceState=function(){var t=this.getSource();return t?t.getState():bo.UNDEFINED};t.prototype.handleSourceChange_=function(){this.changed()};t.prototype.handleSourcePropertyChange_=function(){if(this.sourceChangeKey_){g(this.sourceChangeKey_);this.sourceChangeKey_=null}var t=this.getSource();t&&(this.sourceChangeKey_=m(t,C.CHANGE,this.handleSourceChange_,this));this.changed()};t.prototype.render=function(t){var e=this.getRenderer(),i=this.getLayerState();if(e.prepareFrame(t,i))return e.renderFrame(t,i)};t.prototype.setMap=function(t){if(this.mapPrecomposeKey_){g(this.mapPrecomposeKey_);this.mapPrecomposeKey_=null}t||this.changed();if(this.mapRenderKey_){g(this.mapRenderKey_);this.mapRenderKey_=null}if(t){this.mapPrecomposeKey_=m(t,Kn.PRECOMPOSE,function(t){var e=t,i=this.getLayerState();i.managed=!1;void 0===this.getZIndex()&&(i.zIndex=1/0);e.frameState.layerStatesArray.push(i);e.frameState.layerStates[bt(this)]=i},this);this.mapRenderKey_=m(this,C.CHANGE,t.render,t);this.changed()}};t.prototype.setSource=function(t){this.set(Oo.SOURCE,t)};t.prototype.getRenderer=function(){this.renderer_||(this.renderer_=this.createRenderer());return this.renderer_};t.prototype.createRenderer=function(){return null};return t}(Po);function qo(t,e){return t.visible&&e>=t.minResolution&&e<t.maxResolution}var Jo=function(u){function t(t){var e=t||{};u.call(this,{element:document.createElement("div"),render:e.render||Qo,target:e.target});this.ulElement_=document.createElement("ul");this.collapsed_=void 0===e.collapsed||e.collapsed;this.overrideCollapsible_=void 0!==e.collapsible;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var i=void 0!==e.className?e.className:"ol-attribution",r=void 0!==e.tipLabel?e.tipLabel:"Attributions",n=void 0!==e.collapseLabel?e.collapseLabel:"";if("string"==typeof n){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=n}else this.collapseLabel_=n;var o=void 0!==e.label?e.label:"i";if("string"==typeof o){this.label_=document.createElement("span");this.label_.textContent=o}else this.label_=o;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button");a.title=r;a.appendChild(s);m(a,C.CLICK,this.handleClick_,this);var h=i+" "+zo+" "+Wo+(this.collapsed_&&this.collapsible_?" "+Ko:"")+(this.collapsible_?"":" ol-uncollapsible"),l=this.element;l.className=h;l.appendChild(this.ulElement_);l.appendChild(a);this.renderedAttributions_=[];this.renderedVisible_=!0}u&&(t.__proto__=u);((t.prototype=Object.create(u&&u.prototype)).constructor=t).prototype.collectSourceAttributions_=function(t){for(var e={},i=[],r=t.layerStatesArray,n=t.viewState.resolution,o=0,s=r.length;o<s;++o){var a=r[o];if(qo(a,n)){var h=a.layer.getSource();if(h){var l=h.getAttributions();if(l){var u=l(t);if(u){this.overrideCollapsible_||!1!==h.getAttributionsCollapsible()||this.setCollapsible(!1);if(Array.isArray(u)){for(var c=0,p=u.length;c<p;++c)if(!(u[c]in e)){i.push(u[c]);e[u[c]]=!0}}else if(!(u in e)){i.push(u);e[u]=!0}}}}}}return i};t.prototype.updateElement_=function(t){if(t){var e=this.collectSourceAttributions_(t),i=0<e.length;if(this.renderedVisible_!=i){this.element.style.display=i?"":"none";this.renderedVisible_=i}if(!Ft(e,this.renderedAttributions_)){Zr(this.ulElement_);for(var r=0,n=e.length;r<n;++r){var o=document.createElement("li");o.innerHTML=e[r];this.ulElement_.appendChild(o)}this.renderedAttributions_=e}}else if(this.renderedVisible_){this.element.style.display="none";this.renderedVisible_=!1}};t.prototype.handleClick_=function(t){t.preventDefault();this.handleToggle_()};t.prototype.handleToggle_=function(){this.element.classList.toggle(Ko);this.collapsed_?Kr(this.collapseLabel_,this.label_):Kr(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_};t.prototype.getCollapsible=function(){return this.collapsible_};t.prototype.setCollapsible=function(t){if(this.collapsible_!==t){this.collapsible_=t;this.element.classList.toggle("ol-uncollapsible");!t&&this.collapsed_&&this.handleToggle_()}};t.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()};t.prototype.getCollapsed=function(){return this.collapsed_};return t}(Yo);function Qo(t){this.updateElement_(t.frameState)}var $o=function(h){function t(t){var e=t||{};h.call(this,{element:document.createElement("div"),render:e.render||ts,target:e.target});var i=void 0!==e.className?e.className:"ol-rotate",r=void 0!==e.label?e.label:"";this.label_=null;if("string"==typeof r){this.label_=document.createElement("span");this.label_.className="ol-compass";this.label_.textContent=r}else{this.label_=r;this.label_.classList.add("ol-compass")}var n=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=i+"-reset";o.setAttribute("type","button");o.title=n;o.appendChild(this.label_);m(o,C.CLICK,this.handleClick_,this);var s=i+" "+zo+" "+Wo,a=this.element;a.className=s;a.appendChild(o);this.callResetNorth_=e.resetNorth?e.resetNorth:void 0;this.duration_=void 0!==e.duration?e.duration:250;this.autoHide_=void 0===e.autoHide||e.autoHide;this.rotation_=void 0;this.autoHide_&&this.element.classList.add(Xo)}h&&(t.__proto__=h);((t.prototype=Object.create(h&&h.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()};t.prototype.resetNorth_=function(){var t=this.getMap().getView();t&&void 0!==t.getRotation()&&(0<this.duration_?t.animate({rotation:0,duration:this.duration_,easing:Ur}):t.setRotation(0))};return t}(Yo);function ts(t){var e=t.frameState;if(e){var i=e.viewState.rotation;if(i!=this.rotation_){var r="rotate("+i+"rad)";if(this.autoHide_){var n=this.element.classList.contains(Xo);n||0!==i?n&&0!==i&&this.element.classList.remove(Xo):this.element.classList.add(Xo)}this.label_.style.msTransform=r;this.label_.style.webkitTransform=r;this.label_.style.transform=r}this.rotation_=i}}var es=function(p){function t(t){var e=t||{};p.call(this,{element:document.createElement("div"),target:e.target});var i=void 0!==e.className?e.className:"ol-zoom",r=void 0!==e.delta?e.delta:1,n=void 0!==e.zoomInLabel?e.zoomInLabel:"+",o=void 0!==e.zoomOutLabel?e.zoomOutLabel:"",s=void 0!==e.zoomInTipLabel?e.zoomInTipLabel:"Zoom in",a=void 0!==e.zoomOutTipLabel?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=i+"-in";h.setAttribute("type","button");h.title=s;h.appendChild("string"==typeof n?document.createTextNode(n):n);m(h,C.CLICK,this.handleClick_.bind(this,r));var l=document.createElement("button");l.className=i+"-out";l.setAttribute("type","button");l.title=a;l.appendChild("string"==typeof o?document.createTextNode(o):o);m(l,C.CLICK,this.handleClick_.bind(this,-r));var u=i+" "+zo+" "+Wo,c=this.element;c.className=u;c.appendChild(h);c.appendChild(l);this.duration_=void 0!==e.duration?e.duration:250}p&&(t.__proto__=p);((t.prototype=Object.create(p&&p.prototype)).constructor=t).prototype.handleClick_=function(t,e){e.preventDefault();this.zoomByDelta_(t)};t.prototype.zoomByDelta_=function(t){var e=this.getMap().getView();if(e){var i=e.getResolution();if(i){var r=e.constrainResolution(i,t);if(0<this.duration_){e.getAnimating()&&e.cancelAnimations();e.animate({resolution:r,duration:this.duration_,easing:Ur})}else e.setResolution(r)}}};return t}(Yo);function is(t){var e=t||{},i=new N;(void 0===e.zoom||e.zoom)&&i.push(new es(e.zoomOptions));(void 0===e.rotate||e.rotate)&&i.push(new $o(e.rotateOptions));(void 0===e.attribution||e.attribution)&&i.push(new Jo(e.attributionOptions));return i}var rs={ACTIVE:"active"},ns=function(e){function t(t){e.call(this);t.handleEvent&&(this.handleEvent=t.handleEvent);this.map_=null;this.setActive(!0)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getActive=function(){return this.get(rs.ACTIVE)};t.prototype.getMap=function(){return this.map_};t.prototype.handleEvent=function(t){return!0};t.prototype.setActive=function(t){this.set(rs.ACTIVE,t)};t.prototype.setMap=function(t){this.map_=t};return t}(O);function os(t,e,i){var r=t.getCenter();if(r){var n=t.constrainCenter([r[0]+e[0],r[1]+e[1]]);i?t.animate({duration:i,easing:Xr,center:n}):t.setCenter(n)}}function ss(t,e,i,r){as(t,e=t.constrainRotation(e,0),i,r)}function as(t,e,i,r){if(void 0!==e){var n=t.getRotation(),o=t.getCenter();void 0!==n&&o&&0<r?t.animate({rotation:e,anchor:i,duration:r,easing:Ur}):t.rotate(e,i)}}function hs(t,e,i,r,n){us(t,e=t.constrainResolution(e,0,n),i,r)}function ls(t,e,i,r){var n=t.getResolution(),o=t.constrainResolution(n,e,0);if(void 0!==o){var s=t.getResolutions();o=zt(o,t.getMinResolution()||s[s.length-1],t.getMaxResolution()||s[0])}if(i&&void 0!==o&&o!==n){var a=t.getCenter(),h=t.calculateCenterZoom(o,i);h=t.constrainCenter(h);i=[(o*a[0]-n*h[0])/(o-n),(o*a[1]-n*h[1])/(o-n)]}us(t,o,i,r)}function us(t,e,i,r){if(e){var n=t.getResolution(),o=t.getCenter();if(void 0!==n&&o&&e!==n&&r)t.animate({resolution:e,anchor:i,duration:r,easing:Ur});else{if(i){var s=t.calculateCenterZoom(e,i);t.setCenter(s)}t.setResolution(e)}}}var cs=function(i){function t(t){i.call(this,{handleEvent:ps});var e=t||{};this.delta_=e.delta?e.delta:1;this.duration_=void 0!==e.duration?e.duration:250}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ns);function ps(t){var e=!1;if(t.type==rn.DBLCLICK){var i=t.originalEvent,r=t.map,n=t.coordinate,o=i.shiftKey?-this.delta_:this.delta_;ls(r.getView(),o,n,this.duration_);t.preventDefault();e=!0}return!e}var ds=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},fs=function(t){var e=t.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},_s=function(t){return t.target.getTargetElement()===document.activeElement},gs=E,ys=function(t){var e=t.originalEvent;return 0==e.button&&!(_r&&gr&&e.ctrlKey)},ms=T,vs=function(t){return"pointermove"==t.type},Es=function(t){return t.type==rn.SINGLECLICK},Ts=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ss=function(t){var e=t.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},xs=function(t){var e=t.originalEvent.target.tagName;return"INPUT"!==e&&"SELECT"!==e&&"TEXTAREA"!==e},Rs=function(t){var e=t.pointerEvent;A(void 0!==e,56);return"mouse"==e.pointerType},Cs=function(t){var e=t.pointerEvent;A(void 0!==e,56);return e.isPrimary&&0===e.button},ws=function(i){function t(t){var e=t||{};i.call(this,e);e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent);e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent);e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent);e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent);e.stopDown&&(this.stopDown=e.stopDown);this.handlingDownUpSequence=!1;this.trackedPointers_={};this.targetPointers=[]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleDownEvent=function(t){return!1};t.prototype.handleDragEvent=function(t){};t.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e=!1;this.updateTrackedPointers_(t);if(this.handlingDownUpSequence){if(t.type==rn.POINTERDRAG)this.handleDragEvent(t);else if(t.type==rn.POINTERUP){var i=this.handleUpEvent(t);this.handlingDownUpSequence=i&&0<this.targetPointers.length}}else if(t.type==rn.POINTERDOWN){var r=this.handleDownEvent(t);r&&t.preventDefault();this.handlingDownUpSequence=r;e=this.stopDown(r)}else t.type==rn.POINTERMOVE&&this.handleMoveEvent(t);return!e};t.prototype.handleMoveEvent=function(t){};t.prototype.handleUpEvent=function(t){return!1};t.prototype.stopDown=function(t){return t};t.prototype.updateTrackedPointers_=function(t){if((r=t.type)===rn.POINTERDOWN||r===rn.POINTERDRAG||r===rn.POINTERUP){var e=t.pointerEvent,i=e.pointerId.toString();t.type==rn.POINTERUP?delete this.trackedPointers_[i]:t.type==rn.POINTERDOWN?this.trackedPointers_[i]=e:i in this.trackedPointers_&&(this.trackedPointers_[i]=e);this.targetPointers=h(this.trackedPointers_)}var r};return t}(ns);function Is(t){for(var e=t.length,i=0,r=0,n=0;n<e;n++){i+=t[n].clientX;r+=t[n].clientY}return[i/e,r/e]}var Ls=function(i){function t(t){i.call(this,{stopDown:T});var e=t||{};this.kinetic_=e.kinetic;this.lastCentroid=null;this.lastPointersCount_;this.panning_=!1;this.condition_=e.condition?e.condition:Ts;this.noKinetic_=!1}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleDragEvent=function(t){if(!this.panning_){this.panning_=!0;this.getMap().getView().setHint(so.INTERACTING,1)}var e=this.targetPointers,i=Is(e);if(e.length==this.lastPointersCount_){this.kinetic_&&this.kinetic_.update(i[0],i[1]);if(this.lastCentroid){var r=this.lastCentroid[0]-i[0],n=i[1]-this.lastCentroid[1],o=t.map.getView(),s=[r,n];mo(s,o.getResolution());yo(s,o.getRotation());uo(s,o.getCenter());s=o.constrainCenter(s);o.setCenter(s)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=i;this.lastPointersCount_=e.length};t.prototype.handleUpEvent=function(t){var e=t.map,i=e.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){var r=this.kinetic_.getDistance(),n=this.kinetic_.getAngle(),o=i.getCenter(),s=e.getPixelFromCoordinate(o),a=e.getCoordinateFromPixel([s[0]-r*Math.cos(n),s[1]-r*Math.sin(n)]);i.animate({center:i.constrainCenter(a),duration:500,easing:Ur})}if(this.panning_){this.panning_=!1;i.setHint(so.INTERACTING,-1)}return!1}this.kinetic_&&this.kinetic_.begin();return!(this.lastCentroid=null)};t.prototype.handleDownEvent=function(t){if(0<this.targetPointers.length&&this.condition_(t)){var e=t.map.getView();this.lastCentroid=null;e.getAnimating()&&e.setCenter(t.frameState.viewState.center);this.kinetic_&&this.kinetic_.begin();this.noKinetic_=1<this.targetPointers.length;return!0}return!1};return t}(ws),Os=function(i){function t(t){var e=t||{};i.call(this,{stopDown:T});this.condition_=e.condition?e.condition:fs;this.lastAngle_=void 0;this.duration_=void 0!==e.duration?e.duration:250}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleDragEvent=function(t){if(Rs(t)){var e=t.map,i=e.getView();if(i.getConstraints().rotation!==io){var r=e.getSize(),n=t.pixel,o=Math.atan2(r[1]/2-n[1],n[0]-r[0]/2);if(void 0!==this.lastAngle_){var s=o-this.lastAngle_;as(i,i.getRotation()-s)}this.lastAngle_=o}}};t.prototype.handleUpEvent=function(t){if(!Rs(t))return!0;var e=t.map.getView();e.setHint(so.INTERACTING,-1);ss(e,e.getRotation(),void 0,this.duration_);return!1};t.prototype.handleDownEvent=function(t){if(!Rs(t))return!1;if(ys(t)&&this.condition_(t)){t.map.getView().setHint(so.INTERACTING,1);return!(this.lastAngle_=void 0)}return!1};return t}(ws),Ps=function(e){function t(t){e.call(this);this.geometry_=null;this.element_=document.createElement("div");this.element_.style.position="absolute";this.element_.className="ol-box "+t;this.map_=null;this.startPixel_=null;this.endPixel_=null}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){this.setMap(null)};t.prototype.render_=function(){var t=this.startPixel_,e=this.endPixel_,i=this.element_.style;i.left=Math.min(t[0],e[0])+"px";i.top=Math.min(t[1],e[1])+"px";i.width=Math.abs(e[0]-t[0])+"px";i.height=Math.abs(e[1]-t[1])+"px"};t.prototype.setMap=function(t){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);var e=this.element_.style;e.left=e.top=e.width=e.height="inherit"}this.map_=t;this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)};t.prototype.setPixels=function(t,e){this.startPixel_=t;this.endPixel_=e;this.createOrUpdateGeometry();this.render_()};t.prototype.createOrUpdateGeometry=function(){var t=this.startPixel_,e=this.endPixel_,i=[t,[t[0],e[1]],e,[e[0],t[1]]].map(this.map_.getCoordinateFromPixel,this.map_);i[4]=i[0].slice();this.geometry_?this.geometry_.setCoordinates([i]):this.geometry_=new tr([i])};t.prototype.getGeometry=function(){return this.geometry_};return t}(i),bs="boxstart",Ms="boxdrag",Fs="boxend",Ns=function(r){function t(t,e,i){r.call(this,t);this.coordinate=e;this.mapBrowserEvent=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),As=function(i){function t(t){i.call(this);var e=t||{};this.box_=new Ps(e.className||"ol-dragbox");this.minArea_=void 0!==e.minArea?e.minArea:64;this.onBoxEnd_=e.onBoxEnd?e.onBoxEnd:L;this.startPixel_=null;this.condition_=e.condition?e.condition:gs;this.boxEndCondition_=e.boxEndCondition?e.boxEndCondition:this.defaultBoxEndCondition}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.defaultBoxEndCondition=function(t,e,i){var r=i[0]-e[0],n=i[1]-e[1];return r*r+n*n>=this.minArea_};t.prototype.getGeometry=function(){return this.box_.getGeometry()};t.prototype.handleDragEvent=function(t){if(Rs(t)){this.box_.setPixels(this.startPixel_,t.pixel);this.dispatchEvent(new Ns(Ms,t.coordinate,t))}};t.prototype.handleUpEvent=function(t){if(!Rs(t))return!0;this.box_.setMap(null);if(this.boxEndCondition_(t,this.startPixel_,t.pixel)){this.onBoxEnd_(t);this.dispatchEvent(new Ns(Fs,t.coordinate,t))}return!1};t.prototype.handleDownEvent=function(t){if(!Rs(t))return!1;if(ys(t)&&this.condition_(t)){this.startPixel_=t.pixel;this.box_.setMap(t.map);this.box_.setPixels(this.startPixel_,this.startPixel_);this.dispatchEvent(new Ns(bs,t.coordinate,t));return!0}return!1};return t}(ws),Gs=function(r){function t(t){var e=t||{},i=e.condition?e.condition:Ss;r.call(this,{condition:i,className:e.className||"ol-dragzoom",onBoxEnd:Ds});this.duration_=void 0!==e.duration?e.duration:200;this.out_=void 0!==e.out&&e.out}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(As);function Ds(){var t=this.getMap(),e=t.getView(),i=t.getSize(),r=this.getGeometry().getExtent();if(this.out_){var n=e.calculateExtent(i),o=ht([t.getPixelFromCoordinate(vt(r)),t.getPixelFromCoordinate(It(r))]);At(n,1/e.getResolutionForExtent(o,i));r=n}var s=e.constrainResolution(e.getResolutionForExtent(r,i)),a=Tt(r);a=e.constrainCenter(a);e.animate({resolution:s,center:a,duration:this.duration_,easing:Ur})}var ks={LEFT:37,UP:38,RIGHT:39,DOWN:40},js=function(i){function t(t){i.call(this,{handleEvent:Us});var e=t||{};this.defaultCondition_=function(t){return Ts(t)&&xs(t)};this.condition_=void 0!==e.condition?e.condition:this.defaultCondition_;this.duration_=void 0!==e.duration?e.duration:100;this.pixelDelta_=void 0!==e.pixelDelta?e.pixelDelta:128}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ns);function Us(t){var e=!1;if(t.type==C.KEYDOWN){var i=t.originalEvent.keyCode;if(this.condition_(t)&&(i==ks.DOWN||i==ks.LEFT||i==ks.RIGHT||i==ks.UP)){var r=t.map.getView(),n=r.getResolution()*this.pixelDelta_,o=0,s=0;i==ks.DOWN?s=-n:i==ks.LEFT?o=-n:i==ks.RIGHT?o=n:s=n;var a=[o,s];yo(a,r.getRotation());os(r,a,this.duration_);t.preventDefault();e=!0}}return!e}var Ys=function(i){function t(t){i.call(this,{handleEvent:Xs});var e=t||{};this.condition_=e.condition?e.condition:xs;this.delta_=e.delta?e.delta:1;this.duration_=void 0!==e.duration?e.duration:100}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(ns);function Xs(t){var e=!1;if(t.type==C.KEYDOWN||t.type==C.KEYPRESS){var i=t.originalEvent.charCode;if(this.condition_(t)&&(i=="+".charCodeAt(0)||i=="-".charCodeAt(0))){var r=t.map,n=i=="+".charCodeAt(0)?this.delta_:-this.delta_;ls(r.getView(),n,void 0,this.duration_);t.preventDefault();e=!0}}return!e}var Bs={TRACKPAD:"trackpad",WHEEL:"wheel"},zs=function(i){function t(t){var e=t||{};i.call(this,e);this.delta_=0;this.duration_=void 0!==e.duration?e.duration:250;this.timeout_=void 0!==e.timeout?e.timeout:80;this.useAnchor_=void 0===e.useAnchor||e.useAnchor;this.constrainResolution_=e.constrainResolution||!1;this.condition_=e.condition?e.condition:gs;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_;this.mode_=void 0;this.trackpadEventGap_=400;this.trackpadTimeoutId_;this.trackpadDeltaPerZoom_=300;this.trackpadZoomBuffer_=1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.decrementInteractingHint_=function(){this.trackpadTimeoutId_=void 0;this.getMap().getView().setHint(so.INTERACTING,-1)};t.prototype.handleEvent=function(t){if(!this.condition_(t))return!0;var e=t.type;if(e!==C.WHEEL&&e!==C.MOUSEWHEEL)return!0;t.preventDefault();var i,r=t.map,n=t.originalEvent;this.useAnchor_&&(this.lastAnchor_=t.coordinate);if(t.type==C.WHEEL){i=n.deltaY;dr&&n.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(i/=yr);n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(i*=40)}else if(t.type==C.MOUSEWHEEL){i=-n.wheelDeltaY;fr&&(i/=3)}if(0===i)return!1;var o=Date.now();void 0===this.startTime_&&(this.startTime_=o);(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(i)<4?Bs.TRACKPAD:Bs.WHEEL);if(this.mode_===Bs.TRACKPAD){var s=r.getView();this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):s.setHint(so.INTERACTING,1);this.trackpadTimeoutId_=setTimeout(this.decrementInteractingHint_.bind(this),this.trackpadEventGap_);var a=s.getResolution()*Math.pow(2,i/this.trackpadDeltaPerZoom_),h=s.getMinResolution(),l=s.getMaxResolution(),u=0;if(a<h){a=Math.max(a,h/this.trackpadZoomBuffer_);u=1}else if(l<a){a=Math.min(a,l*this.trackpadZoomBuffer_);u=-1}if(this.lastAnchor_){var c=s.calculateCenterZoom(a,this.lastAnchor_);s.setCenter(s.constrainCenter(c))}s.setResolution(a);0===u&&this.constrainResolution_&&s.animate({resolution:s.constrainResolution(a,0<i?-1:1),easing:Ur,anchor:this.lastAnchor_,duration:this.duration_});0<u?s.animate({resolution:h,easing:Ur,anchor:this.lastAnchor_,duration:500}):u<0&&s.animate({resolution:l,easing:Ur,anchor:this.lastAnchor_,duration:500});this.startTime_=o;return!1}this.delta_+=i;var p=Math.max(this.timeout_-(o-this.startTime_),0);clearTimeout(this.timeoutId_);this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,r),p);return!1};t.prototype.handleWheelZoom_=function(t){var e=t.getView();e.getAnimating()&&e.cancelAnimations();ls(e,-zt(this.delta_,-1,1),this.lastAnchor_,this.duration_);this.mode_=void 0;this.delta_=0;this.lastAnchor_=null;this.startTime_=void 0;this.timeoutId_=void 0};t.prototype.setMouseAnchor=function(t){(this.useAnchor_=t)||(this.lastAnchor_=null)};return t}(ns),Vs=function(r){function t(t){var e=t||{},i=e;i.stopDown||(i.stopDown=T);r.call(this,i);this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.threshold_=void 0!==e.threshold?e.threshold:.3;this.duration_=void 0!==e.duration?e.duration:250}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.handleDragEvent=function(t){var e=0,i=this.targetPointers[0],r=this.targetPointers[1],n=Math.atan2(r.clientY-i.clientY,r.clientX-i.clientX);if(void 0!==this.lastAngle_){var o=n-this.lastAngle_;this.rotationDelta_+=o;!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0);e=o}this.lastAngle_=n;var s=t.map,a=s.getView();if(a.getConstraints().rotation!==io){var h=s.getViewport().getBoundingClientRect(),l=Is(this.targetPointers);l[0]-=h.left;l[1]-=h.top;this.anchor_=s.getCoordinateFromPixel(l);if(this.rotating_){var u=a.getRotation();s.render();as(a,u+e,this.anchor_)}}};t.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(so.INTERACTING,-1);if(this.rotating_){ss(e,e.getRotation(),this.anchor_,this.duration_)}return!1}return!0};t.prototype.handleDownEvent=function(t){if(2<=this.targetPointers.length){var e=t.map;this.anchor_=null;this.lastAngle_=void 0;this.rotating_=!1;this.rotationDelta_=0;this.handlingDownUpSequence||e.getView().setHint(so.INTERACTING,1);return!0}return!1};return t}(ws),Ws=function(r){function t(t){var e=t||{},i=e;i.stopDown||(i.stopDown=T);r.call(this,i);this.constrainResolution_=e.constrainResolution||!1;this.anchor_=null;this.duration_=void 0!==e.duration?e.duration:400;this.lastDistance_=void 0;this.lastScaleDelta_=1}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.handleDragEvent=function(t){var e=1,i=this.targetPointers[0],r=this.targetPointers[1],n=i.clientX-r.clientX,o=i.clientY-r.clientY,s=Math.sqrt(n*n+o*o);void 0!==this.lastDistance_&&(e=this.lastDistance_/s);this.lastDistance_=s;var a=t.map,h=a.getView(),l=h.getResolution(),u=h.getMaxResolution(),c=h.getMinResolution(),p=l*e;if(u<p){e=u/l;p=u}else if(p<c){e=c/l;p=c}1!=e&&(this.lastScaleDelta_=e);var d=a.getViewport().getBoundingClientRect(),f=Is(this.targetPointers);f[0]-=d.left;f[1]-=d.top;this.anchor_=a.getCoordinateFromPixel(f);a.render();us(h,p,this.anchor_)};t.prototype.handleUpEvent=function(t){if(this.targetPointers.length<2){var e=t.map.getView();e.setHint(so.INTERACTING,-1);var i=e.getResolution();if(this.constrainResolution_||i<e.getMinResolution()||i>e.getMaxResolution()){var r=this.lastScaleDelta_-1;hs(e,i,this.anchor_,this.duration_,r)}return!1}return!0};t.prototype.handleDownEvent=function(t){if(2<=this.targetPointers.length){var e=t.map;this.anchor_=null;this.lastDistance_=void 0;this.lastScaleDelta_=1;this.handlingDownUpSequence||e.getView().setHint(so.INTERACTING,1);return!0}return!1};return t}(ws),Ks="addfeatures",Hs=function(n){function t(t,e,i,r){n.call(this,t);this.features=i;this.file=e;this.projection=r}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(S),Zs=function(i){function t(t){var e=t||{};i.call(this,{handleEvent:E});this.formatConstructors_=e.formatConstructors?e.formatConstructors:[];this.projection_=e.projection?be(e.projection):null;this.dropListenKeys_=null;this.source_=e.source||null;this.target=e.target?e.target:null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleResult_=function(t,e){var i=e.target.result,r=this.getMap(),n=this.projection_;if(!n){n=r.getView().getProjection()}for(var o=this.formatConstructors_,s=[],a=0,h=o.length;a<h;++a){var l=new o[a];if((s=this.tryReadFeatures_(l,i,{featureProjection:n}))&&0<s.length)break}if(this.source_){this.source_.clear();this.source_.addFeatures(s)}this.dispatchEvent(new Hs(Ks,t,s,n))};t.prototype.registerListeners_=function(){var t=this.getMap();if(t){var e=this.target?this.target:t.getViewport();this.dropListenKeys_=[m(e,C.DROP,qs,this),m(e,C.DRAGENTER,Js,this),m(e,C.DRAGOVER,Js,this),m(e,C.DROP,Js,this)]}};t.prototype.setActive=function(t){i.prototype.setActive.call(this,t);t?this.registerListeners_():this.unregisterListeners_()};t.prototype.setMap=function(t){this.unregisterListeners_();i.prototype.setMap.call(this,t);this.getActive()&&this.registerListeners_()};t.prototype.tryReadFeatures_=function(t,e,i){try{return t.readFeatures(e,i)}catch(t){return null}};t.prototype.unregisterListeners_=function(){if(this.dropListenKeys_){this.dropListenKeys_.forEach(g);this.dropListenKeys_=null}};return t}(ns);function qs(t){for(var e=t.dataTransfer.files,i=0,r=e.length;i<r;++i){var n=e.item(i),o=new FileReader;o.addEventListener(C.LOAD,this.handleResult_.bind(this,n));o.readAsText(n)}}function Js(t){t.stopPropagation();t.preventDefault();t.dataTransfer.dropEffect="copy"}var Qs=function(i){function t(t){var e=t||{};i.call(this,e);this.condition_=e.condition?e.condition:Ss;this.lastAngle_=void 0;this.lastMagnitude_=void 0;this.lastScaleDelta_=0;this.duration_=void 0!==e.duration?e.duration:400}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleDragEvent=function(t){if(Rs(t)){var e=t.map,i=e.getSize(),r=t.pixel,n=r[0]-i[0]/2,o=i[1]/2-r[1],s=Math.atan2(o,n),a=Math.sqrt(n*n+o*o),h=e.getView();if(h.getConstraints().rotation!==io&&void 0!==this.lastAngle_){var l=s-this.lastAngle_;as(h,h.getRotation()-l)}this.lastAngle_=s;if(void 0!==this.lastMagnitude_){us(h,this.lastMagnitude_*(h.getResolution()/a))}void 0!==this.lastMagnitude_&&(this.lastScaleDelta_=this.lastMagnitude_/a);this.lastMagnitude_=a}};t.prototype.handleUpEvent=function(t){if(!Rs(t))return!0;var e=t.map.getView();e.setHint(so.INTERACTING,-1);var i=this.lastScaleDelta_-1;ss(e,e.getRotation());hs(e,e.getResolution(),void 0,this.duration_,i);this.lastScaleDelta_=0;return!1};t.prototype.handleDownEvent=function(t){if(!Rs(t))return!1;if(this.condition_(t)){t.map.getView().setHint(so.INTERACTING,1);this.lastAngle_=void 0;return!(this.lastMagnitude_=void 0)}return!1};return t}(ws),$s=function(n){function t(t,e,i){n.call(this);if(void 0!==i&&void 0===e)this.setFlatCoordinates(i,t);else{var r=e||0;this.setCenterAndRadius(t,r,i)}}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.clone=function(){return new t(this.flatCoordinates.slice(),void 0,this.layout)};t.prototype.closestPointXY=function(t,e,i,r){var n=this.flatCoordinates,o=t-n[0],s=e-n[1],a=o*o+s*s;if(a<r){if(0===a)for(var h=0;h<this.stride;++h)i[h]=n[h];else{var l=this.getRadius()/Math.sqrt(a);i[0]=n[0]+l*o;i[1]=n[1]+l*s;for(var u=2;u<this.stride;++u)i[u]=n[u]}i.length=this.stride;return a}return r};t.prototype.containsXY=function(t,e){var i=this.flatCoordinates,r=t-i[0],n=e-i[1];return r*r+n*n<=this.getRadiusSquared_()};t.prototype.getCenter=function(){return this.flatCoordinates.slice(0,this.stride)};t.prototype.computeExtent=function(t){var e=this.flatCoordinates,i=e[this.stride]-e[0];return ot(e[0]-i,e[1]-i,e[0]+i,e[1]+i,t)};t.prototype.getRadius=function(){return Math.sqrt(this.getRadiusSquared_())};t.prototype.getRadiusSquared_=function(){var t=this.flatCoordinates[this.stride]-this.flatCoordinates[0],e=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return t*t+e*e};t.prototype.getType=function(){return jt.CIRCLE};t.prototype.intersectsExtent=function(t){if(Nt(t,this.getExtent())){var e=this.getCenter();return t[0]<=e[0]&&t[2]>=e[0]||(t[1]<=e[1]&&t[3]>=e[1]||yt(t,this.intersectsCoordinate,this))}return!1};t.prototype.setCenter=function(t){var e=this.stride,i=this.flatCoordinates[e]-this.flatCoordinates[0],r=t.slice();r[e]=r[0]+i;for(var n=1;n<e;++n)r[e+n]=t[n];this.setFlatCoordinates(this.layout,r);this.changed()};t.prototype.setCenterAndRadius=function(t,e,i){this.setLayout(i,t,0);this.flatCoordinates||(this.flatCoordinates=[]);var r=this.flatCoordinates,n=Ei(r,0,t,this.stride);r[n++]=r[0]+e;for(var o=1,s=this.stride;o<s;++o)r[n++]=r[o];r.length=n;this.changed()};t.prototype.getCoordinates=function(){return null};t.prototype.setCoordinates=function(t,e){};t.prototype.setRadius=function(t){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+t;this.changed()};return t}(ai);$s.prototype.transform;function ta(t,e,i,r,n,o){var s=NaN,a=NaN,h=(i-e)/r;if(1===h){s=t[e];a=t[e+1]}else if(2==h){s=(1-n)*t[e]+n*t[e+r];a=(1-n)*t[e+1]+n*t[e+r+1]}else if(0!==h){for(var l=t[e],u=t[e+1],c=0,p=[0],d=e+r;d<i;d+=r){var f=t[d],_=t[d+1];c+=Math.sqrt((f-l)*(f-l)+(_-u)*(_-u));p.push(c);l=f;u=_}var g=n*c,y=k(p,g);if(y<0){var m=(g-p[-y-2])/(p[-y-1]-p[-y-2]),v=e+(-y-2)*r;s=Qt(t[v],t[v+r],m);a=Qt(t[v+1],t[v+r+1],m)}else{s=t[e+y*r];a=t[e+y*r+1]}}if(o){o[0]=s;o[1]=a;return o}return[s,a]}function ea(t,e,i,r,n,o){if(i==e)return null;var s;if(n<t[e+r-1]){if(o){(s=t.slice(e,e+r))[r-1]=n;return s}return null}if(t[i-1]<n){if(o){(s=t.slice(i-r,i))[r-1]=n;return s}return null}if(n==t[e+r-1])return t.slice(e,e+r);for(var a=e/r,h=i/r;a<h;){var l=a+h>>1;n<t[(l+1)*r-1]?h=l:a=l+1}var u=t[a*r-1];if(n==u)return t.slice((a-1)*r,(a-1)*r+r);var c=(n-u)/(t[(a+1)*r-1]-u);s=[];for(var p=0;p<r-1;++p)s.push(Qt(t[(a-1)*r+p],t[a*r+p],c));s.push(n);return s}function ia(t,e,i,r,n,o,s){if(s)return ea(t,e,i[i.length-1],r,n,o);var a;if(n<t[r-1]){if(o){(a=t.slice(0,r))[r-1]=n;return a}return null}if(t[t.length-1]<n){if(o){(a=t.slice(t.length-r))[r-1]=n;return a}return null}for(var h=0,l=i.length;h<l;++h){var u=i[h];if(e!=u){if(n<t[e+r-1])return null;if(n<=t[u-1])return ea(t,e,u,r,n,!1);e=u}}return null}function ra(t,e,i,r){for(var n=t[e],o=t[e+1],s=0,a=e+r;a<i;a+=r){var h=t[a],l=t[a+1];s+=Math.sqrt((h-n)*(h-n)+(l-o)*(l-o));n=h;o=l}return s}var na=function(i){function r(t,e){i.call(this);this.flatMidpoint_=null;this.flatMidpointRevision_=-1;this.maxDelta_=-1;this.maxDeltaRevision_=-1;void 0===e||Array.isArray(t[0])?this.setCoordinates(t,e):this.setFlatCoordinates(e,t)}i&&(r.__proto__=i);((r.prototype=Object.create(i&&i.prototype)).constructor=r).prototype.appendCoordinate=function(t){this.flatCoordinates?B(this.flatCoordinates,t):this.flatCoordinates=t.slice();this.changed()};r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout)};r.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(fi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return yi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,i,r)};r.prototype.forEachSegment=function(t){return Xi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};r.prototype.getCoordinateAtM=function(t,e){if(this.layout!=kt.XYM&&this.layout!=kt.XYZM)return null;var i=void 0!==e&&e;return ea(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,i)};r.prototype.getCoordinates=function(){return Ri(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getCoordinateAt=function(t,e){return ta(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e)};r.prototype.getLength=function(){return ra(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};r.prototype.getFlatMidpoint=function(){if(this.flatMidpointRevision_!=this.getRevision()){this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_);this.flatMidpointRevision_=this.getRevision()}return this.flatMidpoint_};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[];e.length=Ii(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0);return new r(e,kt.XY)};r.prototype.getType=function(){return jt.LINE_STRING};r.prototype.intersectsExtent=function(t){return Bi(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=Ti(this.flatCoordinates,0,t,this.stride);this.changed()};return r}(ai),oa=function(u){function r(t,e,i){u.call(this);this.ends_=[];this.maxDelta_=-1;this.maxDeltaRevision_=-1;if(Array.isArray(t[0]))this.setCoordinates(t,e);else if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.ends_=i}else{for(var r=this.getLayout(),n=t,o=[],s=[],a=0,h=n.length;a<h;++a){var l=n[a];0===a&&(r=l.getLayout());B(o,l.getFlatCoordinates());s.push(o.length)}this.setFlatCoordinates(r,o);this.ends_=s}}u&&(r.__proto__=u);((r.prototype=Object.create(u&&u.prototype)).constructor=r).prototype.appendLineString=function(t){this.flatCoordinates?B(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice();this.ends_.push(this.flatCoordinates.length);this.changed()};r.prototype.clone=function(){return new r(this.flatCoordinates.slice(),this.layout,this.ends_.slice())};r.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(_i(this.flatCoordinates,0,this.ends_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return mi(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,i,r)};r.prototype.getCoordinateAtM=function(t,e,i){if(this.layout!=kt.XYM&&this.layout!=kt.XYZM||0===this.flatCoordinates.length)return null;var r=void 0!==e&&e,n=void 0!==i&&i;return ia(this.flatCoordinates,0,this.ends_,this.stride,t,r,n)};r.prototype.getCoordinates=function(){return Ci(this.flatCoordinates,0,this.ends_,this.stride)};r.prototype.getEnds=function(){return this.ends_};r.prototype.getLineString=function(t){return t<0||this.ends_.length<=t?null:new na(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)};r.prototype.getLineStrings=function(){for(var t=this.flatCoordinates,e=this.ends_,i=this.layout,r=[],n=0,o=0,s=e.length;o<s;++o){var a=e[o],h=new na(t.slice(n,a),i);r.push(h);n=a}return r};r.prototype.getFlatMidpoints=function(){for(var t=[],e=this.flatCoordinates,i=0,r=this.ends_,n=this.stride,o=0,s=r.length;o<s;++o){var a=r[o];B(t,ta(e,i,a,n,.5));i=a}return t};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=Li(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,i);return new r(e,kt.XY,i)};r.prototype.getType=function(){return jt.MULTI_LINE_STRING};r.prototype.intersectsExtent=function(t){return zi(this.flatCoordinates,0,this.ends_,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,2);this.flatCoordinates||(this.flatCoordinates=[]);var i=Si(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===i.length?0:i[i.length-1];this.changed()};return r}(ai),sa=function(i){function t(t,e){i.call(this);e&&!Array.isArray(t[0])?this.setFlatCoordinates(e,t):this.setCoordinates(t,e)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.appendPoint=function(t){this.flatCoordinates?B(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice();this.changed()};t.prototype.clone=function(){return new t(this.flatCoordinates.slice(),this.layout)};t.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;for(var n=this.flatCoordinates,o=this.stride,s=0,a=n.length;s<a;s+=o){var h=Kt(t,e,n[s],n[s+1]);if(h<r){r=h;for(var l=0;l<o;++l)i[l]=n[s+l];i.length=o}}return r};t.prototype.getCoordinates=function(){return Ri(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)};t.prototype.getPoint=function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Ai(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)};t.prototype.getPoints=function(){for(var t=this.flatCoordinates,e=this.layout,i=this.stride,r=[],n=0,o=t.length;n<o;n+=i){var s=new Ai(t.slice(n,n+i),e);r.push(s)}return r};t.prototype.getType=function(){return jt.MULTI_POINT};t.prototype.intersectsExtent=function(t){for(var e=this.flatCoordinates,i=this.stride,r=0,n=e.length;r<n;r+=i){if(it(t,e[r],e[r+1]))return!0}return!1};t.prototype.setCoordinates=function(t,e){this.setLayout(e,t,1);this.flatCoordinates||(this.flatCoordinates=[]);this.flatCoordinates.length=Ti(this.flatCoordinates,0,t,this.stride);this.changed()};return t}(ai);function aa(t,e,i,r){for(var n=[],o=[1/0,1/0,-1/0,-1/0],s=0,a=i.length;s<a;++s){var h=i[s];o=lt(t,e,h[0],r);n.push((o[0]+o[2])/2,(o[1]+o[3])/2);e=h[h.length-1]}return n}var ha=function(f){function r(t,e,i){f.call(this);this.endss_=[];this.flatInteriorPointsRevision_=-1;this.flatInteriorPoints_=null;this.maxDelta_=-1;this.maxDeltaRevision_=-1;this.orientedRevision_=-1;this.orientedFlatCoordinates_=null;if(!i&&!Array.isArray(t[0])){for(var r=this.getLayout(),n=t,o=[],s=[],a=0,h=n.length;a<h;++a){var l=n[a];0===a&&(r=l.getLayout());for(var u=o.length,c=l.getEnds(),p=0,d=c.length;p<d;++p)c[p]+=u;B(o,l.getFlatCoordinates());s.push(c)}e=r;t=o;i=s}if(void 0!==e&&i){this.setFlatCoordinates(e,t);this.endss_=i}else this.setCoordinates(t,e)}f&&(r.__proto__=f);((r.prototype=Object.create(f&&f.prototype)).constructor=r).prototype.appendPolygon=function(t){var e;if(this.flatCoordinates){var i=this.flatCoordinates.length;B(this.flatCoordinates,t.getFlatCoordinates());for(var r=0,n=(e=t.getEnds().slice()).length;r<n;++r)e[r]+=i}else{this.flatCoordinates=t.getFlatCoordinates().slice();e=t.getEnds().slice();this.endss_.push()}this.endss_.push(e);this.changed()};r.prototype.clone=function(){for(var t=this.endss_.length,e=new Array(t),i=0;i<t;++i)e[i]=this.endss_[i].slice();return new r(this.flatCoordinates.slice(),this.layout,e)};r.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;if(this.maxDeltaRevision_!=this.getRevision()){this.maxDelta_=Math.sqrt(gi(this.flatCoordinates,0,this.endss_,this.stride,0));this.maxDeltaRevision_=this.getRevision()}return vi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,i,r)};r.prototype.containsXY=function(t,e){return ji(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)};r.prototype.getArea=function(){return pi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)};r.prototype.getCoordinates=function(t){var e;void 0!==t?$i(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates;return wi(e,0,this.endss_,this.stride)};r.prototype.getEndss=function(){return this.endss_};r.prototype.getFlatInteriorPoints=function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=aa(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=Yi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t);this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_};r.prototype.getInteriorPoints=function(){return new sa(this.getFlatInteriorPoints().slice(),kt.XYM)};r.prototype.getOrientedFlatCoordinates=function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;if(Ji(t,0,this.endss_,this.stride))this.orientedFlatCoordinates_=t;else{this.orientedFlatCoordinates_=t.slice();this.orientedFlatCoordinates_.length=$i(this.orientedFlatCoordinates_,0,this.endss_,this.stride)}this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_};r.prototype.getSimplifiedGeometryInternal=function(t){var e=[],i=[];e.length=Fi(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,i);return new r(e,kt.XY,i)};r.prototype.getPolygon=function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var i=this.endss_[t-1];e=i[i.length-1]}var r=this.endss_[t].slice(),n=r[r.length-1];if(0!==e)for(var o=0,s=r.length;o<s;++o)r[o]-=e;return new tr(this.flatCoordinates.slice(e,n),this.layout,r)};r.prototype.getPolygons=function(){for(var t=this.layout,e=this.flatCoordinates,i=this.endss_,r=[],n=0,o=0,s=i.length;o<s;++o){var a=i[o].slice(),h=a[a.length-1];if(0!==n)for(var l=0,u=a.length;l<u;++l)a[l]-=n;var c=new tr(e.slice(n,h),t,a);r.push(c);n=h}return r};r.prototype.getType=function(){return jt.MULTI_POLYGON};r.prototype.intersectsExtent=function(t){return Ki(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)};r.prototype.setCoordinates=function(t,e){this.setLayout(e,t,3);this.flatCoordinates||(this.flatCoordinates=[]);var i=xi(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===i.length)this.flatCoordinates.length=0;else{var r=i[i.length-1];this.flatCoordinates.length=0===r.length?0:r[r.length-1]}this.changed()};return r}(ai),la=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,ua=/^([a-z]*)$/i;function ca(t){return"string"==typeof t?t:ya(t)}var pa,da,fa=(pa={},da=0,function(t){var e;if(pa.hasOwnProperty(t))e=pa[t];else{if(1024<=da){var i=0;for(var r in pa)if(0==(3&i++)){delete pa[r];--da}}e=function(t){var e,i,r,n,o;ua.exec(t)&&(t=function(t){var e=document.createElement("div");e.style.color=t;if(""===e.style.color)return"";document.body.appendChild(e);var i=getComputedStyle(e).color;document.body.removeChild(e);return i}(t));if(la.exec(t)){var s,a=t.length-1;s=a<=4?1:2;var h=4===a||8===a;e=parseInt(t.substr(1+0*s,s),16);i=parseInt(t.substr(1+1*s,s),16);r=parseInt(t.substr(1+2*s,s),16);n=h?parseInt(t.substr(1+3*s,s),16):255;if(1==s){e=(e<<4)+e;i=(i<<4)+i;r=(r<<4)+r;h&&(n=(n<<4)+n)}o=[e,i,r,n/255]}else if(0==t.indexOf("rgba("))ga(o=t.slice(5,-1).split(",").map(Number));else if(0==t.indexOf("rgb(")){(o=t.slice(4,-1).split(",").map(Number)).push(1);ga(o)}else A(!1,14);return o}(t);pa[t]=e;++da}return e});function _a(t){return Array.isArray(t)?t:fa(t)}function ga(t){t[0]=zt(t[0]+.5|0,0,255);t[1]=zt(t[1]+.5|0,0,255);t[2]=zt(t[2]+.5|0,0,255);t[3]=zt(t[3],0,1);return t}function ya(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var i=t[1];i!=(0|i)&&(i=i+.5|0);var r=t[2];r!=(0|r)&&(r=r+.5|0);return"rgba("+e+","+i+","+r+","+(void 0===t[3]?1:t[3])+")"}function ma(t){return Array.isArray(t)?ya(t):t}var va=function(e){function t(t){e.call(this);this.highWaterMark=void 0!==t?t:2048;this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){return this.getCount()>this.highWaterMark};t.prototype.clear=function(){this.count_=0;this.entries_={};this.oldest_=null;this.newest_=null;this.dispatchEvent(C.CLEAR)};t.prototype.containsKey=function(t){return this.entries_.hasOwnProperty(t)};t.prototype.forEach=function(t,e){for(var i=this.oldest_;i;){t.call(e,i.value_,i.key_,this);i=i.newer}};t.prototype.get=function(t){var e=this.entries_[t];A(void 0!==e,15);if(e===this.newest_)return e.value_;if(e===this.oldest_){this.oldest_=this.oldest_.newer;this.oldest_.older=null}else{e.newer.older=e.older;e.older.newer=e.newer}e.newer=null;e.older=this.newest_;this.newest_.newer=e;return(this.newest_=e).value_};t.prototype.remove=function(t){var e=this.entries_[t];A(void 0!==e,15);if(e===this.newest_){this.newest_=e.older;this.newest_&&(this.newest_.newer=null)}else if(e===this.oldest_){this.oldest_=e.newer;this.oldest_&&(this.oldest_.older=null)}else{e.newer.older=e.older;e.older.newer=e.newer}delete this.entries_[t];--this.count_;return e.value_};t.prototype.getCount=function(){return this.count_};t.prototype.getKeys=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.key_;return e};t.prototype.getValues=function(){var t,e=new Array(this.count_),i=0;for(t=this.newest_;t;t=t.older)e[i++]=t.value_;return e};t.prototype.peekLast=function(){return this.oldest_.value_};t.prototype.peekLastKey=function(){return this.oldest_.key_};t.prototype.peekFirstKey=function(){return this.newest_.key_};t.prototype.pop=function(){var t=this.oldest_;delete this.entries_[t.key_];t.newer&&(t.newer.older=null);this.oldest_=t.newer;this.oldest_||(this.newest_=null);--this.count_;return t.value_};t.prototype.replace=function(t,e){this.get(t);this.entries_[t].value_=e};t.prototype.set=function(t,e){A(!(t in this.entries_),16);var i={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=i:this.oldest_=i;this.newest_=i;this.entries_[t]=i;++this.count_};t.prototype.setSize=function(t){this.highWaterMark=t};t.prototype.prune=function(){for(;this.canExpireCache();)this.pop()};return t}(R),Ea="10px sans-serif",Ta=[0,0,0,1],Sa="round",xa=[],Ra="round",Ca=[0,0,0,1],wa="center",Ia="middle",La=[0,0,0,0],Oa=new va,Pa={},ba=null,Ma={},Fa=function(){var o,h,s=60,a=Pa,l="32px ",u=["monospace","serif"],c=u.length,p="wmytzilWMYTZIL@#/&?$%10";function d(t){for(var e=Na(),i=100;i<=700;i+=300){for(var r=i+" ",n=!0,o=0;o<c;++o){var s=u[o];e.font=r+l+s;h=e.measureText(p).width;if(t!=s){e.font=r+l+t+","+s;var a=e.measureText(p).width;n=n&&a!=h}}if(n)return!0}return!1}function f(){var t=!0;for(var e in a)if(a[e]<s)if(d(e)){a[e]=s;_(Ma);ba=null;Oa.clear()}else{++a[e];t=!1}if(t){clearInterval(o);o=void 0}}return function(t){var e=Ho(t);if(e)for(var i=0,r=e.length;i<r;++i){var n=e[i];if(!(n in a)){a[n]=s;d(n)||void(a[n]=0)===o&&(o=setInterval(f,32))}}}}();function Na(){ba||(ba=zr(1,1));return ba}var Aa,Ga,Da=(Ga=Ma,function(t){var e=Ga[t];if(null==e){if(!Aa){(Aa=document.createElement("span")).textContent="M";Aa.style.margin=Aa.style.padding="0 !important";Aa.style.position="absolute !important";Aa.style.left="-99999px !important"}Aa.style.font=t;document.body.appendChild(Aa);e=Ga[t]=Aa.offsetHeight;document.body.removeChild(Aa)}return e});function ka(t,e){var i=Na();t!=i.font&&(i.font=t);return i.measureText(e).width}function ja(t,e,i){return e in i?i[e]:i[e]=ka(t,e)}function Ua(t,e,i){for(var r=e.length,n=0,o=0;o<r;++o){var s=ka(t,e[o]);n=Math.max(n,s);i.push(s)}return n}function Ya(t,e,i,r){if(0!==e){t.translate(i,r);t.rotate(e);t.translate(-i,-r)}}var Xa=[1,0,0,1,0,0];function Ba(t,e,i,r,n,o,s,a,h,l,u){var c;if(1!=i){c=t.globalAlpha;t.globalAlpha=c*i}e&&t.setTransform.apply(t,e);t.drawImage(r,n,o,s,a,h,l,s*u,a*u);c&&(t.globalAlpha=c);e&&t.setTransform.apply(t,Xa)}var za=function(t){this.opacity_=t.opacity;this.rotateWithView_=t.rotateWithView;this.rotation_=t.rotation;this.scale_=t.scale};za.prototype.clone=function(){return new za({opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};za.prototype.getOpacity=function(){return this.opacity_};za.prototype.getRotateWithView=function(){return this.rotateWithView_};za.prototype.getRotation=function(){return this.rotation_};za.prototype.getScale=function(){return this.scale_};za.prototype.getSnapToPixel=function(){return!1};za.prototype.getAnchor=function(){return o()};za.prototype.getImage=function(t){return o()};za.prototype.getHitDetectionImage=function(t){return o()};za.prototype.getImageState=function(){return o()};za.prototype.getImageSize=function(){return o()};za.prototype.getHitDetectionImageSize=function(){return o()};za.prototype.getOrigin=function(){return o()};za.prototype.getSize=function(){return o()};za.prototype.setOpacity=function(t){this.opacity_=t};za.prototype.setRotateWithView=function(t){this.rotateWithView_=t};za.prototype.setRotation=function(t){this.rotation_=t};za.prototype.setScale=function(t){this.scale_=t};za.prototype.setSnapToPixel=function(t){};za.prototype.listenImageChange=function(t,e){return o()};za.prototype.load=function(){o()};za.prototype.unlistenImageChange=function(t,e){o()};var Va=function(i){function e(t){var e=void 0!==t.rotateWithView&&t.rotateWithView;i.call(this,{opacity:1,rotateWithView:e,rotation:void 0!==t.rotation?t.rotation:0,scale:1});this.checksums_=null;this.canvas_=null;this.hitDetectionCanvas_=null;this.fill_=void 0!==t.fill?t.fill:null;this.origin_=[0,0];this.points_=t.points;this.radius_=void 0!==t.radius?t.radius:t.radius1;this.radius2_=t.radius2;this.angle_=void 0!==t.angle?t.angle:0;this.stroke_=void 0!==t.stroke?t.stroke:null;this.anchor_=null;this.size_=null;this.imageSize_=null;this.hitDetectionImageSize_=null;this.atlasManager_=t.atlasManager;this.render_(this.atlasManager_)}i&&(e.__proto__=i);((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),atlasManager:this.atlasManager_});t.setOpacity(this.getOpacity());t.setScale(this.getScale());return t};e.prototype.getAnchor=function(){return this.anchor_};e.prototype.getAngle=function(){return this.angle_};e.prototype.getFill=function(){return this.fill_};e.prototype.getHitDetectionImage=function(t){return this.hitDetectionCanvas_};e.prototype.getImage=function(t){return this.canvas_};e.prototype.getImageSize=function(){return this.imageSize_};e.prototype.getHitDetectionImageSize=function(){return this.hitDetectionImageSize_};e.prototype.getImageState=function(){return Ar.LOADED};e.prototype.getOrigin=function(){return this.origin_};e.prototype.getPoints=function(){return this.points_};e.prototype.getRadius=function(){return this.radius_};e.prototype.getRadius2=function(){return this.radius2_};e.prototype.getSize=function(){return this.size_};e.prototype.getStroke=function(){return this.stroke_};e.prototype.listenImageChange=function(t,e){};e.prototype.load=function(){};e.prototype.unlistenImageChange=function(t,e){};e.prototype.render_=function(t){var e,i,r="",n="",o=0,s=null,a=0,h=0;if(this.stroke_){null===(i=this.stroke_.getColor())&&(i=Ca);i=ma(i);void 0===(h=this.stroke_.getWidth())&&(h=1);s=this.stroke_.getLineDash();a=this.stroke_.getLineDashOffset();void 0===(n=this.stroke_.getLineJoin())&&(n=Ra);void 0===(r=this.stroke_.getLineCap())&&(r=Sa);void 0===(o=this.stroke_.getMiterLimit())&&(o=10)}var l=2*(this.radius_+h)+1,u={strokeStyle:i,strokeWidth:h,size:l,lineCap:r,lineDash:s,lineDashOffset:a,lineJoin:n,miterLimit:o};if(void 0===t){var c=zr(l,l);this.canvas_=c.canvas;e=l=this.canvas_.width;this.draw_(u,c,0,0);this.createHitDetectionCanvas_(u)}else{l=Math.round(l);var p,d=!this.fill_;d&&(p=this.drawHitDetectionCanvas_.bind(this,u));var f=this.getChecksum(),_=t.add(f,l,l,this.draw_.bind(this,u),p);this.canvas_=_.image;this.origin_=[_.offsetX,_.offsetY];e=_.image.width;if(d){this.hitDetectionCanvas_=_.hitImage;this.hitDetectionImageSize_=[_.hitImage.width,_.hitImage.height]}else{this.hitDetectionCanvas_=this.canvas_;this.hitDetectionImageSize_=[e,e]}}this.anchor_=[l/2,l/2];this.size_=[l,l];this.imageSize_=[e,e]};e.prototype.draw_=function(t,e,i,r){var n,o,s;e.setTransform(1,0,0,1,0,0);e.translate(i,r);e.beginPath();var a=this.points_;if(a===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var h=void 0!==this.radius2_?this.radius2_:this.radius_;h!==this.radius_&&(a*=2);for(n=0;n<=a;n++){o=2*n*Math.PI/a-Math.PI/2+this.angle_;s=n%2==0?this.radius_:h;e.lineTo(t.size/2+s*Math.cos(o),t.size/2+s*Math.sin(o))}}if(this.fill_){var l=this.fill_.getColor();null===l&&(l=Ta);e.fillStyle=ma(l);e.fill()}if(this.stroke_){e.strokeStyle=t.strokeStyle;e.lineWidth=t.strokeWidth;if(e.setLineDash&&t.lineDash){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.lineCap=t.lineCap;e.lineJoin=t.lineJoin;e.miterLimit=t.miterLimit;e.stroke()}e.closePath()};e.prototype.createHitDetectionCanvas_=function(t){this.hitDetectionImageSize_=[t.size,t.size];if(this.fill_)this.hitDetectionCanvas_=this.canvas_;else{var e=zr(t.size,t.size);this.hitDetectionCanvas_=e.canvas;this.drawHitDetectionCanvas_(t,e,0,0)}};e.prototype.drawHitDetectionCanvas_=function(t,e,i,r){e.setTransform(1,0,0,1,0,0);e.translate(i,r);e.beginPath();var n=this.points_;if(n===1/0)e.arc(t.size/2,t.size/2,this.radius_,0,2*Math.PI,!0);else{var o,s,a,h=void 0!==this.radius2_?this.radius2_:this.radius_;h!==this.radius_&&(n*=2);for(o=0;o<=n;o++){a=2*o*Math.PI/n-Math.PI/2+this.angle_;s=o%2==0?this.radius_:h;e.lineTo(t.size/2+s*Math.cos(a),t.size/2+s*Math.sin(a))}}e.fillStyle=ca(Ta);e.fill();if(this.stroke_){e.strokeStyle=t.strokeStyle;e.lineWidth=t.strokeWidth;if(t.lineDash){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.stroke()}e.closePath()};e.prototype.getChecksum=function(){var t=this.stroke_?this.stroke_.getChecksum():"-",e=this.fill_?this.fill_.getChecksum():"-";if(!this.checksums_||t!=this.checksums_[1]||e!=this.checksums_[2]||this.radius_!=this.checksums_[3]||this.radius2_!=this.checksums_[4]||this.angle_!=this.checksums_[5]||this.points_!=this.checksums_[6]){var i="r"+t+e+(void 0!==this.radius_?this.radius_.toString():"-")+(void 0!==this.radius2_?this.radius2_.toString():"-")+(void 0!==this.angle_?this.angle_.toString():"-")+(void 0!==this.points_?this.points_.toString():"-");this.checksums_=[i,t,e,this.radius_,this.radius2_,this.angle_,this.points_]}return this.checksums_[0]};return e}(za),Wa=function(i){function e(t){var e=t||{};i.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,atlasManager:e.atlasManager})}i&&(e.__proto__=i);((e.prototype=Object.create(i&&i.prototype)).constructor=e).prototype.clone=function(){var t=new e({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),atlasManager:this.atlasManager_});t.setOpacity(this.getOpacity());t.setScale(this.getScale());return t};e.prototype.setRadius=function(t){this.radius_=t;this.render_(this.atlasManager_)};return e}(Va),Ka=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null;this.checksum_=void 0};Ka.prototype.clone=function(){var t=this.getColor();return new Ka({color:Array.isArray(t)?t.slice():t||void 0})};Ka.prototype.getColor=function(){return this.color_};Ka.prototype.setColor=function(t){this.color_=t;this.checksum_=void 0};Ka.prototype.getChecksum=function(){if(void 0===this.checksum_){var t=this.color_;t?Array.isArray(t)||"string"==typeof t?this.checksum_="f"+ca(t):this.checksum_=bt(this.color_):this.checksum_="f-"}return this.checksum_};var Ha=function(t){var e=t||{};this.color_=void 0!==e.color?e.color:null;this.lineCap_=e.lineCap;this.lineDash_=void 0!==e.lineDash?e.lineDash:null;this.lineDashOffset_=e.lineDashOffset;this.lineJoin_=e.lineJoin;this.miterLimit_=e.miterLimit;this.width_=e.width;this.checksum_=void 0};Ha.prototype.clone=function(){var t=this.getColor();return new Ha({color:Array.isArray(t)?t.slice():t||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})};Ha.prototype.getColor=function(){return this.color_};Ha.prototype.getLineCap=function(){return this.lineCap_};Ha.prototype.getLineDash=function(){return this.lineDash_};Ha.prototype.getLineDashOffset=function(){return this.lineDashOffset_};Ha.prototype.getLineJoin=function(){return this.lineJoin_};Ha.prototype.getMiterLimit=function(){return this.miterLimit_};Ha.prototype.getWidth=function(){return this.width_};Ha.prototype.setColor=function(t){this.color_=t;this.checksum_=void 0};Ha.prototype.setLineCap=function(t){this.lineCap_=t;this.checksum_=void 0};Ha.prototype.setLineDash=function(t){this.lineDash_=t;this.checksum_=void 0};Ha.prototype.setLineDashOffset=function(t){this.lineDashOffset_=t;this.checksum_=void 0};Ha.prototype.setLineJoin=function(t){this.lineJoin_=t;this.checksum_=void 0};Ha.prototype.setMiterLimit=function(t){this.miterLimit_=t;this.checksum_=void 0};Ha.prototype.setWidth=function(t){this.width_=t;this.checksum_=void 0};Ha.prototype.getChecksum=function(){if(void 0===this.checksum_){this.checksum_="s";this.color_?"string"==typeof this.color_?this.checksum_+=this.color_:this.checksum_+=bt(this.color_):this.checksum_+="-";this.checksum_+=","+(void 0!==this.lineCap_?this.lineCap_.toString():"-")+","+(this.lineDash_?this.lineDash_.toString():"-")+","+(void 0!==this.lineDashOffset_?this.lineDashOffset_:"-")+","+(void 0!==this.lineJoin_?this.lineJoin_:"-")+","+(void 0!==this.miterLimit_?this.miterLimit_.toString():"-")+","+(void 0!==this.width_?this.width_.toString():"-")}return this.checksum_};var Za=function(t){var e=t||{};this.geometry_=null;this.geometryFunction_=th;void 0!==e.geometry&&this.setGeometry(e.geometry);this.fill_=void 0!==e.fill?e.fill:null;this.image_=void 0!==e.image?e.image:null;this.renderer_=void 0!==e.renderer?e.renderer:null;this.stroke_=void 0!==e.stroke?e.stroke:null;this.text_=void 0!==e.text?e.text:null;this.zIndex_=e.zIndex};Za.prototype.clone=function(){var t=this.getGeometry();t&&"object"==typeof t&&(t=t.clone());return new Za({geometry:t,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})};Za.prototype.getRenderer=function(){return this.renderer_};Za.prototype.setRenderer=function(t){this.renderer_=t};Za.prototype.getGeometry=function(){return this.geometry_};Za.prototype.getGeometryFunction=function(){return this.geometryFunction_};Za.prototype.getFill=function(){return this.fill_};Za.prototype.setFill=function(t){this.fill_=t};Za.prototype.getImage=function(){return this.image_};Za.prototype.setImage=function(t){this.image_=t};Za.prototype.getStroke=function(){return this.stroke_};Za.prototype.setStroke=function(t){this.stroke_=t};Za.prototype.getText=function(){return this.text_};Za.prototype.setText=function(t){this.text_=t};Za.prototype.getZIndex=function(){return this.zIndex_};Za.prototype.setGeometry=function(e){"function"==typeof e?this.geometryFunction_=e:"string"==typeof e?this.geometryFunction_=function(t){return t.get(e)}:e?void 0!==e&&(this.geometryFunction_=function(){return e}):this.geometryFunction_=th;this.geometry_=e};Za.prototype.setZIndex=function(t){this.zIndex_=t};function qa(t){var e;if("function"==typeof t)e=t;else{var i;if(Array.isArray(t))i=t;else{A("function"==typeof t.getZIndex,41);i=[t]}e=function(){return i}}return e}var Ja=null;function Qa(t,e){if(!Ja){var i=new Ka({color:"rgba(255,255,255,0.4)"}),r=new Ha({color:"#3399CC",width:1.25});Ja=[new Za({image:new Wa({fill:i,stroke:r,radius:5}),fill:i,stroke:r})]}return Ja}function $a(){var t={},e=[255,255,255,1],i=[0,153,255,1];t[jt.POLYGON]=[new Za({fill:new Ka({color:[255,255,255,.5]})})];t[jt.MULTI_POLYGON]=t[jt.POLYGON];t[jt.LINE_STRING]=[new Za({stroke:new Ha({color:e,width:5})}),new Za({stroke:new Ha({color:i,width:3})})];t[jt.MULTI_LINE_STRING]=t[jt.LINE_STRING];t[jt.CIRCLE]=t[jt.POLYGON].concat(t[jt.LINE_STRING]);t[jt.POINT]=[new Za({image:new Wa({radius:6,fill:new Ka({color:i}),stroke:new Ha({color:e,width:1.5})}),zIndex:1/0})];t[jt.MULTI_POINT]=t[jt.POINT];t[jt.GEOMETRY_COLLECTION]=t[jt.POLYGON].concat(t[jt.LINE_STRING],t[jt.POINT]);return t}function th(t){return t.getGeometry()}var eh="renderOrder",ih=function(r){function t(t){var e=t||{},i=y({},e);delete i.style;delete i.renderBuffer;delete i.updateWhileAnimating;delete i.updateWhileInteracting;r.call(this,i);this.declutter_=void 0!==e.declutter&&e.declutter;this.renderBuffer_=void 0!==e.renderBuffer?e.renderBuffer:100;this.style_=null;this.styleFunction_=void 0;this.setStyle(e.style);this.updateWhileAnimating_=void 0!==e.updateWhileAnimating&&e.updateWhileAnimating;this.updateWhileInteracting_=void 0!==e.updateWhileInteracting&&e.updateWhileInteracting}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getDeclutter=function(){return this.declutter_};t.prototype.setDeclutter=function(t){this.declutter_=t};t.prototype.getRenderBuffer=function(){return this.renderBuffer_};t.prototype.getRenderOrder=function(){return this.get(eh)};t.prototype.getStyle=function(){return this.style_};t.prototype.getStyleFunction=function(){return this.styleFunction_};t.prototype.getUpdateWhileAnimating=function(){return this.updateWhileAnimating_};t.prototype.getUpdateWhileInteracting=function(){return this.updateWhileInteracting_};t.prototype.setRenderOrder=function(t){this.set(eh,t)};t.prototype.setStyle=function(t){this.style_=void 0!==t?t:Qa;this.styleFunction_=null===t?void 0:qa(this.style_);this.changed()};return t}(Zo);ih.prototype.getSource;"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var rh,nh=(function(t,e){t.exports=function(){function _(t,e,i,r,n){for(;i<r;){if(600<r-i){var o=r-i+1,s=e-i+1,a=Math.log(o),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1),u=Math.max(i,Math.floor(e-s*h/o+l)),c=Math.min(r,Math.floor(e+(o-s)*h/o+l));_(t,e,u,c,n)}var p=t[e],d=i,f=r;g(t,i,e);0<n(t[r],p)&&g(t,i,r);for(;d<f;){g(t,d,f);d++;f--;for(;n(t[d],p)<0;)d++;for(;0<n(t[f],p);)f--}0===n(t[i],p)?g(t,i,f):g(t,++f,r);f<=e&&(i=f+1);e<=f&&(r=f-1)}}function g(t,e,i){var r=t[e];t[e]=t[i];t[i]=r}function o(t,e){return t<e?-1:e<t?1:0}return function(t,e,i,r,n){_(t,e,i||0,r||t.length-1,n||o)}}()}(rh={exports:{}},rh.exports),rh.exports),oh=ah,sh=ah;function ah(t,e){if(!(this instanceof ah))return new ah(t,e);this._maxEntries=Math.max(4,t||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));e&&this._initFormat(e);this.clear()}ah.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,i=[],r=this.toBBox;if(!yh(t,e))return i;for(var n,o,s,a,h=[];e;){for(n=0,o=e.children.length;n<o;n++){s=e.children[n];yh(t,a=e.leaf?r(s):s)&&(e.leaf?i.push(s):gh(t,a)?this._all(s,i):h.push(s))}e=h.pop()}return i},collides:function(t){var e=this.data,i=this.toBBox;if(!yh(t,e))return!1;for(var r,n,o,s,a=[];e;){for(r=0,n=e.children.length;r<n;r++){o=e.children[r];if(yh(t,s=e.leaf?i(o):o)){if(e.leaf||gh(t,s))return!0;a.push(o)}}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,i=t.length;e<i;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r;r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},insert:function(t){t&&this._insert(t,this.data.height-1);return this},clear:function(){this.data=mh([]);return this},remove:function(t,e){if(!t)return this;for(var i,r,n,o,s=this.data,a=this.toBBox(t),h=[],l=[];s||h.length;){if(!s){s=h.pop();r=h[h.length-1];i=l.pop();o=!0}if(s.leaf&&-1!==(n=hh(t,s.children,e))){s.children.splice(n,1);h.push(s);this._condense(h);return this}if(o||s.leaf||!gh(s,a))if(r){i++;s=r.children[i];o=!1}else s=null;else{h.push(s);l.push(i);i=0;s=(r=s).children[0]}}return this},toBBox:function(t){return t},compareMinX:ph,compareMinY:dh,toJSON:function(){return this.data},fromJSON:function(t){this.data=t;return this},_all:function(t,e){for(var i=[];t;){t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children);t=i.pop()}return e},_build:function(t,e,i,r){var n,o=i-e+1,s=this._maxEntries;if(o<=s){lh(n=mh(t.slice(e,i+1)),this.toBBox);return n}if(!r){r=Math.ceil(Math.log(o)/Math.log(s));s=Math.ceil(o/Math.pow(s,r-1))}(n=mh([])).leaf=!1;n.height=r;var a,h,l,u,c=Math.ceil(o/s),p=c*Math.ceil(Math.sqrt(s));vh(t,e,i,p,this.compareMinX);for(a=e;a<=i;a+=p){vh(t,a,l=Math.min(a+p-1,i),c,this.compareMinY);for(h=a;h<=l;h+=c){u=Math.min(h+c-1,l);n.children.push(this._build(t,h,u,r-1))}}lh(n,this.toBBox);return n},_chooseSubtree:function(t,e,i,r){for(var n,o,s,a,h,l,u,c,p,d;;){r.push(e);if(e.leaf||r.length-1===i)break;u=c=1/0;for(n=0,o=e.children.length;n<o;n++){h=fh(s=e.children[n]);if((l=(p=t,d=s,(Math.max(d.maxX,p.maxX)-Math.min(d.minX,p.minX))*(Math.max(d.maxY,p.maxY)-Math.min(d.minY,p.minY)))-h)<c){c=l;u=h<u?h:u;a=s}else if(l===c&&h<u){u=h;a=s}}e=a||e.children[0]}return e},_insert:function(t,e,i){var r=this.toBBox,n=i?t:r(t),o=[],s=this._chooseSubtree(n,this.data,e,o);s.children.push(t);ch(s,n);for(;0<=e&&o[e].children.length>this._maxEntries;){this._split(o,e);e--}this._adjustParentBBoxes(n,o,e)},_split:function(t,e){var i=t[e],r=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,r);var o=this._chooseSplitIndex(i,n,r),s=mh(i.children.splice(o,i.children.length-o));s.height=i.height;s.leaf=i.leaf;lh(i,this.toBBox);lh(s,this.toBBox);e?t[e-1].children.push(s):this._splitRoot(i,s)},_splitRoot:function(t,e){this.data=mh([t,e]);this.data.height=t.height+1;this.data.leaf=!1;lh(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,i){var r,n,o,s,a,h,l,u,c,p,d,f,_,g;h=l=1/0;for(r=e;r<=i-e;r++){n=uh(t,0,r,this.toBBox);o=uh(t,r,i,this.toBBox);s=(c=n,p=o,void 0,d=Math.max(c.minX,p.minX),f=Math.max(c.minY,p.minY),_=Math.min(c.maxX,p.maxX),g=Math.min(c.maxY,p.maxY),Math.max(0,_-d)*Math.max(0,g-f));a=fh(n)+fh(o);if(s<h){h=s;u=r;l=a<l?a:l}else if(s===h&&a<l){l=a;u=r}}return u},_chooseSplitAxis:function(t,e,i){var r=t.leaf?this.compareMinX:ph,n=t.leaf?this.compareMinY:dh;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,n)&&t.children.sort(r)},_allDistMargin:function(t,e,i,r){t.children.sort(r);var n,o,s=this.toBBox,a=uh(t,0,e,s),h=uh(t,i-e,i,s),l=_h(a)+_h(h);for(n=e;n<i-e;n++){o=t.children[n];ch(a,t.leaf?s(o):o);l+=_h(a)}for(n=i-e-1;e<=n;n--){o=t.children[n];ch(h,t.leaf?s(o):o);l+=_h(h)}return l},_adjustParentBBoxes:function(t,e,i){for(var r=i;0<=r;r--)ch(e[r],t)},_condense:function(t){for(var e,i=t.length-1;0<=i;i--)0===t[i].children.length?0<i?(e=t[i-1].children).splice(e.indexOf(t[i]),1):this.clear():lh(t[i],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0]));this.compareMinY=new Function("a","b",e.join(t[1]));this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};function hh(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return-1}function lh(t,e){uh(t,0,t.children.length,e,t)}function uh(t,e,i,r,n){n||(n=mh(null));n.minX=1/0;n.minY=1/0;n.maxX=-1/0;n.maxY=-1/0;for(var o,s=e;s<i;s++){o=t.children[s];ch(n,t.leaf?r(o):o)}return n}function ch(t,e){t.minX=Math.min(t.minX,e.minX);t.minY=Math.min(t.minY,e.minY);t.maxX=Math.max(t.maxX,e.maxX);t.maxY=Math.max(t.maxY,e.maxY);return t}function ph(t,e){return t.minX-e.minX}function dh(t,e){return t.minY-e.minY}function fh(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function _h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function gh(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function yh(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function mh(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function vh(t,e,i,r,n){for(var o,s=[e,i];s.length;)if(!((i=s.pop())-(e=s.pop())<=r)){o=e+Math.ceil((i-e)/r/2)*r;nh(t,o,e,i,n);s.push(e,o,o,i)}}oh.default=sh;var Eh=function(){};Eh.prototype.drawCustom=function(t,e,i){};Eh.prototype.drawGeometry=function(t){};Eh.prototype.setStyle=function(t){};Eh.prototype.drawCircle=function(t,e){};Eh.prototype.drawFeature=function(t,e){};Eh.prototype.drawGeometryCollection=function(t,e){};Eh.prototype.drawLineString=function(t,e){};Eh.prototype.drawMultiLineString=function(t,e){};Eh.prototype.drawMultiPoint=function(t,e){};Eh.prototype.drawMultiPolygon=function(t,e){};Eh.prototype.drawPoint=function(t,e){};Eh.prototype.drawPolygon=function(t,e){};Eh.prototype.drawText=function(t,e){};Eh.prototype.setFillStrokeStyle=function(t,e){};Eh.prototype.setImageStyle=function(t,e){};Eh.prototype.setTextStyle=function(t,e){};var Th={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},Sh=[Th.FILL],xh=[Th.STROKE],Rh=[Th.BEGIN_PATH],Ch=[Th.CLOSE_PATH],wh=function(n){function t(t,e,i,r){n.call(this);this.tolerance=t;this.maxExtent=e;this.pixelRatio=r;this.maxLineWidth=0;this.resolution=i;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_=null;this.bufferedMaxExtent_=null;this.instructions=[];this.coordinates=[];this.hitDetectionInstructions=[];this.state={}}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.applyPixelRatio=function(t){var e=this.pixelRatio;return 1==e?t:t.map(function(t){return t*e})};t.prototype.appendFlatCoordinates=function(t,e,i,r,n,o){var s=this.coordinates.length,a=this.getBufferedMaxExtent();o&&(e+=r);var h,l,u,c=[t[e],t[e+1]],p=[NaN,NaN],d=!0;for(h=e+r;h<i;h+=r){p[0]=t[h];p[1]=t[h+1];if((u=rt(a,p))!==l){if(d){this.coordinates[s++]=c[0];this.coordinates[s++]=c[1]}this.coordinates[s++]=p[0];this.coordinates[s++]=p[1];d=!1}else if(u===Z.INTERSECTING){this.coordinates[s++]=p[0];this.coordinates[s++]=p[1];d=!1}else d=!0;c[0]=p[0];c[1]=p[1];l=u}if(n&&d||h===e+r){this.coordinates[s++]=c[0];this.coordinates[s++]=c[1]}return s};t.prototype.drawCustomCoordinates_=function(t,e,i,r,n){for(var o=0,s=i.length;o<s;++o){var a=i[o],h=this.appendFlatCoordinates(t,e,a,r,!1,!1);n.push(h);e=a}return e};t.prototype.drawCustom=function(t,e,i){this.beginGeometry(t,e);var r,n,o,s,a,h=t.getType(),l=t.getStride(),u=this.coordinates.length;if(h==jt.MULTI_POLYGON){r=(t=t).getOrientedFlatCoordinates();s=[];for(var c=t.getEndss(),p=a=0,d=c.length;p<d;++p){var f=[];a=this.drawCustomCoordinates_(r,a,c[p],l,f);s.push(f)}this.instructions.push([Th.CUSTOM,u,s,t,i,wi])}else if(h==jt.POLYGON||h==jt.MULTI_LINE_STRING){o=[];r=h==jt.POLYGON?t.getOrientedFlatCoordinates():t.getFlatCoordinates();a=this.drawCustomCoordinates_(r,0,t.getEnds(),l,o);this.instructions.push([Th.CUSTOM,u,o,t,i,Ci])}else if(h==jt.LINE_STRING||h==jt.MULTI_POINT){r=t.getFlatCoordinates();n=this.appendFlatCoordinates(r,0,r.length,l,!1,!1);this.instructions.push([Th.CUSTOM,u,n,t,i,Ri])}else if(h==jt.POINT){r=t.getFlatCoordinates();this.coordinates.push(r[0],r[1]);n=this.coordinates.length;this.instructions.push([Th.CUSTOM,u,n,t,i])}this.endGeometry(t,e)};t.prototype.beginGeometry=function(t,e){this.beginGeometryInstruction1_=[Th.BEGIN_GEOMETRY,e,0];this.instructions.push(this.beginGeometryInstruction1_);this.beginGeometryInstruction2_=[Th.BEGIN_GEOMETRY,e,0];this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)};t.prototype.finish=function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}};t.prototype.reverseHitDetectionInstructions=function(){var t,e=this.hitDetectionInstructions;e.reverse();var i,r,n=e.length,o=-1;for(t=0;t<n;++t)if((r=(i=e[t])[0])==Th.END_GEOMETRY)o=t;else if(r==Th.BEGIN_GEOMETRY){i[2]=t;X(this.hitDetectionInstructions,o,t);o=-1}};t.prototype.setFillStrokeStyle=function(t,e){var i=this.state;if(t){var r=t.getColor();i.fillStyle=ma(r||Ta)}else i.fillStyle=void 0;if(e){var n=e.getColor();i.strokeStyle=ma(n||Ca);var o=e.getLineCap();i.lineCap=void 0!==o?o:Sa;var s=e.getLineDash();i.lineDash=s?s.slice():xa;var a=e.getLineDashOffset();i.lineDashOffset=a||0;var h=e.getLineJoin();i.lineJoin=void 0!==h?h:Ra;var l=e.getWidth();i.lineWidth=void 0!==l?l:1;var u=e.getMiterLimit();i.miterLimit=void 0!==u?u:10;if(i.lineWidth>this.maxLineWidth){this.maxLineWidth=i.lineWidth;this.bufferedMaxExtent_=null}}else{i.strokeStyle=void 0;i.lineCap=void 0;i.lineDash=null;i.lineDashOffset=void 0;i.lineJoin=void 0;i.lineWidth=void 0;i.miterLimit=void 0}};t.prototype.createFill=function(t,e){var i=t.fillStyle,r=[Th.SET_FILL_STYLE,i];"string"!=typeof i&&r.push(!0);return r};t.prototype.applyStroke=function(t){this.instructions.push(this.createStroke(t))};t.prototype.createStroke=function(t){return[Th.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]};t.prototype.updateFillStyle=function(t,e,i){var r=t.fillStyle;if("string"!=typeof r||t.currentFillStyle!=r){void 0!==r&&this.instructions.push(e.call(this,t,i));t.currentFillStyle=r}};t.prototype.updateStrokeStyle=function(t,e){var i=t.strokeStyle,r=t.lineCap,n=t.lineDash,o=t.lineDashOffset,s=t.lineJoin,a=t.lineWidth,h=t.miterLimit;if(t.currentStrokeStyle!=i||t.currentLineCap!=r||n!=t.currentLineDash&&!Ft(t.currentLineDash,n)||t.currentLineDashOffset!=o||t.currentLineJoin!=s||t.currentLineWidth!=a||t.currentMiterLimit!=h){void 0!==i&&e.call(this,t);t.currentStrokeStyle=i;t.currentLineCap=r;t.currentLineDash=n;t.currentLineDashOffset=o;t.currentLineJoin=s;t.currentLineWidth=a;t.currentMiterLimit=h}};t.prototype.endGeometry=function(t,e){this.beginGeometryInstruction1_[2]=this.instructions.length;this.beginGeometryInstruction1_=null;this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length;this.beginGeometryInstruction2_=null;var i=[Th.END_GEOMETRY,e];this.instructions.push(i);this.hitDetectionInstructions.push(i)};t.prototype.getBufferedMaxExtent=function(){if(!this.bufferedMaxExtent_){this.bufferedMaxExtent_=Q(this.maxExtent);if(0<this.maxLineWidth){var t=this.resolution*(this.maxLineWidth+1)/2;J(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}}return this.bufferedMaxExtent_};return t}(Eh),Ih=function(n){function t(t,e,i,r){n.call(this,t,e,i,r);this.declutterGroup_=null;this.hitDetectionImage_=null;this.image_=null;this.anchorX_=void 0;this.anchorY_=void 0;this.height_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.scale_=void 0;this.width_=void 0}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.drawCoordinates_=function(t,e,i,r){return this.appendFlatCoordinates(t,e,i,r,!1,!1)};t.prototype.drawPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),n=this.coordinates.length,o=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([Th.DRAW_IMAGE,n,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]);this.hitDetectionInstructions.push([Th.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]);this.endGeometry(t,e)}};t.prototype.drawMultiPoint=function(t,e){if(this.image_){this.beginGeometry(t,e);var i=t.getFlatCoordinates(),r=t.getStride(),n=this.coordinates.length,o=this.drawCoordinates_(i,0,i.length,r);this.instructions.push([Th.DRAW_IMAGE,n,o,this.image_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_*this.pixelRatio,this.width_]);this.hitDetectionInstructions.push([Th.DRAW_IMAGE,n,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.declutterGroup_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_]);this.endGeometry(t,e)}};t.prototype.finish=function(){this.reverseHitDetectionInstructions();this.anchorX_=void 0;this.anchorY_=void 0;this.hitDetectionImage_=null;this.image_=null;this.height_=void 0;this.scale_=void 0;this.opacity_=void 0;this.originX_=void 0;this.originY_=void 0;this.rotateWithView_=void 0;this.rotation_=void 0;this.width_=void 0;return n.prototype.finish.call(this)};t.prototype.setImageStyle=function(t,e){var i=t.getAnchor(),r=t.getSize(),n=t.getHitDetectionImage(1),o=t.getImage(1),s=t.getOrigin();this.anchorX_=i[0];this.anchorY_=i[1];this.declutterGroup_=e;this.hitDetectionImage_=n;this.image_=o;this.height_=r[1];this.opacity_=t.getOpacity();this.originX_=s[0];this.originY_=s[1];this.rotateWithView_=t.getRotateWithView();this.rotation_=t.getRotation();this.scale_=t.getScale();this.width_=r[0]};return t}(wh),Lh=function(n){function t(t,e,i,r){n.call(this,t,e,i,r)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.drawFlatCoordinates_=function(t,e,i,r){var n=this.coordinates.length,o=this.appendFlatCoordinates(t,e,i,r,!1,!1),s=[Th.MOVE_TO_LINE_TO,n,o];this.instructions.push(s);this.hitDetectionInstructions.push(s);return i};t.prototype.drawLineString=function(t,e){var i=this.state,r=i.strokeStyle,n=i.lineWidth;if(void 0!==r&&void 0!==n){this.updateStrokeStyle(i,this.applyStroke);this.beginGeometry(t,e);this.hitDetectionInstructions.push([Th.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Rh);var o=t.getFlatCoordinates(),s=t.getStride();this.drawFlatCoordinates_(o,0,o.length,s);this.hitDetectionInstructions.push(xh);this.endGeometry(t,e)}};t.prototype.drawMultiLineString=function(t,e){var i=this.state,r=i.strokeStyle,n=i.lineWidth;if(void 0!==r&&void 0!==n){this.updateStrokeStyle(i,this.applyStroke);this.beginGeometry(t,e);this.hitDetectionInstructions.push([Th.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset],Rh);for(var o=t.getEnds(),s=t.getFlatCoordinates(),a=t.getStride(),h=0,l=0,u=o.length;l<u;++l)h=this.drawFlatCoordinates_(s,h,o[l],a);this.hitDetectionInstructions.push(xh);this.endGeometry(t,e)}};t.prototype.finish=function(){var t=this.state;null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(xh);this.reverseHitDetectionInstructions();this.state=null;return n.prototype.finish.call(this)};t.prototype.applyStroke=function(t){if(null!=t.lastStroke&&t.lastStroke!=this.coordinates.length){this.instructions.push(xh);t.lastStroke=this.coordinates.length}t.lastStroke=0;n.prototype.applyStroke.call(this,t);this.instructions.push(Rh)};return t}(wh),Oh=function(n){function t(t,e,i,r){n.call(this,t,e,i,r)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.drawFlatCoordinatess_=function(t,e,i,r){var n=this.state,o=void 0!==n.fillStyle,s=null!=n.strokeStyle,a=i.length;this.instructions.push(Rh);this.hitDetectionInstructions.push(Rh);for(var h=0;h<a;++h){var l=i[h],u=this.coordinates.length,c=this.appendFlatCoordinates(t,e,l,r,!0,!s),p=[Th.MOVE_TO_LINE_TO,u,c];this.instructions.push(p);this.hitDetectionInstructions.push(p);if(s){this.instructions.push(Ch);this.hitDetectionInstructions.push(Ch)}e=l}if(o){this.instructions.push(Sh);this.hitDetectionInstructions.push(Sh)}if(s){this.instructions.push(xh);this.hitDetectionInstructions.push(xh)}return e};t.prototype.drawCircle=function(t,e){var i=this.state,r=i.fillStyle,n=i.strokeStyle;if(void 0!==r||void 0!==n){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Th.SET_FILL_STYLE,ca(Ta)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Th.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var o=t.getFlatCoordinates(),s=t.getStride(),a=this.coordinates.length;this.appendFlatCoordinates(o,0,o.length,s,!1,!1);var h=[Th.CIRCLE,a];this.instructions.push(Rh,h);this.hitDetectionInstructions.push(Rh,h);this.hitDetectionInstructions.push(Sh);void 0!==i.fillStyle&&this.instructions.push(Sh);if(void 0!==i.strokeStyle){this.instructions.push(xh);this.hitDetectionInstructions.push(xh)}this.endGeometry(t,e)}};t.prototype.drawPolygon=function(t,e){var i=this.state,r=i.fillStyle,n=i.strokeStyle;if(void 0!==r||void 0!==n){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Th.SET_FILL_STYLE,ca(Ta)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Th.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);var o=t.getEnds(),s=t.getOrientedFlatCoordinates(),a=t.getStride();this.drawFlatCoordinatess_(s,0,o,a);this.endGeometry(t,e)}};t.prototype.drawMultiPolygon=function(t,e){var i=this.state,r=i.fillStyle,n=i.strokeStyle;if(void 0!==r||void 0!==n){this.setFillStrokeStyles_(t);this.beginGeometry(t,e);void 0!==i.fillStyle&&this.hitDetectionInstructions.push([Th.SET_FILL_STYLE,ca(Ta)]);void 0!==i.strokeStyle&&this.hitDetectionInstructions.push([Th.SET_STROKE_STYLE,i.strokeStyle,i.lineWidth,i.lineCap,i.lineJoin,i.miterLimit,i.lineDash,i.lineDashOffset]);for(var o=t.getEndss(),s=t.getOrientedFlatCoordinates(),a=t.getStride(),h=0,l=0,u=o.length;l<u;++l)h=this.drawFlatCoordinatess_(s,h,o[l],a);this.endGeometry(t,e)}};t.prototype.finish=function(){this.reverseHitDetectionInstructions();this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,i=0,r=e.length;i<r;++i)e[i]=Pi(e[i],t);return n.prototype.finish.call(this)};t.prototype.setFillStrokeStyles_=function(t){var e=this.state;void 0!==e.fillStyle&&this.updateFillStyle(e,this.createFill,t);void 0!==e.strokeStyle&&this.updateStrokeStyle(e,this.applyStroke)};return t}(wh);function Ph(t,e,i,r,n){var o,s,a,h,l,u,c,p,d,f=i,_=i,g=0,y=0,m=i;for(o=i;o<r;o+=n){var v=e[o],E=e[o+1];if(void 0!==h){p=v-h;d=E-l;a=Math.sqrt(p*p+d*d);if(void 0!==u){y+=s;if(t<Math.acos((u*p+c*d)/(s*a))){if(g<y){g=y;f=m;_=o}y=0;m=o-n}}s=a;u=p;c=d}h=v;l=E}return g<(y+=a)?[m,o]:[f,_]}var bh={POINT:"point",LINE:"line"},Mh={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1},Fh=function(n){function t(t,e,i,r){n.call(this,t,e,i,r);this.declutterGroup_;this.labels_=null;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=void 0;this.textRotation_=0;this.textFillState_=null;this.fillStates={};this.textStrokeState_=null;this.strokeStates={};this.textState_={};this.textStates={};this.textKey_="";this.fillKey_="";this.strokeKey_="";Oa.prune()}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.finish=function(){var t=n.prototype.finish.call(this);t.textStates=this.textStates;t.fillStates=this.fillStates;t.strokeStates=this.strokeStates;return t};t.prototype.drawText=function(t,e){var i=this.textFillState_,r=this.textStrokeState_,n=this.textState_;if(""!==this.text_&&n&&(i||r)){var o,s,a=this.coordinates.length,h=t.getType(),l=null,u=2,c=2;if(n.placement===bh.LINE){if(!Nt(this.getBufferedMaxExtent(),t.getExtent()))return;var p;l=t.getFlatCoordinates();c=t.getStride();if(h==jt.LINE_STRING)p=[l.length];else if(h==jt.MULTI_LINE_STRING)p=t.getEnds();else if(h==jt.POLYGON)p=t.getEnds().slice(0,1);else if(h==jt.MULTI_POLYGON){var d=t.getEndss();p=[];for(o=0,s=d.length;o<s;++o)p.push(d[o][0])}this.beginGeometry(t,e);for(var f,_=n.textAlign,g=0,y=0,m=p.length;y<m;++y){if(null==_){var v=Ph(n.maxAngle,l,g,p[y],c);g=v[0];f=v[1]}else f=p[y];for(o=g;o<f;o+=c)this.coordinates.push(l[o],l[o+1]);u=this.coordinates.length;g=p[y];this.drawChars_(a,u,this.declutterGroup_);a=u}this.endGeometry(t,e)}else{var E=null;n.overflow||(E=[]);switch(h){case jt.POINT:case jt.MULTI_POINT:u=(l=t.getFlatCoordinates()).length;break;case jt.LINE_STRING:l=t.getFlatMidpoint();break;case jt.CIRCLE:l=t.getCenter();break;case jt.MULTI_LINE_STRING:u=(l=t.getFlatMidpoints()).length;break;case jt.POLYGON:l=t.getFlatInteriorPoint();n.overflow||E.push(l[2]/this.resolution);c=3;break;case jt.MULTI_POLYGON:var T=t.getFlatInteriorPoints();l=[];for(o=0,s=T.length;o<s;o+=3){n.overflow||E.push(T[o+2]/this.resolution);l.push(T[o],T[o+1])}if(0==(u=l.length))return}u=this.appendFlatCoordinates(l,0,u,c,!1,!1);this.saveTextStates_();if(n.backgroundFill||n.backgroundStroke){this.setFillStrokeStyle(n.backgroundFill,n.backgroundStroke);if(n.backgroundFill){this.updateFillStyle(this.state,this.createFill,t);this.hitDetectionInstructions.push(this.createFill(this.state,t))}if(n.backgroundStroke){this.updateStrokeStyle(this.state,this.applyStroke);this.hitDetectionInstructions.push(this.createStroke(this.state))}}this.beginGeometry(t,e);var S=this.pixelRatio;this.instructions.push([Th.DRAW_IMAGE,a,u,null,NaN,NaN,this.declutterGroup_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1,NaN,n.padding==La?La:n.padding.map(function(t){return t*S}),!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,E]);this.hitDetectionInstructions.push([Th.DRAW_IMAGE,a,u,null,NaN,NaN,this.declutterGroup_,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,1/this.pixelRatio,NaN,n.padding,!!n.backgroundFill,!!n.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,E]);this.endGeometry(t,e)}}};t.prototype.saveTextStates_=function(){var t=this.textStrokeState_,e=this.textState_,i=this.textFillState_,r=this.strokeKey_;t&&(r in this.strokeStates||(this.strokeStates[r]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var n=this.textKey_;n in this.textStates||(this.textStates[n]={font:e.font,textAlign:e.textAlign||wa,textBaseline:e.textBaseline||Ia,scale:e.scale});var o=this.fillKey_;i&&(o in this.fillStates||(this.fillStates[o]={fillStyle:i.fillStyle}))};t.prototype.drawChars_=function(t,e,i){var r=this.textStrokeState_,n=this.textState_,o=this.strokeKey_,s=this.textKey_,a=this.fillKey_;this.saveTextStates_();var h=this.pixelRatio,l=Mh[n.textBaseline],u=this.textOffsetY_*h,c=this.text_,p=n.scale,d=r?r.lineWidth*p/2:0;this.instructions.push([Th.DRAW_CHARS,t,e,l,i,n.overflow,a,n.maxAngle,h,u,o,d*h,c,s,1]);this.hitDetectionInstructions.push([Th.DRAW_CHARS,t,e,l,i,n.overflow,a,n.maxAngle,1,u,o,d,c,s,1/h])};t.prototype.setTextStyle=function(t,e){var i,r,n;if(t){this.declutterGroup_=e;var o=t.getFill();if(o){(r=this.textFillState_)||(r=this.textFillState_={});r.fillStyle=ma(o.getColor()||Ta)}else r=this.textFillState_=null;var s=t.getStroke();if(s){(n=this.textStrokeState_)||(n=this.textStrokeState_={});var a=s.getLineDash(),h=s.getLineDashOffset(),l=s.getWidth(),u=s.getMiterLimit();n.lineCap=s.getLineCap()||Sa;n.lineDash=a?a.slice():xa;n.lineDashOffset=void 0===h?0:h;n.lineJoin=s.getLineJoin()||Ra;n.lineWidth=void 0===l?1:l;n.miterLimit=void 0===u?10:u;n.strokeStyle=ma(s.getColor()||Ca)}else n=this.textStrokeState_=null;i=this.textState_;var c=t.getFont()||Ea;Fa(c);var p=t.getScale();i.overflow=t.getOverflow();i.font=c;i.maxAngle=t.getMaxAngle();i.placement=t.getPlacement();i.textAlign=t.getTextAlign();i.textBaseline=t.getTextBaseline()||Ia;i.backgroundFill=t.getBackgroundFill();i.backgroundStroke=t.getBackgroundStroke();i.padding=t.getPadding()||La;i.scale=void 0===p?1:p;var d=t.getOffsetX(),f=t.getOffsetY(),_=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"";this.textOffsetX_=void 0===d?0:d;this.textOffsetY_=void 0===f?0:f;this.textRotateWithView_=void 0!==_&&_;this.textRotation_=void 0===g?0:g;this.strokeKey_=n?("string"==typeof n.strokeStyle?n.strokeStyle:bt(n.strokeStyle))+n.lineCap+n.lineDashOffset+"|"+n.lineWidth+n.lineJoin+n.miterLimit+"["+n.lineDash.join()+"]":"";this.textKey_=i.font+i.scale+(i.textAlign||"?");this.fillKey_=r?"string"==typeof r.fillStyle?r.fillStyle:"|"+bt(r.fillStyle):""}else this.text_=""};return t}(wh),Nh={Circle:Oh,Default:wh,Image:Ih,LineString:Lh,Polygon:Oh,Text:Fh},Ah=function(t,e,i,r,n){this.declutter_=n;this.declutterGroup_=null;this.tolerance_=t;this.maxExtent_=e;this.pixelRatio_=r;this.resolution_=i;this.buildersByZIndex_={}};Ah.prototype.addDeclutter=function(t){var e=null;this.declutter_&&(t?(e=this.declutterGroup_)[4]++:(e=this.declutterGroup_=[1/0,1/0,-1/0,-1/0]).push(1));return e};Ah.prototype.finish=function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var i=this.buildersByZIndex_[e];for(var r in i){var n=i[r].finish();t[e][r]=n}}return t};Ah.prototype.getBuilder=function(t,e){var i=void 0!==t?t.toString():"0",r=this.buildersByZIndex_[i];if(void 0===r){r={};this.buildersByZIndex_[i]=r}var n=r[e];if(void 0===n){n=new Nh[e](this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_);r[e]=n}return n};var Gh={CIRCLE:"Circle",DEFAULT:"Default",IMAGE:"Image",LINE_STRING:"LineString",POLYGON:"Polygon",TEXT:"Text"};function Dh(t,e,i,r,n,o,s,a,h,l,u){for(var c,p,d,f=[],_=t[e]>t[i-r],g=n.length,y=t[e],m=t[e+1],v=t[e+=r],E=t[e+1],T=0,S=Math.sqrt(Math.pow(v-y,2)+Math.pow(E-m,2)),x="",R=0,C=0;C<g;++C){p=_?g-C-1:C;var w=n.charAt(p),I=a*h(l,x=_?w+x:x+w,u)-R;R+=I;for(var L=o+I/2;e<i-r&&T+S<L;){y=v;m=E;v=t[e+=r];E=t[e+1];T+=S;S=Math.sqrt(Math.pow(v-y,2)+Math.pow(E-m,2))}var O=L-T,P=Math.atan2(E-m,v-y);_&&(P+=0<P?-Math.PI:Math.PI);if(void 0!==d){var b=P-d;b+=b>Math.PI?-2*Math.PI:b<-Math.PI?2*Math.PI:0;if(Math.abs(b)>s)return null}var M=O/S,F=Qt(y,v,M),N=Qt(m,E,M);if(d==P){if(_){c[0]=F;c[1]=N;c[2]=I/2}c[4]=x}else{c=[F,N,(R=I)/2,P,x=w];_?f.unshift(c):f.push(c);d=P}o+=I}return f}var kh=[1/0,1/0,-1/0,-1/0],jh=[1,0,0,1,0,0],Uh=function(t,e,i,r,n,o){this.declutterTree=n;this.maxExtent=t;this.overlaps=r;this.pixelRatio=i;this.resolution=e;this.alignFill_;this.instructions=o.instructions;this.coordinates=o.coordinates;this.coordinateCache_={};this.renderedTransform_=[1,0,0,1,0,0];this.hitDetectionInstructions=o.hitDetectionInstructions;this.pixelCoordinates_=null;this.viewRotation_=0;this.fillStates=o.fillStates||{};this.strokeStates=o.strokeStates||{};this.textStates=o.textStates||{};this.widths_={}};Uh.prototype.getTextImage=function(t,e,i,r){var n,o=r+e+t+i+this.pixelRatio;if(!Oa.containsKey(o)){var s=r?this.strokeStates[r]:null,a=i?this.fillStates[i]:null,h=this.textStates[e],l=this.pixelRatio,u=h.scale*l,c=Mh[h.textAlign||wa],p=r&&s.lineWidth?s.lineWidth:0,d=t.split("\n"),f=d.length,_=[],g=Ua(h.font,d,_),y=Da(h.font),m=y*f,v=g+p,E=zr(Math.ceil(v*u),Math.ceil((m+p)*u));n=E.canvas;Oa.set(o,n);1!=u&&E.scale(u,u);E.font=h.font;if(r){E.strokeStyle=s.strokeStyle;E.lineWidth=p;E.lineCap=s.lineCap;E.lineJoin=s.lineJoin;E.miterLimit=s.miterLimit;if(E.setLineDash&&s.lineDash.length){E.setLineDash(s.lineDash);E.lineDashOffset=s.lineDashOffset}}i&&(E.fillStyle=a.fillStyle);E.textBaseline="middle";E.textAlign="center";var T,S=.5-c,x=c*n.width/u+S*p;if(r)for(T=0;T<f;++T)E.strokeText(d[T],x+S*_[T],.5*(p+y)+T*y);if(i)for(T=0;T<f;++T)E.fillText(d[T],x+S*_[T],.5*(p+y)+T*y)}return Oa.get(o)};Uh.prototype.replayTextBackground_=function(t,e,i,r,n,o,s){t.beginPath();t.moveTo.apply(t,e);t.lineTo.apply(t,i);t.lineTo.apply(t,r);t.lineTo.apply(t,n);t.lineTo.apply(t,e);if(o){this.alignFill_=o[2];this.fill_(t)}if(s){this.setStrokeStyle_(t,s);t.stroke()}};Uh.prototype.replayImage_=function(t,e,i,r,n,o,s,a,h,l,u,c,p,d,f,_,g,y){var m=g||y;e-=n*=p;i-=o*=p;var v,E,T,S,x=f+l>r.width?r.width-l:f,R=a+u>r.height?r.height-u:a,C=_[3]+x*p+_[1],w=_[0]+R*p+_[2],I=e-_[3],L=i-_[0];if(m||0!==c){v=[I,L];E=[I+C,L];T=[I+C,L+w];S=[I,L+w]}var O=null;if(0!==c){var P=e+n,b=i+o;O=ei(jh,P,b,1,1,c,-P,-b);st(kh);pt(kh,qe(jh,v));pt(kh,qe(jh,E));pt(kh,qe(jh,T));pt(kh,qe(jh,S))}else ot(I,L,I+C,L+w,kh);var M=t.canvas,F=y?y[2]*p/2:0,N=kh[0]-F<=M.width&&0<=kh[2]+F&&kh[1]-F<=M.height&&0<=kh[3]+F;if(d){e=Math.round(e);i=Math.round(i)}if(s){if(!N&&1==s[4])return;ct(s,kh);var A=N?[t,O?O.slice(0):null,h,r,l,u,x,R,e,i,p]:null;A&&m&&A.push(g,y,v,E,T,S);s.push(A)}else if(N){m&&this.replayTextBackground_(t,v,E,T,S,g,y);Ba(t,O,h,r,l,u,x,R,e,i,p)}};Uh.prototype.fill_=function(t){if(this.alignFill_){var e=qe(this.renderedTransform_,[0,0]),i=512*this.pixelRatio;t.translate(e[0]%i,e[1]%i);t.rotate(this.viewRotation_)}t.fill();this.alignFill_&&t.setTransform.apply(t,Xa)};Uh.prototype.setStrokeStyle_=function(t,e){t.strokeStyle=e[1];t.lineWidth=e[2];t.lineCap=e[3];t.lineJoin=e[4];t.miterLimit=e[5];if(t.setLineDash){t.lineDashOffset=e[7];t.setLineDash(e[6])}};Uh.prototype.renderDeclutter_=function(t,e){if(t&&5<t.length){var i=t[4];if(1==i||i==t.length-5){var r={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};if(!this.declutterTree.collides(r)){this.declutterTree.insert(r);for(var n=5,o=t.length;n<o;++n){var s=t[n];if(s){11<s.length&&this.replayTextBackground_(s[0],s[13],s[14],s[15],s[16],s[11],s[12]);Ba.apply(void 0,s)}}}t.length=5;st(t)}}};Uh.prototype.drawTextImageWithPointPlacement_=function(t,e,i,r){var n=this.textStates[e],o=this.getTextImage(t,e,r,i),s=this.strokeStates[i],a=this.pixelRatio,h=Mh[n.textAlign||wa],l=Mh[n.textBaseline||Ia],u=s&&s.lineWidth?s.lineWidth:0;return{label:o,anchorX:h*o.width/a+2*(.5-h)*u,anchorY:l*o.height/a+2*(.5-l)*u}};Uh.prototype.execute_=function(t,e,i,r,n,o,s){var a;if(this.pixelCoordinates_&&Ft(e,this.renderedTransform_))a=this.pixelCoordinates_;else{this.pixelCoordinates_||(this.pixelCoordinates_=[]);a=Ut(this.coordinates,0,this.coordinates.length,2,e,this.pixelCoordinates_);Ze(this.renderedTransform_,e)}for(var h,l,u,c,p,d,f,_,g,y,m,v,E,T,S,x,R=!Mt(i),C=0,w=r.length,I=0,L=0,O=0,P=null,b=null,M=this.coordinateCache_,F=this.viewRotation_,N={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:F},A=this.instructions!=r||this.overlaps?0:200;C<w;){var G=r[C];switch(G[0]){case Th.BEGIN_GEOMETRY:T=G[1];R&&i[bt(T)]||!T.getGeometry()?C=G[2]:void 0===s||Nt(s,T.getGeometry().getExtent())?++C:C=G[2]+1;break;case Th.BEGIN_PATH:if(A<L){this.fill_(t);L=0}if(A<O){t.stroke();O=0}if(!L&&!O){t.beginPath();c=p=NaN}++C;break;case Th.CIRCLE:var D=a[I=G[1]],k=a[I+1],j=a[I+2]-D,U=a[I+3]-k,Y=Math.sqrt(j*j+U*U);t.moveTo(D+Y,k);t.arc(D,k,Y,0,2*Math.PI,!0);++C;break;case Th.CLOSE_PATH:t.closePath();++C;break;case Th.CUSTOM:I=G[1];h=G[2];var X=G[3],B=G[4],z=6==G.length?G[5]:void 0;N.geometry=X;N.feature=T;C in M||(M[C]=[]);var V=M[C];if(z)z(a,I,h,2,V);else{V[0]=a[I];V[1]=a[I+1];V.length=2}B(V,N);++C;break;case Th.DRAW_IMAGE:I=G[1];h=G[2];g=G[3];l=G[4];u=G[5];_=o?null:G[6];var W=G[7],K=G[8],H=G[9],Z=G[10],q=G[11],J=G[12],Q=G[13],$=G[14];if(!g&&19<=G.length){y=G[18];m=G[19];v=G[20];E=G[21];var tt=this.drawTextImageWithPointPlacement_(y,m,v,E);g=G[3]=tt.label;var et=G[22];l=G[4]=(tt.anchorX-et)*this.pixelRatio;var it=G[23];u=G[5]=(tt.anchorY-it)*this.pixelRatio;W=G[7]=g.height;$=G[14]=g.width}var rt=void 0;24<G.length&&(rt=G[24]);var nt=void 0,ot=void 0,st=void 0;if(16<G.length){nt=G[15];ot=G[16];st=G[17]}else{nt=La;ot=st=!1}q&&(J+=F);for(var at=0;I<h;I+=2)rt&&rt[at++]<$/this.pixelRatio||this.replayImage_(t,a[I],a[I+1],g,l,u,_,W,K,H,Z,J,Q,n,$,nt,ot?P:null,st?b:null);this.renderDeclutter_(_,T);++C;break;case Th.DRAW_CHARS:var ht=G[1],lt=G[2],ut=G[3];_=o?null:G[4];var ct=G[5];E=G[6];var pt=G[7],dt=G[8],ft=G[9];v=G[10];var _t=G[11];y=G[12];m=G[13];var gt=G[14],yt=this.textStates[m],mt=yt.font,vt=yt.scale*dt,Et=void 0;Et=mt in this.widths_?this.widths_[mt]:this.widths_[mt]={};var Tt=ra(a,ht,lt,2),St=vt*ja(mt,y,Et);if(ct||St<=Tt){var xt=this.textStates[m].textAlign,Rt=Dh(a,ht,lt,2,y,(Tt-St)*Mh[xt],pt,vt,ja,mt,Et);if(Rt){var Ct=void 0,wt=void 0,It=void 0,Lt=void 0,Ot=void 0;if(v)for(Ct=0,wt=Rt.length;Ct<wt;++Ct){It=(Ot=Rt[Ct])[4];Lt=this.getTextImage(It,m,"",v);l=Ot[2]+_t;u=ut*Lt.height+2*(.5-ut)*_t-ft;this.replayImage_(t,Ot[0],Ot[1],Lt,l,u,_,Lt.height,1,0,0,Ot[3],gt,!1,Lt.width,La,null,null)}if(E)for(Ct=0,wt=Rt.length;Ct<wt;++Ct){It=(Ot=Rt[Ct])[4];Lt=this.getTextImage(It,m,E,"");l=Ot[2];u=ut*Lt.height-ft;this.replayImage_(t,Ot[0],Ot[1],Lt,l,u,_,Lt.height,1,0,0,Ot[3],gt,!1,Lt.width,La,null,null)}}}this.renderDeclutter_(_,T);++C;break;case Th.END_GEOMETRY:if(void 0!==o){var Pt=o(T=G[1]);if(Pt)return Pt}++C;break;case Th.FILL:A?L++:this.fill_(t);++C;break;case Th.MOVE_TO_LINE_TO:I=G[1];h=G[2];S=a[I];f=(x=a[I+1])+.5|0;if((d=S+.5|0)!==c||f!==p){t.moveTo(S,x);c=d;p=f}for(I+=2;I<h;I+=2){d=(S=a[I])+.5|0;f=(x=a[I+1])+.5|0;if(I==h-2||d!==c||f!==p){t.lineTo(S,x);c=d;p=f}}++C;break;case Th.SET_FILL_STYLE:P=G;this.alignFill_=G[2];if(L){this.fill_(t);L=0;if(O){t.stroke();O=0}}t.fillStyle=G[1];++C;break;case Th.SET_STROKE_STYLE:b=G;if(O){t.stroke();O=0}this.setStrokeStyle_(t,G);++C;break;case Th.STROKE:A?O++:t.stroke();++C;break;default:++C}}L&&this.fill_(t);O&&t.stroke()};Uh.prototype.execute=function(t,e,i,r,n){this.viewRotation_=i;this.execute_(t,e,r,this.instructions,n,void 0,void 0)};Uh.prototype.executeHitDetection=function(t,e,i,r,n,o){this.viewRotation_=i;return this.execute_(t,e,r,this.hitDetectionInstructions,!0,n,o)};var Yh=[Gh.POLYGON,Gh.CIRCLE,Gh.LINE_STRING,Gh.IMAGE,Gh.TEXT,Gh.DEFAULT],Xh=function(t,e,i,r,n,o,s){this.declutterTree_=n;this.maxExtent_=t;this.overlaps_=r;this.pixelRatio_=i;this.resolution_=e;this.renderBuffer_=s;this.executorsByZIndex_={};this.hitDetectionContext_=zr(1,1);this.hitDetectionTransform_=[1,0,0,1,0,0];this.createExecutors_(o)};Xh.prototype.clip=function(t,e){var i=this.getClipCoords(e);t.beginPath();t.moveTo(i[0],i[1]);t.lineTo(i[2],i[3]);t.lineTo(i[4],i[5]);t.lineTo(i[6],i[7]);t.clip()};Xh.prototype.createExecutors_=function(t){for(var e in t){var i=this.executorsByZIndex_[e];void 0===i&&(this.executorsByZIndex_[e]=i={});var r=t[e];for(var n in r){var o=r[n];i[n]=new Uh(this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,this.declutterTree_,o)}}};Xh.prototype.hasExecutors=function(t){for(var e in this.executorsByZIndex_)for(var i=this.executorsByZIndex_[e],r=0,n=t.length;r<n;++r)if(t[r]in i)return!0;return!1};Xh.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n,o,s){var a,h=2*(r=Math.round(r))+1,l=ei(this.hitDetectionTransform_,r+.5,r+.5,1/e,-1/e,-i,-t[0],-t[1]),u=this.hitDetectionContext_;if(u.canvas.width!==h||u.canvas.height!==h){u.canvas.width=h;u.canvas.height=h}else u.clearRect(0,0,h,h);if(void 0!==this.renderBuffer_){pt(a=[1/0,1/0,-1/0,-1/0],t);J(a,e*(this.renderBuffer_+r),a)}var c,p,d=Vh(r);this.declutterTree_&&(c=this.declutterTree_.all().map(function(t){return t.value}));function f(t){for(var e=u.getImageData(0,0,h,h).data,i=0;i<h;i++)for(var r=0;r<h;r++)if(d[i][r]&&0<e[4*(r*h+i)+3]){var n=void 0;(!c||p!=Gh.IMAGE&&p!=Gh.TEXT||-1!==c.indexOf(t))&&(n=o(t));if(n)return n;u.clearRect(0,0,h,h);return}}var _,g,y,m,v,E=Object.keys(this.executorsByZIndex_).map(Number);E.sort(j);for(_=E.length-1;0<=_;--_){var T=E[_].toString();y=this.executorsByZIndex_[T];for(g=Yh.length-1;0<=g;--g)if(void 0!==(m=y[p=Yh[g]]))if(!s||p!=Gh.IMAGE&&p!=Gh.TEXT){if(v=m.executeHitDetection(u,l,i,n,f,a))return v}else{var S=s[T];S?S.push(m,l.slice(0)):s[T]=[m,l.slice(0)]}}};Xh.prototype.getClipCoords=function(t){var e=this.maxExtent_,i=e[0],r=e[1],n=e[2],o=e[3],s=[i,r,i,o,n,o,n,r];Ut(s,0,8,2,t,s);return s};Xh.prototype.getExecutor=function(t,e){var i=void 0!==t?t.toString():"0",r=this.executorsByZIndex_[i];if(void 0===r){r={};this.executorsByZIndex_[i]=r}var n=r[e];if(void 0===n){n=new Uh(this.maxExtent_,this.resolution_,this.pixelRatio_,this.overlaps_,{instructions:[],hitDetectionInstructions:[],coordinates:[]},this.declutterTree_);r[e]=n}return n};Xh.prototype.getExecutors=function(){return this.executorsByZIndex_};Xh.prototype.isEmpty=function(){return Mt(this.executorsByZIndex_)};Xh.prototype.execute=function(t,e,i,r,n,o,s){var a=Object.keys(this.executorsByZIndex_).map(Number);a.sort(j);t.save();this.clip(t,e);var h,l,u,c,p,d,f=o||Yh;for(h=0,l=a.length;h<l;++h){var _=a[h].toString();p=this.executorsByZIndex_[_];for(u=0,c=f.length;u<c;++u){var g=f[u];if(void 0!==(d=p[g]))if(!s||g!=Gh.IMAGE&&g!=Gh.TEXT)d.execute(t,e,i,r,n);else{var y=s[_];y?y.push(d,e.slice(0)):s[_]=[d,e.slice(0)]}}}t.restore()};var Bh={0:[[!0]]};function zh(t,e,i){var r,n=Math.floor(t.length/2);if(n<=e)for(r=n;r<e;r++)t[r][i]=!0;else if(e<n)for(r=e+1;r<n;r++)t[r][i]=!0}function Vh(t){if(void 0!==Bh[t])return Bh[t];for(var e=2*t+1,i=new Array(e),r=0;r<e;r++)i[r]=new Array(e);for(var n=t,o=0,s=0;o<=n;){zh(i,t+n,t+o);zh(i,t+o,t+n);zh(i,t-o,t+n);zh(i,t-n,t+o);zh(i,t-n,t-o);zh(i,t-o,t-n);zh(i,t+o,t-n);zh(i,t+n,t-o);0<2*((s+=1+2*++o)-n)+1&&(s+=1-2*(n-=1))}return Bh[t]=i}function Wh(t,e,i,r){for(var n=Object.keys(t).map(Number).sort(j),o={},s=0,a=n.length;s<a;++s)for(var h=t[n[s].toString()],l=0,u=h.length;l<u;){var c=h[l++],p=h[l++];c.execute(e,p,i,o,r)}}var Kh=function(o){function t(t,e,i,r,n){o.call(this,t);this.inversePixelTransform=e;this.frameState=i;this.context=r;this.glContext=n}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(S),Hh=function(e){function t(t){e.call(this);this.layer_=t}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.prepareFrame=function(t,e){return o()};t.prototype.renderFrame=function(t,e){return o()};t.prototype.loadedTileCallback=function(t,e,i){t[e]||(t[e]={});t[e][i.tileCoord.toString()]=i};t.prototype.createLoadedTileFinder=function(r,n,o){return function(t,e){var i=this.loadedTileCallback.bind(this,o,t);return r.forEachLoadedTile(n,t,e,i)}.bind(this)};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r){};t.prototype.getDataAtPixel=function(t,e,i){return o()};t.prototype.getLayer=function(){return this.layer_};t.prototype.handleImageChange_=function(t){t.target.getState()===Ar.LOADED&&this.renderIfReadyAndVisible()};t.prototype.hasFeatureAtCoordinate=function(t,e){return!1};t.prototype.loadImage=function(t){var e=t.getState();e!=Ar.LOADED&&e!=Ar.ERROR&&m(t,C.CHANGE,this.handleImageChange_,this);if(e==Ar.IDLE){t.load();e=t.getState()}return e==Ar.LOADED};t.prototype.renderIfReadyAndVisible=function(){var t=this.getLayer();t.getVisible()&&t.getSourceState()==bo.READY&&t.changed()};t.prototype.scheduleExpireCache=function(t,e){if(e.canExpireCache()){var i=function(t,e,i){var r=bt(t);r in i.usedTiles&&t.expireCache(i.viewState.projection,i.usedTiles[r])}.bind(null,e);t.postRenderFunctions.push(i)}};t.prototype.updateUsedTiles=function(t,e,i,r){var n=bt(e),o=i.toString();if(n in t)o in t[n]?t[n][o].extend(r):t[n][o]=r;else{t[n]={};t[n][o]=r}};t.prototype.manageTilePyramid=function(t,e,i,r,n,o,s,a,h,l){var u=bt(e);u in t.wantedTiles||(t.wantedTiles[u]={});var c,p,d,f,_,g,y=t.wantedTiles[u],m=t.tileQueue;for(g=i.getMinZoom();g<=s;++g){p=i.getTileRangeForExtentAndZ(o,g,p);d=i.getResolution(g);for(f=p.minX;f<=p.maxX;++f)for(_=p.minY;_<=p.maxY;++_)if(s-g<=a){if((c=e.getTile(g,f,_,r,n)).getState()==kr.IDLE){y[c.getKey()]=!0;m.isKeyQueued(c.getKey())||m.enqueue([c,u,i.getTileCoordCenter(c.tileCoord),d])}void 0!==h&&h.call(l,c)}else e.useTile(g,f,_,n)}};return t}(w),Zh=function(i){function t(t){i.call(this,t);this.renderedResolution;this.tempTransform_=[1,0,0,1,0,0];this.pixelTransform_=[1,0,0,1,0,0];this.inversePixelTransform_=[1,0,0,1,0,0];this.context=zr();var e=this.context.canvas;e.style.position="absolute";e.style.transformOrigin="top left";e.className=this.getLayer().getClassName()}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.clip=function(t,e,i){var r=e.pixelRatio,n=e.size[0]*r/2,o=e.size[1]*r/2,s=e.viewState.rotation,a=wt(i),h=It(i),l=Et(i),u=vt(i);qe(e.coordinateToPixelTransform,a);qe(e.coordinateToPixelTransform,h);qe(e.coordinateToPixelTransform,l);qe(e.coordinateToPixelTransform,u);t.save();Ya(t,-s,n,o);t.beginPath();t.moveTo(a[0]*r,a[1]*r);t.lineTo(h[0]*r,h[1]*r);t.lineTo(l[0]*r,l[1]*r);t.lineTo(u[0]*r,u[1]*r);t.clip();Ya(t,s,n,o)};t.prototype.clipUnrotated=function(t,e,i){var r=wt(i),n=It(i),o=Et(i),s=vt(i);qe(e.coordinateToPixelTransform,r);qe(e.coordinateToPixelTransform,n);qe(e.coordinateToPixelTransform,o);qe(e.coordinateToPixelTransform,s);var a=this.inversePixelTransform_;qe(a,r);qe(a,n);qe(a,o);qe(a,s);t.save();t.beginPath();t.moveTo(Math.round(r[0]),Math.round(r[1]));t.lineTo(Math.round(n[0]),Math.round(n[1]));t.lineTo(Math.round(o[0]),Math.round(o[1]));t.lineTo(Math.round(s[0]),Math.round(s[1]));t.clip()};t.prototype.dispatchRenderEvent_=function(t,e,i){var r=this.getLayer();if(r.hasListener(t)){var n=new Kh(t,this.inversePixelTransform_,i,e,null);r.dispatchEvent(n)}};t.prototype.preRender=function(t,e){this.dispatchRenderEvent_(Kn.PRERENDER,t,e)};t.prototype.postRender=function(t,e){this.dispatchRenderEvent_(Kn.POSTRENDER,t,e)};t.prototype.getRenderTransform=function(t,e,i,r){var n=t.viewState,o=e/2,s=i/2,a=t.pixelRatio/n.resolution,h=-a,l=-n.center[0]+r,u=-n.center[1];return ei(this.tempTransform_,o,s,a,h,-n.rotation,l,u)};t.prototype.getDataAtPixel=function(t,e,i){var r,n=qe(this.inversePixelTransform_,t.slice()),o=this.context;try{r=o.getImageData(Math.round(n[0]),Math.round(n[1]),1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:r}return 0===r[3]?null:r};return t}(Hh),qh=.5,Jh={Point:function(t,e,i,r){var n=i.getImage();if(n){if(n.getImageState()!=Ar.LOADED)return;var o=t.getBuilder(i.getZIndex(),Gh.IMAGE);o.setImageStyle(n,t.addDeclutter(!1));o.drawPoint(e,r)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Gh.TEXT);a.setTextStyle(s,t.addDeclutter(!!n));a.drawText(e,r)}},LineString:function(t,e,i,r){var n=i.getStroke();if(n){var o=t.getBuilder(i.getZIndex(),Gh.LINE_STRING);o.setFillStrokeStyle(null,n);o.drawLineString(e,r)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Gh.TEXT);a.setTextStyle(s,t.addDeclutter(!1));a.drawText(e,r)}},Polygon:function(t,e,i,r){var n=i.getFill(),o=i.getStroke();if(n||o){var s=t.getBuilder(i.getZIndex(),Gh.POLYGON);s.setFillStrokeStyle(n,o);s.drawPolygon(e,r)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Gh.TEXT);h.setTextStyle(a,t.addDeclutter(!1));h.drawText(e,r)}},MultiPoint:function(t,e,i,r){var n=i.getImage();if(n){if(n.getImageState()!=Ar.LOADED)return;var o=t.getBuilder(i.getZIndex(),Gh.IMAGE);o.setImageStyle(n,t.addDeclutter(!1));o.drawMultiPoint(e,r)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Gh.TEXT);a.setTextStyle(s,t.addDeclutter(!!n));a.drawText(e,r)}},MultiLineString:function(t,e,i,r){var n=i.getStroke();if(n){var o=t.getBuilder(i.getZIndex(),Gh.LINE_STRING);o.setFillStrokeStyle(null,n);o.drawMultiLineString(e,r)}var s=i.getText();if(s){var a=t.getBuilder(i.getZIndex(),Gh.TEXT);a.setTextStyle(s,t.addDeclutter(!1));a.drawText(e,r)}},MultiPolygon:function(t,e,i,r){var n=i.getFill(),o=i.getStroke();if(o||n){var s=t.getBuilder(i.getZIndex(),Gh.POLYGON);s.setFillStrokeStyle(n,o);s.drawMultiPolygon(e,r)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Gh.TEXT);h.setTextStyle(a,t.addDeclutter(!1));h.drawText(e,r)}},GeometryCollection:function(t,e,i,r){var n,o,s=e.getGeometriesArray();for(n=0,o=s.length;n<o;++n){var a=Jh[s[n].getType()];a(t,s[n],i,r)}},Circle:function(t,e,i,r){var n=i.getFill(),o=i.getStroke();if(n||o){var s=t.getBuilder(i.getZIndex(),Gh.CIRCLE);s.setFillStrokeStyle(n,o);s.drawCircle(e,r)}var a=i.getText();if(a){var h=t.getBuilder(i.getZIndex(),Gh.TEXT);h.setTextStyle(a,t.addDeclutter(!1));h.drawText(e,r)}}};function Qh(t,e){return parseInt(bt(t),10)-parseInt(bt(e),10)}function $h(t,e){var i=tl(t,e);return i*i}function tl(t,e){return qh*t/e}function el(t,e,i,r,n,o){var s=!1,a=i.getImage();if(a){var h=a.getImageState();if(h==Ar.LOADED||h==Ar.ERROR)a.unlistenImageChange(n,o);else{h==Ar.IDLE&&a.load();h=a.getImageState();a.listenImageChange(n,o);s=!0}}!function(t,e,i,r){var n=i.getGeometryFunction()(e);if(!n)return;var o=n.getSimplifiedGeometry(r);if(i.getRenderer())!function t(e,i,r,n){if(i.getType()==jt.GEOMETRY_COLLECTION){for(var o=i.getGeometries(),s=0,a=o.length;s<a;++s)t(e,o[s],r,n);return}var h=e.getBuilder(r.getZIndex(),Gh.DEFAULT);h.drawCustom(i,n,r.getRenderer())}(t,o,i,e);else{var s=Jh[o.getType()];s(t,o,i,e)}}(t,e,i,r);return s}var il=function(e){function t(t){e.call(this,t);this.declutterTree_=t.getDeclutter()?oh(9,void 0):null;this.dirty_=!1;this.renderedRevision_=-1;this.renderedResolution_=NaN;this.renderedExtent_=[1/0,1/0,-1/0,-1/0];this.renderedRenderOrder_=null;this.replayGroup_=null;this.replayGroupChanged=!0;m(Oa,C.CLEAR,this.handleFontsChanged_,this)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.disposeInternal=function(){f(Oa,C.CLEAR,this.handleFontsChanged_,this);e.prototype.disposeInternal.call(this)};t.prototype.renderFrame=function(t,e){var i=this.context,r=i.canvas,n=this.replayGroup_;if(!n||n.isEmpty()){0<r.width&&(r.width=0);return r}var o=t.pixelRatio;$e(this.pixelTransform_,1/o,1/o);ii(this.inversePixelTransform_,this.pixelTransform_);var s=Math.round(t.size[0]*o),a=Math.round(t.size[1]*o);if(r.width!=s||r.height!=a){r.width=s;r.height=a;var h=ni(this.pixelTransform_);r.style.transform!==h&&(r.style.transform=h)}else i.clearRect(0,0,s,a);this.preRender(i,t);var l=t.extent,u=t.viewState,c=u.projection,p=u.rotation,d=c.getExtent(),f=this.getLayer().getSource(),_=e.extent,g=void 0!==_;g&&this.clip(i,t,_);this.declutterTree_&&this.declutterTree_.clear();var y=t.viewHints,m=!(y[so.ANIMATING]||y[so.INTERACTING]),v=this.getRenderTransform(t,s,a,0),E=e.managed?t.skippedFeatureUids:{};n.execute(i,v,p,E,m);if(f.getWrapX()&&c.canWrapX()&&!et(d,l)){for(var T,S=l[0],x=Lt(d),R=0;S<d[0];){T=x*--R;var C=this.getRenderTransform(t,s,a,T);n.execute(i,C,p,E,m);S+=x}R=0;S=l[2];for(;S>d[2];){T=x*++R;var w=this.getRenderTransform(t,s,a,T);n.execute(i,w,p,E,m);S-=x}}g&&i.restore();this.postRender(i,t);var I=e.opacity;I!==r.style.opacity&&(r.style.opacity=I);return r};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){if(this.replayGroup_){var o=e.viewState.resolution,s=e.viewState.rotation,a=this.getLayer(),h={};return this.replayGroup_.forEachFeatureAtCoordinate(t,o,s,i,{},function(t){var e=bt(t);if(!(e in h)){h[e]=!0;return r.call(n,t,a)}},null)}};t.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&this.replayGroup_&&e.changed()};t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()};t.prototype.prepareFrame=function(t,e){var n=this.getLayer(),i=n.getSource(),r=t.viewHints[so.ANIMATING],o=t.viewHints[so.INTERACTING],s=n.getUpdateWhileAnimating(),a=n.getUpdateWhileInteracting();if(!this.dirty_&&!s&&r||!a&&o)return!0;var h=t.extent,l=t.viewState,u=l.projection,c=l.resolution,p=t.pixelRatio,d=n.getRevision(),f=n.getRenderBuffer(),_=n.getRenderOrder();void 0===_&&(_=Qh);var g=J(h,f*c),y=l.projection.getExtent();if(i.getWrapX()&&l.projection.canWrapX()&&!et(y,t.extent)){var m=Lt(y),v=Math.max(Lt(g)/2,m);g[0]=y[0]-v;g[2]=y[2]+v}if(!this.dirty_&&this.renderedResolution_==c&&this.renderedRevision_==d&&this.renderedRenderOrder_==_&&et(this.renderedExtent_,g))return!(this.replayGroupChanged=!1);this.replayGroup_=null;this.dirty_=!1;var E=new Ah(tl(c,p),g,c,p,!!this.declutterTree_);i.loadFeatures(g,c,u);var T=function(t){var e,i=t.getStyleFunction()||n.getStyleFunction();i&&(e=i(t,c));if(e){var r=this.renderFeature(t,c,p,e,E);this.dirty_=this.dirty_||r}}.bind(this);if(_){var S=[];i.forEachFeatureInExtent(g,function(t){S.push(t)});S.sort(_);for(var x=0,R=S.length;x<R;++x)T(S[x])}else i.forEachFeatureInExtent(g,T);var C=E.finish(),w=new Xh(g,c,p,i.getOverlaps(),this.declutterTree_,C,n.getRenderBuffer());this.renderedResolution_=c;this.renderedRevision_=d;this.renderedRenderOrder_=_;this.renderedExtent_=g;this.replayGroup_=w;return this.replayGroupChanged=!0};t.prototype.renderFeature=function(t,e,i,r,n){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var s=0,a=r.length;s<a;++s)o=el(n,t,r[s],$h(e,i),this.handleStyleImageChange_,this)||o;else o=el(n,t,r,$h(e,i),this.handleStyleImageChange_,this);return o};return t}(Zh),rl=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){return new il(this)};return t}(ih),nl={ARRAY_BUFFER:"arraybuffer",JSON:"json",TEXT:"text",XML:"xml"};function ol(i,o,s,a){return function(t,e,r){var n=new XMLHttpRequest;n.open("GET","function"==typeof i?i(t,e,r):i,!0);o.getType()==nl.ARRAY_BUFFER&&(n.responseType="arraybuffer");n.onload=function(t){if(!n.status||200<=n.status&&n.status<300){var e,i=o.getType();i==nl.JSON||i==nl.TEXT?e=n.responseText:i==nl.XML?(e=n.responseXML)||(e=(new DOMParser).parseFromString(n.responseText,"application/xml")):i==nl.ARRAY_BUFFER&&(e=n.response);e?s.call(this,o.readFeatures(e,{featureProjection:r}),o.readProjection(e),o.getLastExtent()):a.call(this)}else a.call(this)}.bind(this);n.onerror=function(){a.call(this)}.bind(this);n.send()}}function sl(t,e){return ol(t,e,function(t,e){"function"==typeof this.addFeatures&&this.addFeatures(t)},L)}function al(t,e){return[[-1/0,-1/0,1/0,1/0]]}function hl(t,e){return[t]}var ll=function(e){function t(t){e.call(this);this.projection_=be(t.projection);this.attributions_=ul(t.attributions);this.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible;this.loading=!1;this.state_=void 0!==t.state?t.state:bo.READY;this.wrapX_=void 0!==t.wrapX&&t.wrapX}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getAttributions=function(){return this.attributions_};t.prototype.getAttributionsCollapsible=function(){return this.attributionsCollapsible_};t.prototype.getProjection=function(){return this.projection_};t.prototype.getResolutions=function(){return o()};t.prototype.getState=function(){return this.state_};t.prototype.getWrapX=function(){return this.wrapX_};t.prototype.refresh=function(){this.changed()};t.prototype.setAttributions=function(t){this.attributions_=ul(t);this.changed()};t.prototype.setState=function(t){this.state_=t;this.changed()};return t}(O);function ul(e){return e?Array.isArray(e)?function(t){return e}:"function"==typeof e?e:function(t){return[e]}:null}var cl={ADDFEATURE:"addfeature",CHANGEFEATURE:"changefeature",CLEAR:"clear",REMOVEFEATURE:"removefeature"},pl=function(t){this.rbush_=oh(t,void 0);this.items_={}};pl.prototype.insert=function(t,e){var i={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3],value:e};this.rbush_.insert(i);this.items_[bt(e)]=i};pl.prototype.load=function(t,e){for(var i=new Array(e.length),r=0,n=e.length;r<n;r++){var o=t[r],s=e[r],a={minX:o[0],minY:o[1],maxX:o[2],maxY:o[3],value:s};i[r]=a;this.items_[bt(s)]=a}this.rbush_.load(i)};pl.prototype.remove=function(t){var e=bt(t),i=this.items_[e];delete this.items_[e];return null!==this.rbush_.remove(i)};pl.prototype.update=function(t,e){var i=this.items_[bt(e)];if(!ut([i.minX,i.minY,i.maxX,i.maxY],t)){this.remove(e);this.insert(t,e)}};pl.prototype.getAll=function(){return this.rbush_.all().map(function(t){return t.value})};pl.prototype.getInExtent=function(t){var e={minX:t[0],minY:t[1],maxX:t[2],maxY:t[3]};return this.rbush_.search(e).map(function(t){return t.value})};pl.prototype.forEach=function(t,e){return this.forEach_(this.getAll(),t,e)};pl.prototype.forEachInExtent=function(t,e,i){return this.forEach_(this.getInExtent(t),e,i)};pl.prototype.forEach_=function(t,e,i){for(var r,n=0,o=t.length;n<o;n++)if(r=e.call(i,t[n]))return r;return r};pl.prototype.isEmpty=function(){return Mt(this.items_)};pl.prototype.clear=function(){this.rbush_.clear();this.items_={}};pl.prototype.getExtent=function(t){var e=this.rbush_.toJSON();return ot(e.minX,e.minY,e.maxX,e.maxY,t)};pl.prototype.concat=function(t){this.rbush_.load(t.rbush_.all());for(var e in t.items_)this.items_[e]=t.items_[e]};var dl=function(i){function t(t,e){i.call(this,t);this.feature=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(S),fl=function(o){function t(t){var e=t||{};o.call(this,{attributions:e.attributions,projection:void 0,state:bo.READY,wrapX:void 0===e.wrapX||e.wrapX});this.loader_=L;this.format_=e.format;this.overlaps_=null==e.overlaps||e.overlaps;this.url_=e.url;if(void 0!==e.loader)this.loader_=e.loader;else if(void 0!==this.url_){A(this.format_,7);this.loader_=sl(this.url_,this.format_)}this.strategy_=void 0!==e.strategy?e.strategy:al;var i,r,n=void 0===e.useSpatialIndex||e.useSpatialIndex;this.featuresRtree_=n?new pl:null;this.loadedExtentsRtree_=new pl;this.nullGeometryFeatures_={};this.idIndex_={};this.undefIdIndex_={};this.featureChangeKeys_={};this.featuresCollection_=null;Array.isArray(e.features)?r=e.features:e.features&&(r=(i=e.features).getArray());n||void 0!==i||(i=new N(r));void 0!==r&&this.addFeaturesInternal(r);void 0!==i&&this.bindFeaturesCollection_(i)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.addFeature=function(t){this.addFeatureInternal(t);this.changed()};t.prototype.addFeatureInternal=function(t){var e=bt(t);if(this.addToIndex_(e,t)){this.setupChangeEvents_(e,t);var i=t.getGeometry();if(i){var r=i.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(r,t)}else this.nullGeometryFeatures_[e]=t;this.dispatchEvent(new dl(cl.ADDFEATURE,t))}};t.prototype.setupChangeEvents_=function(t,e){this.featureChangeKeys_[t]=[m(e,C.CHANGE,this.handleFeatureChange_,this),m(e,s.PROPERTYCHANGE,this.handleFeatureChange_,this)]};t.prototype.addToIndex_=function(t,e){var i=!0,r=e.getId();if(void 0!==r)r.toString()in this.idIndex_?i=!1:this.idIndex_[r.toString()]=e;else{A(!(t in this.undefIdIndex_),30);this.undefIdIndex_[t]=e}return i};t.prototype.addFeatures=function(t){this.addFeaturesInternal(t);this.changed()};t.prototype.addFeaturesInternal=function(t){for(var e=[],i=[],r=[],n=0,o=t.length;n<o;n++){var s=t[n],a=bt(s);this.addToIndex_(a,s)&&i.push(s)}for(var h=0,l=i.length;h<l;h++){var u=i[h],c=bt(u);this.setupChangeEvents_(c,u);var p=u.getGeometry();if(p){var d=p.getExtent();e.push(d);r.push(u)}else this.nullGeometryFeatures_[c]=u}this.featuresRtree_&&this.featuresRtree_.load(e,r);for(var f=0,_=i.length;f<_;f++)this.dispatchEvent(new dl(cl.ADDFEATURE,i[f]))};t.prototype.bindFeaturesCollection_=function(e){var i=!1;m(this,cl.ADDFEATURE,function(t){if(!i){i=!0;e.push(t.feature);i=!1}});m(this,cl.REMOVEFEATURE,function(t){if(!i){i=!0;e.remove(t.feature);i=!1}});m(e,a.ADD,function(t){if(!i){i=!0;this.addFeature(t.element);i=!1}},this);m(e,a.REMOVE,function(t){if(!i){i=!0;this.removeFeature(t.element);i=!1}},this);this.featuresCollection_=e};t.prototype.clear=function(t){if(t){for(var e in this.featureChangeKeys_){this.featureChangeKeys_[e].forEach(g)}if(!this.featuresCollection_){this.featureChangeKeys_={};this.idIndex_={};this.undefIdIndex_={}}}else if(this.featuresRtree_){this.featuresRtree_.forEach(this.removeFeatureInternal,this);for(var i in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[i])}this.featuresCollection_&&this.featuresCollection_.clear();this.featuresRtree_&&this.featuresRtree_.clear();this.loadedExtentsRtree_.clear();this.nullGeometryFeatures_={};var r=new dl(cl.CLEAR);this.dispatchEvent(r);this.changed()};t.prototype.forEachFeature=function(t){if(this.featuresRtree_)return this.featuresRtree_.forEach(t);this.featuresCollection_&&this.featuresCollection_.forEach(t)};t.prototype.forEachFeatureAtCoordinateDirect=function(e,i){var t=[e[0],e[1],e[0],e[1]];return this.forEachFeatureInExtent(t,function(t){return t.getGeometry().intersectsCoordinate(e)?i(t):void 0})};t.prototype.forEachFeatureInExtent=function(t,e){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(t,e);this.featuresCollection_&&this.featuresCollection_.forEach(e)};t.prototype.forEachFeatureIntersectingExtent=function(i,r){return this.forEachFeatureInExtent(i,function(t){if(t.getGeometry().intersectsExtent(i)){var e=r(t);if(e)return e}})};t.prototype.getFeaturesCollection=function(){return this.featuresCollection_};t.prototype.getFeatures=function(){var t;if(this.featuresCollection_)t=this.featuresCollection_.getArray();else if(this.featuresRtree_){t=this.featuresRtree_.getAll();Mt(this.nullGeometryFeatures_)||B(t,h(this.nullGeometryFeatures_))}return t};t.prototype.getFeaturesAtCoordinate=function(t){var e=[];this.forEachFeatureAtCoordinateDirect(t,function(t){e.push(t)});return e};t.prototype.getFeaturesInExtent=function(t){return this.featuresRtree_.getInExtent(t)};t.prototype.getClosestFeatureToCoordinate=function(t,e){var n=t[0],o=t[1],s=null,a=[NaN,NaN],h=1/0,l=[-1/0,-1/0,1/0,1/0],u=e||E;this.featuresRtree_.forEachInExtent(l,function(t){if(u(t)){var e=t.getGeometry(),i=h;if((h=e.closestPointXY(n,o,a,h))<i){s=t;var r=Math.sqrt(h);l[0]=n-r;l[1]=o-r;l[2]=n+r;l[3]=o+r}}});return s};t.prototype.getExtent=function(t){return this.featuresRtree_.getExtent(t)};t.prototype.getFeatureById=function(t){var e=this.idIndex_[t.toString()];return void 0!==e?e:null};t.prototype.getFormat=function(){return this.format_};t.prototype.getOverlaps=function(){return this.overlaps_};t.prototype.getUrl=function(){return this.url_};t.prototype.handleFeatureChange_=function(t){var e=t.target,i=bt(e),r=e.getGeometry();if(r){var n=r.getExtent();if(i in this.nullGeometryFeatures_){delete this.nullGeometryFeatures_[i];this.featuresRtree_&&this.featuresRtree_.insert(n,e)}else this.featuresRtree_&&this.featuresRtree_.update(n,e)}else if(!(i in this.nullGeometryFeatures_)){this.featuresRtree_&&this.featuresRtree_.remove(e);this.nullGeometryFeatures_[i]=e}var o=e.getId();if(void 0!==o){var s=o.toString();if(i in this.undefIdIndex_){delete this.undefIdIndex_[i];this.idIndex_[s]=e}else if(this.idIndex_[s]!==e){this.removeFromIdIndex_(e);this.idIndex_[s]=e}}else if(!(i in this.undefIdIndex_)){this.removeFromIdIndex_(e);this.undefIdIndex_[i]=e}this.changed();this.dispatchEvent(new dl(cl.CHANGEFEATURE,e))};t.prototype.hasFeature=function(t){var e=t.getId();return void 0!==e?e in this.idIndex_:bt(t)in this.undefIdIndex_};t.prototype.isEmpty=function(){return this.featuresRtree_.isEmpty()&&Mt(this.nullGeometryFeatures_)};t.prototype.loadFeatures=function(t,r,n){var o=this,s=this.loadedExtentsRtree_,a=this.strategy_(t,r);this.loading=!1;for(var e=function(t,e){var i=a[t];if(!s.forEachInExtent(i,function(t){return et(t.extent,i)})){o.loader_.call(o,i,r,n);s.insert(i,{extent:i.slice()});o.loading=o.loader_!==L}},i=0,h=a.length;i<h;++i)e(i)};t.prototype.removeLoadedExtent=function(e){var i,t=this.loadedExtentsRtree_;t.forEachInExtent(e,function(t){if(ut(t.extent,e)){i=t;return!0}});i&&t.remove(i)};t.prototype.removeFeature=function(t){var e=bt(t);e in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[e]:this.featuresRtree_&&this.featuresRtree_.remove(t);this.removeFeatureInternal(t);this.changed()};t.prototype.removeFeatureInternal=function(t){var e=bt(t);this.featureChangeKeys_[e].forEach(g);delete this.featureChangeKeys_[e];var i=t.getId();void 0!==i?delete this.idIndex_[i.toString()]:delete this.undefIdIndex_[e];this.dispatchEvent(new dl(cl.REMOVEFEATURE,t))};t.prototype.removeFromIdIndex_=function(t){var e=!1;for(var i in this.idIndex_)if(this.idIndex_[i]===t){delete this.idIndex_[i];e=!0;break}return e};t.prototype.setLoader=function(t){this.loader_=t};return t}(ll),_l={POINT:"Point",LINE_STRING:"LineString",POLYGON:"Polygon",CIRCLE:"Circle"},gl="drawstart",yl="drawend",ml=function(i){function t(t,e){i.call(this,t);this.feature=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(S),vl=function(s){function t(t){var e=t;e.stopDown||(e.stopDown=T);s.call(this,e);this.shouldHandle_=!1;this.downPx_=null;this.downTimeout_;this.lastDragTime_;this.freehand_=!1;this.source_=t.source?t.source:null;this.features_=t.features?t.features:null;this.snapTolerance_=t.snapTolerance?t.snapTolerance:12;this.type_=t.type;this.mode_=function(t){var e;t===jt.POINT||t===jt.MULTI_POINT?e=_l.POINT:t===jt.LINE_STRING||t===jt.MULTI_LINE_STRING?e=_l.LINE_STRING:t===jt.POLYGON||t===jt.MULTI_POLYGON?e=_l.POLYGON:t===jt.CIRCLE&&(e=_l.CIRCLE);return e}(this.type_);this.stopClick_=!!t.stopClick;this.minPoints_=t.minPoints?t.minPoints:this.mode_===_l.POLYGON?3:2;this.maxPoints_=t.maxPoints?t.maxPoints:1/0;this.finishCondition_=t.finishCondition?t.finishCondition:E;var i,r=t.geometryFunction;if(!r)if(this.type_===jt.CIRCLE)r=function(t,e){var i=e||new $s([NaN,NaN]),r=vo(t[0],t[1]);i.setCenterAndRadius(t[0],Math.sqrt(r));return i};else{var n,o=this.mode_;o===_l.POINT?n=Ai:o===_l.LINE_STRING?n=na:o===_l.POLYGON&&(n=tr);r=function(t,e){var i=e;i?o===_l.POLYGON?t[0].length?i.setCoordinates([t[0].concat([t[0][0]])]):i.setCoordinates([]):i.setCoordinates(t):i=new n(t);return i}}this.geometryFunction_=r;this.dragVertexDelay_=void 0!==t.dragVertexDelay?t.dragVertexDelay:500;this.finishCoordinate_=null;this.sketchFeature_=null;this.sketchPoint_=null;this.sketchCoords_=null;this.sketchLine_=null;this.sketchLineCoords_=null;this.squaredClickTolerance_=t.clickTolerance?t.clickTolerance*t.clickTolerance:36;this.overlay_=new rl({source:new fl({useSpatialIndex:!1,wrapX:!!t.wrapX&&t.wrapX}),style:t.style?t.style:(i=$a(),function(t,e){return i[t.getGeometry().getType()]}),updateWhileInteracting:!0});this.geometryName_=t.geometryName;this.condition_=t.condition?t.condition:Ts;this.freehandCondition_;t.freehand?this.freehandCondition_=gs:this.freehandCondition_=t.freehandCondition?t.freehandCondition:Ss;m(this,b(rs.ACTIVE),this.updateState_,this)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.setMap=function(t){s.prototype.setMap.call(this,t);this.updateState_()};t.prototype.getOverlay=function(){return this.overlay_};t.prototype.handleEvent=function(t){t.originalEvent.type===C.CONTEXTMENU&&t.preventDefault();this.freehand_=this.mode_!==_l.POINT&&this.freehandCondition_(t);var e=t.type===rn.POINTERMOVE,i=!0;if(!this.freehand_&&this.lastDragTime_&&t.type===rn.POINTERDRAG){if(Date.now()-this.lastDragTime_>=this.dragVertexDelay_){this.downPx_=t.pixel;this.shouldHandle_=!this.freehand_;e=!0}else this.lastDragTime_=void 0;if(this.shouldHandle_&&void 0!==this.downTimeout_){clearTimeout(this.downTimeout_);this.downTimeout_=void 0}}if(this.freehand_&&t.type===rn.POINTERDRAG&&null!==this.sketchFeature_){this.addToDrawing_(t);i=!1}else this.freehand_&&t.type===rn.POINTERDOWN?i=!1:e?(i=t.type===rn.POINTERMOVE)&&this.freehand_?i=this.handlePointerMove_(t):(t.pointerEvent.pointerType==hn||t.type===rn.POINTERDRAG&&void 0===this.downTimeout_)&&this.handlePointerMove_(t):t.type===rn.DBLCLICK&&(i=!1);return s.prototype.handleEvent.call(this,t)&&i};t.prototype.handleDownEvent=function(t){this.shouldHandle_=!this.freehand_;if(this.freehand_){this.downPx_=t.pixel;this.finishCoordinate_||this.startDrawing_(t);return!0}if(this.condition_(t)){this.lastDragTime_=Date.now();this.downTimeout_=setTimeout(function(){this.handlePointerMove_(new nn(rn.POINTERMOVE,t.map,t.pointerEvent,!1,t.frameState))}.bind(this),this.dragVertexDelay_);this.downPx_=t.pixel;return!0}return!1};t.prototype.handleUpEvent=function(t){var e=!0;if(this.downTimeout_){clearTimeout(this.downTimeout_);this.downTimeout_=void 0}this.handlePointerMove_(t);var i=this.mode_===_l.CIRCLE;if(this.shouldHandle_){if(this.finishCoordinate_)this.freehand_||i?this.finishDrawing():this.atFinish_(t)?this.finishCondition_(t)&&this.finishDrawing():this.addToDrawing_(t);else{this.startDrawing_(t);this.mode_===_l.POINT&&this.finishDrawing()}e=!1}else if(this.freehand_){this.finishCoordinate_=null;this.abortDrawing_()}!e&&this.stopClick_&&t.stopPropagation();return e};t.prototype.handlePointerMove_=function(t){if(this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){var e=this.downPx_,i=t.pixel,r=e[0]-i[0],n=e[1]-i[1],o=r*r+n*n;this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_;if(!this.shouldHandle_)return!0}this.finishCoordinate_?this.modifyDrawing_(t):this.createOrUpdateSketchPoint_(t);return!0};t.prototype.atFinish_=function(t){var e=!1;if(this.sketchFeature_){var i=!1,r=[this.finishCoordinate_];if(this.mode_===_l.LINE_STRING)i=this.sketchCoords_.length>this.minPoints_;else if(this.mode_===_l.POLYGON){var n=this.sketchCoords_;i=n[0].length>this.minPoints_;r=[n[0][0],n[0][n[0].length-2]]}if(i)for(var o=t.map,s=0,a=r.length;s<a;s++){var h=r[s],l=o.getPixelFromCoordinate(h),u=t.pixel,c=u[0]-l[0],p=u[1]-l[1],d=this.freehand_?1:this.snapTolerance_;if(e=Math.sqrt(c*c+p*p)<=d){this.finishCoordinate_=h;break}}}return e};t.prototype.createOrUpdateSketchPoint_=function(t){var e=t.coordinate.slice();if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(e)}else{this.sketchPoint_=new G(new Ai(e));this.updateSketchFeatures_()}};t.prototype.startDrawing_=function(t){var e=t.coordinate;this.finishCoordinate_=e;if(this.mode_===_l.POINT)this.sketchCoords_=e.slice();else if(this.mode_===_l.POLYGON){this.sketchCoords_=[[e.slice(),e.slice()]];this.sketchLineCoords_=this.sketchCoords_[0]}else this.sketchCoords_=[e.slice(),e.slice()];this.sketchLineCoords_&&(this.sketchLine_=new G(new na(this.sketchLineCoords_)));var i=this.geometryFunction_(this.sketchCoords_);this.sketchFeature_=new G;this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_);this.sketchFeature_.setGeometry(i);this.updateSketchFeatures_();this.dispatchEvent(new ml(gl,this.sketchFeature_))};t.prototype.modifyDrawing_=function(t){var e,i,r,n=t.coordinate,o=this.sketchFeature_.getGeometry();if(this.mode_===_l.POINT)i=this.sketchCoords_;else if(this.mode_===_l.POLYGON){i=(e=this.sketchCoords_[0])[e.length-1];this.atFinish_(t)&&(n=this.finishCoordinate_.slice())}else i=(e=this.sketchCoords_)[e.length-1];i[0]=n[0];i[1]=n[1];this.geometryFunction_(this.sketchCoords_,o);if(this.sketchPoint_){this.sketchPoint_.getGeometry().setCoordinates(n)}if(o.getType()==jt.POLYGON&&this.mode_!==_l.POLYGON){this.sketchLine_||(this.sketchLine_=new G);var s=o.getLinearRing(0);if(r=this.sketchLine_.getGeometry()){r.setFlatCoordinates(s.getLayout(),s.getFlatCoordinates());r.changed()}else{r=new na(s.getFlatCoordinates(),s.getLayout());this.sketchLine_.setGeometry(r)}}else this.sketchLineCoords_&&(r=this.sketchLine_.getGeometry()).setCoordinates(this.sketchLineCoords_);this.updateSketchFeatures_()};t.prototype.addToDrawing_=function(t){var e,i,r=t.coordinate,n=this.sketchFeature_.getGeometry();if(this.mode_===_l.LINE_STRING){this.finishCoordinate_=r.slice();(i=this.sketchCoords_).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0);i.push(r.slice());this.geometryFunction_(i,n)}else if(this.mode_===_l.POLYGON){(i=this.sketchCoords_[0]).length>=this.maxPoints_&&(this.freehand_?i.pop():e=!0);i.push(r.slice());e&&(this.finishCoordinate_=i[0]);this.geometryFunction_(this.sketchCoords_,n)}this.updateSketchFeatures_();e&&this.finishDrawing()};t.prototype.removeLastPoint=function(){if(this.sketchFeature_){var t,e=this.sketchFeature_.getGeometry();if(this.mode_===_l.LINE_STRING){(t=this.sketchCoords_).splice(-2,1);this.geometryFunction_(t,e);2<=t.length&&(this.finishCoordinate_=t[t.length-2].slice())}else if(this.mode_===_l.POLYGON){(t=this.sketchCoords_[0]).splice(-2,1);this.sketchLine_.getGeometry().setCoordinates(t);this.geometryFunction_(this.sketchCoords_,e)}0===t.length&&(this.finishCoordinate_=null);this.updateSketchFeatures_()}};t.prototype.finishDrawing=function(){var t=this.abortDrawing_();if(t){var e=this.sketchCoords_,i=t.getGeometry();if(this.mode_===_l.LINE_STRING){e.pop();this.geometryFunction_(e,i)}else if(this.mode_===_l.POLYGON){e[0].pop();this.geometryFunction_(e,i);e=i.getCoordinates()}this.type_===jt.MULTI_POINT?t.setGeometry(new sa([e])):this.type_===jt.MULTI_LINE_STRING?t.setGeometry(new oa([e])):this.type_===jt.MULTI_POLYGON&&t.setGeometry(new ha([e]));this.dispatchEvent(new ml(yl,t));this.features_&&this.features_.push(t);this.source_&&this.source_.addFeature(t)}};t.prototype.abortDrawing_=function(){this.finishCoordinate_=null;var t=this.sketchFeature_;if(t){this.sketchFeature_=null;this.sketchPoint_=null;this.sketchLine_=null;this.overlay_.getSource().clear(!0)}return t};t.prototype.extend=function(t){var e=t.getGeometry();this.sketchFeature_=t;this.sketchCoords_=e.getCoordinates();var i=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=i.slice();this.sketchCoords_.push(i.slice());this.updateSketchFeatures_();this.dispatchEvent(new ml(gl,this.sketchFeature_))};t.prototype.updateSketchFeatures_=function(){var t=[];this.sketchFeature_&&t.push(this.sketchFeature_);this.sketchLine_&&t.push(this.sketchLine_);this.sketchPoint_&&t.push(this.sketchPoint_);var e=this.overlay_.getSource();e.clear(!0);e.addFeatures(t)};t.prototype.updateState_=function(){var t=this.getMap(),e=this.getActive();t&&e||this.abortDrawing_();this.overlay_.setMap(e?t:null)};return t}(ws);var El="extentchanged",Tl=function(e){function t(t){e.call(this,El);this.extent=t}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(S),Sl=function(n){function t(t){var i,r,e=t||{};n.call(this,e);this.extent_=null;this.pointerHandler_=null;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.snappedToVertex_=!1;this.extentFeature_=null;this.vertexFeature_=null;t||(t={});this.extentOverlay_=new rl({source:new fl({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.boxStyle?t.boxStyle:(i=$a(),function(t,e){return i[jt.POLYGON]}),updateWhileAnimating:!0,updateWhileInteracting:!0});this.vertexOverlay_=new rl({source:new fl({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.pointerStyle?t.pointerStyle:(r=$a(),function(t,e){return r[jt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0});t.extent&&this.setExtent(t.extent)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.snapToVertex_=function(t,e){var i,r=e.getCoordinateFromPixel(t),n=this.getExtent();if(n){var o=[[[(i=n)[0],i[1]],[i[0],i[3]]],[[i[0],i[3]],[i[2],i[3]]],[[i[2],i[3]],[i[2],i[1]]],[[i[2],i[1]],[i[0],i[1]]]];o.sort(function(t,e){return To(r,t)-To(r,e)});var s=o[0],a=po(r,s),h=e.getPixelFromCoordinate(a);if(Eo(t,h)<=this.pixelTolerance_){var l=e.getPixelFromCoordinate(s[0]),u=e.getPixelFromCoordinate(s[1]),c=vo(h,l),p=vo(h,u),d=Math.sqrt(Math.min(c,p));this.snappedToVertex_=d<=this.pixelTolerance_;this.snappedToVertex_&&(a=p<c?s[1]:s[0]);return a}}return null};t.prototype.handlePointerMove_=function(t){var e=t.pixel,i=t.map,r=this.snapToVertex_(e,i);r||(r=i.getCoordinateFromPixel(e));this.createOrUpdatePointerFeature_(r)};t.prototype.createOrUpdateExtentFeature_=function(t){var e=this.extentFeature_;if(e)t?e.setGeometry(ir(t)):e.setGeometry(void 0);else{e=new G(t?ir(t):{});this.extentFeature_=e;this.extentOverlay_.getSource().addFeature(e)}return e};t.prototype.createOrUpdatePointerFeature_=function(t){var e=this.vertexFeature_;if(e){e.getGeometry().setCoordinates(t)}else{e=new G(new Ai(t));this.vertexFeature_=e;this.vertexOverlay_.getSource().addFeature(e)}return e};t.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;t.type!=rn.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t);n.prototype.handleEvent.call(this,t);return!1};t.prototype.handleDownEvent=function(t){var e=t.pixel,i=t.map,r=this.getExtent(),n=this.snapToVertex_(e,i),o=function(t){var e=null,i=null;t[0]==r[0]?e=r[2]:t[0]==r[2]&&(e=r[0]);t[1]==r[1]?i=r[3]:t[1]==r[3]&&(i=r[1]);return null!==e&&null!==i?[e,i]:null};if(n&&r){var s=n[0]==r[0]||n[0]==r[2]?n[0]:null,a=n[1]==r[1]||n[1]==r[3]?n[1]:null;null!==s&&null!==a?this.pointerHandler_=xl(o(n)):null!==s?this.pointerHandler_=Rl(o([s,r[1]]),o([s,r[3]])):null!==a&&(this.pointerHandler_=Rl(o([r[0],a]),o([r[2],a])))}else{n=i.getCoordinateFromPixel(e);this.setExtent([n[0],n[1],n[0],n[1]]);this.pointerHandler_=xl(n)}return!0};t.prototype.handleDragEvent=function(t){if(this.pointerHandler_){var e=t.coordinate;this.setExtent(this.pointerHandler_(e));this.createOrUpdatePointerFeature_(e)}return!0};t.prototype.handleUpEvent=function(t){this.pointerHandler_=null;var e=this.getExtent();e&&0!==mt(e)||this.setExtent(null);return!1};t.prototype.setMap=function(t){this.extentOverlay_.setMap(t);this.vertexOverlay_.setMap(t);n.prototype.setMap.call(this,t)};t.prototype.getExtent=function(){return this.extent_};t.prototype.setExtent=function(t){this.extent_=t||null;this.createOrUpdateExtentFeature_(t);this.dispatchEvent(new Tl(this.extent_))};return t}(ws);function xl(e){return function(t){return q([e,t])}}function Rl(e,i){return e[0]==i[0]?function(t){return q([e,[t[0],i[1]]])}:e[1]==i[1]?function(t){return q([e,[i[0],t[1]]])}:null}var Cl=1,wl="modifystart",Il="modifyend",Ll=function(r){function t(t,e,i){r.call(this,t);this.features=e;this.mapBrowserEvent=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),Ol=function(r){function t(t){r.call(this,t);this.condition_=t.condition?t.condition:Cs;this.defaultDeleteCondition_=function(t){return ds(t)&&Es(t)};this.deleteCondition_=t.deleteCondition?t.deleteCondition:this.defaultDeleteCondition_;this.insertVertexCondition_=t.insertVertexCondition?t.insertVertexCondition:gs;this.vertexFeature_=null;this.vertexSegments_=null;this.lastPixel_=[0,0];this.ignoreNextSingleClick_=!1;this.modified_=!1;this.rBush_=new pl;this.pixelTolerance_=void 0!==t.pixelTolerance?t.pixelTolerance:10;this.snappedToVertex_=!1;this.changingFeature_=!1;this.dragSegments_=[];this.overlay_=new rl({source:new fl({useSpatialIndex:!1,wrapX:!!t.wrapX}),style:t.style?t.style:(i=$a(),function(t,e){return i[jt.POINT]}),updateWhileAnimating:!0,updateWhileInteracting:!0});var i,e;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,Circle:this.writeCircleGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_};this.source_=null;if(t.source){this.source_=t.source;e=new N(this.source_.getFeatures());m(this.source_,cl.ADDFEATURE,this.handleSourceAdd_,this);m(this.source_,cl.REMOVEFEATURE,this.handleSourceRemove_,this)}else e=t.features;if(!e)throw new Error("The modify interaction requires features or a source");this.features_=e;this.features_.forEach(this.addFeature_.bind(this));m(this.features_,a.ADD,this.handleFeatureAdd_,this);m(this.features_,a.REMOVE,this.handleFeatureRemove_,this);this.lastPointerEvent_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.addFeature_=function(t){var e=t.getGeometry();e&&e.getType()in this.SEGMENT_WRITERS_&&this.SEGMENT_WRITERS_[e.getType()].call(this,t,e);var i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastPixel_,i);m(t,C.CHANGE,this.handleFeatureChange_,this)};t.prototype.willModifyFeatures_=function(t){if(!this.modified_){this.modified_=!0;this.dispatchEvent(new Ll(wl,this.features_,t))}};t.prototype.removeFeature_=function(t){this.removeFeatureSegmentData_(t);if(this.vertexFeature_&&0===this.features_.getLength()){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}f(t,C.CHANGE,this.handleFeatureChange_,this)};t.prototype.removeFeatureSegmentData_=function(e){var t=this.rBush_,i=[];t.forEach(function(t){e===t.feature&&i.push(t)});for(var r=i.length-1;0<=r;--r){for(var n=i[r],o=this.dragSegments_.length-1;0<=o;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);t.remove(n)}};t.prototype.setActive=function(t){if(this.vertexFeature_&&!t){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}r.prototype.setActive.call(this,t)};t.prototype.setMap=function(t){this.overlay_.setMap(t);r.prototype.setMap.call(this,t)};t.prototype.getOverlay=function(){return this.overlay_};t.prototype.handleSourceAdd_=function(t){t.feature&&this.features_.push(t.feature)};t.prototype.handleSourceRemove_=function(t){t.feature&&this.features_.remove(t.feature)};t.prototype.handleFeatureAdd_=function(t){this.addFeature_(t.element)};t.prototype.handleFeatureChange_=function(t){if(!this.changingFeature_){var e=t.target;this.removeFeature_(e);this.addFeature_(e)}};t.prototype.handleFeatureRemove_=function(t){var e=t.element;this.removeFeature_(e)};t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,geometry:e,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)};t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],s={feature:t,geometry:e,depth:[r],index:r,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}};t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),s={feature:t,geometry:e,index:r,segment:o};this.rBush_.insert(q(o),s)}};t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,geometry:e,depth:[r],index:s,segment:h};this.rBush_.insert(q(h),l)}};t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,geometry:e,depth:[r],index:s,segment:h};this.rBush_.insert(q(h),l)}};t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length;s<a;++s)for(var h=o[s],l=0,u=h.length-1;l<u;++l){var c=h.slice(l,l+2),p={feature:t,geometry:e,depth:[s,r],index:l,segment:c};this.rBush_.insert(q(c),p)}};t.prototype.writeCircleGeometry_=function(t,e){var i=e.getCenter(),r={feature:t,geometry:e,index:0,segment:[i,i]},n={feature:t,geometry:e,index:Cl,segment:[i,i]},o=[r,n];r.featureSegments=n.featureSegments=o;this.rBush_.insert(at(i),r);this.rBush_.insert(e.getExtent(),n)};t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r)this.SEGMENT_WRITERS_[i[r].getType()].call(this,t,i[r])};t.prototype.createOrUpdateVertexFeature_=function(t){var e=this.vertexFeature_;if(e){e.getGeometry().setCoordinates(t)}else{e=new G(new Ai(t));this.vertexFeature_=e;this.overlay_.getSource().addFeature(e)}return e};t.prototype.handleEvent=function(t){if(!t.pointerEvent)return!0;var e;(this.lastPointerEvent_=t).map.getView().getInteracting()||t.type!=rn.POINTERMOVE||this.handlingDownUpSequence||this.handlePointerMove_(t);this.vertexFeature_&&this.deleteCondition_(t)&&(e=!(t.type!=rn.SINGLECLICK||!this.ignoreNextSingleClick_)||this.removePoint());t.type==rn.SINGLECLICK&&(this.ignoreNextSingleClick_=!1);return r.prototype.handleEvent.call(this,t)&&!e};t.prototype.handleDragEvent=function(t){this.ignoreNextSingleClick_=!1;this.willModifyFeatures_(t);for(var e=t.coordinate,i=0,r=this.dragSegments_.length;i<r;++i){for(var n=this.dragSegments_[i],o=n[0],s=o.depth,a=o.geometry,h=void 0,l=o.segment,u=n[1];e.length<a.getStride();)e.push(l[u][e.length]);switch(a.getType()){case jt.POINT:h=e;l[0]=l[1]=e;break;case jt.MULTI_POINT:(h=a.getCoordinates())[o.index]=e;l[0]=l[1]=e;break;case jt.LINE_STRING:(h=a.getCoordinates())[o.index+u]=e;l[u]=e;break;case jt.MULTI_LINE_STRING:case jt.POLYGON:(h=a.getCoordinates())[s[0]][o.index+u]=e;l[u]=e;break;case jt.MULTI_POLYGON:(h=a.getCoordinates())[s[1]][s[0]][o.index+u]=e;l[u]=e;break;case jt.CIRCLE:l[0]=l[1]=e;if(0===o.index){this.changingFeature_=!0;a.setCenter(e);this.changingFeature_=!1}else{this.changingFeature_=!0;a.setRadius(Eo(a.getCenter(),e));this.changingFeature_=!1}}h&&this.setGeometryCoordinates_(a,h)}this.createOrUpdateVertexFeature_(e)};t.prototype.handleDownEvent=function(t){if(!this.condition_(t))return!1;this.handlePointerAtPixel_(t.pixel,t.map);var e=t.map.getCoordinateFromPixel(t.pixel);this.dragSegments_.length=0;this.modified_=!1;var i=this.vertexFeature_;if(i){var r=[],n=i.getGeometry().getCoordinates(),o=q([n]),s=this.rBush_.getInExtent(o),a={};s.sort(Pl);for(var h=0,l=s.length;h<l;++h){var u=s[h],c=u.segment,p=bt(u.feature),d=u.depth;d&&(p+="-"+d.join("-"));a[p]||(a[p]=new Array(2));if(u.geometry.getType()===jt.CIRCLE&&u.index===Cl){if(go(Ml(e,u),n)&&!a[p][0]){this.dragSegments_.push([u,0]);a[p][0]=u}}else if(go(c[0],n)&&!a[p][0]){this.dragSegments_.push([u,0]);a[p][0]=u}else if(go(c[1],n)&&!a[p][1]){if((u.geometry.getType()===jt.LINE_STRING||u.geometry.getType()===jt.MULTI_LINE_STRING)&&a[p][0]&&0===a[p][0].index)continue;this.dragSegments_.push([u,1]);a[p][1]=u}else bt(c)in this.vertexSegments_&&!a[p][0]&&!a[p][1]&&this.insertVertexCondition_(t)&&r.push([u,n])}r.length&&this.willModifyFeatures_(t);for(var f=r.length-1;0<=f;--f)this.insertVertex_.apply(this,r[f])}return!!this.vertexFeature_};t.prototype.handleUpEvent=function(t){for(var e=this.dragSegments_.length-1;0<=e;--e){var i=this.dragSegments_[e][0],r=i.geometry;if(r.getType()===jt.CIRCLE){var n=r.getCenter(),o=i.featureSegments[0],s=i.featureSegments[1];o.segment[0]=o.segment[1]=n;s.segment[0]=s.segment[1]=n;this.rBush_.update(at(n),o);this.rBush_.update(r.getExtent(),s)}else this.rBush_.update(q(i.segment),i)}if(this.modified_){this.dispatchEvent(new Ll(Il,this.features_,t));this.modified_=!1}return!1};t.prototype.handlePointerMove_=function(t){this.lastPixel_=t.pixel;this.handlePointerAtPixel_(t.pixel,t.map)};t.prototype.handlePointerAtPixel_=function(t,e){var i=e.getCoordinateFromPixel(t),r=J(at(i),e.getView().getResolution()*this.pixelTolerance_),n=this.rBush_.getInExtent(r);if(0<n.length){n.sort(function(t,e){return bl(i,t)-bl(i,e)});var o=n[0],s=o.segment,a=Ml(i,o),h=e.getPixelFromCoordinate(a),l=Eo(t,h);if(l<=this.pixelTolerance_){var u={};if(o.geometry.getType()===jt.CIRCLE&&o.index===Cl){this.snappedToVertex_=!0;this.createOrUpdateVertexFeature_(a)}else{var c=e.getPixelFromCoordinate(s[0]),p=e.getPixelFromCoordinate(s[1]),d=vo(h,c),f=vo(h,p);l=Math.sqrt(Math.min(d,f));this.snappedToVertex_=l<=this.pixelTolerance_;this.snappedToVertex_&&(a=f<d?s[1]:s[0]);this.createOrUpdateVertexFeature_(a);for(var _=1,g=n.length;_<g;++_){var y=n[_].segment;if(!(go(s[0],y[0])&&go(s[1],y[1])||go(s[0],y[1])&&go(s[1],y[0])))break;u[bt(y)]=!0}}u[bt(s)]=!0;this.vertexSegments_=u;return}}if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}};t.prototype.insertVertex_=function(t,e){for(var i,r=t.segment,n=t.feature,o=t.geometry,s=t.depth,a=t.index;e.length<o.getStride();)e.push(0);switch(o.getType()){case jt.MULTI_LINE_STRING:case jt.POLYGON:(i=o.getCoordinates())[s[0]].splice(a+1,0,e);break;case jt.MULTI_POLYGON:(i=o.getCoordinates())[s[1]][s[0]].splice(a+1,0,e);break;case jt.LINE_STRING:(i=o.getCoordinates()).splice(a+1,0,e);break;default:return}this.setGeometryCoordinates_(o,i);var h=this.rBush_;h.remove(t);this.updateSegmentIndices_(o,a,s,1);var l={segment:[r[0],e],feature:n,geometry:o,depth:s,index:a};h.insert(q(l.segment),l);this.dragSegments_.push([l,1]);var u={segment:[e,r[1]],feature:n,geometry:o,depth:s,index:a+1};h.insert(q(u.segment),u);this.dragSegments_.push([u,0]);this.ignoreNextSingleClick_=!0};t.prototype.removePoint=function(){if(this.lastPointerEvent_&&this.lastPointerEvent_.type!=rn.POINTERDRAG){var t=this.lastPointerEvent_;this.willModifyFeatures_(t);this.removeVertex_();this.dispatchEvent(new Ll(Il,this.features_,t));return!(this.modified_=!1)}return!1};t.prototype.removeVertex_=function(){var t,e,i,r,n,o,s,a,h,l,u,c=this.dragSegments_,p={},d=!1;for(n=c.length-1;0<=n;--n){u=bt((l=(i=c[n])[0]).feature);l.depth&&(u+="-"+l.depth.join("-"));u in p||(p[u]={});if(0===i[1]){p[u].right=l;p[u].index=l.index}else if(1==i[1]){p[u].left=l;p[u].index=l.index+1}}for(u in p){h=p[u].right;s=p[u].left;(a=(o=p[u].index)-1)<0&&(a=0);t=e=(r=(l=void 0!==s?s:h).geometry).getCoordinates();d=!1;switch(r.getType()){case jt.MULTI_LINE_STRING:if(2<e[l.depth[0]].length){e[l.depth[0]].splice(o,1);d=!0}break;case jt.LINE_STRING:if(2<e.length){e.splice(o,1);d=!0}break;case jt.MULTI_POLYGON:t=t[l.depth[1]];case jt.POLYGON:if(4<(t=t[l.depth[0]]).length){o==t.length-1&&(o=0);t.splice(o,1);d=!0;if(0===o){t.pop();t.push(t[0]);a=t.length-1}}}if(d){this.setGeometryCoordinates_(r,e);var f=[];if(void 0!==s){this.rBush_.remove(s);f.push(s.segment[0])}if(void 0!==h){this.rBush_.remove(h);f.push(h.segment[1])}if(void 0!==s&&void 0!==h){var _={depth:l.depth,feature:l.feature,geometry:l.geometry,index:a,segment:f};this.rBush_.insert(q(_.segment),_)}this.updateSegmentIndices_(r,o,l.depth,-1);if(this.vertexFeature_){this.overlay_.getSource().removeFeature(this.vertexFeature_);this.vertexFeature_=null}c.length=0}}return d};t.prototype.setGeometryCoordinates_=function(t,e){this.changingFeature_=!0;t.setCoordinates(e);this.changingFeature_=!1};t.prototype.updateSegmentIndices_=function(e,i,r,n){this.rBush_.forEachInExtent(e.getExtent(),function(t){t.geometry===e&&(void 0===r||void 0===t.depth||Ft(t.depth,r))&&t.index>i&&(t.index+=n)})};return t}(ws);function Pl(t,e){return t.index-e.index}function bl(t,e){var i=e.geometry;if(i.getType()===jt.CIRCLE){var r=i;if(e.index===Cl){var n=vo(r.getCenter(),t),o=Math.sqrt(n)-r.getRadius();return o*o}}return To(t,e.segment)}function Ml(t,e){var i=e.geometry;return i.getType()===jt.CIRCLE&&e.index===Cl?i.getClosestPoint(t):po(t,e.segment)}var Fl={SELECT:"select"},Nl=function(n){function t(t,e,i,r){n.call(this,t);this.selected=e;this.deselected=i;this.mapBrowserEvent=r}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(S),Al=function(s){function t(t){s.call(this,{handleEvent:Gl});var e=t||{};this.condition_=e.condition?e.condition:Es;this.addCondition_=e.addCondition?e.addCondition:ms;this.removeCondition_=e.removeCondition?e.removeCondition:ms;this.toggleCondition_=e.toggleCondition?e.toggleCondition:Ss;this.multi_=!!e.multi&&e.multi;this.filter_=e.filter?e.filter:E;this.hitTolerance_=e.hitTolerance?e.hitTolerance:0;var i,r=new rl({source:new fl({useSpatialIndex:!1,features:e.features,wrapX:e.wrapX}),style:e.style?e.style:function(){var i=$a();B(i[jt.POLYGON],i[jt.LINE_STRING]);B(i[jt.GEOMETRY_COLLECTION],i[jt.LINE_STRING]);return function(t,e){return t.getGeometry()?i[t.getGeometry().getType()]:null}}(),updateWhileAnimating:!0,updateWhileInteracting:!0});this.featureOverlay_=r;if(e.layers)if("function"==typeof e.layers)i=e.layers;else{var n=e.layers;i=function(t){return U(n,t)}}else i=E;this.layerFilter_=i;this.featureLayerAssociation_={};var o=this.getFeatures();m(o,a.ADD,this.addFeature_,this);m(o,a.REMOVE,this.removeFeature_,this)}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.addFeatureLayerAssociation_=function(t,e){this.featureLayerAssociation_[bt(t)]=e};t.prototype.getFeatures=function(){return this.featureOverlay_.getSource().getFeaturesCollection()};t.prototype.getHitTolerance=function(){return this.hitTolerance_};t.prototype.getLayer=function(t){return this.featureLayerAssociation_[bt(t)]};t.prototype.getOverlay=function(){return this.featureOverlay_};t.prototype.setHitTolerance=function(t){this.hitTolerance_=t};t.prototype.setMap=function(t){var e=this.getMap(),i=this.getFeatures();e&&i.forEach(e.unskipFeature.bind(e));s.prototype.setMap.call(this,t);this.featureOverlay_.setMap(t);t&&i.forEach(t.skipFeature.bind(t))};t.prototype.addFeature_=function(t){var e=this.getMap();e&&e.skipFeature(t.element)};t.prototype.removeFeature_=function(t){var e=this.getMap();e&&e.unskipFeature(t.element)};t.prototype.removeFeatureLayerAssociation_=function(t){delete this.featureLayerAssociation_[bt(t)]};return t}(ns);function Gl(t){if(!this.condition_(t))return!0;var i=this.addCondition_(t),r=this.removeCondition_(t),n=this.toggleCondition_(t),e=!i&&!r&&!n,o=t.map,s=this.getFeatures(),a=[],h=[];if(e){_(this.featureLayerAssociation_);o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e)){h.push(t);this.addFeatureLayerAssociation_(t,e);return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var l=s.getLength()-1;0<=l;--l){var u=s.item(l),c=h.indexOf(u);if(-1<c)h.splice(c,1);else{s.remove(u);a.push(u)}}0!==h.length&&s.extend(h)}else{o.forEachFeatureAtPixel(t.pixel,function(t,e){if(this.filter_(t,e)){if(!i&&!n||U(s.getArray(),t)){if((r||n)&&U(s.getArray(),t)){a.push(t);this.removeFeatureLayerAssociation_(t)}}else{h.push(t);this.addFeatureLayerAssociation_(t,e)}return!this.multi_}}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_});for(var p=a.length-1;0<=p;--p)s.remove(a[p]);s.extend(h)}(0<h.length||0<a.length)&&this.dispatchEvent(new Nl(Fl.SELECT,h,a,t));return vs(t)}function Dl(t){return t.feature?t.feature:t.element?t.element:void 0}var kl=function(n){function t(t){var e=t||{},i=e;i.handleDownEvent||(i.handleDownEvent=E);i.stopDown||(i.stopDown=T);n.call(this,i);this.source_=e.source?e.source:null;this.vertex_=void 0===e.vertex||e.vertex;this.edge_=void 0===e.edge||e.edge;this.features_=e.features?e.features:null;this.featuresListenerKeys_=[];this.featureChangeListenerKeys_={};this.indexedFeaturesExtents_={};this.pendingFeatures_={};this.pixelCoordinate_=null;this.pixelTolerance_=void 0!==e.pixelTolerance?e.pixelTolerance:10;this.sortByDistance_=function(t,e){var i=To(this.pixelCoordinate_,t.segment),r=To(this.pixelCoordinate_,e.segment);return i-r}.bind(this);this.rBush_=new pl;this.SEGMENT_WRITERS_={Point:this.writePointGeometry_,LineString:this.writeLineStringGeometry_,LinearRing:this.writeLineStringGeometry_,Polygon:this.writePolygonGeometry_,MultiPoint:this.writeMultiPointGeometry_,MultiLineString:this.writeMultiLineStringGeometry_,MultiPolygon:this.writeMultiPolygonGeometry_,GeometryCollection:this.writeGeometryCollectionGeometry_,Circle:this.writeCircleGeometry_}}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.addFeature=function(t,e){var i=void 0===e||e,r=bt(t),n=t.getGeometry();if(n){var o=this.SEGMENT_WRITERS_[n.getType()];if(o){this.indexedFeaturesExtents_[r]=n.getExtent([1/0,1/0,-1/0,-1/0]);o.call(this,t,n)}}i&&(this.featureChangeListenerKeys_[r]=m(t,C.CHANGE,this.handleFeatureChange_,this))};t.prototype.forEachFeatureAdd_=function(t){this.addFeature(t)};t.prototype.forEachFeatureRemove_=function(t){this.removeFeature(t)};t.prototype.getFeatures_=function(){var t;this.features_?t=this.features_:this.source_&&(t=this.source_.getFeatures());return t};t.prototype.handleEvent=function(t){var e=this.snapTo(t.pixel,t.coordinate,t.map);if(e.snapped){t.coordinate=e.vertex.slice(0,2);t.pixel=e.vertexPixel}return n.prototype.handleEvent.call(this,t)};t.prototype.handleFeatureAdd_=function(t){var e=Dl(t);this.addFeature(e)};t.prototype.handleFeatureRemove_=function(t){var e=Dl(t);this.removeFeature(e)};t.prototype.handleFeatureChange_=function(t){var e=t.target;if(this.handlingDownUpSequence){var i=bt(e);i in this.pendingFeatures_||(this.pendingFeatures_[i]=e)}else this.updateFeature_(e)};t.prototype.handleUpEvent=function(t){var e=h(this.pendingFeatures_);if(e.length){e.forEach(this.updateFeature_.bind(this));this.pendingFeatures_={}}return!1};t.prototype.removeFeature=function(e,t){var i=void 0===t||t,r=bt(e),n=this.indexedFeaturesExtents_[r];if(n){var o=this.rBush_,s=[];o.forEachInExtent(n,function(t){e===t.feature&&s.push(t)});for(var a=s.length-1;0<=a;--a)o.remove(s[a])}if(i){g(this.featureChangeListenerKeys_[r]);delete this.featureChangeListenerKeys_[r]}};t.prototype.setMap=function(t){var e=this.getMap(),i=this.featuresListenerKeys_,r=this.getFeatures_();if(e){i.forEach(g);i.length=0;r.forEach(this.forEachFeatureRemove_.bind(this))}n.prototype.setMap.call(this,t);if(t){this.features_?i.push(m(this.features_,a.ADD,this.handleFeatureAdd_,this),m(this.features_,a.REMOVE,this.handleFeatureRemove_,this)):this.source_&&i.push(m(this.source_,cl.ADDFEATURE,this.handleFeatureAdd_,this),m(this.source_,cl.REMOVEFEATURE,this.handleFeatureRemove_,this));r.forEach(this.forEachFeatureAdd_.bind(this))}};t.prototype.snapTo=function(t,e,i){var r=q([i.getCoordinateFromPixel([t[0]-this.pixelTolerance_,t[1]+this.pixelTolerance_]),i.getCoordinateFromPixel([t[0]+this.pixelTolerance_,t[1]-this.pixelTolerance_])]),n=this.rBush_.getInExtent(r);this.vertex_&&!this.edge_&&(n=n.filter(function(t){return t.feature.getGeometry().getType()!==jt.CIRCLE}));var o,s,a,h,l=!1,u=null,c=null;if(0<n.length){this.pixelCoordinate_=e;n.sort(this.sortByDistance_);var p=n[0].segment,d=n[0].feature.getGeometry().getType()===jt.CIRCLE;if(this.vertex_&&!this.edge_){o=i.getPixelFromCoordinate(p[0]);s=i.getPixelFromCoordinate(p[1]);a=vo(t,o);h=vo(t,s);if(Math.sqrt(Math.min(a,h))<=this.pixelTolerance_){l=!0;u=h<a?p[1]:p[0];c=i.getPixelFromCoordinate(u)}}else if(this.edge_){u=d?co(e,n[0].feature.getGeometry()):po(e,p);if(Eo(t,c=i.getPixelFromCoordinate(u))<=this.pixelTolerance_){l=!0;if(this.vertex_&&!d){o=i.getPixelFromCoordinate(p[0]);s=i.getPixelFromCoordinate(p[1]);a=vo(c,o);h=vo(c,s);if(Math.sqrt(Math.min(a,h))<=this.pixelTolerance_){u=h<a?p[1]:p[0];c=i.getPixelFromCoordinate(u)}}}}l&&(c=[Math.round(c[0]),Math.round(c[1])])}return{snapped:l,vertex:u,vertexPixel:c}};t.prototype.updateFeature_=function(t){this.removeFeature(t,!1);this.addFeature(t,!1)};t.prototype.writeCircleGeometry_=function(t,e){for(var i=rr(e).getCoordinates()[0],r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),s={feature:t,segment:o};this.rBush_.insert(q(o),s)}};t.prototype.writeGeometryCollectionGeometry_=function(t,e){for(var i=e.getGeometriesArray(),r=0;r<i.length;++r){var n=this.SEGMENT_WRITERS_[i[r].getType()];n&&n.call(this,t,i[r])}};t.prototype.writeLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length-1;r<n;++r){var o=i.slice(r,r+2),s={feature:t,segment:o};this.rBush_.insert(q(o),s)}};t.prototype.writeMultiLineStringGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,segment:h};this.rBush_.insert(q(h),l)}};t.prototype.writeMultiPointGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r){var o=i[r],s={feature:t,segment:[o,o]};this.rBush_.insert(e.getExtent(),s)}};t.prototype.writeMultiPolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length;s<a;++s)for(var h=o[s],l=0,u=h.length-1;l<u;++l){var c=h.slice(l,l+2),p={feature:t,segment:c};this.rBush_.insert(q(c),p)}};t.prototype.writePointGeometry_=function(t,e){var i=e.getCoordinates(),r={feature:t,segment:[i,i]};this.rBush_.insert(e.getExtent(),r)};t.prototype.writePolygonGeometry_=function(t,e){for(var i=e.getCoordinates(),r=0,n=i.length;r<n;++r)for(var o=i[r],s=0,a=o.length-1;s<a;++s){var h=o.slice(s,s+2),l={feature:t,segment:h};this.rBush_.insert(q(h),l)}};return t}(ws);var jl="translatestart",Ul="translating",Yl="translateend",Xl=function(r){function t(t,e,i){r.call(this,t);this.features=e;this.coordinate=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),Bl=function(n){function t(t){var e,i=t||{};n.call(this,i);this.lastCoordinate_=null;this.features_=void 0!==i.features?i.features:null;if(i.layers)if("function"==typeof i.layers)e=i.layers;else{var r=i.layers;e=function(t){return U(r,t)}}else e=E;this.layerFilter_=e;this.hitTolerance_=i.hitTolerance?i.hitTolerance:0;this.lastFeature_=null;m(this,b(rs.ACTIVE),this.handleActiveChanged_,this)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.handleDownEvent=function(t){this.lastFeature_=this.featuresAtPixel_(t.pixel,t.map);if(this.lastCoordinate_||!this.lastFeature_)return!1;this.lastCoordinate_=t.coordinate;this.handleMoveEvent(t);var e=this.features_||new N([this.lastFeature_]);this.dispatchEvent(new Xl(jl,e,t.coordinate));return!0};t.prototype.handleUpEvent=function(t){if(this.lastCoordinate_){this.lastCoordinate_=null;this.handleMoveEvent(t);var e=this.features_||new N([this.lastFeature_]);this.dispatchEvent(new Xl(Yl,e,t.coordinate));return!0}return!1};t.prototype.handleDragEvent=function(t){if(this.lastCoordinate_){var e=t.coordinate,i=e[0]-this.lastCoordinate_[0],r=e[1]-this.lastCoordinate_[1],n=this.features_||new N([this.lastFeature_]);n.forEach(function(t){var e=t.getGeometry();e.translate(i,r);t.setGeometry(e)});this.lastCoordinate_=e;this.dispatchEvent(new Xl(Ul,n,e))}};t.prototype.handleMoveEvent=function(t){var e=t.map.getViewport();if(this.featuresAtPixel_(t.pixel,t.map)){e.classList.remove(this.lastCoordinate_?"ol-grab":"ol-grabbing");e.classList.add(this.lastCoordinate_?"ol-grabbing":"ol-grab")}else e.classList.remove("ol-grab","ol-grabbing")};t.prototype.featuresAtPixel_=function(t,e){return e.forEachFeatureAtPixel(t,function(t){if(!this.features_||U(this.features_.getArray(),t))return t}.bind(this),{layerFilter:this.layerFilter_,hitTolerance:this.hitTolerance_})};t.prototype.getHitTolerance=function(){return this.hitTolerance_};t.prototype.setHitTolerance=function(t){this.hitTolerance_=t};t.prototype.setMap=function(t){var e=this.getMap();n.prototype.setMap.call(this,t);this.updateState_(e)};t.prototype.handleActiveChanged_=function(){this.updateState_(null)};t.prototype.updateState_=function(t){var e=this.getMap(),i=this.getActive();if((!e||!i)&&(e=e||t)){e.getViewport().classList.remove("ol-grab","ol-grabbing")}};return t}(ws);function zl(t){var e=t||{},i=new N,r=new $r(-.005,.05,100);(void 0===e.altShiftDragRotate||e.altShiftDragRotate)&&i.push(new Os);(void 0===e.doubleClickZoom||e.doubleClickZoom)&&i.push(new cs({delta:e.zoomDelta,duration:e.zoomDuration}));(void 0===e.dragPan||e.dragPan)&&i.push(new Ls({condition:e.onFocusOnly?_s:void 0,kinetic:r}));(void 0===e.pinchRotate||e.pinchRotate)&&i.push(new Vs);(void 0===e.pinchZoom||e.pinchZoom)&&i.push(new Ws({constrainResolution:e.constrainResolution,duration:e.zoomDuration}));if(void 0===e.keyboard||e.keyboard){i.push(new js);i.push(new Ys({delta:e.zoomDelta,duration:e.zoomDuration}))}(void 0===e.mouseWheelZoom||e.mouseWheelZoom)&&i.push(new zs({condition:e.onFocusOnly?_s:void 0,constrainResolution:e.constrainResolution,duration:e.zoomDuration}));(void 0===e.shiftDragZoom||e.shiftDragZoom)&&i.push(new Gs({duration:e.zoomDuration}));return i}var Vl=function(){this.cache_={};this.cacheSize_=0;this.maxCacheSize_=32};Vl.prototype.clear=function(){this.cache_={};this.cacheSize_=0};Vl.prototype.expire=function(){if(this.cacheSize_>this.maxCacheSize_){var t=0;for(var e in this.cache_){var i=this.cache_[e];if(0==(3&t++)&&!i.hasListener()){delete this.cache_[e];--this.cacheSize_}}}};Vl.prototype.get=function(t,e,i){var r=Wl(t,e,i);return r in this.cache_?this.cache_[r]:null};Vl.prototype.set=function(t,e,i,r){var n=Wl(t,e,i);this.cache_[n]=r;++this.cacheSize_};Vl.prototype.setSize=function(t){this.maxCacheSize_=t;this.expire()};function Wl(t,e,i){return e+":"+t+":"+(i?ca(i):"null")}var Kl=new Vl,Hl=function(e){function t(t){e.call(this);this.map_=t;this.layerRenderers_={};this.layerRendererListeners_={}}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.dispatchRenderEvent=function(t,e){o()};t.prototype.calculateMatrices2D=function(t){var e=t.viewState,i=t.coordinateToPixelTransform,r=t.pixelToCoordinateTransform;ei(i,t.size[0]/2,t.size[1]/2,1/e.resolution,-1/e.resolution,-e.rotation,-e.center[0],-e.center[1]);ii(r,i)};t.prototype.removeLayerRenderers=function(){for(var t in this.layerRenderers_)this.removeLayerRendererByKey_(t).dispose()};t.prototype.forEachFeatureAtCoordinate=function(t,r,e,n,o,i,s){var a,h=r.viewState,l=h.resolution;function u(t,e){var i=r.layerStates[bt(e)].managed;if(!(bt(t)in r.skippedFeatureUids)||i)return n.call(o,t,i?e:null)}var c=h.projection,p=t;if(c.canWrapX()){var d=c.getExtent(),f=Lt(d),_=t[0];if(_<d[0]||_>d[2]){p=[_+f*Math.ceil((d[0]-_)/f),t[1]]}}var g,y=r.layerStatesArray;for(g=y.length-1;0<=g;--g){var m=y[g],v=m.layer;if(qo(m,l)&&i.call(s,v)){var E=this.getLayerRenderer(v),T=v.getSource();E&&T&&(a=E.forEachFeatureAtCoordinate(T.getWrapX()?p:t,r,e,u));if(a)return a}}};t.prototype.forEachLayerAtPixel=function(t,e,i,r,n){return o()};t.prototype.hasFeatureAtCoordinate=function(t,e,i,r,n){return void 0!==this.forEachFeatureAtCoordinate(t,e,i,E,this,r,n)};t.prototype.getLayerRenderer=function(t){var e=bt(t);if(e in this.layerRenderers_)return this.layerRenderers_[e];var i=t.getRenderer();if(!i)return null;this.layerRenderers_[e]=i;this.layerRendererListeners_[e]=m(i,C.CHANGE,this.handleLayerRendererChange_,this);return i};t.prototype.getLayerRenderers=function(){return this.layerRenderers_};t.prototype.getMap=function(){return this.map_};t.prototype.handleLayerRendererChange_=function(){this.map_.render()};t.prototype.removeLayerRendererByKey_=function(t){var e=this.layerRenderers_[t];delete this.layerRenderers_[t];g(this.layerRendererListeners_[t]);delete this.layerRendererListeners_[t];return e};t.prototype.removeUnusedLayerRenderers_=function(t,e){for(var i in this.layerRenderers_)e&&i in e.layerStates||this.removeLayerRendererByKey_(i).dispose()};t.prototype.renderFrame=function(t){o()};t.prototype.scheduleExpireIconCache=function(t){t.postRenderFunctions.push(Zl)};t.prototype.scheduleRemoveUnusedLayerRenderers=function(t){for(var e in this.layerRenderers_)if(!(e in t.layerStates)){t.postRenderFunctions.push(this.removeUnusedLayerRenderers_.bind(this));return}};return t}(i);function Zl(t,e){Kl.expire()}var ql=function(r){function t(t){r.call(this,t);this.element_=document.createElement("div");var e=this.element_.style;e.position="absolute";e.width="100%";e.height="100%";e.zIndex="0";this.element_.className=zo+" ol-layers";var i=t.getViewport();i.insertBefore(this.element_,i.firstChild||null);this.children_=[];this.renderedVisible_=!0}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.dispatchRenderEvent=function(t,e){var i=this.getMap();if(i.hasListener(t)){var r=new Kh(t,void 0,e);i.dispatchEvent(r)}};t.prototype.renderFrame=function(t){if(t){this.calculateMatrices2D(t);this.dispatchRenderEvent(Kn.PRECOMPOSE,t);for(var e=t.layerStatesArray,i=t.viewState.resolution,r=this.children_.length=0,n=e.length;r<n;++r){var o=e[r];if(qo(o,i)&&o.sourceState==bo.READY){var s=o.layer.render(t);if(s){var a=o.zIndex;a!==s.style.zIndex&&(s.style.zIndex=a);this.children_.push(s)}}}qr(this.element_,this.children_);this.dispatchRenderEvent(Kn.POSTCOMPOSE,t);if(!this.renderedVisible_){this.element_.style.display="";this.renderedVisible_=!0}this.scheduleRemoveUnusedLayerRenderers(t);this.scheduleExpireIconCache(t)}else if(this.renderedVisible_){this.element_.style.display="none";this.renderedVisible_=!1}};t.prototype.forEachLayerAtPixel=function(t,e,i,r,n){for(var o=e.viewState.resolution,s=e.layerStatesArray,a=s.length-1;0<=a;--a){var h=s[a],l=h.layer;if(qo(h,o)&&n(l)){var u=this.getLayerRenderer(l);if(!u)continue;var c=u.getDataAtPixel(t,e,i);if(c){var p=r(l,c);if(p)return p}}}};return t}(Hl),Jl=function(e){function t(t){(t=y({},t)).controls||(t.controls=is());t.interactions||(t.interactions=zl());e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){return new ql(this)};return t}(ko),Ql={BOTTOM_LEFT:"bottom-left",BOTTOM_CENTER:"bottom-center",BOTTOM_RIGHT:"bottom-right",CENTER_LEFT:"center-left",CENTER_CENTER:"center-center",CENTER_RIGHT:"center-right",TOP_LEFT:"top-left",TOP_CENTER:"top-center",TOP_RIGHT:"top-right"},$l="element",tu="map",eu="offset",iu="position",ru="positioning",nu=function(e){function t(t){e.call(this);this.options=t;this.id=t.id;this.insertFirst=void 0===t.insertFirst||t.insertFirst;this.stopEvent=void 0===t.stopEvent||t.stopEvent;this.element=document.createElement("div");this.element.className=void 0!==t.className?t.className:"ol-overlay-container "+Bo;this.element.style.position="absolute";this.autoPan=void 0!==t.autoPan&&t.autoPan;this.autoPanAnimation=t.autoPanAnimation||{};this.autoPanMargin=void 0!==t.autoPanMargin?t.autoPanMargin:20;this.rendered={bottom_:"",left_:"",right_:"",top_:"",visible:!0};this.mapPostrenderListenerKey=null;m(this,b($l),this.handleElementChanged,this);m(this,b(tu),this.handleMapChanged,this);m(this,b(eu),this.handleOffsetChanged,this);m(this,b(iu),this.handlePositionChanged,this);m(this,b(ru),this.handlePositioningChanged,this);void 0!==t.element&&this.setElement(t.element);this.setOffset(void 0!==t.offset?t.offset:[0,0]);this.setPositioning(void 0!==t.positioning?t.positioning:Ql.TOP_LEFT);void 0!==t.position&&this.setPosition(t.position)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getElement=function(){return this.get($l)};t.prototype.getId=function(){return this.id};t.prototype.getMap=function(){return this.get(tu)};t.prototype.getOffset=function(){return this.get(eu)};t.prototype.getPosition=function(){return this.get(iu)};t.prototype.getPositioning=function(){return this.get(ru)};t.prototype.handleElementChanged=function(){Zr(this.element);var t=this.getElement();t&&this.element.appendChild(t)};t.prototype.handleMapChanged=function(){if(this.mapPostrenderListenerKey){Hr(this.element);g(this.mapPostrenderListenerKey);this.mapPostrenderListenerKey=null}var t=this.getMap();if(t){this.mapPostrenderListenerKey=m(t,Vn.POSTRENDER,this.render,this);this.updatePixelPosition();var e=this.stopEvent?t.getOverlayContainerStopEvent():t.getOverlayContainer();this.insertFirst?e.insertBefore(this.element,e.childNodes[0]||null):e.appendChild(this.element)}};t.prototype.render=function(){this.updatePixelPosition()};t.prototype.handleOffsetChanged=function(){this.updatePixelPosition()};t.prototype.handlePositionChanged=function(){this.updatePixelPosition();this.get(iu)&&this.autoPan&&this.panIntoView()};t.prototype.handlePositioningChanged=function(){this.updatePixelPosition()};t.prototype.setElement=function(t){this.set($l,t)};t.prototype.setMap=function(t){this.set(tu,t)};t.prototype.setOffset=function(t){this.set(eu,t)};t.prototype.setPosition=function(t){this.set(iu,t)};t.prototype.panIntoView=function(){var t=this.getMap();if(t&&t.getTargetElement()){var e=this.getRect(t.getTargetElement(),t.getSize()),i=this.getElement(),r=this.getRect(i,[Vr(i),Wr(i)]),n=this.autoPanMargin;if(!et(e,r)){var o=r[0]-e[0],s=e[2]-r[2],a=r[1]-e[1],h=e[3]-r[3],l=[0,0];o<0?l[0]=o-n:s<0&&(l[0]=Math.abs(s)+n);a<0?l[1]=a-n:h<0&&(l[1]=Math.abs(h)+n);if(0!==l[0]||0!==l[1]){var u=t.getView().getCenter(),c=t.getPixelFromCoordinate(u),p=[c[0]+l[0],c[1]+l[1]];t.getView().animate({center:t.getCoordinateFromPixel(p),duration:this.autoPanAnimation.duration,easing:this.autoPanAnimation.easing})}}}};t.prototype.getRect=function(t,e){var i=t.getBoundingClientRect(),r=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[r,n,r+e[0],n+e[1]]};t.prototype.setPositioning=function(t){this.set(ru,t)};t.prototype.setVisible=function(t){if(this.rendered.visible!==t){this.element.style.display=t?"":"none";this.rendered.visible=t}};t.prototype.updatePixelPosition=function(){var t=this.getMap(),e=this.getPosition();if(t&&t.isRendered()&&e){var i=t.getPixelFromCoordinate(e),r=t.getSize();this.updateRenderedPosition(i,r)}else this.setVisible(!1)};t.prototype.updateRenderedPosition=function(t,e){var i=this.element.style,r=this.getOffset(),n=this.getPositioning();this.setVisible(!0);var o=r[0],s=r[1];if(n==Ql.BOTTOM_RIGHT||n==Ql.CENTER_RIGHT||n==Ql.TOP_RIGHT){""!==this.rendered.left_&&(this.rendered.left_=i.left="");var a=Math.round(e[0]-t[0]-o)+"px";this.rendered.right_!=a&&(this.rendered.right_=i.right=a)}else{""!==this.rendered.right_&&(this.rendered.right_=i.right="");n!=Ql.BOTTOM_CENTER&&n!=Ql.CENTER_CENTER&&n!=Ql.TOP_CENTER||(o-=this.element.offsetWidth/2);var h=Math.round(t[0]+o)+"px";this.rendered.left_!=h&&(this.rendered.left_=i.left=h)}if(n==Ql.BOTTOM_LEFT||n==Ql.BOTTOM_CENTER||n==Ql.BOTTOM_RIGHT){""!==this.rendered.top_&&(this.rendered.top_=i.top="");var l=Math.round(e[1]-t[1]-s)+"px";this.rendered.bottom_!=l&&(this.rendered.bottom_=i.bottom=l)}else{""!==this.rendered.bottom_&&(this.rendered.bottom_=i.bottom="");n!=Ql.CENTER_LEFT&&n!=Ql.CENTER_CENTER&&n!=Ql.CENTER_RIGHT||(s-=this.element.offsetHeight/2);var u=Math.round(t[1]+s)+"px";this.rendered.top_!=u&&(this.rendered.top_=i.top=u)}};t.prototype.getOptions=function(){return this.options};return t}(O);function ou(t,e,i,r){if(void 0===r)return[t,e,i];r[0]=t;r[1]=e;r[2]=i;return r}function su(t,e,i){return t+"/"+e+"/"+i}function au(t){return su(t[0],t[1],t[2])}function hu(t){return t.split("/").map(Number)}function lu(t){return(t[1]<<t[0])+t[2]}function uu(t,e){var i=t[0],r=t[1],n=t[2];if(e.getMinZoom()>i||i>e.getMaxZoom())return!1;var o,s=e.getExtent();return!(o=s?e.getTileRangeForExtentAndZ(s,i):e.getFullTileRange(i))||o.containsXY(r,n)}var cu=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.expireCache=function(t){for(;this.canExpireCache();){var e=this.peekLast(),i=e.tileCoord[0].toString();if(i in t&&t[i].contains(e.tileCoord))break;this.pop().dispose()}};t.prototype.pruneExceptNewestZ=function(){if(0!==this.getCount()){var e=hu(this.peekFirstKey())[0];this.forEach(function(t){if(t.tileCoord[0]!==e){this.remove(au(t.tileCoord));t.dispose()}},this)}};return t}(va),pu=function(t,e,i,r){this.minX=t;this.maxX=e;this.minY=i;this.maxY=r};pu.prototype.contains=function(t){return this.containsXY(t[1],t[2])};pu.prototype.containsTileRange=function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY};pu.prototype.containsXY=function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY};pu.prototype.equals=function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY};pu.prototype.extend=function(t){t.minX<this.minX&&(this.minX=t.minX);t.maxX>this.maxX&&(this.maxX=t.maxX);t.minY<this.minY&&(this.minY=t.minY);t.maxY>this.maxY&&(this.maxY=t.maxY)};pu.prototype.getHeight=function(){return this.maxY-this.minY+1};pu.prototype.getSize=function(){return[this.getWidth(),this.getHeight()]};pu.prototype.getWidth=function(){return this.maxX-this.minX+1};pu.prototype.intersects=function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY};function du(t,e,i,r,n){if(void 0===n)return new pu(t,e,i,r);n.minX=t;n.maxX=e;n.minY=i;n.maxY=r;return n}var fu=function(y){function h(t,e,i,s,a,r,h,l,n,u,c,p,d,f){y.call(this,t,e,{transition:0});this.context_={};this.loader_;this.replayState_={};this.sourceTiles_=u;this.sourceTileGrid_=l;this.sourceTilesLoaded=!1;this.tileKeys=[];this.extent=null;this.wrappedTileCoord=r;this.loadListenerKeys_=[];this.isInterimTile=!l;this.sourceTileListenerKeys_=[];this.key=i.toString();if(r&&l){var _=this.extent=n.getTileCoordExtent(r),g=this.resolution_=n.getResolution(r[0]),o=l.getZForResolution(g);l.forEachTileCoord(_,o,function(t){var e=Ct(_,l.getTileCoordExtent(t)),i=l.getExtent();i&&(e=Ct(e,i,e));if(.5<=Lt(e)/g&&.5<=Rt(e)/g){var r=t.toString(),n=u[r];if(!n){var o=h(t,c,p);n=u[r]=new d(t,null==o?kr.EMPTY:kr.IDLE,null==o?"":o,s,a);this.sourceTileListenerKeys_.push(m(n,C.CHANGE,f))}n.consumers++;this.tileKeys.push(r)}}.bind(this))}}y&&(h.__proto__=y);((h.prototype=Object.create(y&&y.prototype)).constructor=h).prototype.disposeInternal=function(){this.isInterimTile||this.setState(kr.ABORT);if(this.interimTile){this.interimTile.dispose();this.interimTile=null}for(var t=0,e=this.tileKeys.length;t<e;++t){var i=this.tileKeys[t],r=this.getTile(i);r.consumers--;if(0==r.consumers){delete this.sourceTiles_[i];r.dispose()}}this.tileKeys.length=0;this.sourceTiles_=null;this.loadListenerKeys_.forEach(g);this.loadListenerKeys_.length=0;this.sourceTileListenerKeys_.forEach(g);this.sourceTileListenerKeys_.length=0;y.prototype.disposeInternal.call(this)};h.prototype.getContext=function(t){var e=bt(t);e in this.context_||(this.context_[e]=zr());return this.context_[e]};h.prototype.hasContext=function(t){return bt(t)in this.context_};h.prototype.getImage=function(t){return this.hasContext(t)?this.getContext(t).canvas:null};h.prototype.getInterimTile=function(){var o=this,s=this.sourceTileGrid_,t=this.getState();if(t<kr.LOADED&&!this.interimTile)for(var a=this.tileCoord[0],e=s.getMinZoom(),i=function(){var i=!0,r=[];s.forEachTileCoord(o.extent,a,function(t){var e=t.toString();e in this.sourceTiles_&&this.sourceTiles_[e].getState()===kr.LOADED?r.push(e):i=!1}.bind(o));if(i&&r.length){for(var t=0,e=r.length;t<e;++t)o.sourceTiles_[r[t]].consumers++;var n=new h(o.tileCoord,kr.IDLE,Number(o.key),null,null,o.wrappedTileCoord,null,null,null,o.sourceTiles_,void 0,null,null,null);n.extent=o.extent;n.tileKeys=r;n.context_=o.context_;setTimeout(function(){n.sourceTilesLoaded=!0;n.changed()},16);o.interimTile=n;return"break"}};--a>e;){if("break"===i())break}var r=this.interimTile;return t===kr.LOADED?this:r||this};h.prototype.getReplayState=function(t){var e=bt(t);e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedRevision:-1,renderedTileRevision:-1});return this.replayState_[e]};h.prototype.getTile=function(t){return this.sourceTiles_[t]};h.prototype.load=function(){var n=0,o={};this.state==kr.IDLE&&this.setState(kr.LOADING);this.state==kr.LOADING&&this.tileKeys.forEach(function(t){var r=this.getTile(t);if(r.state==kr.IDLE){r.setLoader(this.loader_);r.load()}if(r.state==kr.LOADING){var e=m(r,C.CHANGE,function(t){var e=r.getState();if(e==kr.LOADED||e==kr.ERROR){var i=bt(r);if(e==kr.ERROR)o[i]=!0;else{--n;delete o[i]}n-Object.keys(o).length==0&&this.finishLoading_()}}.bind(this));this.loadListenerKeys_.push(e);++n}}.bind(this));n-Object.keys(o).length==0&&setTimeout(this.finishLoading_.bind(this),16)};h.prototype.finishLoading_=function(){for(var t=this.tileKeys.length,e=0,i=t-1;0<=i;--i){var r=this.getTile(this.tileKeys[i]).getState();r!=kr.LOADED&&--t;r==kr.EMPTY&&++e}if(t==this.tileKeys.length){this.loadListenerKeys_.forEach(g);this.loadListenerKeys_.length=0;this.sourceTilesLoaded=!0;this.changed()}else this.setState(e==this.tileKeys.length?kr.EMPTY:kr.ERROR)};return h}(Br);function _u(t,e){var i=ol(e,t.getFormat(),t.onLoad.bind(t),t.onError.bind(t));t.setLoader(i)}var gu,yu=[0,0,4096,4096],mu=function(s){function t(t,e,i,r,n,o){s.call(this,t,e,o);this.consumers=0;this.extent_=null;this.format_=r;this.features_=null;this.loader_;this.projection_=null;this.executorGroups_={};this.tileLoadFunction_=n;this.url_=i}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.disposeInternal=function(){this.features_=null;this.executorGroups_={};this.state=kr.ABORT;this.changed();s.prototype.disposeInternal.call(this)};t.prototype.getExtent=function(){return this.extent_||yu};t.prototype.getFormat=function(){return this.format_};t.prototype.getFeatures=function(){return this.features_};t.prototype.getKey=function(){return this.url_};t.prototype.getProjection=function(){return this.projection_};t.prototype.getExecutorGroup=function(t,e){return this.executorGroups_[t+","+e]};t.prototype.load=function(){if(this.state==kr.IDLE){this.setState(kr.LOADING);this.tileLoadFunction_(this,this.url_);this.loader_(null,NaN,null)}};t.prototype.onLoad=function(t,e,i){this.setProjection(e);this.setFeatures(t);this.setExtent(i)};t.prototype.onError=function(){this.setState(kr.ERROR)};t.prototype.setExtent=function(t){this.extent_=t};t.prototype.setFeatures=function(t){this.features_=t;this.setState(kr.LOADED)};t.prototype.setProjection=function(t){this.projection_=t};t.prototype.setExecutorGroup=function(t,e,i){this.executorGroups_[t+","+e]=i};t.prototype.setLoader=function(t){this.loader_=t};return t}(Br),vu=function(){if(!gu){var t=document.body;t.webkitRequestFullscreen?gu="webkitfullscreenchange":t.mozRequestFullScreen?gu="mozfullscreenchange":t.msRequestFullscreen?gu="MSFullscreenChange":t.requestFullscreen&&(gu="fullscreenchange")}return gu},Eu=function(a){function t(t){var e=t||{};a.call(this,{element:document.createElement("div"),target:e.target});this.cssClassName_=void 0!==e.className?e.className:"ol-full-screen";var i=void 0!==e.label?e.label:"";this.labelNode_="string"==typeof i?document.createTextNode(i):i;var r=void 0!==e.labelActive?e.labelActive:"";this.labelActiveNode_="string"==typeof r?document.createTextNode(r):r;this.button_=document.createElement("button");var n=e.tipLabel?e.tipLabel:"Toggle full-screen";this.setClassName_(this.button_,Su());this.button_.setAttribute("type","button");this.button_.title=n;this.button_.appendChild(this.labelNode_);m(this.button_,C.CLICK,this.handleClick_,this);var o=this.cssClassName_+" "+zo+" "+Wo+" "+(Tu()?"":Vo),s=this.element;s.className=o;s.appendChild(this.button_);this.keys_=void 0!==e.keys&&e.keys;this.source_=e.source}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();this.handleFullScreen_()};t.prototype.handleFullScreen_=function(){if(Tu()){var t=this.getMap();if(t){if(Su())document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen();else{var e;e=this.source_?"string"==typeof this.source_?document.getElementById(this.source_):this.source_:t.getTargetElement();this.keys_?(i=e).mozRequestFullScreenWithKeys?i.mozRequestFullScreenWithKeys():i.webkitRequestFullscreen?i.webkitRequestFullscreen():xu(i):xu(e)}var i}}};t.prototype.handleFullScreenChange_=function(){var t=this.getMap();if(Su()){this.setClassName_(this.button_,!0);Kr(this.labelActiveNode_,this.labelNode_)}else{this.setClassName_(this.button_,!1);Kr(this.labelNode_,this.labelActiveNode_)}t&&t.updateSize()};t.prototype.setClassName_=function(t,e){var i=this.cssClassName_+"-true",r=this.cssClassName_+"-false",n=e?i:r;t.classList.remove(i);t.classList.remove(r);t.classList.add(n)};t.prototype.setMap=function(t){a.prototype.setMap.call(this,t);t&&this.listenerKeys.push(m(document,vu(),this.handleFullScreenChange_,this))};return t}(Yo);function Tu(){var t=document.body;return!!(t.webkitRequestFullscreen||t.mozRequestFullScreen&&document.mozFullScreenEnabled||t.msRequestFullscreen&&document.msFullscreenEnabled||t.requestFullscreen&&document.fullscreenEnabled)}function Su(){return!!(document.webkitIsFullScreen||document.mozFullScreen||document.msFullscreenElement||document.fullscreenElement)}function xu(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen()}var Ru="projection",Cu="coordinateFormat",wu=function(r){function t(t){var e=t||{},i=document.createElement("div");i.className=void 0!==e.className?e.className:"ol-mouse-position";r.call(this,{element:i,render:e.render||Iu,target:e.target});m(this,b(Ru),this.handleProjectionChanged_,this);e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat);e.projection&&this.setProjection(e.projection);this.undefinedHTML_=void 0!==e.undefinedHTML?e.undefinedHTML:"&#160;";this.renderOnMouseOut_=!!this.undefinedHTML_;this.renderedHTML_=i.innerHTML;this.mapProjection_=null;this.transform_=null;this.lastMouseMovePixel_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.handleProjectionChanged_=function(){this.transform_=null};t.prototype.getCoordinateFormat=function(){return this.get(Cu)};t.prototype.getProjection=function(){return this.get(Ru)};t.prototype.handleMouseMove=function(t){var e=this.getMap();this.lastMouseMovePixel_=e.getEventPixel(t);this.updateHTML_(this.lastMouseMovePixel_)};t.prototype.handleMouseOut=function(t){this.updateHTML_(null);this.lastMouseMovePixel_=null};t.prototype.setMap=function(t){r.prototype.setMap.call(this,t);if(t){var e=t.getViewport();this.listenerKeys.push(m(e,C.MOUSEMOVE,this.handleMouseMove,this),m(e,C.TOUCHSTART,this.handleMouseMove,this));this.renderOnMouseOut_&&this.listenerKeys.push(m(e,C.MOUSEOUT,this.handleMouseOut,this),m(e,C.TOUCHEND,this.handleMouseOut,this))}};t.prototype.setCoordinateFormat=function(t){this.set(Cu,t)};t.prototype.setProjection=function(t){this.set(Ru,be(t))};t.prototype.updateHTML_=function(t){var e=this.undefinedHTML_;if(t&&this.mapProjection_){if(!this.transform_){var i=this.getProjection();this.transform_=i?je(this.mapProjection_,i):Le}var r=this.getMap().getCoordinateFromPixel(t);if(r){this.transform_(r,r);var n=this.getCoordinateFormat();e=n?n(r):r.toString()}}if(!this.renderedHTML_||e!==this.renderedHTML_){this.element.innerHTML=e;this.renderedHTML_=e}};return t}(Yo);function Iu(t){var e=t.frameState;if(e){if(this.mapProjection_!=e.viewState.projection){this.mapProjection_=e.viewState.projection;this.transform_=null}}else this.mapProjection_=null}var Lu=function(y){function t(t){var e=t||{};y.call(this,{element:document.createElement("div"),render:e.render||Ou,target:e.target});this.collapsed_=void 0===e.collapsed||e.collapsed;this.collapsible_=void 0===e.collapsible||e.collapsible;this.collapsible_||(this.collapsed_=!1);var i=void 0!==e.className?e.className:"ol-overviewmap",r=void 0!==e.tipLabel?e.tipLabel:"Overview map",n=void 0!==e.collapseLabel?e.collapseLabel:"";if("string"==typeof n){this.collapseLabel_=document.createElement("span");this.collapseLabel_.textContent=n}else this.collapseLabel_=n;var o=void 0!==e.label?e.label:"";if("string"==typeof o){this.label_=document.createElement("span");this.label_.textContent=o}else this.label_=o;var s=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button");a.title=r;a.appendChild(s);m(a,C.CLICK,this.handleClick_,this);this.ovmapDiv_=document.createElement("div");this.ovmapDiv_.className="ol-overviewmap-map";this.ovmap_=new Jl({controls:new N,interactions:new N,view:e.view});var h=this.ovmap_;e.layers&&e.layers.forEach(function(t){h.addLayer(t)}.bind(this));var l=document.createElement("div");l.className="ol-overviewmap-box";l.style.boxSizing="border-box";this.boxOverlay_=new nu({position:[0,0],positioning:Ql.BOTTOM_LEFT,element:l});this.ovmap_.addOverlay(this.boxOverlay_);var u=i+" "+zo+" "+Wo+(this.collapsed_&&this.collapsible_?" "+Ko:"")+(this.collapsible_?"":" ol-uncollapsible"),c=this.element;c.className=u;c.appendChild(this.ovmapDiv_);c.appendChild(a);var p=this,d=this.boxOverlay_,f=this.boxOverlay_.getElement(),_=function(t){var e,i={clientX:(e=t).clientX-f.offsetWidth/2,clientY:e.clientY+f.offsetHeight/2},r=h.getEventCoordinate(i);d.setPosition(r)},g=function(t){var e=h.getEventCoordinate(t);p.getMap().getView().setCenter(e);window.removeEventListener("mousemove",_);window.removeEventListener("mouseup",g)};f.addEventListener("mousedown",function(){window.addEventListener("mousemove",_);window.addEventListener("mouseup",g)})}y&&(t.__proto__=y);((t.prototype=Object.create(y&&y.prototype)).constructor=t).prototype.setMap=function(t){var e=this.getMap();if(t!==e){if(e){var i=e.getView();i&&this.unbindView_(i);this.ovmap_.setTarget(null)}y.prototype.setMap.call(this,t);if(t){this.ovmap_.setTarget(this.ovmapDiv_);this.listenerKeys.push(m(t,s.PROPERTYCHANGE,this.handleMapPropertyChange_,this));var r=t.getView();if(r){this.bindView_(r);if(r.isDef()){this.ovmap_.updateSize();this.resetExtent_()}}}}};t.prototype.handleMapPropertyChange_=function(t){if(t.key===Wn.VIEW){var e=t.oldValue;e&&this.unbindView_(e);var i=this.getMap().getView();this.bindView_(i)}};t.prototype.bindView_=function(t){m(t,b(ao.ROTATION),this.handleRotationChanged_,this)};t.prototype.unbindView_=function(t){f(t,b(ao.ROTATION),this.handleRotationChanged_,this)};t.prototype.handleRotationChanged_=function(){this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())};t.prototype.validateExtent_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var i=t.getSize(),r=t.getView().calculateExtent(i),n=e.getSize(),o=e.getView().calculateExtent(n),s=e.getPixelFromCoordinate(wt(r)),a=e.getPixelFromCoordinate(Et(r)),h=Math.abs(s[0]-a[0]),l=Math.abs(s[1]-a[1]),u=n[0],c=n[1];h<.1*u||l<.1*c||.75*u<h||.75*c<l?this.resetExtent_():et(o,r)||this.recenter_()}};t.prototype.resetExtent_=function(){var t=this.getMap(),e=this.ovmap_,i=t.getSize(),r=t.getView().calculateExtent(i),n=e.getView(),o=Math.log(7.5)/Math.LN2;At(r,1/(.1*Math.pow(2,o/2)));n.fit(r)};t.prototype.recenter_=function(){var t=this.getMap(),e=this.ovmap_,i=t.getView();e.getView().setCenter(i.getCenter())};t.prototype.updateBox_=function(){var t=this.getMap(),e=this.ovmap_;if(t.isRendered()&&e.isRendered()){var i=t.getSize(),r=t.getView(),n=e.getView(),o=r.getRotation(),s=this.boxOverlay_,a=this.boxOverlay_.getElement(),h=r.calculateExtent(i),l=n.getResolution(),u=vt(h),c=It(h),p=this.calculateCoordinateRotate_(o,u);s.setPosition(p);if(a){a.style.width=Math.abs((u[0]-c[0])/l)+"px";a.style.height=Math.abs((c[1]-u[1])/l)+"px"}}};t.prototype.calculateCoordinateRotate_=function(t,e){var i,r=this.getMap().getView().getCenter();if(r){yo(i=[e[0]-r[0],e[1]-r[1]],t);uo(i,r)}return i};t.prototype.handleClick_=function(t){t.preventDefault();this.handleToggle_()};t.prototype.handleToggle_=function(){this.element.classList.toggle(Ko);this.collapsed_?Kr(this.collapseLabel_,this.label_):Kr(this.label_,this.collapseLabel_);this.collapsed_=!this.collapsed_;var t=this.ovmap_;if(!this.collapsed_&&!t.isRendered()){t.updateSize();this.resetExtent_();d(t,Vn.POSTRENDER,function(t){this.updateBox_()},this)}};t.prototype.getCollapsible=function(){return this.collapsible_};t.prototype.setCollapsible=function(t){if(this.collapsible_!==t){this.collapsible_=t;this.element.classList.toggle("ol-uncollapsible");!t&&this.collapsed_&&this.handleToggle_()}};t.prototype.setCollapsed=function(t){this.collapsible_&&this.collapsed_!==t&&this.handleToggle_()};t.prototype.getCollapsed=function(){return this.collapsed_};t.prototype.getOverviewMap=function(){return this.ovmap_};return t}(Yo);function Ou(t){this.validateExtent_();this.updateBox_()}var Pu="units",bu={DEGREES:"degrees",IMPERIAL:"imperial",NAUTICAL:"nautical",METRIC:"metric",US:"us"},Mu=[1,2,5],Fu=function(r){function t(t){var e=t||{},i=void 0!==e.className?e.className:"ol-scale-line";r.call(this,{element:document.createElement("div"),render:e.render||Nu,target:e.target});this.innerElement_=document.createElement("div");this.innerElement_.className=i+"-inner";this.element.className=i+" "+zo;this.element.appendChild(this.innerElement_);this.viewState_=null;this.minWidth_=void 0!==e.minWidth?e.minWidth:64;this.renderedVisible_=!1;this.renderedWidth_=void 0;this.renderedHTML_="";m(this,b(Pu),this.handleUnitsChanged_,this);this.setUnits(e.units||bu.METRIC)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getUnits=function(){return this.get(Pu)};t.prototype.handleUnitsChanged_=function(){this.updateElement_()};t.prototype.setUnits=function(t){this.set(Pu,t)};t.prototype.updateElement_=function(){var t=this.viewState_;if(t){var e=t.center,i=t.projection,r=this.getUnits(),n=r==bu.DEGREES?ne.DEGREES:ne.METERS,o=Me(i,t.resolution,e,n);i.getUnits()!=ne.DEGREES&&i.getMetersPerUnit()&&n==ne.METERS&&(o*=i.getMetersPerUnit());var s=this.minWidth_*o,a="";if(r==bu.DEGREES){var h=oe[ne.DEGREES];i.getUnits()==ne.DEGREES?s*=h:o/=h;if(s<h/60){a="";o*=3600}else if(s<h){a="";o*=60}else a=""}else if(r==bu.IMPERIAL)if(s<.9144){a="in";o/=.0254}else if(s<1609.344){a="ft";o/=.3048}else{a="mi";o/=1609.344}else if(r==bu.NAUTICAL){o/=1852;a="nm"}else if(r==bu.METRIC)if(s<.001){a="m";o*=1e6}else if(s<1){a="mm";o*=1e3}else if(s<1e3)a="m";else{a="km";o/=1e3}else if(r==bu.US)if(s<.9144){a="in";o*=39.37}else if(s<1609.344){a="ft";o/=.30480061}else{a="mi";o/=1609.3472}else A(!1,33);for(var l,u,c=3*Math.floor(Math.log(this.minWidth_*o)/Math.log(10));;){l=Mu[(c%3+3)%3]*Math.pow(10,Math.floor(c/3));u=Math.round(l/o);if(isNaN(u)){this.element.style.display="none";this.renderedVisible_=!1;return}if(u>=this.minWidth_)break;++c}var p=l+" "+a;if(this.renderedHTML_!=p){this.innerElement_.innerHTML=p;this.renderedHTML_=p}if(this.renderedWidth_!=u){this.innerElement_.style.width=u+"px";this.renderedWidth_=u}if(!this.renderedVisible_){this.element.style.display="";this.renderedVisible_=!0}}else if(this.renderedVisible_){this.element.style.display="none";this.renderedVisible_=!1}};return t}(Yo);function Nu(t){var e=t.frameState;this.viewState_=e?e.viewState:null;this.updateElement_()}var Au=0,Gu=1,Du=function(o){function t(t){var e=t||{};o.call(this,{element:document.createElement("div"),render:e.render||ku});this.dragListenerKeys_=[];this.currentResolution_=void 0;this.direction_=Au;this.dragging_;this.heightLimit_=0;this.widthLimit_=0;this.previousX_;this.previousY_;this.thumbSize_=null;this.sliderInitialized_=!1;this.duration_=void 0!==e.duration?e.duration:200;var i=void 0!==e.className?e.className:"ol-zoomslider",r=document.createElement("button");r.setAttribute("type","button");r.className=i+"-thumb "+zo;var n=this.element;n.className=i+" "+zo+" "+Wo;n.appendChild(r);this.dragger_=new Bn(n);m(this.dragger_,on.POINTERDOWN,this.handleDraggerStart_,this);m(this.dragger_,on.POINTERMOVE,this.handleDraggerDrag_,this);m(this.dragger_,on.POINTERUP,this.handleDraggerEnd_,this);m(n,C.CLICK,this.handleContainerClick_,this);m(r,C.CLICK,x)}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.disposeInternal=function(){this.dragger_.dispose();o.prototype.disposeInternal.call(this)};t.prototype.setMap=function(t){o.prototype.setMap.call(this,t);t&&t.render()};t.prototype.initSlider_=function(){var t=this.element,e=t.offsetWidth,i=t.offsetHeight,r=t.firstElementChild,n=getComputedStyle(r),o=r.offsetWidth+parseFloat(n.marginRight)+parseFloat(n.marginLeft),s=r.offsetHeight+parseFloat(n.marginTop)+parseFloat(n.marginBottom);this.thumbSize_=[o,s];if(i<e){this.direction_=Gu;this.widthLimit_=e-o}else{this.direction_=Au;this.heightLimit_=i-s}this.sliderInitialized_=!0};t.prototype.handleContainerClick_=function(t){var e=this.getMap().getView(),i=this.getRelativePosition_(t.offsetX-this.thumbSize_[0]/2,t.offsetY-this.thumbSize_[1]/2),r=this.getResolutionForPosition_(i);e.animate({resolution:e.constrainResolution(r),duration:this.duration_,easing:Ur})};t.prototype.handleDraggerStart_=function(t){if(!this.dragging_&&t.originalEvent.target===this.element.firstElementChild){this.getMap().getView().setHint(so.INTERACTING,1);this.previousX_=t.clientX;this.previousY_=t.clientY;this.dragging_=!0;if(0===this.dragListenerKeys_.length){var e=this.handleDraggerDrag_,i=this.handleDraggerEnd_;this.dragListenerKeys_.push(m(document,C.MOUSEMOVE,e,this),m(document,on.POINTERMOVE,e,this),m(document,C.MOUSEUP,i,this),m(document,on.POINTERUP,i,this))}}};t.prototype.handleDraggerDrag_=function(t){if(this.dragging_){var e=this.element.firstElementChild,i=t.clientX-this.previousX_+parseFloat(e.style.left),r=t.clientY-this.previousY_+parseFloat(e.style.top),n=this.getRelativePosition_(i,r);this.currentResolution_=this.getResolutionForPosition_(n);this.getMap().getView().setResolution(this.currentResolution_);this.setThumbPosition_(this.currentResolution_);this.previousX_=t.clientX;this.previousY_=t.clientY}};t.prototype.handleDraggerEnd_=function(t){if(this.dragging_){var e=this.getMap().getView();e.setHint(so.INTERACTING,-1);e.animate({resolution:e.constrainResolution(this.currentResolution_),duration:this.duration_,easing:Ur});this.dragging_=!1;this.previousX_=void 0;this.previousY_=void 0;this.dragListenerKeys_.forEach(g);this.dragListenerKeys_.length=0}};t.prototype.setThumbPosition_=function(t){var e=this.getPositionForResolution_(t),i=this.element.firstElementChild;this.direction_==Gu?i.style.left=this.widthLimit_*e+"px":i.style.top=this.heightLimit_*e+"px"};t.prototype.getRelativePosition_=function(t,e){return zt(this.direction_===Gu?t/this.widthLimit_:e/this.heightLimit_,0,1)};t.prototype.getResolutionForPosition_=function(t){return this.getMap().getView().getResolutionForValueFunction()(1-t)};t.prototype.getPositionForResolution_=function(t){return 1-this.getMap().getView().getValueForResolutionFunction()(t)};return t}(Yo);function ku(t){if(t.frameState){this.sliderInitialized_||this.initSlider_();var e=t.frameState.viewState.resolution;if(e!==this.currentResolution_){this.currentResolution_=e;this.setThumbPosition_(e)}}}var ju=function(h){function t(t){var e=t||{};h.call(this,{element:document.createElement("div"),target:e.target});this.extent=e.extent?e.extent:null;var i=void 0!==e.className?e.className:"ol-zoom-extent",r=void 0!==e.label?e.label:"E",n=void 0!==e.tipLabel?e.tipLabel:"Fit to extent",o=document.createElement("button");o.setAttribute("type","button");o.title=n;o.appendChild("string"==typeof r?document.createTextNode(r):r);m(o,C.CLICK,this.handleClick_,this);var s=i+" "+zo+" "+Wo,a=this.element;a.className=s;a.appendChild(o)}h&&(t.__proto__=h);((t.prototype=Object.create(h&&h.prototype)).constructor=t).prototype.handleClick_=function(t){t.preventDefault();this.handleZoomToExtent()};t.prototype.handleZoomToExtent=function(){var t=this.getMap().getView(),e=this.extent?this.extent:t.getProjection().getExtent();t.fit(e)};return t}(Yo),Uu=function(){this.dataProjection=null;this.defaultFeatureProjection=null};Uu.prototype.getReadOptions=function(t,e){var i;e&&(i={dataProjection:e.dataProjection?e.dataProjection:this.readProjection(t),featureProjection:e.featureProjection});return this.adaptOptions(i)};Uu.prototype.adaptOptions=function(t){return y({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)};Uu.prototype.getLastExtent=function(){return null};Uu.prototype.getType=function(){return o()};Uu.prototype.readFeature=function(t,e){return o()};Uu.prototype.readFeatures=function(t,e){return o()};Uu.prototype.readGeometry=function(t,e){return o()};Uu.prototype.readProjection=function(t){return o()};Uu.prototype.writeFeature=function(t,e){return o()};Uu.prototype.writeFeatures=function(t,e){return o()};Uu.prototype.writeGeometry=function(t,e){return o()};function Yu(t,e,i){var r,n=i?be(i.featureProjection):null,o=i?be(i.dataProjection):null;r=n&&o&&!ke(n,o)?Array.isArray(t)?Xe(t,o,n):(e?t.clone():t).transform(e?n:o,e?o:n):t;if(e&&i&&void 0!==i.decimals&&!Array.isArray(r)){var s=Math.pow(10,i.decimals);r===t&&(r=t.clone());r.applyTransform(function(t){for(var e=0,i=t.length;e<i;++e)t[e]=Math.round(t[e]*s)/s;return t})}return r}var Xu=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return nl.JSON};e.prototype.readFeature=function(t,e){return this.readFeatureFromObject(Bu(t),this.getReadOptions(t,e))};e.prototype.readFeatures=function(t,e){return this.readFeaturesFromObject(Bu(t),this.getReadOptions(t,e))};e.prototype.readFeatureFromObject=function(t,e){return o()};e.prototype.readFeaturesFromObject=function(t,e){return o()};e.prototype.readGeometry=function(t,e){return this.readGeometryFromObject(Bu(t),this.getReadOptions(t,e))};e.prototype.readGeometryFromObject=function(t,e){return o()};e.prototype.readProjection=function(t){return this.readProjectionFromObject(Bu(t))};e.prototype.readProjectionFromObject=function(t){return o()};e.prototype.writeFeature=function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))};e.prototype.writeFeatureObject=function(t,e){return o()};e.prototype.writeFeatures=function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))};e.prototype.writeFeaturesObject=function(t,e){return o()};e.prototype.writeGeometry=function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))};e.prototype.writeGeometryObject=function(t,e){return o()};return e}(Uu);function Bu(t){if("string"!=typeof t)return null!==t?t:null;var e=JSON.parse(t);return e||null}var zu={};zu[jt.POINT]=function(t){var e;e=void 0!==t.m&&void 0!==t.z?new Ai([t.x,t.y,t.z,t.m],kt.XYZM):void 0!==t.z?new Ai([t.x,t.y,t.z],kt.XYZ):void 0!==t.m?new Ai([t.x,t.y,t.m],kt.XYM):new Ai([t.x,t.y]);return e};zu[jt.LINE_STRING]=function(t){var e=Hu(t);return new na(t.paths[0],e)};zu[jt.POLYGON]=function(t){var e=Hu(t);return new tr(t.rings,e)};zu[jt.MULTI_POINT]=function(t){var e=Hu(t);return new sa(t.points,e)};zu[jt.MULTI_LINE_STRING]=function(t){var e=Hu(t);return new oa(t.paths,e)};zu[jt.MULTI_POLYGON]=function(t){var e=Hu(t);return new ha(t.rings,e)};var Vu={};Vu[jt.POINT]=function(t,e){var i,r=t.getCoordinates(),n=t.getLayout();n===kt.XYZ?i={x:r[0],y:r[1],z:r[2]}:n===kt.XYM?i={x:r[0],y:r[1],m:r[2]}:n===kt.XYZM?i={x:r[0],y:r[1],z:r[2],m:r[3]}:n===kt.XY?i={x:r[0],y:r[1]}:A(!1,34);return i};Vu[jt.LINE_STRING]=function(t,e){var i=t,r=Zu(i);return{hasZ:r.hasZ,hasM:r.hasM,paths:[i.getCoordinates()]}};Vu[jt.POLYGON]=function(t,e){var i=t,r=Zu(i);return{hasZ:r.hasZ,hasM:r.hasM,rings:i.getCoordinates(!1)}};Vu[jt.MULTI_POINT]=function(t,e){var i=t,r=Zu(i);return{hasZ:r.hasZ,hasM:r.hasM,points:i.getCoordinates()}};Vu[jt.MULTI_LINE_STRING]=function(t,e){var i=t,r=Zu(i);return{hasZ:r.hasZ,hasM:r.hasM,paths:i.getCoordinates()}};Vu[jt.MULTI_POLYGON]=function(t,e){for(var i=Zu(t),r=t.getCoordinates(!1),n=[],o=0;o<r.length;o++)for(var s=r[o].length-1;0<=s;s--)n.push(r[o][s]);return{hasZ:i.hasZ,hasM:i.hasM,rings:n}};var Wu=function(i){function t(t){var e=t||{};i.call(this);this.geometryName_=e.geometryName}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromObject=function(t,e){var i=t,r=Ku(i.geometry,e),n=new G;this.geometryName_&&n.setGeometryName(this.geometryName_);n.setGeometry(r);e&&e.idField&&i.attributes[e.idField]&&n.setId(i.attributes[e.idField]);i.attributes&&n.setProperties(i.attributes);return n};t.prototype.readFeaturesFromObject=function(t,e){var i=e||{};if(t.features){var r=[],n=t.features;i.idField=t.objectIdFieldName;for(var o=0,s=n.length;o<s;++o)r.push(this.readFeatureFromObject(n[o],i));return r}return[this.readFeatureFromObject(t,i)]};t.prototype.readGeometryFromObject=function(t,e){return Ku(t,e)};t.prototype.readProjectionFromObject=function(t){if(t.spatialReference&&void 0!==t.spatialReference.wkid){return be("EPSG:"+t.spatialReference.wkid)}return null};t.prototype.writeGeometryObject=function(t,e){return qu(t,this.adaptOptions(e))};t.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={},r=t.getGeometry();if(r){i.geometry=qu(r,e);e&&e.featureProjection&&(i.geometry.spatialReference={wkid:Number(be(e.featureProjection).getCode().split(":").pop())})}var n=t.getProperties();delete n[t.getGeometryName()];Mt(n)?i.attributes={}:i.attributes=n;return i};t.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{features:i}};return t}(Xu);function Ku(t,e){if(!t)return null;var i;if("number"==typeof t.x&&"number"==typeof t.y)i=jt.POINT;else if(t.points)i=jt.MULTI_POINT;else if(t.paths){i=1===t.paths.length?jt.LINE_STRING:jt.MULTI_LINE_STRING}else if(t.rings){var r=t,n=Hu(r),o=function(t,e){var i,r,n=[],o=[],s=[];for(i=0,r=t.length;i<r;++i){n.length=0;Ti(n,0,t[i],e.length);var a=Zi(n,0,n.length,e.length);a?o.push([t[i]]):s.push(t[i])}for(;s.length;){var h=s.shift(),l=!1;for(i=o.length-1;0<=i;i--){var u=o[i][0],c=et(new Ni(u).getExtent(),new Ni(h).getExtent());if(c){o[i].push(h);l=!0;break}}l||o.push([h.reverse()])}return o}(r.rings,n);if(1===o.length){i=jt.POLYGON;t.rings=o[0]}else{i=jt.MULTI_POLYGON;t.rings=o}}return Yu((0,zu[i])(t),!1,e)}function Hu(t){var e=kt.XY;!0===t.hasZ&&!0===t.hasM?e=kt.XYZM:!0===t.hasZ?e=kt.XYZ:!0===t.hasM&&(e=kt.XYM);return e}function Zu(t){var e=t.getLayout();return{hasZ:e===kt.XYZ||e===kt.XYZM,hasM:e===kt.XYM||e===kt.XYZM}}function qu(t,e){return(0,Vu[t.getType()])(Yu(t,!0,e),e)}var Ju=document.implementation.createDocument("","",null),Qu="http://www.w3.org/2001/XMLSchema-instance";function $u(t,e){return Ju.createElementNS(t,e)}function tc(t,e){return ec(t,e,[]).join("")}function ec(t,e,i){if(t.nodeType==Node.CDATA_SECTION_NODE||t.nodeType==Node.TEXT_NODE)e?i.push(String(t.nodeValue).replace(/(\r\n|\r|\n)/g,"")):i.push(t.nodeValue);else{var r;for(r=t.firstChild;r;r=r.nextSibling)ec(r,e,i)}return i}function ic(t){return"documentElement"in t}function rc(t,e,i){return t.getAttributeNS(e,i)||""}function nc(t){return(new DOMParser).parseFromString(t,"application/xml")}function oc(r,n){return function(t,e){var i=r.call(void 0!==n?n:this,t,e);if(void 0!==i){B(e[e.length-1],i)}}}function sc(r,n){return function(t,e){var i=r.call(void 0!==n?n:this,t,e);if(void 0!==i){e[e.length-1].push(i)}}}function ac(r,n){return function(t,e){var i=r.call(void 0!==n?n:this,t,e);void 0!==i&&(e[e.length-1]=i)}}function hc(o,s,a){return function(t,e){var i=o.call(void 0!==a?a:this,t,e);if(void 0!==i){var r=e[e.length-1],n=void 0!==s?s:t.localName;(n in r?r[n]:r[n]=[]).push(i)}}}function lc(r,n,o){return function(t,e){var i=r.call(void 0!==o?o:this,t,e);if(void 0!==i){e[e.length-1][void 0!==n?n:t.localName]=i}}}function uc(r,n){return function(t,e,i){r.call(void 0!==n?n:this,t,e,i);i[i.length-1].node.appendChild(t)}}function cc(n,t){var o,s;return function(t,e,i){if(void 0===o){o={};var r={};r[t.localName]=n;o[t.namespaceURI]=r;s=pc(t.localName)}mc(o,s,e,i)}}function pc(t,o){var s=t;return function(t,e,i){var r=e[e.length-1].node,n=s;void 0===n&&(n=i);return $u(void 0!==o?o:r.namespaceURI,n)}}var dc=pc();function fc(t,e){for(var i=e.length,r=new Array(i),n=0;n<i;++n)r[n]=t[e[n]];return r}function _c(t,e,i){var r,n,o=void 0!==i?i:{};for(r=0,n=t.length;r<n;++r)o[t[r]]=e;return o}function gc(t,e,i,r){var n;for(n=e.firstElementChild;n;n=n.nextElementSibling){var o=t[n.namespaceURI];if(void 0!==o){var s=o[n.localName];void 0!==s&&s.call(r,n,i)}}}function yc(t,e,i,r,n){r.push(t);gc(e,i,r,n);return r.pop()}function mc(t,e,i,r,n,o){for(var s,a,h=(void 0!==n?n:i).length,l=0;l<h;++l)void 0!==(s=i[l])&&void 0!==(a=e.call(void 0!==o?o:this,s,r,void 0!==n?n[l]:void 0))&&t[a.namespaceURI][a.localName].call(o,a,s,r)}function vc(t,e,i,r,n,o,s){n.push(t);mc(e,i,r,n,o,s);return n.pop()}var Ec=function(t){function e(){t.call(this);this.xmlSerializer_=new XMLSerializer}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return nl.XML};e.prototype.readFeature=function(t,e){if(t){if("string"!=typeof t)return ic(t)?this.readFeatureFromDocument(t,e):this.readFeatureFromNode(t,e);var i=nc(t);return this.readFeatureFromDocument(i,e)}return null};e.prototype.readFeatureFromDocument=function(t,e){var i=this.readFeaturesFromDocument(t,e);return 0<i.length?i[0]:null};e.prototype.readFeatureFromNode=function(t,e){return null};e.prototype.readFeatures=function(t,e){if(t){if("string"!=typeof t)return ic(t)?this.readFeaturesFromDocument(t,e):this.readFeaturesFromNode(t,e);var i=nc(t);return this.readFeaturesFromDocument(i,e)}return[]};e.prototype.readFeaturesFromDocument=function(t,e){for(var i=[],r=t.firstChild;r;r=r.nextSibling)r.nodeType==Node.ELEMENT_NODE&&B(i,this.readFeaturesFromNode(r,e));return i};e.prototype.readFeaturesFromNode=function(t,e){return o()};e.prototype.readGeometry=function(t,e){if(t){if("string"!=typeof t)return ic(t)?this.readGeometryFromDocument(t,e):this.readGeometryFromNode(t,e);var i=nc(t);return this.readGeometryFromDocument(i,e)}return null};e.prototype.readGeometryFromDocument=function(t,e){return null};e.prototype.readGeometryFromNode=function(t,e){return null};e.prototype.readProjection=function(t){if(t){if("string"!=typeof t)return ic(t)?this.readProjectionFromDocument(t):this.readProjectionFromNode(t);var e=nc(t);return this.readProjectionFromDocument(e)}return null};e.prototype.readProjectionFromDocument=function(t){return this.dataProjection};e.prototype.readProjectionFromNode=function(t){return this.dataProjection};e.prototype.writeFeature=function(t,e){var i=this.writeFeatureNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeFeatureNode=function(t,e){return null};e.prototype.writeFeatures=function(t,e){var i=this.writeFeaturesNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeFeaturesNode=function(t,e){return null};e.prototype.writeGeometry=function(t,e){var i=this.writeGeometryNode(t,e);return this.xmlSerializer_.serializeToString(i)};e.prototype.writeGeometryNode=function(t,e){return null};return e}(Uu),Tc="http://www.opengis.net/gml",Sc=/^[\s\xa0]*$/,xc=function(i){function t(t){i.call(this);var e=t||{};this.featureType=e.featureType;this.featureNS=e.featureNS;this.srsName=e.srsName;this.schemaLocation="";this.FEATURE_COLLECTION_PARSERS={};this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:sc(this.readFeaturesInternal),featureMembers:ac(this.readFeaturesInternal)}}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeaturesInternal=function(t,e){var i=t.localName,r=null;if("FeatureCollection"==i)r=yc([],this.FEATURE_COLLECTION_PARSERS,t,e,this);else if("featureMembers"==i||"featureMember"==i){var n=e[0],o=n.featureType,s=n.featureNS;if(!o&&t.childNodes){o=[],s={};for(var a=0,h=t.childNodes.length;a<h;++a){var l=t.childNodes[a];if(1===l.nodeType){var u=l.nodeName.split(":").pop();if(-1===o.indexOf(u)){var c="",p=0,d=l.namespaceURI;for(var f in s){if(s[f]===d){c=f;break}++p}c||(s[c="p"+p]=d);o.push(c+":"+u)}}}if("featureMember"!=i){n.featureType=o;n.featureNS=s}}if("string"==typeof s){var _=s;(s={}).p0=_}var g={},y=Array.isArray(o)?o:[o];for(var m in s){for(var v={},E=0,T=y.length;E<T;++E){(-1===y[E].indexOf(":")?"p0":y[E].split(":")[0])===m&&(v[y[E].split(":").pop()]="featureMembers"==i?sc(this.readFeatureElement,this):ac(this.readFeatureElement,this))}g[s[m]]=v}r=yc("featureMember"==i?void 0:[],g,t,e)}null===r&&(r=[]);return r};t.prototype.readGeometryElement=function(t,e){var i=e[0];i.srsName=t.firstElementChild.getAttribute("srsName");i.srsDimension=t.firstElementChild.getAttribute("srsDimension");var r=yc(null,this.GEOMETRY_PARSERS,t,e,this);return r?Yu(r,!1,i):void 0};t.prototype.readFeatureElementInternal=function(t,e,i){for(var r,n={},o=t.firstElementChild;o;o=o.nextElementSibling){var s=void 0,a=o.localName;if(0===o.childNodes.length||1===o.childNodes.length&&(3===o.firstChild.nodeType||4===o.firstChild.nodeType)){s=tc(o,!1);Sc.test(s)&&(s=void 0)}else{i&&(s=this.readGeometryElement(o,e));s?"boundedBy"!==a&&(r=a):s=this.readFeatureElementInternal(o,e,!1)}if(n[a]){n[a]instanceof Array||(n[a]=[n[a]]);n[a].push(s)}else n[a]=s;var h=o.attributes.length;if(0<h){n[a]={_content_:n[a]};for(var l=0;l<h;l++){var u=o.attributes[l].name;n[a][u]=o.attributes[l].value}}}if(i){var c=new G(n);r&&c.setGeometryName(r);var p=t.getAttribute("fid")||rc(t,this.namespace,"id");p&&c.setId(p);return c}return n};t.prototype.readFeatureElement=function(t,e){return this.readFeatureElementInternal(t,e,!0)};t.prototype.readPoint=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i)return new Ai(i,kt.XYZ)};t.prototype.readMultiPoint=function(t,e){var i=yc([],this.MULTIPOINT_PARSERS_,t,e,this);return i?new sa(i):void 0};t.prototype.readMultiLineString=function(t,e){var i=yc([],this.MULTILINESTRING_PARSERS_,t,e,this);if(i)return new oa(i)};t.prototype.readMultiPolygon=function(t,e){var i=yc([],this.MULTIPOLYGON_PARSERS_,t,e,this);if(i)return new ha(i)};t.prototype.pointMemberParser_=function(t,e){gc(this.POINTMEMBER_PARSERS_,t,e,this)};t.prototype.lineStringMemberParser_=function(t,e){gc(this.LINESTRINGMEMBER_PARSERS_,t,e,this)};t.prototype.polygonMemberParser_=function(t,e){gc(this.POLYGONMEMBER_PARSERS_,t,e,this)};t.prototype.readLineString=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i){return new na(i,kt.XYZ)}};t.prototype.readFlatLinearRing_=function(t,e){var i=yc(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this);return i||void 0};t.prototype.readLinearRing=function(t,e){var i=this.readFlatCoordinatesFromNode_(t,e);if(i)return new Ni(i,kt.XYZ)};t.prototype.readPolygon=function(t,e){var i=yc([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this);if(i&&i[0]){var r,n,o=i[0],s=[o.length];for(r=1,n=i.length;r<n;++r){B(o,i[r]);s.push(o.length)}return new tr(o,kt.XYZ,s)}};t.prototype.readFlatCoordinatesFromNode_=function(t,e){return yc(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)};t.prototype.readGeometryFromNode=function(t,e){var i=this.readGeometryElement(t,[this.getReadOptions(t,e||{})]);return i||null};t.prototype.readFeaturesFromNode=function(t,e){var i={featureType:this.featureType,featureNS:this.featureNS};e&&y(i,this.getReadOptions(t,e));return this.readFeaturesInternal(t,[i])||[]};t.prototype.readProjectionFromNode=function(t){return be(this.srsName?this.srsName:t.firstElementChild.getAttribute("srsName"))};return t}(Ec);xc.prototype.namespace=Tc;xc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};xc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};xc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};xc.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml":{pointMember:sc(xc.prototype.pointMemberParser_),pointMembers:sc(xc.prototype.pointMemberParser_)}};xc.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml":{lineStringMember:sc(xc.prototype.lineStringMemberParser_),lineStringMembers:sc(xc.prototype.lineStringMemberParser_)}};xc.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml":{polygonMember:sc(xc.prototype.polygonMemberParser_),polygonMembers:sc(xc.prototype.polygonMemberParser_)}};xc.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml":{Point:sc(xc.prototype.readFlatCoordinatesFromNode_)}};xc.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:sc(xc.prototype.readLineString)}};xc.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:sc(xc.prototype.readPolygon)}};xc.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:ac(xc.prototype.readFlatLinearRing_)}};function Rc(t){return Cc(tc(t,!1))}function Cc(t){var e=/^\s*(true|1)|(false|0)\s*$/.exec(t);return e?void 0!==e[1]||!1:void 0}function wc(t){var e=tc(t,!1),i=Date.parse(e);return isNaN(i)?void 0:i/1e3}function Ic(t){return Lc(tc(t,!1))}function Lc(t){var e=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*$/i.exec(t);return e?parseFloat(e[1]):void 0}function Oc(t){return Pc(tc(t,!1))}function Pc(t){var e=/^\s*(\d+)\s*$/.exec(t);return e?parseInt(e[1],10):void 0}function bc(t){return tc(t,!1).trim()}function Mc(t,e){Dc(t,e?"1":"0")}function Fc(t,e){t.appendChild(Ju.createCDATASection(e))}function Nc(t,e){var i=new Date(1e3*e),r=i.getUTCFullYear()+"-"+ho(i.getUTCMonth()+1,2)+"-"+ho(i.getUTCDate(),2)+"T"+ho(i.getUTCHours(),2)+":"+ho(i.getUTCMinutes(),2)+":"+ho(i.getUTCSeconds(),2)+"Z";t.appendChild(Ju.createTextNode(r))}function Ac(t,e){var i=e.toPrecision();t.appendChild(Ju.createTextNode(i))}function Gc(t,e){var i=e.toString();t.appendChild(Ju.createTextNode(i))}function Dc(t,e){t.appendChild(Ju.createTextNode(e))}var kc=Tc+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",jc={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},Uc=function(i){function t(t){var e=t||{};i.call(this,e);this.surface_=void 0!==e.surface&&e.surface;this.curve_=void 0!==e.curve&&e.curve;this.multiCurve_=void 0===e.multiCurve||e.multiCurve;this.multiSurface_=void 0===e.multiSurface||e.multiSurface;this.schemaLocation=e.schemaLocation?e.schemaLocation:kc;this.hasZ=void 0!==e.hasZ&&e.hasZ}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readMultiCurve_=function(t,e){var i=yc([],this.MULTICURVE_PARSERS_,t,e,this);if(i){return new oa(i)}};t.prototype.readMultiSurface_=function(t,e){var i=yc([],this.MULTISURFACE_PARSERS_,t,e,this);if(i)return new ha(i)};t.prototype.curveMemberParser_=function(t,e){gc(this.CURVEMEMBER_PARSERS_,t,e,this)};t.prototype.surfaceMemberParser_=function(t,e){gc(this.SURFACEMEMBER_PARSERS_,t,e,this)};t.prototype.readPatch_=function(t,e){return yc([null],this.PATCHES_PARSERS_,t,e,this)};t.prototype.readSegment_=function(t,e){return yc([null],this.SEGMENTS_PARSERS_,t,e,this)};t.prototype.readPolygonPatch_=function(t,e){return yc([null],this.FLAT_LINEAR_RINGS_PARSERS,t,e,this)};t.prototype.readLineStringSegment_=function(t,e){return yc([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,t,e,this)};t.prototype.interiorParser_=function(t,e){var i=yc(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1].push(i)}};t.prototype.exteriorParser_=function(t,e){var i=yc(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1][0]=i}};t.prototype.readSurface_=function(t,e){var i=yc([null],this.SURFACE_PARSERS_,t,e,this);if(i&&i[0]){var r,n,o=i[0],s=[o.length];for(r=1,n=i.length;r<n;++r){B(o,i[r]);s.push(o.length)}return new tr(o,kt.XYZ,s)}};t.prototype.readCurve_=function(t,e){var i=yc([null],this.CURVE_PARSERS_,t,e,this);if(i){return new na(i,kt.XYZ)}};t.prototype.readEnvelope_=function(t,e){var i=yc([null],this.ENVELOPE_PARSERS_,t,e,this);return ot(i[1][0],i[1][1],i[2][0],i[2][1])};t.prototype.readFlatPos_=function(t,e){for(var i,r=tc(t,!1),n=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,o=[];i=n.exec(r);){o.push(parseFloat(i[1]));r=r.substr(i[0].length)}if(""===r){var s=e[0].srsName,a="enu";if(s){a=be(s).getAxisOrientation()}if("neu"===a){var h,l;for(h=0,l=o.length;h<l;h+=3){var u=o[h],c=o[h+1];o[h]=c;o[h+1]=u}}var p=o.length;2==p&&o.push(0);if(0!==p)return o}};t.prototype.readFlatPosList_=function(t,e){var i=tc(t,!1).replace(/^\s*|\s*$/g,""),r=e[0],n=r.srsName,o=r.srsDimension,s="enu";if(n){s=be(n).getAxisOrientation()}var a,h,l,u=i.split(/\s+/),c=2;t.getAttribute("srsDimension")?c=Pc(t.getAttribute("srsDimension")):t.getAttribute("dimension")?c=Pc(t.getAttribute("dimension")):t.parentNode.getAttribute("srsDimension")?c=Pc(t.parentNode.getAttribute("srsDimension")):o&&(c=Pc(o));for(var p=[],d=0,f=u.length;d<f;d+=c){a=parseFloat(u[d]);h=parseFloat(u[d+1]);l=3===c?parseFloat(u[d+2]):0;"en"===s.substr(0,2)?p.push(a,h,l):p.push(h,a,l)}return p};t.prototype.writePos_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=n?"3":"2";t.setAttribute("srsDimension",o);var s=r.srsName,a="enu";s&&(a=be(s).getAxisOrientation());var h,l=e.getCoordinates();h="en"===a.substr(0,2)?l[0]+" "+l[1]:l[1]+" "+l[0];if(n){h+=" "+(l[2]||0)}Dc(t,h)};t.prototype.getCoords_=function(t,e,i){var r="enu";e&&(r=be(e).getAxisOrientation());var n="en"===r.substr(0,2)?t[0]+" "+t[1]:t[1]+" "+t[0];if(i){n+=" "+(t[2]||0)}return n};t.prototype.writePosList_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=n?"3":"2";t.setAttribute("srsDimension",o);for(var s,a=r.srsName,h=e.getCoordinates(),l=h.length,u=new Array(l),c=0;c<l;++c){s=h[c];u[c]=this.getCoords_(s,a,n)}Dc(t,u.join(" "))};t.prototype.writePoint_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var n=$u(t.namespaceURI,"pos");t.appendChild(n);this.writePos_(n,e,i)};t.prototype.writeEnvelope=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var n=[e[0]+" "+e[1],e[2]+" "+e[3]];vc({node:t},this.ENVELOPE_SERIALIZERS_,dc,n,i,["lowerCorner","upperCorner"],this)};t.prototype.writeLinearRing_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var n=$u(t.namespaceURI,"posList");t.appendChild(n);this.writePosList_(n,e,i)};t.prototype.RING_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1],n=r.node,o=r.exteriorWritten;void 0===o&&(r.exteriorWritten=!0);return $u(n.namespaceURI,void 0!==o?"interior":"exterior")};t.prototype.writeSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName;"PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o);if("Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var s=e.getLinearRings();vc({node:t,hasZ:n,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,s,i,void 0,this)}else if("Surface"===t.nodeName){var a=$u(t.namespaceURI,"patches");t.appendChild(a);this.writeSurfacePatches_(a,e,i)}};t.prototype.writeCurveOrLineString_=function(t,e,i){var r=i[i.length-1].srsName;"LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r);if("LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var n=$u(t.namespaceURI,"posList");t.appendChild(n);this.writePosList_(n,e,i)}else if("Curve"===t.nodeName){var o=$u(t.namespaceURI,"segments");t.appendChild(o);this.writeCurveSegments_(o,e,i)}};t.prototype.writeMultiSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName,s=r.surface;o&&t.setAttribute("srsName",o);var a=e.getPolygons();vc({node:t,hasZ:n,srsName:o,surface:s},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeMultiPoint_=function(t,e,i){var r=i[i.length-1],n=r.srsName,o=r.hasZ;n&&t.setAttribute("srsName",n);var s=e.getPoints();vc({node:t,hasZ:o,srsName:n},this.POINTMEMBER_SERIALIZERS_,pc("pointMember"),s,i,void 0,this)};t.prototype.writeMultiCurveOrLineString_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName,s=r.curve;o&&t.setAttribute("srsName",o);var a=e.getLineStrings();vc({node:t,hasZ:n,srsName:o,curve:s},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeRing_=function(t,e,i){var r=$u(t.namespaceURI,"LinearRing");t.appendChild(r);this.writeLinearRing_(r,e,i)};t.prototype.writeSurfaceOrPolygonMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)}};t.prototype.writePointMember_=function(t,e,i){var r=$u(t.namespaceURI,"Point");t.appendChild(r);this.writePoint_(r,e,i)};t.prototype.writeLineStringOrCurveMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeCurveOrLineString_(r,e,i)}};t.prototype.writeSurfacePatches_=function(t,e,i){var r=$u(t.namespaceURI,"PolygonPatch");t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)};t.prototype.writeCurveSegments_=function(t,e,i){var r=$u(t.namespaceURI,"LineStringSegment");t.appendChild(r);this.writeCurveOrLineString_(r,e,i)};t.prototype.writeGeometryElement=function(t,e,i){var r,n=i[i.length-1],o=y({},n);o.node=t;r=Array.isArray(e)?n.dataProjection?Xe(e,n.featureProjection,n.dataProjection):e:Yu(e,!0,n);vc(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)};t.prototype.writeFeatureElement=function(t,e,i){var r=e.getId();r&&t.setAttribute("fid",r);var n=i[i.length-1],o=n.featureNS,s=e.getGeometryName();if(!n.serializers){n.serializers={};n.serializers[o]={}}var a=e.getProperties(),h=[],l=[];for(var u in a){var c=a[u];if(null!==c){h.push(u);l.push(c);u==s||"function"==typeof c.getSimplifiedGeometry?u in n.serializers[o]||(n.serializers[o][u]=uc(this.writeGeometryElement,this)):u in n.serializers[o]||(n.serializers[o][u]=uc(Dc))}}var p=y({},n);p.node=t;vc(p,n.serializers,pc(void 0,o),l,i,h)};t.prototype.writeFeatureMembers_=function(t,e,i){var r=i[i.length-1],n=r.featureType,o=r.featureNS,s={};s[o]={};s[o][n]=uc(this.writeFeatureElement,this);var a=y({},r);a.node=t;vc(a,s,pc(n,o),e,i)};t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1].node;return $u(this.namespace,jc[r.nodeName])};t.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,i){var r,n=e[e.length-1],o=n.multiSurface,s=n.surface,a=n.curve,h=n.multiCurve;Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===o?r="MultiSurface":"Polygon"===r&&!0===s?r="Surface":"LineString"===r&&!0===a?r="Curve":"MultiLineString"===r&&!0===h&&(r="MultiCurve");return $u(this.namespace,r)};t.prototype.writeGeometryNode=function(t,e){e=this.adaptOptions(e);var i=$u(this.namespace,"geom"),r={node:i,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};e&&y(r,e);this.writeGeometryElement(i,t,[r]);return i};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=$u(this.namespace,"featureMembers");i.setAttributeNS(Qu,"xsi:schemaLocation",this.schemaLocation);var r={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};e&&y(r,e);this.writeFeatureMembers_(i,t,[r]);return i};return t}(xc);Uc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:ac(Uc.prototype.readFlatPos_),posList:ac(Uc.prototype.readFlatPosList_)}};Uc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:Uc.prototype.interiorParser_,exterior:Uc.prototype.exteriorParser_}};Uc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ac(xc.prototype.readPoint),MultiPoint:ac(xc.prototype.readMultiPoint),LineString:ac(xc.prototype.readLineString),MultiLineString:ac(xc.prototype.readMultiLineString),LinearRing:ac(xc.prototype.readLinearRing),Polygon:ac(xc.prototype.readPolygon),MultiPolygon:ac(xc.prototype.readMultiPolygon),Surface:ac(Uc.prototype.readSurface_),MultiSurface:ac(Uc.prototype.readMultiSurface_),Curve:ac(Uc.prototype.readCurve_),MultiCurve:ac(Uc.prototype.readMultiCurve_),Envelope:ac(Uc.prototype.readEnvelope_)}};Uc.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml":{curveMember:sc(Uc.prototype.curveMemberParser_),curveMembers:sc(Uc.prototype.curveMemberParser_)}};Uc.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml":{surfaceMember:sc(Uc.prototype.surfaceMemberParser_),surfaceMembers:sc(Uc.prototype.surfaceMemberParser_)}};Uc.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml":{LineString:sc(xc.prototype.readLineString),Curve:sc(Uc.prototype.readCurve_)}};Uc.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml":{Polygon:sc(xc.prototype.readPolygon),Surface:sc(Uc.prototype.readSurface_)}};Uc.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml":{patches:ac(Uc.prototype.readPatch_)}};Uc.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml":{segments:ac(Uc.prototype.readSegment_)}};Uc.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml":{lowerCorner:sc(Uc.prototype.readFlatPosList_),upperCorner:sc(Uc.prototype.readFlatPosList_)}};Uc.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml":{PolygonPatch:ac(Uc.prototype.readPolygonPatch_)}};Uc.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml":{LineStringSegment:ac(Uc.prototype.readLineStringSegment_)}};Uc.prototype.writeFeatures;Uc.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{exterior:uc(Uc.prototype.writeRing_),interior:uc(Uc.prototype.writeRing_)}};Uc.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:uc(Dc),upperCorner:uc(Dc)}};Uc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:uc(Uc.prototype.writeSurfaceOrPolygonMember_),polygonMember:uc(Uc.prototype.writeSurfaceOrPolygonMember_)}};Uc.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:uc(Uc.prototype.writePointMember_)}};Uc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:uc(Uc.prototype.writeLineStringOrCurveMember_),curveMember:uc(Uc.prototype.writeLineStringOrCurveMember_)}};Uc.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:uc(Uc.prototype.writeCurveOrLineString_),MultiCurve:uc(Uc.prototype.writeMultiCurveOrLineString_),Point:uc(Uc.prototype.writePoint_),MultiPoint:uc(Uc.prototype.writeMultiPoint_),LineString:uc(Uc.prototype.writeCurveOrLineString_),MultiLineString:uc(Uc.prototype.writeMultiCurveOrLineString_),LinearRing:uc(Uc.prototype.writeLinearRing_),Polygon:uc(Uc.prototype.writeSurfaceOrPolygon_),MultiPolygon:uc(Uc.prototype.writeMultiSurfaceOrPolygon_),Surface:uc(Uc.prototype.writeSurfaceOrPolygon_),MultiSurface:uc(Uc.prototype.writeMultiSurfaceOrPolygon_),Envelope:uc(Uc.prototype.writeEnvelope)}};var Yc=Uc;Yc.prototype.writeFeatures;Yc.prototype.writeFeaturesNode;var Xc=Tc+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Bc={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"},zc=function(i){function t(t){var e=t||{};i.call(this,e);this.FEATURE_COLLECTION_PARSERS[Tc].featureMember=sc(this.readFeaturesInternal);this.schemaLocation=e.schemaLocation?e.schemaLocation:Xc}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFlatCoordinates_=function(t,e){var i=tc(t,!1).replace(/^\s*|\s*$/g,""),r=e[0].srsName,n="enu";if(r){var o=be(r);o&&(n=o.getAxisOrientation())}for(var s=i.trim().split(/\s+/),a=[],h=0,l=s.length;h<l;h++){var u=s[h].split(/,+/),c=parseFloat(u[0]),p=parseFloat(u[1]),d=3===u.length?parseFloat(u[2]):0;"en"===n.substr(0,2)?a.push(c,p,d):a.push(p,c,d)}return a};t.prototype.readBox_=function(t,e){var i=yc([null],this.BOX_PARSERS_,t,e,this);return ot(i[1][0],i[1][1],i[1][3],i[1][4])};t.prototype.innerBoundaryIsParser_=function(t,e){var i=yc(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1].push(i)}};t.prototype.outerBoundaryIsParser_=function(t,e){var i=yc(void 0,this.RING_PARSERS,t,e,this);if(i){e[e.length-1][0]=i}};t.prototype.GEOMETRY_NODE_FACTORY_=function(t,e,i){var r,n=e[e.length-1],o=n.multiSurface,s=n.surface,a=n.multiCurve;Array.isArray(t)?r="Envelope":"MultiPolygon"===(r=t.getType())&&!0===o?r="MultiSurface":"Polygon"===r&&!0===s?r="Surface":"MultiLineString"===r&&!0===a&&(r="MultiCurve");return $u("http://www.opengis.net/gml",r)};t.prototype.writeFeatureElement=function(t,e,i){var r=e.getId();r&&t.setAttribute("fid",r);var n=i[i.length-1],o=n.featureNS,s=e.getGeometryName();if(!n.serializers){n.serializers={};n.serializers[o]={}}var a=e.getProperties(),h=[],l=[];for(var u in a){var c=a[u];if(null!==c){h.push(u);l.push(c);u==s||"function"==typeof c.getSimplifiedGeometry?u in n.serializers[o]||(n.serializers[o][u]=uc(this.writeGeometryElement,this)):u in n.serializers[o]||(n.serializers[o][u]=uc(Dc))}}var p=y({},n);p.node=t;vc(p,n.serializers,pc(void 0,o),l,i,h)};t.prototype.writeCurveOrLineString_=function(t,e,i){var r=i[i.length-1].srsName;"LineStringSegment"!==t.nodeName&&r&&t.setAttribute("srsName",r);if("LineString"===t.nodeName||"LineStringSegment"===t.nodeName){var n=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(n);this.writeCoordinates_(n,e,i)}else if("Curve"===t.nodeName){var o=$u(t.namespaceURI,"segments");t.appendChild(o);this.writeCurveSegments_(o,e,i)}};t.prototype.writeLineStringOrCurveMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeCurveOrLineString_(r,e,i)}};t.prototype.writeMultiCurveOrLineString_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName,s=r.curve;o&&t.setAttribute("srsName",o);var a=e.getLineStrings();vc({node:t,hasZ:n,srsName:o,curve:s},this.LINESTRINGORCURVEMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeGeometryElement=function(t,e,i){var r,n=i[i.length-1],o=y({},n);o.node=t;r=Array.isArray(e)?n.dataProjection?Xe(e,n.featureProjection,n.dataProjection):e:Yu(e,!0,n);vc(o,this.GEOMETRY_SERIALIZERS_,this.GEOMETRY_NODE_FACTORY_,[r],i,void 0,this)};t.prototype.createCoordinatesNode_=function(t){var e=$u(t,"coordinates");e.setAttribute("decimal",".");e.setAttribute("cs",",");e.setAttribute("ts"," ");return e};t.prototype.writeCoordinates_=function(t,e,i){for(var r=i[i.length-1],n=r.hasZ,o=r.srsName,s=e.getCoordinates(),a=s.length,h=new Array(a),l=0;l<a;++l){var u=s[l];h[l]=this.getCoords_(u,o,n)}Dc(t,h.join(" "))};t.prototype.writeCurveSegments_=function(t,e,i){var r=$u(t.namespaceURI,"LineStringSegment");t.appendChild(r);this.writeCurveOrLineString_(r,e,i)};t.prototype.writeSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName;"PolygonPatch"!==t.nodeName&&o&&t.setAttribute("srsName",o);if("Polygon"===t.nodeName||"PolygonPatch"===t.nodeName){var s=e.getLinearRings();vc({node:t,hasZ:n,srsName:o},this.RING_SERIALIZERS_,this.RING_NODE_FACTORY_,s,i,void 0,this)}else if("Surface"===t.nodeName){var a=$u(t.namespaceURI,"patches");t.appendChild(a);this.writeSurfacePatches_(a,e,i)}};t.prototype.RING_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1],n=r.node,o=r.exteriorWritten;void 0===o&&(r.exteriorWritten=!0);return $u(n.namespaceURI,void 0!==o?"innerBoundaryIs":"outerBoundaryIs")};t.prototype.writeSurfacePatches_=function(t,e,i){var r=$u(t.namespaceURI,"PolygonPatch");t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)};t.prototype.writeRing_=function(t,e,i){var r=$u(t.namespaceURI,"LinearRing");t.appendChild(r);this.writeLinearRing_(r,e,i)};t.prototype.getCoords_=function(t,e,i){var r="enu";e&&(r=be(e).getAxisOrientation());var n="en"===r.substr(0,2)?t[0]+","+t[1]:t[1]+","+t[0];if(i){n+=","+(t[2]||0)}return n};t.prototype.writePoint_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);var s=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(s);var a=e.getCoordinates();Dc(s,this.getCoords_(a,o,n))};t.prototype.writeMultiPoint_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName;o&&t.setAttribute("srsName",o);var s=e.getPoints();vc({node:t,hasZ:n,srsName:o},this.POINTMEMBER_SERIALIZERS_,pc("pointMember"),s,i,void 0,this)};t.prototype.writePointMember_=function(t,e,i){var r=$u(t.namespaceURI,"Point");t.appendChild(r);this.writePoint_(r,e,i)};t.prototype.writeLinearRing_=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var n=this.createCoordinatesNode_(t.namespaceURI);t.appendChild(n);this.writeCoordinates_(n,e,i)};t.prototype.writeMultiSurfaceOrPolygon_=function(t,e,i){var r=i[i.length-1],n=r.hasZ,o=r.srsName,s=r.surface;o&&t.setAttribute("srsName",o);var a=e.getPolygons();vc({node:t,hasZ:n,srsName:o,surface:s},this.SURFACEORPOLYGONMEMBER_SERIALIZERS_,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,a,i,void 0,this)};t.prototype.writeSurfaceOrPolygonMember_=function(t,e,i){var r=this.GEOMETRY_NODE_FACTORY_(e,i);if(r){t.appendChild(r);this.writeSurfaceOrPolygon_(r,e,i)}};t.prototype.writeEnvelope=function(t,e,i){var r=i[i.length-1].srsName;r&&t.setAttribute("srsName",r);var n=[e[0]+" "+e[1],e[2]+" "+e[3]];vc({node:t},this.ENVELOPE_SERIALIZERS_,dc,n,i,["lowerCorner","upperCorner"],this)};t.prototype.MULTIGEOMETRY_MEMBER_NODE_FACTORY_=function(t,e,i){var r=e[e.length-1].node;return $u("http://www.opengis.net/gml",Bc[r.nodeName])};return t}(xc);zc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:ac(zc.prototype.readFlatCoordinates_)}};zc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:zc.prototype.innerBoundaryIsParser_,outerBoundaryIs:zc.prototype.outerBoundaryIsParser_}};zc.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:sc(zc.prototype.readFlatCoordinates_)}};zc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:ac(xc.prototype.readPoint),MultiPoint:ac(xc.prototype.readMultiPoint),LineString:ac(xc.prototype.readLineString),MultiLineString:ac(xc.prototype.readMultiLineString),LinearRing:ac(xc.prototype.readLinearRing),Polygon:ac(xc.prototype.readPolygon),MultiPolygon:ac(xc.prototype.readMultiPolygon),Box:ac(zc.prototype.readBox_)}};zc.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml":{Curve:uc(zc.prototype.writeCurveOrLineString_),MultiCurve:uc(zc.prototype.writeMultiCurveOrLineString_),Point:uc(zc.prototype.writePoint_),MultiPoint:uc(zc.prototype.writeMultiPoint_),LineString:uc(zc.prototype.writeCurveOrLineString_),MultiLineString:uc(zc.prototype.writeMultiCurveOrLineString_),LinearRing:uc(zc.prototype.writeLinearRing_),Polygon:uc(zc.prototype.writeSurfaceOrPolygon_),MultiPolygon:uc(zc.prototype.writeMultiSurfaceOrPolygon_),Surface:uc(zc.prototype.writeSurfaceOrPolygon_),MultiSurface:uc(zc.prototype.writeMultiSurfaceOrPolygon_),Envelope:uc(zc.prototype.writeEnvelope)}};zc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{lineStringMember:uc(zc.prototype.writeLineStringOrCurveMember_),curveMember:uc(zc.prototype.writeLineStringOrCurveMember_)}};zc.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml":{outerBoundaryIs:uc(zc.prototype.writeRing_),innerBoundaryIs:uc(zc.prototype.writeRing_)}};zc.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{pointMember:uc(zc.prototype.writePointMember_)}};zc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml":{surfaceMember:uc(zc.prototype.writeSurfaceOrPolygonMember_),polygonMember:uc(zc.prototype.writeSurfaceOrPolygonMember_)}};zc.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml":{lowerCorner:uc(Dc),upperCorner:uc(Dc)}};var Vc=function(i){function t(t){var e=t||{};i.call(this,e);this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Uc);Vc.prototype.namespace="http://www.opengis.net/gml/3.2";Vc.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:ac(Uc.prototype.readFlatPos_),posList:ac(Uc.prototype.readFlatPosList_)}};Vc.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:Uc.prototype.interiorParser_,exterior:Uc.prototype.exteriorParser_}};Vc.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:ac(xc.prototype.readPoint),MultiPoint:ac(xc.prototype.readMultiPoint),LineString:ac(xc.prototype.readLineString),MultiLineString:ac(xc.prototype.readMultiLineString),LinearRing:ac(xc.prototype.readLinearRing),Polygon:ac(xc.prototype.readPolygon),MultiPolygon:ac(xc.prototype.readMultiPolygon),Surface:ac(Vc.prototype.readSurface_),MultiSurface:ac(Uc.prototype.readMultiSurface_),Curve:ac(Vc.prototype.readCurve_),MultiCurve:ac(Uc.prototype.readMultiCurve_),Envelope:ac(Vc.prototype.readEnvelope_)}};Vc.prototype.MULTICURVE_PARSERS_={"http://www.opengis.net/gml/3.2":{curveMember:sc(Uc.prototype.curveMemberParser_),curveMembers:sc(Uc.prototype.curveMemberParser_)}};Vc.prototype.MULTISURFACE_PARSERS_={"http://www.opengis.net/gml/3.2":{surfaceMember:sc(Uc.prototype.surfaceMemberParser_),surfaceMembers:sc(Uc.prototype.surfaceMemberParser_)}};Vc.prototype.CURVEMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{LineString:sc(xc.prototype.readLineString),Curve:sc(Uc.prototype.readCurve_)}};Vc.prototype.SURFACEMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Polygon:sc(xc.prototype.readPolygon),Surface:sc(Uc.prototype.readSurface_)}};Vc.prototype.SURFACE_PARSERS_={"http://www.opengis.net/gml/3.2":{patches:ac(Uc.prototype.readPatch_)}};Vc.prototype.CURVE_PARSERS_={"http://www.opengis.net/gml/3.2":{segments:ac(Uc.prototype.readSegment_)}};Vc.prototype.ENVELOPE_PARSERS_={"http://www.opengis.net/gml/3.2":{lowerCorner:sc(Uc.prototype.readFlatPosList_),upperCorner:sc(Uc.prototype.readFlatPosList_)}};Vc.prototype.PATCHES_PARSERS_={"http://www.opengis.net/gml/3.2":{PolygonPatch:ac(Uc.prototype.readPolygonPatch_)}};Vc.prototype.SEGMENTS_PARSERS_={"http://www.opengis.net/gml/3.2":{LineStringSegment:ac(Uc.prototype.readLineStringSegment_)}};Vc.prototype.MULTIPOINT_PARSERS_={"http://www.opengis.net/gml/3.2":{pointMember:sc(xc.prototype.pointMemberParser_),pointMembers:sc(xc.prototype.pointMemberParser_)}};Vc.prototype.MULTILINESTRING_PARSERS_={"http://www.opengis.net/gml/3.2":{lineStringMember:sc(xc.prototype.lineStringMemberParser_),lineStringMembers:sc(xc.prototype.lineStringMemberParser_)}};Vc.prototype.MULTIPOLYGON_PARSERS_={"http://www.opengis.net/gml/3.2":{polygonMember:sc(xc.prototype.polygonMemberParser_),polygonMembers:sc(xc.prototype.polygonMemberParser_)}};Vc.prototype.POINTMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Point:sc(xc.prototype.readFlatCoordinatesFromNode_)}};Vc.prototype.LINESTRINGMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{LineString:sc(xc.prototype.readLineString)}};Vc.prototype.POLYGONMEMBER_PARSERS_={"http://www.opengis.net/gml/3.2":{Polygon:sc(xc.prototype.readPolygon)}};Vc.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:ac(xc.prototype.readFlatLinearRing_)}};Vc.prototype.RING_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{exterior:uc(Uc.prototype.writeRing_),interior:uc(Uc.prototype.writeRing_)}};Vc.prototype.ENVELOPE_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{lowerCorner:uc(Dc),upperCorner:uc(Dc)}};Vc.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{surfaceMember:uc(Uc.prototype.writeSurfaceOrPolygonMember_),polygonMember:uc(Uc.prototype.writeSurfaceOrPolygonMember_)}};Vc.prototype.POINTMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{pointMember:uc(Uc.prototype.writePointMember_)}};Vc.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{lineStringMember:uc(Uc.prototype.writeLineStringOrCurveMember_),curveMember:uc(Uc.prototype.writeLineStringOrCurveMember_)}};Vc.prototype.GEOMETRY_SERIALIZERS_={"http://www.opengis.net/gml/3.2":{Curve:uc(Uc.prototype.writeCurveOrLineString_),MultiCurve:uc(Uc.prototype.writeMultiCurveOrLineString_),Point:uc(Vc.prototype.writePoint_),MultiPoint:uc(Uc.prototype.writeMultiPoint_),LineString:uc(Uc.prototype.writeCurveOrLineString_),MultiLineString:uc(Uc.prototype.writeMultiCurveOrLineString_),LinearRing:uc(Uc.prototype.writeLinearRing_),Polygon:uc(Uc.prototype.writeSurfaceOrPolygon_),MultiPolygon:uc(Uc.prototype.writeMultiSurfaceOrPolygon_),Surface:uc(Uc.prototype.writeSurfaceOrPolygon_),MultiSurface:uc(Uc.prototype.writeMultiSurfaceOrPolygon_),Envelope:uc(Uc.prototype.writeEnvelope)}};var Wc=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Kc={rte:Tp,trk:Sp,wpt:xp},Hc=_c(Wc,{rte:sc(Tp),trk:sc(Sp),wpt:sc(xp)}),Zc=_c(Wc,{text:lc(bc,"linkText"),type:lc(bc,"linkType")}),qc=_c(Wc,{rte:uc(function(t,e,i){var r=i[0],n=e.getProperties(),o={node:t};o.properties=n;var s=e.getGeometry();if(s.getType()==jt.LINE_STRING){var a=Yu(s,!0,r);o.geometryLayout=a.getLayout();n.rtept=a.getCoordinates()}var h=i[i.length-1].node,l=sp[h.namespaceURI],u=fc(n,l);vc(o,ap,dc,u,i,l)}),trk:uc(function(t,e,i){var r=i[0],n=e.getProperties(),o={node:t};o.properties=n;var s=e.getGeometry();if(s.getType()==jt.MULTI_LINE_STRING){var a=Yu(s,!0,r);n.trkseg=a.getLineStrings()}var h=i[i.length-1].node,l=lp[h.namespaceURI],u=fc(n,l);vc(o,up,dc,u,i,l)}),wpt:uc(function(t,e,i){var r=i[0],n=i[i.length-1];n.properties=e.getProperties();var o=e.getGeometry();if(o.getType()==jt.POINT){var s=Yu(o,!0,r);n.geometryLayout=s.getLayout();Cp(t,s.getCoordinates(),i)}})}),Jc=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=be("EPSG:4326");this.readExtensions_=e.readExtensions}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.handleReadExtensions_=function(t){t||(t=[]);for(var e=0,i=t.length;e<i;++e){var r=t[e];if(this.readExtensions_){var n=r.get("extensionsNode_")||null;this.readExtensions_(r,n)}r.set("extensionsNode_",void 0)}};t.prototype.readFeatureFromNode=function(t,e){if(!U(Wc,t.namespaceURI))return null;var i=Kc[t.localName];if(!i)return null;var r=i(t,[this.getReadOptions(t,e)]);if(!r)return null;this.handleReadExtensions_([r]);return r};t.prototype.readFeaturesFromNode=function(t,e){if(!U(Wc,t.namespaceURI))return[];if("gpx"!=t.localName)return[];var i=yc([],Hc,t,[this.getReadOptions(t,e)]);if(i){this.handleReadExtensions_(i);return i}return[]};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=$u("http://www.topografix.com/GPX/1/1","gpx");i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Qu);i.setAttributeNS(Qu,"xsi:schemaLocation","http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd");i.setAttribute("version","1.1");i.setAttribute("creator","OpenLayers");vc({node:i},qc,gp,t,[e]);return i};return t}(Ec),Qc=_c(Wc,{name:lc(bc),cmt:lc(bc),desc:lc(bc),src:lc(bc),link:vp,number:lc(Oc),extensions:Ep,type:lc(bc),rtept:function(t,e){var i=yc({},$c,t,e);if(i){var r=e[e.length-1],n=r.flatCoordinates,o=r.layoutOptions;yp(n,o,t,i)}}}),$c=_c(Wc,{ele:lc(Ic),time:lc(wc)}),tp=_c(Wc,{name:lc(bc),cmt:lc(bc),desc:lc(bc),src:lc(bc),link:vp,number:lc(Oc),type:lc(bc),extensions:Ep,trkseg:function(t,e){var i=e[e.length-1];gc(ep,t,e);var r=i.flatCoordinates;i.ends.push(r.length)}}),ep=_c(Wc,{trkpt:function(t,e){var i=yc({},ip,t,e);if(i){var r=e[e.length-1],n=r.flatCoordinates,o=r.layoutOptions;yp(n,o,t,i)}}}),ip=_c(Wc,{ele:lc(Ic),time:lc(wc)}),rp=_c(Wc,{ele:lc(Ic),time:lc(wc),magvar:lc(Ic),geoidheight:lc(Ic),name:lc(bc),cmt:lc(bc),desc:lc(bc),src:lc(bc),link:vp,sym:lc(bc),type:lc(bc),fix:lc(bc),sat:lc(Oc),hdop:lc(Ic),vdop:lc(Ic),pdop:lc(Ic),ageofdgpsdata:lc(Ic),dgpsid:lc(Oc),extensions:Ep}),np=["text","type"],op=_c(Wc,{text:uc(Dc),type:uc(Dc)}),sp=_c(Wc,["name","cmt","desc","src","link","number","type","rtept"]),ap=_c(Wc,{name:uc(Dc),cmt:uc(Dc),desc:uc(Dc),src:uc(Dc),link:uc(Rp),number:uc(Gc),type:uc(Dc),rtept:cc(uc(Cp))}),hp=_c(Wc,["ele","time"]),lp=_c(Wc,["name","cmt","desc","src","link","number","type","trkseg"]),up=_c(Wc,{name:uc(Dc),cmt:uc(Dc),desc:uc(Dc),src:uc(Dc),link:uc(Rp),number:uc(Gc),type:uc(Dc),trkseg:cc(uc(function(t,e,i){var r={node:t};r.geometryLayout=e.getLayout();r.properties={};vc(r,pp,cp,e.getCoordinates(),i)}))}),cp=pc("trkpt"),pp=_c(Wc,{trkpt:uc(Cp)}),dp=_c(Wc,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),fp=_c(Wc,{ele:uc(Ac),time:uc(Nc),magvar:uc(Ac),geoidheight:uc(Ac),name:uc(Dc),cmt:uc(Dc),desc:uc(Dc),src:uc(Dc),link:uc(Rp),sym:uc(Dc),type:uc(Dc),fix:uc(Dc),sat:uc(Gc),hdop:uc(Ac),vdop:uc(Ac),pdop:uc(Ac),ageofdgpsdata:uc(Ac),dgpsid:uc(Gc)}),_p={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function gp(t,e,i){var r=t.getGeometry();if(r){var n=_p[r.getType()];if(n){return $u(e[e.length-1].node.namespaceURI,n)}}}function yp(t,e,i,r){t.push(parseFloat(i.getAttribute("lon")),parseFloat(i.getAttribute("lat")));if("ele"in r){t.push(r.ele);delete r.ele;e.hasZ=!0}else t.push(0);if("time"in r){t.push(r.time);delete r.time;e.hasM=!0}else t.push(0);return t}function mp(t,e,i){var r=kt.XY,n=2;if(t.hasZ&&t.hasM){r=kt.XYZM;n=4}else if(t.hasZ){r=kt.XYZ;n=3}else if(t.hasM){r=kt.XYM;n=3}if(4!==n){for(var o=0,s=e.length/4;o<s;o++){e[o*n]=e[4*o];e[o*n+1]=e[4*o+1];t.hasZ&&(e[o*n+2]=e[4*o+2]);t.hasM&&(e[o*n+2]=e[4*o+3])}e.length=e.length/4*n;if(i)for(var a=0,h=i.length;a<h;a++)i[a]=i[a]/4*n}return r}function vp(t,e){var i=e[e.length-1],r=t.getAttribute("href");null!==r&&(i.link=r);gc(Zc,t,e)}function Ep(t,e){e[e.length-1].extensionsNode_=t}function Tp(t,e){var i=e[0],r=yc({flatCoordinates:[],layoutOptions:{}},Qc,t,e);if(r){var n=r.flatCoordinates;delete r.flatCoordinates;var o=r.layoutOptions;delete r.layoutOptions;var s=mp(o,n),a=new na(n,s);Yu(a,!1,i);var h=new G(a);h.setProperties(r);return h}}function Sp(t,e){var i=e[0],r=yc({flatCoordinates:[],ends:[],layoutOptions:{}},tp,t,e);if(r){var n=r.flatCoordinates;delete r.flatCoordinates;var o=r.ends;delete r.ends;var s=r.layoutOptions;delete r.layoutOptions;var a=mp(s,n,o),h=new oa(n,a,o);Yu(h,!1,i);var l=new G(h);l.setProperties(r);return l}}function xp(t,e){var i=e[0],r=yc({},rp,t,e);if(r){var n={},o=yp([],n,t,r),s=mp(n,o),a=new Ai(o,s);Yu(a,!1,i);var h=new G(a);h.setProperties(r);return h}}function Rp(t,e,i){t.setAttribute("href",e);var r=i[i.length-1].properties,n=[r.linkText,r.linkType];vc({node:t},op,dc,n,i,np)}function Cp(t,e,i){var r=i[i.length-1],n=r.node.namespaceURI,o=r.properties;t.setAttributeNS(null,"lat",String(e[1]));t.setAttributeNS(null,"lon",String(e[0]));switch(r.geometryLayout){case kt.XYZM:0!==e[3]&&(o.time=e[3]);case kt.XYZ:0!==e[2]&&(o.ele=e[2]);break;case kt.XYM:0!==e[2]&&(o.time=e[2])}var s="rtept"==t.nodeName?hp[n]:dp[n],a=fc(o,s);vc({node:t,properties:o},fp,dc,a,i,s)}var wp=function(e){function u(t){e.call(this);this.geometries_=t||null;this.listenGeometriesChange_()}e&&(u.__proto__=e);((u.prototype=Object.create(e&&e.prototype)).constructor=u).prototype.unlistenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)f(this.geometries_[t],C.CHANGE,this.changed,this)};u.prototype.listenGeometriesChange_=function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)m(this.geometries_[t],C.CHANGE,this.changed,this)};u.prototype.clone=function(){var t=new u(null);t.setGeometries(this.geometries_);return t};u.prototype.closestPointXY=function(t,e,i,r){if(r<$(this.getExtent(),t,e))return r;for(var n=this.geometries_,o=0,s=n.length;o<s;++o)r=n[o].closestPointXY(t,e,i,r);return r};u.prototype.containsXY=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)if(i[r].containsXY(t,e))return!0;return!1};u.prototype.computeExtent=function(t){st(t);for(var e=this.geometries_,i=0,r=e.length;i<r;++i)ct(t,e[i].getExtent());return t};u.prototype.getGeometries=function(){return Ip(this.geometries_)};u.prototype.getGeometriesArray=function(){return this.geometries_};u.prototype.getSimplifiedGeometry=function(t){if(this.simplifiedGeometryRevision!=this.getRevision()){_(this.simplifiedGeometryCache);this.simplifiedGeometryMaxMinSquaredTolerance=0;this.simplifiedGeometryRevision=this.getRevision()}if(t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=t.toString();if(this.simplifiedGeometryCache.hasOwnProperty(e))return this.simplifiedGeometryCache[e];for(var i=[],r=this.geometries_,n=!1,o=0,s=r.length;o<s;++o){var a=r[o],h=a.getSimplifiedGeometry(t);i.push(h);h!==a&&(n=!0)}if(n){var l=new u(null);l.setGeometriesArray(i);return this.simplifiedGeometryCache[e]=l}this.simplifiedGeometryMaxMinSquaredTolerance=t;return this};u.prototype.getType=function(){return jt.GEOMETRY_COLLECTION};u.prototype.intersectsExtent=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)if(e[i].intersectsExtent(t))return!0;return!1};u.prototype.isEmpty=function(){return 0===this.geometries_.length};u.prototype.rotate=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].rotate(t,e);this.changed()};u.prototype.scale=function(t,e,i){var r=i;r||(r=Tt(this.getExtent()));for(var n=this.geometries_,o=0,s=n.length;o<s;++o)n[o].scale(t,e,r);this.changed()};u.prototype.setGeometries=function(t){this.setGeometriesArray(Ip(t))};u.prototype.setGeometriesArray=function(t){this.unlistenGeometriesChange_();this.geometries_=t;this.listenGeometriesChange_();this.changed()};u.prototype.applyTransform=function(t){for(var e=this.geometries_,i=0,r=e.length;i<r;++i)e[i].applyTransform(t);this.changed()};u.prototype.translate=function(t,e){for(var i=this.geometries_,r=0,n=i.length;r<n;++r)i[r].translate(t,e);this.changed()};u.prototype.disposeInternal=function(){this.unlistenGeometriesChange_();e.prototype.disposeInternal.call(this)};return u}(si);function Ip(t){for(var e=[],i=0,r=t.length;i<r;++i)e.push(t[i].clone());return e}var Lp=function(i){function t(t){var e=t||{};i.call(this);this.dataProjection=be(e.dataProjection?e.dataProjection:"EPSG:4326");e.featureProjection&&(this.defaultFeatureProjection=be(e.featureProjection));this.geometryName_=e.geometryName;this.extractGeometryName_=e.extractGeometryName}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromObject=function(t,e){var i=null,r=Op((i="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),n=new G;this.geometryName_?n.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in i!==void 0&&n.setGeometryName(i.geometry_name);n.setGeometry(r);"id"in i&&n.setId(i.id);i.properties&&n.setProperties(i.properties);return n};t.prototype.readFeaturesFromObject=function(t,e){var i=null;if("FeatureCollection"===t.type){i=[];for(var r=t.features,n=0,o=r.length;n<o;++n)i.push(this.readFeatureFromObject(r[n],e))}else i=[this.readFeatureFromObject(t,e)];return i};t.prototype.readGeometryFromObject=function(t,e){return Op(t,e)};t.prototype.readProjectionFromObject=function(t){var e,i=t.crs;i?"name"==i.type?e=be(i.properties.name):A(!1,36):e=this.dataProjection;return e};t.prototype.writeFeatureObject=function(t,e){e=this.adaptOptions(e);var i={type:"Feature",geometry:null,properties:null},r=t.getId();void 0!==r&&(i.id=r);var n=t.getGeometry();n&&(i.geometry=Pp(n,e));var o=t.getProperties();delete o[t.getGeometryName()];Mt(o)||(i.properties=o);return i};t.prototype.writeFeaturesObject=function(t,e){e=this.adaptOptions(e);for(var i=[],r=0,n=t.length;r<n;++r)i.push(this.writeFeatureObject(t[r],e));return{type:"FeatureCollection",features:i}};t.prototype.writeGeometryObject=function(t,e){return Pp(t,this.adaptOptions(e))};return t}(Xu);function Op(t,e){if(!t)return null;var i,r,n;switch(t.type){case jt.POINT:i=new Ai(t.coordinates);break;case jt.LINE_STRING:i=new na(t.coordinates);break;case jt.POLYGON:i=new tr(t.coordinates);break;case jt.MULTI_POINT:i=new sa(t.coordinates);break;case jt.MULTI_LINE_STRING:i=new oa(t.coordinates);break;case jt.MULTI_POLYGON:i=new ha(t.coordinates);break;case jt.GEOMETRY_COLLECTION:i=(n=t.geometries.map(function(t){return Op(t,r)}),new wp(n));break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return Yu(i,!1,e)}function Pp(t,e){var i,r,n=(t=Yu(t,!0,e)).getType();switch(n){case jt.POINT:i={type:"Point",coordinates:t.getCoordinates()};break;case jt.LINE_STRING:i={type:"LineString",coordinates:t.getCoordinates()};break;case jt.POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(i)}}(t,e);break;case jt.MULTI_POINT:i={type:"MultiPoint",coordinates:t.getCoordinates()};break;case jt.MULTI_LINE_STRING:i={type:"MultiLineString",coordinates:t.getCoordinates()};break;case jt.MULTI_POLYGON:i=function(t,e){var i;e&&(i=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(i)}}(t,e);break;case jt.GEOMETRY_COLLECTION:i=(r=e,{type:"GeometryCollection",geometries:t.getGeometriesArray().map(function(t){var e=y({},r);delete e.featureProjection;return Pp(t,e)})});break;case jt.CIRCLE:i={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return i}var bp=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.getType=function(){return nl.TEXT};e.prototype.readFeature=function(t,e){return this.readFeatureFromText(Mp(t),this.adaptOptions(e))};e.prototype.readFeatureFromText=function(t,e){return o()};e.prototype.readFeatures=function(t,e){return this.readFeaturesFromText(Mp(t),this.adaptOptions(e))};e.prototype.readFeaturesFromText=function(t,e){return o()};e.prototype.readGeometry=function(t,e){return this.readGeometryFromText(Mp(t),this.adaptOptions(e))};e.prototype.readGeometryFromText=function(t,e){return o()};e.prototype.readProjection=function(t){return this.readProjectionFromText(Mp(t))};e.prototype.readProjectionFromText=function(t){return this.dataProjection};e.prototype.writeFeature=function(t,e){return this.writeFeatureText(t,this.adaptOptions(e))};e.prototype.writeFeatureText=function(t,e){return o()};e.prototype.writeFeatures=function(t,e){return this.writeFeaturesText(t,this.adaptOptions(e))};e.prototype.writeFeaturesText=function(t,e){return o()};e.prototype.writeGeometry=function(t,e){return this.writeGeometryText(t,this.adaptOptions(e))};e.prototype.writeGeometryText=function(t,e){return o()};return e}(Uu);function Mp(t){return"string"==typeof t?t:""}var Fp="barometric",Np="gps",Ap="none",Gp=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,Dp=/^H.([A-Z]{3}).*?:(.*)/,kp=/^HFDTE(\d{2})(\d{2})(\d{2})/,jp=/\r\n|\r|\n/,Up=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=be("EPSG:4326");this.altitudeMode_=e.altitudeMode?e.altitudeMode:Ap}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromText=function(t,e){var i,r,n=this.altitudeMode_,o=t.split(jp),s={},a=[],h=2e3,l=0,u=1,c=-1;for(i=0,r=o.length;i<r;++i){var p=o[i],d=void 0;if("B"==p.charAt(0)){if(d=Gp.exec(p)){var f=parseInt(d[1],10),_=parseInt(d[2],10),g=parseInt(d[3],10),y=parseInt(d[4],10)+parseInt(d[5],10)/6e4;"S"==d[6]&&(y=-y);var m=parseInt(d[7],10)+parseInt(d[8],10)/6e4;"W"==d[9]&&(m=-m);a.push(m,y);if(n!=Ap){var v=void 0;v=n==Np?parseInt(d[11],10):n==Fp?parseInt(d[12],10):0;a.push(v)}var E=Date.UTC(h,l,u,f,_,g);E<c&&(E=Date.UTC(h,l,u+1,f,_,g));a.push(E/1e3);c=E}}else if("H"==p.charAt(0))if(d=kp.exec(p)){u=parseInt(d[1],10);l=parseInt(d[2],10)-1;h=2e3+parseInt(d[3],10)}else(d=Dp.exec(p))&&(s[d[1]]=d[2].trim())}if(0===a.length)return null;var T=n==Ap?kt.XYM:kt.XYZM,S=new na(a,T),x=new G(Yu(S,!1,e));x.setProperties(s);return x};t.prototype.readFeaturesFromText=function(t,e){var i=this.readFeatureFromText(t,e);return i?[i]:[]};return t}(bp),Yp={FRACTION:"fraction",PIXELS:"pixels"},Xp=function(s){function t(t,e,i,r,n,o){s.call(this);this.hitDetectionImage_=null;this.image_=t||new Image;null!==r&&(this.image_.crossOrigin=r);this.canvas_=o?document.createElement("canvas"):null;this.color_=o;this.imageListenerKeys_=null;this.imageState_=n;this.size_=i;this.src_=e;this.tainted_}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.isTainted_=function(){if(void 0===this.tainted_&&this.imageState_===Ar.LOADED){this.tainted_=!1;var t=zr(1,1);try{t.drawImage(this.image_,0,0);t.getImageData(0,0,1,1)}catch(t){this.tainted_=!0}}return!0===this.tainted_};t.prototype.dispatchChangeEvent_=function(){this.dispatchEvent(C.CHANGE)};t.prototype.handleImageError_=function(){this.imageState_=Ar.ERROR;this.unlistenImage_();this.dispatchChangeEvent_()};t.prototype.handleImageLoad_=function(){this.imageState_=Ar.LOADED;if(this.size_){this.image_.width=this.size_[0];this.image_.height=this.size_[1]}this.size_=[this.image_.width,this.image_.height];this.unlistenImage_();this.replaceColor_();this.dispatchChangeEvent_()};t.prototype.getImage=function(t){return this.canvas_?this.canvas_:this.image_};t.prototype.getImageState=function(){return this.imageState_};t.prototype.getHitDetectionImage=function(t){if(!this.hitDetectionImage_)if(this.isTainted_()){var e=this.size_[0],i=this.size_[1],r=zr(e,i);r.fillRect(0,0,e,i);this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_};t.prototype.getSize=function(){return this.size_};t.prototype.getSrc=function(){return this.src_};t.prototype.load=function(){if(this.imageState_==Ar.IDLE){this.imageState_=Ar.LOADING;this.imageListenerKeys_=[d(this.image_,C.ERROR,this.handleImageError_,this),d(this.image_,C.LOAD,this.handleImageLoad_,this)];try{this.image_.src=this.src_}catch(t){this.handleImageError_()}}};t.prototype.replaceColor_=function(){if(this.color_&&!this.isTainted_()){this.canvas_.width=this.image_.width;this.canvas_.height=this.image_.height;var t=this.canvas_.getContext("2d");t.drawImage(this.image_,0,0);for(var e=t.getImageData(0,0,this.image_.width,this.image_.height),i=e.data,r=this.color_[0]/255,n=this.color_[1]/255,o=this.color_[2]/255,s=0,a=i.length;s<a;s+=4){i[s]*=r;i[s+1]*=n;i[s+2]*=o}t.putImageData(e,0,0)}};t.prototype.unlistenImage_=function(){this.imageListenerKeys_.forEach(g);this.imageListenerKeys_=null};return t}(R);function Bp(t,e,i,r,n,o){var s=Kl.get(e,r,o);if(!s){s=new Xp(t,e,i,r,n,o);Kl.set(e,r,o,s)}return s}var zp={BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",TOP_LEFT:"top-left",TOP_RIGHT:"top-right"},Vp=function(u){function t(t){var e=t||{},i=void 0!==e.opacity?e.opacity:1,r=void 0!==e.rotation?e.rotation:0,n=void 0!==e.scale?e.scale:1,o=void 0!==e.rotateWithView&&e.rotateWithView;u.call(this,{opacity:i,rotation:r,scale:n,rotateWithView:o});this.anchor_=void 0!==e.anchor?e.anchor:[.5,.5];this.normalizedAnchor_=null;this.anchorOrigin_=void 0!==e.anchorOrigin?e.anchorOrigin:zp.TOP_LEFT;this.anchorXUnits_=void 0!==e.anchorXUnits?e.anchorXUnits:Yp.FRACTION;this.anchorYUnits_=void 0!==e.anchorYUnits?e.anchorYUnits:Yp.FRACTION;this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;var s=void 0!==e.img?e.img:null,a=void 0!==e.imgSize?e.imgSize:null,h=e.src;A(!(void 0!==h&&s),4);A(!s||s&&a,5);void 0!==h&&0!==h.length||!s||(h=s.src||bt(s));A(void 0!==h&&0<h.length,6);var l=void 0!==e.src?Ar.IDLE:Ar.LOADED;this.color_=void 0!==e.color?_a(e.color):null;this.iconImage_=Bp(s,h,a,this.crossOrigin_,l,this.color_);this.offset_=void 0!==e.offset?e.offset:[0,0];this.offsetOrigin_=void 0!==e.offsetOrigin?e.offsetOrigin:zp.TOP_LEFT;this.origin_=null;this.size_=void 0!==e.size?e.size:null}u&&(t.__proto__=u);((t.prototype=Object.create(u&&u.prototype)).constructor=t).prototype.clone=function(){return new t({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,crossOrigin:this.crossOrigin_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,src:this.getSrc(),offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,size:null!==this.size_?this.size_.slice():void 0,opacity:this.getOpacity(),scale:this.getScale(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView()})};t.prototype.getAnchor=function(){if(this.normalizedAnchor_)return this.normalizedAnchor_;var t=this.anchor_,e=this.getSize();if(this.anchorXUnits_==Yp.FRACTION||this.anchorYUnits_==Yp.FRACTION){if(!e)return null;t=this.anchor_.slice();this.anchorXUnits_==Yp.FRACTION&&(t[0]*=e[0]);this.anchorYUnits_==Yp.FRACTION&&(t[1]*=e[1])}if(this.anchorOrigin_!=zp.TOP_LEFT){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice());this.anchorOrigin_!=zp.TOP_RIGHT&&this.anchorOrigin_!=zp.BOTTOM_RIGHT||(t[0]=-t[0]+e[0]);this.anchorOrigin_!=zp.BOTTOM_LEFT&&this.anchorOrigin_!=zp.BOTTOM_RIGHT||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t;return this.normalizedAnchor_};t.prototype.setAnchor=function(t){this.anchor_=t;this.normalizedAnchor_=null};t.prototype.getColor=function(){return this.color_};t.prototype.getImage=function(t){return this.iconImage_.getImage(t)};t.prototype.getImageSize=function(){return this.iconImage_.getSize()};t.prototype.getHitDetectionImageSize=function(){return this.getImageSize()};t.prototype.getImageState=function(){return this.iconImage_.getImageState()};t.prototype.getHitDetectionImage=function(t){return this.iconImage_.getHitDetectionImage(t)};t.prototype.getOrigin=function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=zp.TOP_LEFT){var e=this.getSize(),i=this.iconImage_.getSize();if(!e||!i)return null;t=t.slice();this.offsetOrigin_!=zp.TOP_RIGHT&&this.offsetOrigin_!=zp.BOTTOM_RIGHT||(t[0]=i[0]-e[0]-t[0]);this.offsetOrigin_!=zp.BOTTOM_LEFT&&this.offsetOrigin_!=zp.BOTTOM_RIGHT||(t[1]=i[1]-e[1]-t[1])}this.origin_=t;return this.origin_};t.prototype.getSrc=function(){return this.iconImage_.getSrc()};t.prototype.getSize=function(){return this.size_?this.size_:this.iconImage_.getSize()};t.prototype.listenImageChange=function(t,e){return m(this.iconImage_,C.CHANGE,t,e)};t.prototype.load=function(){this.iconImage_.load()};t.prototype.unlistenImageChange=function(t,e){f(this.iconImage_,C.CHANGE,t,e)};return t}(za),Wp=function(t){var e=t||{};this.font_=e.font;this.rotation_=e.rotation;this.rotateWithView_=e.rotateWithView;this.scale_=e.scale;this.text_=e.text;this.textAlign_=e.textAlign;this.textBaseline_=e.textBaseline;this.fill_=void 0!==e.fill?e.fill:new Ka({color:"#333"});this.maxAngle_=void 0!==e.maxAngle?e.maxAngle:Math.PI/4;this.placement_=void 0!==e.placement?e.placement:bh.POINT;this.overflow_=!!e.overflow;this.stroke_=void 0!==e.stroke?e.stroke:null;this.offsetX_=void 0!==e.offsetX?e.offsetX:0;this.offsetY_=void 0!==e.offsetY?e.offsetY:0;this.backgroundFill_=e.backgroundFill?e.backgroundFill:null;this.backgroundStroke_=e.backgroundStroke?e.backgroundStroke:null;this.padding_=void 0===e.padding?null:e.padding};Wp.prototype.clone=function(){return new Wp({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:this.getScale(),text:this.getText(),textAlign:this.getTextAlign(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0})};Wp.prototype.getOverflow=function(){return this.overflow_};Wp.prototype.getFont=function(){return this.font_};Wp.prototype.getMaxAngle=function(){return this.maxAngle_};Wp.prototype.getPlacement=function(){return this.placement_};Wp.prototype.getOffsetX=function(){return this.offsetX_};Wp.prototype.getOffsetY=function(){return this.offsetY_};Wp.prototype.getFill=function(){return this.fill_};Wp.prototype.getRotateWithView=function(){return this.rotateWithView_};Wp.prototype.getRotation=function(){return this.rotation_};Wp.prototype.getScale=function(){return this.scale_};Wp.prototype.getStroke=function(){return this.stroke_};Wp.prototype.getText=function(){return this.text_};Wp.prototype.getTextAlign=function(){return this.textAlign_};Wp.prototype.getTextBaseline=function(){return this.textBaseline_};Wp.prototype.getBackgroundFill=function(){return this.backgroundFill_};Wp.prototype.getBackgroundStroke=function(){return this.backgroundStroke_};Wp.prototype.getPadding=function(){return this.padding_};Wp.prototype.setOverflow=function(t){this.overflow_=t};Wp.prototype.setFont=function(t){this.font_=t};Wp.prototype.setMaxAngle=function(t){this.maxAngle_=t};Wp.prototype.setOffsetX=function(t){this.offsetX_=t};Wp.prototype.setOffsetY=function(t){this.offsetY_=t};Wp.prototype.setPlacement=function(t){this.placement_=t};Wp.prototype.setFill=function(t){this.fill_=t};Wp.prototype.setRotation=function(t){this.rotation_=t};Wp.prototype.setScale=function(t){this.scale_=t};Wp.prototype.setStroke=function(t){this.stroke_=t};Wp.prototype.setText=function(t){this.text_=t};Wp.prototype.setTextAlign=function(t){this.textAlign_=t};Wp.prototype.setTextBaseline=function(t){this.textBaseline_=t};Wp.prototype.setBackgroundFill=function(t){this.backgroundFill_=t};Wp.prototype.setBackgroundStroke=function(t){this.backgroundStroke_=t};Wp.prototype.setPadding=function(t){this.padding_=t};var Kp,Hp,Zp,qp,Jp,Qp,$p,td=["http://www.google.com/kml/ext/2.2"],ed=[null,"http://earth.google.com/kml/2.0","http://earth.google.com/kml/2.1","http://earth.google.com/kml/2.2","http://www.opengis.net/kml/2.2"],id={fraction:Yp.FRACTION,pixels:Yp.PIXELS,insetPixels:Yp.PIXELS},rd=_c(ed,{ExtendedData:qd,Region:Jd,MultiGeometry:lc(Yd,"geometry"),LineString:lc(kd,"geometry"),LinearRing:lc(jd,"geometry"),Point:lc(Xd,"geometry"),Polygon:lc(zd,"geometry"),Style:lc(Wd),StyleMap:function(t,e){var i=Rd(t,e);if(!i)return;var r=e[e.length-1];Array.isArray(i)?r.Style=i:"string"==typeof i?r.styleUrl=i:A(!1,38)},address:lc(bc),description:lc(bc),name:lc(bc),open:lc(Rc),phoneNumber:lc(bc),styleUrl:lc(Td),visibility:lc(Rc)},_c(td,{MultiTrack:lc(function(t,e){var i=yc([],bd,t,e);return i?new oa(i):void 0},"geometry"),Track:lc(Fd,"geometry")})),nd=_c(ed,{ExtendedData:qd,Region:Jd,Link:function(t,e){gc(od,t,e)},address:lc(bc),description:lc(bc),name:lc(bc),open:lc(Rc),phoneNumber:lc(bc),visibility:lc(Rc)}),od=_c(ed,{href:lc(Td)}),sd=_c(ed,{LatLonAltBox:function(t,e){var i=yc({},tf,t,e);if(!i)return;var r=e[e.length-1],n=[parseFloat(i.west),parseFloat(i.south),parseFloat(i.east),parseFloat(i.north)];r.extent=n;r.altitudeMode=i.altitudeMode;r.minAltitude=parseFloat(i.minAltitude);r.maxAltitude=parseFloat(i.maxAltitude)},Lod:function(t,e){var i=yc({},ef,t,e);if(!i)return;var r=e[e.length-1];r.minLodPixels=parseFloat(i.minLodPixels);r.maxLodPixels=parseFloat(i.maxLodPixels);r.minFadeExtent=parseFloat(i.minFadeExtent);r.maxFadeExtent=parseFloat(i.maxFadeExtent)}}),ad=_c(ed,["Document","Placemark"]),hd=_c(ed,{Document:uc(function(t,e,i){vc({node:t},af,hf,e,i,void 0,this)}),Placemark:uc(Mf)}),ld=null;var ud,cd=null;var pd,dd=null;var fd=null;var _d=null;var gd=null;var yd=function(i){function t(t){i.call(this);var e=t||{};gd||function(){ld=new Ka({color:Kp=[255,255,255,1]});Hp=[20,2];Zp=Yp.PIXELS;qp=Yp.PIXELS;Jp=[64,64];Qp="https://maps.google.com/mapfiles/kml/pushpin/ylw-pushpin.png";$p=.5;cd=new Vp({anchor:Hp,anchorOrigin:zp.BOTTOM_LEFT,anchorXUnits:Zp,anchorYUnits:qp,crossOrigin:"anonymous",rotation:0,scale:$p,size:Jp,src:Qp});ud="NO_IMAGE";dd=new Ha({color:Kp,width:1});pd=new Ha({color:[51,51,51,1],width:2});fd=new Wp({font:"bold 16px Helvetica",fill:ld,stroke:pd,scale:.8});_d=new Za({fill:ld,image:cd,text:fd,stroke:dd,zIndex:0});gd=[_d]}();this.dataProjection=be("EPSG:4326");this.defaultStyle_=e.defaultStyle?e.defaultStyle:gd;this.extractStyles_=void 0===e.extractStyles||e.extractStyles;this.writeStyles_=void 0===e.writeStyles||e.writeStyles;this.sharedStyles_={};this.showPointNames_=void 0===e.showPointNames||e.showPointNames}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readDocumentOrFolder_=function(t,e){var i=yc([],_c(ed,{Document:oc(this.readDocumentOrFolder_,this),Folder:oc(this.readDocumentOrFolder_,this),Placemark:sc(this.readPlacemark_,this),Style:this.readSharedStyle_.bind(this),StyleMap:this.readSharedStyleMap_.bind(this)}),t,e,this);return i||void 0};t.prototype.readPlacemark_=function(t,e){var i=yc({geometry:null},rd,t,e);if(i){var r=new G,n=t.getAttribute("id");null!==n&&r.setId(n);var a,h,l,u,c,o=e[0],s=i.geometry;s&&Yu(s,!1,o);r.setGeometry(s);delete i.geometry;if(this.extractStyles_){var p=i.Style,d=i.styleUrl,f=(a=p,h=d,l=this.defaultStyle_,u=this.sharedStyles_,c=this.showPointNames_,function(t,e){var i,r=c,n="";if(r){var o=t.getGeometry();o&&(r=o.getType()===jt.POINT)}if(r){n=t.get("name");r=r&&!!n}if(a){if(r){i=md(a[0],n);return a.concat(i)}return a}if(h){var s=function t(e,i,r){if(Array.isArray(e))return e;if("string"!=typeof e)return i;!(e in r)&&"#"+e in r&&(e="#"+e);return t(r[e],i,r)}(h,l,u);if(r){i=md(s[0],n);return s.concat(i)}return s}if(r){i=md(l[0],n);return l.concat(i)}return l});r.setStyle(f)}delete i.Style;r.setProperties(i);return r}};t.prototype.readSharedStyle_=function(t,e){var i=t.getAttribute("id");if(null!==i){var r=Wd(t,e);if(r){var n,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href);if(o){n=new URL("#"+i,o).href}else n="#"+i;this.sharedStyles_[n]=r}}};t.prototype.readSharedStyleMap_=function(t,e){var i=t.getAttribute("id");if(null!==i){var r=Rd(t,e);if(r){var n,o=t.baseURI;o&&"about:blank"!=o||(o=window.location.href);if(o){n=new URL("#"+i,o).href}else n="#"+i;this.sharedStyles_[n]=r}}};t.prototype.readFeatureFromNode=function(t,e){if(!U(ed,t.namespaceURI))return null;var i=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return i||null};t.prototype.readFeaturesFromNode=function(t,e){if(!U(ed,t.namespaceURI))return[];var i,r=t.localName;if("Document"==r||"Folder"==r)return(i=this.readDocumentOrFolder_(t,[this.getReadOptions(t,e)]))||[];if("Placemark"==r){var n=this.readPlacemark_(t,[this.getReadOptions(t,e)]);return n?[n]:[]}if("kml"!=r)return[];i=[];for(var o=t.firstElementChild;o;o=o.nextElementSibling){var s=this.readFeaturesFromNode(o,e);s&&B(i,s)}return i};t.prototype.readName=function(t){if(t){if("string"!=typeof t)return ic(t)?this.readNameFromDocument(t):this.readNameFromNode(t);var e=nc(t);return this.readNameFromDocument(e)}};t.prototype.readNameFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE){var i=this.readNameFromNode(e);if(i)return i}};t.prototype.readNameFromNode=function(t){for(var e=t.firstElementChild;e;e=e.nextElementSibling)if(U(ed,e.namespaceURI)&&"name"==e.localName)return bc(e);for(var i=t.firstElementChild;i;i=i.nextElementSibling){var r=i.localName;if(U(ed,i.namespaceURI)&&("Document"==r||"Folder"==r||"Placemark"==r||"kml"==r)){var n=this.readNameFromNode(i);if(n)return n}}};t.prototype.readNetworkLinks=function(t){var e=[];if("string"==typeof t){var i=nc(t);B(e,this.readNetworkLinksFromDocument(i))}else ic(t)?B(e,this.readNetworkLinksFromDocument(t)):B(e,this.readNetworkLinksFromNode(t));return e};t.prototype.readNetworkLinksFromDocument=function(t){for(var e=[],i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&B(e,this.readNetworkLinksFromNode(i));return e};t.prototype.readNetworkLinksFromNode=function(t){for(var e=[],i=t.firstElementChild;i;i=i.nextElementSibling)if(U(ed,i.namespaceURI)&&"NetworkLink"==i.localName){var r=yc({},nd,i,[]);e.push(r)}for(var n=t.firstElementChild;n;n=n.nextElementSibling){var o=n.localName;!U(ed,n.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||B(e,this.readNetworkLinksFromNode(n))}return e};t.prototype.readRegion=function(t){var e=[];if("string"==typeof t){var i=nc(t);B(e,this.readRegionFromDocument(i))}else ic(t)?B(e,this.readRegionFromDocument(t)):B(e,this.readRegionFromNode(t));return e};t.prototype.readRegionFromDocument=function(t){for(var e=[],i=t.firstChild;i;i=i.nextSibling)i.nodeType==Node.ELEMENT_NODE&&B(e,this.readRegionFromNode(i));return e};t.prototype.readRegionFromNode=function(t){for(var e=[],i=t.firstElementChild;i;i=i.nextElementSibling)if(U(ed,i.namespaceURI)&&"Region"==i.localName){var r=yc({},sd,i,[]);e.push(r)}for(var n=t.firstElementChild;n;n=n.nextElementSibling){var o=n.localName;!U(ed,n.namespaceURI)||"Document"!=o&&"Folder"!=o&&"kml"!=o||B(e,this.readRegionFromNode(n))}return e};t.prototype.writeFeaturesNode=function(t,e){e=this.adaptOptions(e);var i=$u(ed[4],"kml"),r="http://www.w3.org/2000/xmlns/";i.setAttributeNS(r,"xmlns:gx",td[0]);i.setAttributeNS(r,"xmlns:xsi",Qu);i.setAttributeNS(Qu,"xsi:schemaLocation","http://www.opengis.net/kml/2.2 https://developers.google.com/kml/schema/kml22gx.xsd");var n={node:i},o={};1<t.length?o.Document=t:1==t.length&&(o.Placemark=t[0]);var s=ad[i.namespaceURI],a=fc(o,s);vc(n,hd,dc,a,[e],s,this);return i};return t}(Ec);function md(t,e){var i=null,r=[0,0],n="start";if(t.getImage()){var o=t.getImage().getImageSize();null===o&&(o=Jp);if(2==o.length){var s=t.getImage().getScale();r[0]=s*o[0]/2;r[1]=-s*o[1]/2;n="left"}}if(null!==t.getText()){var a=t.getText();(i=a.clone()).setFont(a.getFont()||fd.getFont());i.setScale(a.getScale()||fd.getScale());i.setFill(a.getFill()||fd.getFill());i.setStroke(a.getStroke()||pd)}else i=fd.clone();i.setText(e);i.setOffsetX(r[0]);i.setOffsetY(r[1]);i.setTextAlign(n);return new Za({text:i})}function vd(t){var e=tc(t,!1),i=/^\s*#?\s*([0-9A-Fa-f]{8})\s*$/.exec(e);if(i){var r=i[1];return[parseInt(r.substr(6,2),16),parseInt(r.substr(4,2),16),parseInt(r.substr(2,2),16),parseInt(r.substr(0,2),16)/255]}}function Ed(t){for(var e,i=tc(t,!1),r=[],n=/^\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?)(?:\s*,\s*([+\-]?\d*\.?\d+(?:e[+\-]?\d+)?))?\s*/i;e=n.exec(i);){var o=parseFloat(e[1]),s=parseFloat(e[2]),a=e[3]?parseFloat(e[3]):0;r.push(o,s,a);i=i.substr(e[0].length)}if(""===i)return r}function Td(t){var e=tc(t,!1).trim(),i=t.baseURI;i&&"about:blank"!=i||(i=window.location.href);if(i){return new URL(e,i).href}return e}function Sd(t){return Ic(t)}var xd=_c(ed,{Pair:function(t,e){var i=yc({},Qd,t,e);if(!i)return;var r=i.key;if(r&&"normal"==r){var n=i.styleUrl;n&&(e[e.length-1]=n);var o=i.Style;o&&(e[e.length-1]=o)}}});function Rd(t,e){return yc(void 0,xd,t,e)}var Cd=_c(ed,{Icon:lc(function(t,e){var i=yc({},Nd,t,e);return i||null}),heading:lc(Ic),hotSpot:lc(function(t){var e,i=t.getAttribute("xunits"),r=t.getAttribute("yunits");e="insetPixels"!==i?"insetPixels"!==r?zp.BOTTOM_LEFT:zp.TOP_LEFT:"insetPixels"!==r?zp.BOTTOM_RIGHT:zp.TOP_RIGHT;return{x:parseFloat(t.getAttribute("x")),xunits:id[i],y:parseFloat(t.getAttribute("y")),yunits:id[r],origin:e}}),scale:lc(Sd)});var wd=_c(ed,{color:lc(vd),scale:lc(Sd)});var Id=_c(ed,{color:lc(vd),width:lc(Ic)});var Ld=_c(ed,{color:lc(vd),fill:lc(Rc),outline:lc(Rc)});var Od=_c(ed,{coordinates:ac(Ed)});function Pd(t,e){return yc(null,Od,t,e)}var bd=_c(td,{Track:sc(Fd)});var Md=_c(ed,{when:function(t,e){var i=e[e.length-1].whens,r=tc(t,!1),n=Date.parse(r);i.push(isNaN(n)?0:n)}},_c(td,{coord:function(t,e){var i=e[e.length-1].flatCoordinates,r=tc(t,!1),n=/^\s*([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s+([+\-]?\d+(?:\.\d*)?(?:e[+\-]?\d*)?)\s*$/i.exec(r);if(n){var o=parseFloat(n[1]),s=parseFloat(n[2]),a=parseFloat(n[3]);i.push(o,s,a,0)}else i.push(0,0,0,0)}}));function Fd(t,e){var i=yc({flatCoordinates:[],whens:[]},Md,t,e);if(i){for(var r=i.flatCoordinates,n=i.whens,o=0,s=Math.min(r.length,n.length);o<s;++o)r[4*o+3]=n[o];return new na(r,kt.XYZM)}}var Nd=_c(ed,{href:lc(Td)},_c(td,{x:lc(Ic),y:lc(Ic),w:lc(Ic),h:lc(Ic)}));var Ad=_c(ed,{coordinates:ac(Ed)});function Gd(t,e){return yc(null,Ad,t,e)}var Dd=_c(ed,{extrude:lc(Rc),tessellate:lc(Rc),altitudeMode:lc(bc)});function kd(t,e){var i=yc({},Dd,t,e),r=Gd(t,e);if(r){var n=new na(r,kt.XYZ);n.setProperties(i);return n}}function jd(t,e){var i=yc({},Dd,t,e),r=Gd(t,e);if(r){var n=new tr(r,kt.XYZ,[r.length]);n.setProperties(i);return n}}var Ud=_c(ed,{LineString:sc(kd),LinearRing:sc(jd),MultiGeometry:sc(Yd),Point:sc(Xd),Polygon:sc(zd)});function Yd(t,e){var i,r=yc([],Ud,t,e);if(!r)return null;if(0===r.length)return new wp(r);for(var n=!0,o=r[0].getType(),s=1,a=r.length;s<a;++s)if(r[s].getType()!=o){n=!1;break}if(n){var h,l;if(o==jt.POINT){var u=r[0];h=u.getLayout();l=u.getFlatCoordinates();for(var c=1,p=r.length;c<p;++c)B(l,r[c].getFlatCoordinates());Kd(i=new sa(l,h),r)}else o==jt.LINE_STRING?Kd(i=new oa(r),r):o==jt.POLYGON?Kd(i=new ha(r),r):o==jt.GEOMETRY_COLLECTION?i=new wp(r):A(!1,37)}else i=new wp(r);return i}function Xd(t,e){var i=yc({},Dd,t,e),r=Gd(t,e);if(r){var n=new Ai(r,kt.XYZ);n.setProperties(i);return n}}var Bd=_c(ed,{innerBoundaryIs:function(t,e){var i=yc(void 0,rf,t,e);if(i){var r=e[e.length-1];r.push(i)}},outerBoundaryIs:function(t,e){var i=yc(void 0,nf,t,e);if(i){var r=e[e.length-1];r[0]=i}}});function zd(t,e){var i=yc({},Dd,t,e),r=yc([null],Bd,t,e);if(r&&r[0]){for(var n=r[0],o=[n.length],s=1,a=r.length;s<a;++s){B(n,r[s]);o.push(n.length)}var h=new tr(n,kt.XYZ,o);h.setProperties(i);return h}}var Vd=_c(ed,{IconStyle:function(t,e){var i=yc({},Cd,t,e);if(i){var r,n,o,s,a=e[e.length-1],h="Icon"in i?i.Icon:{},l=!("Icon"in i)||0<Object.keys(h).length,u=h.href;u?r=u:l&&(r=Qp);var c,p=zp.BOTTOM_LEFT,d=i.hotSpot;if(d){n=[d.x,d.y];o=d.xunits;s=d.yunits;p=d.origin}else if(r===Qp){n=Hp;o=Zp;s=qp}else if(/^http:\/\/maps\.(?:google|gstatic)\.com\//.test(r)){n=[.5,0];o=Yp.FRACTION;s=Yp.FRACTION}var f,_=h.x,g=h.y;void 0!==_&&void 0!==g&&(c=[_,g]);var y,m=h.w,v=h.h;void 0!==m&&void 0!==v&&(f=[m,v]);var E=i.heading;void 0!==E&&(y=qt(E));var T=i.scale;if(l){if(r==Qp){f=Jp;void 0===T&&(T=$p)}var S=new Vp({anchor:n,anchorOrigin:p,anchorXUnits:o,anchorYUnits:s,crossOrigin:"anonymous",offset:c,offsetOrigin:zp.BOTTOM_LEFT,rotation:y,scale:T,size:f,src:r});a.imageStyle=S}else a.imageStyle=ud}},LabelStyle:function(t,e){var i=yc({},wd,t,e);if(i){var r=e[e.length-1],n=new Wp({fill:new Ka({color:"color"in i?i.color:Kp}),scale:i.scale});r.textStyle=n}},LineStyle:function(t,e){var i=yc({},Id,t,e);if(i){var r=e[e.length-1],n=new Ha({color:"color"in i?i.color:Kp,width:"width"in i?i.width:1});r.strokeStyle=n}},PolyStyle:function(t,e){var i=yc({},Ld,t,e);if(i){var r=e[e.length-1],n=new Ka({color:"color"in i?i.color:Kp});r.fillStyle=n;var o=i.fill;void 0!==o&&(r.fill=o);var s=i.outline;void 0!==s&&(r.outline=s)}}});function Wd(t,e){var i=yc({},Vd,t,e);if(!i)return null;var r,n="fillStyle"in i?i.fillStyle:ld,o=i.fill;void 0===o||o||(n=null);"imageStyle"in i?i.imageStyle!=ud&&(r=i.imageStyle):r=cd;var s="textStyle"in i?i.textStyle:fd,a="strokeStyle"in i?i.strokeStyle:dd,h=i.outline;void 0===h||h||(a=null);return[new Za({fill:n,image:r,stroke:a,text:s,zIndex:void 0})]}function Kd(t,e){var i,r,n,o=e.length,s=new Array(e.length),a=new Array(e.length),h=new Array(e.length);i=r=n=!1;for(var l=0;l<o;++l){var u=e[l];s[l]=u.get("extrude");a[l]=u.get("tessellate");h[l]=u.get("altitudeMode");i=i||void 0!==s[l];r=r||void 0!==a[l];n=n||h[l]}i&&t.set("extrude",s);r&&t.set("tessellate",a);n&&t.set("altitudeMode",h)}var Hd=_c(ed,{displayName:lc(bc),value:lc(bc)});var Zd=_c(ed,{Data:function(t,e){var i=t.getAttribute("name");gc(Hd,t,e);var r=e[e.length-1];null!==i?r[i]=r.value:null!==r.displayName&&(r[r.displayName]=r.value);delete r.value},SchemaData:function(t,e){gc($d,t,e)}});function qd(t,e){gc(Zd,t,e)}function Jd(t,e){gc(sd,t,e)}var Qd=_c(ed,{Style:lc(Wd),key:lc(bc),styleUrl:lc(Td)});var $d=_c(ed,{SimpleData:function(t,e){var i=t.getAttribute("name");if(null!==i){var r=bc(t),n=e[e.length-1];n[i]=r}}});var tf=_c(ed,{altitudeMode:lc(bc),minAltitude:lc(Ic),maxAltitude:lc(Ic),north:lc(Ic),south:lc(Ic),east:lc(Ic),west:lc(Ic)});var ef=_c(ed,{minLodPixels:lc(Ic),maxLodPixels:lc(Ic),minFadeExtent:lc(Ic),maxFadeExtent:lc(Ic)});var rf=_c(ed,{LinearRing:ac(Pd)});var nf=_c(ed,{LinearRing:ac(Pd)});function of(t,e){for(var i=_a(e),r=[255*(4==i.length?i[3]:1),i[2],i[1],i[0]],n=0;n<4;++n){var o=Math.floor(r[n]).toString(16);r[n]=1==o.length?"0"+o:o}Dc(t,r.join(""))}var sf=_c(ed,{Data:uc(function(t,e,i){t.setAttribute("name",e.name);var r={node:t},n=e.value;if("object"==typeof n){null!==n&&n.displayName&&vc(r,sf,dc,[n.displayName],i,["displayName"]);null!==n&&n.value&&vc(r,sf,dc,[n.value],i,["value"])}else vc(r,sf,dc,[n],i,["value"])}),value:uc(function(t,e){Dc(t,e)}),displayName:uc(function(t,e){Fc(t,e)})});var af=_c(ed,{Placemark:uc(Mf)}),hf=function(t,e,i){return $u(e[e.length-1].node.namespaceURI,"Placemark")};var lf=pc("Data");var uf=_c(ed,["href"],_c(td,["x","y","w","h"])),cf=_c(ed,{href:uc(Dc)},_c(td,{x:uc(Ac),y:uc(Ac),w:uc(Ac),h:uc(Ac)})),pf=function(t,e,i){return $u(td[0],"gx:"+i)};var df=_c(ed,["scale","heading","Icon","hotSpot"]),ff=_c(ed,{Icon:uc(function(t,e,i){var r={node:t},n=i[i.length-1].node,o=uf[n.namespaceURI],s=fc(e,o);vc(r,cf,dc,s,i,o);s=fc(e,o=uf[td[0]]);vc(r,cf,pf,s,i,o)}),heading:uc(Ac),hotSpot:uc(function(t,e){t.setAttribute("x",String(e.x));t.setAttribute("y",String(e.y));t.setAttribute("xunits",e.xunits);t.setAttribute("yunits",e.yunits)}),scale:uc(Xf)});var _f=_c(ed,["color","scale"]),gf=_c(ed,{color:uc(of),scale:uc(Xf)});var yf=_c(ed,["color","width"]),mf=_c(ed,{color:uc(of),width:uc(Ac)});var vf={Point:"Point",LineString:"LineString",LinearRing:"LinearRing",Polygon:"Polygon",MultiPoint:"MultiGeometry",MultiLineString:"MultiGeometry",MultiPolygon:"MultiGeometry",GeometryCollection:"MultiGeometry"},Ef=function(t,e,i){if(t){return $u(e[e.length-1].node.namespaceURI,vf[t.getType()])}},Tf=pc("Point"),Sf=pc("LineString"),xf=pc("LinearRing"),Rf=pc("Polygon"),Cf=_c(ed,{LineString:uc(Af),Point:uc(Af),Polygon:uc(jf),GeometryCollection:uc(wf)});function wf(t,e,i){var r,n,o={node:t},s=e.getType();if(s==jt.GEOMETRY_COLLECTION){r=e.getGeometries();n=Ef}else if(s==jt.MULTI_POINT){r=e.getPoints();n=Tf}else if(s==jt.MULTI_LINE_STRING){r=e.getLineStrings();n=Sf}else if(s==jt.MULTI_POLYGON){r=e.getPolygons();n=Rf}else A(!1,39);vc(o,Cf,n,r,i)}var If=_c(ed,{LinearRing:uc(Af)});function Lf(t,e,i){vc({node:t},If,xf,[e],i)}var Of=_c(ed,{ExtendedData:uc(function(t,e,i){for(var r={node:t},n=e.names,o=e.values,s=n.length,a=0;a<s;a++)vc(r,sf,lf,[{name:n[a],value:o[a]}],i)}),MultiGeometry:uc(wf),LineString:uc(Af),LinearRing:uc(Af),Point:uc(Af),Polygon:uc(jf),Style:uc(function(t,e,i){var r={node:t},n={},o=e.getFill(),s=e.getStroke(),a=e.getImage(),h=e.getText();a&&"function"==typeof a.getSrc&&(n.IconStyle=a);h&&(n.LabelStyle=h);s&&(n.LineStyle=s);o&&(n.PolyStyle=o);var l=i[i.length-1].node,u=Bf[l.namespaceURI],c=fc(n,u);vc(r,zf,dc,c,i,u)}),address:uc(Dc),description:uc(Dc),name:uc(Dc),open:uc(Mc),phoneNumber:uc(Dc),styleUrl:uc(Dc),visibility:uc(Mc)}),Pf=_c(ed,["name","open","visibility","address","phoneNumber","description","styleUrl","Style"]),bf=pc("ExtendedData");function Mf(t,e,i){var r={node:t};e.getId()&&t.setAttribute("id",e.getId());var n=e.getProperties(),o={address:1,description:1,name:1,open:1,phoneNumber:1,styleUrl:1,visibility:1};o[e.getGeometryName()]=1;var s=Object.keys(n||{}).sort().filter(function(t){return!o[t]});if(0<s.length){var a=fc(n,s);vc(r,Of,bf,[{names:s,values:a}],i)}var h=e.getStyleFunction();if(h){var l=h(e,0);if(l){var u=Array.isArray(l)?l[0]:l;this.writeStyles_&&(n.Style=u);var c=u.getText();c&&(n.name=c.getText())}}var p=i[i.length-1].node,d=Pf[p.namespaceURI],f=fc(n,d);vc(r,Of,dc,f,i,d);var _=i[0],g=e.getGeometry();g&&(g=Yu(g,!0,_));vc(r,Of,Ef,[g],i)}var Ff=_c(ed,["extrude","tessellate","altitudeMode","coordinates"]),Nf=_c(ed,{extrude:uc(Mc),tessellate:uc(Mc),altitudeMode:uc(Dc),coordinates:uc(function(t,e,i){var r,n=i[i.length-1],o=n.layout,s=n.stride;o==kt.XY||o==kt.XYM?r=2:o==kt.XYZ||o==kt.XYZM?r=3:A(!1,34);var a=e.length,h="";if(0<a){h+=e[0];for(var l=1;l<r;++l)h+=","+e[l];for(var u=s;u<a;u+=s){h+=" "+e[u];for(var c=1;c<r;++c)h+=","+e[u+c]}}Dc(t,h)})});function Af(t,e,i){var r=e.getFlatCoordinates(),n={node:t};n.layout=e.getLayout();n.stride=e.getStride();var o=e.getProperties();o.coordinates=r;var s=i[i.length-1].node,a=Ff[s.namespaceURI],h=fc(o,a);vc(n,Nf,dc,h,i,a)}var Gf=_c(ed,{outerBoundaryIs:uc(Lf),innerBoundaryIs:uc(Lf)}),Df=pc("innerBoundaryIs"),kf=pc("outerBoundaryIs");function jf(t,e,i){var r=e.getLinearRings(),n=r.shift(),o={node:t};vc(o,Gf,Df,r,i);vc(o,Gf,kf,[n],i)}var Uf=_c(ed,{color:uc(of)}),Yf=pc("color");function Xf(t,e){Ac(t,Math.round(1e6*e)/1e6)}var Bf=_c(ed,["IconStyle","LabelStyle","LineStyle","PolyStyle"]),zf=_c(ed,{IconStyle:uc(function(t,e,i){var r={node:t},n={},o=e.getSrc(),s=e.getSize(),a=e.getImageSize(),h={href:o};if(s){h.w=s[0];h.h=s[1];var l=e.getAnchor(),u=e.getOrigin();if(u&&a&&0!==u[0]&&u[1]!==s[1]){h.x=u[0];h.y=a[1]-(u[1]+s[1])}if(l&&(l[0]!==s[0]/2||l[1]!==s[1]/2)){var c={x:l[0],xunits:Yp.PIXELS,y:s[1]-l[1],yunits:Yp.PIXELS};n.hotSpot=c}}n.Icon=h;var p=e.getScale();1!==p&&(n.scale=p);var d=e.getRotation();0!==d&&(n.heading=d);var f=i[i.length-1].node,_=df[f.namespaceURI],g=fc(n,_);vc(r,ff,dc,g,i,_)}),LabelStyle:uc(function(t,e,i){var r={node:t},n={},o=e.getFill();o&&(n.color=o.getColor());var s=e.getScale();s&&1!==s&&(n.scale=s);var a=i[i.length-1].node,h=_f[a.namespaceURI],l=fc(n,h);vc(r,gf,dc,l,i,h)}),LineStyle:uc(function(t,e,i){var r={node:t},n={color:e.getColor(),width:e.getWidth()},o=i[i.length-1].node,s=yf[o.namespaceURI],a=fc(n,s);vc(r,mf,dc,a,i,s)}),PolyStyle:uc(function(t,e,i){vc({node:t},Uf,Yf,[e.getColor()],i)})});var Vf=function(t,e,i,r,n){var o,s,a=8*n-r-1,h=(1<<a)-1,l=h>>1,u=-7,c=i?n-1:0,p=i?-1:1,d=t[e+c];c+=p;o=d&(1<<-u)-1;d>>=-u;u+=a;for(;0<u;o=256*o+t[e+c],c+=p,u-=8);s=o&(1<<-u)-1;o>>=-u;u+=r;for(;0<u;s=256*s+t[e+c],c+=p,u-=8);if(0===o)o=1-l;else{if(o===h)return s?NaN:1/0*(d?-1:1);s+=Math.pow(2,r);o-=l}return(d?-1:1)*s*Math.pow(2,o-r)},Wf=function(t,e,i,r,n,o){var s,a,h,l=8*o-n-1,u=(1<<l)-1,c=u>>1,p=23===n?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:o-1,f=r?1:-1,_=e<0||0===e&&1/e<0?1:0;e=Math.abs(e);if(isNaN(e)||e===1/0){a=isNaN(e)?1:0;s=u}else{s=Math.floor(Math.log(e)/Math.LN2);if(e*(h=Math.pow(2,-s))<1){s--;h*=2}if(2<=(e+=1<=s+c?p/h:p*Math.pow(2,1-c))*h){s++;h/=2}if(u<=s+c){a=0;s=u}else if(1<=s+c){a=(e*h-1)*Math.pow(2,n);s+=c}else{a=e*Math.pow(2,c-1)*Math.pow(2,n);s=0}}for(;8<=n;t[i+d]=255&a,d+=f,a/=256,n-=8);s=s<<n|a;l+=n;for(;0<l;t[i+d]=255&s,d+=f,s/=256,l-=8);t[i+d-f]|=128*_},Kf=Hf;function Hf(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0);this.pos=0;this.type=0;this.length=this.buf.length}Hf.Varint=0;Hf.Fixed64=1;Hf.Bytes=2;Hf.Fixed32=5;var Zf=4294967296,qf=1/Zf;Hf.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){i=i||this.length;for(;this.pos<i;){var r=this.readVarint(),n=r>>3,o=this.pos;this.type=7&r;t(n,e,this);this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=l_(this.buf,this.pos);this.pos+=4;return t},readSFixed32:function(){var t=c_(this.buf,this.pos);this.pos+=4;return t},readFixed64:function(){var t=l_(this.buf,this.pos)+l_(this.buf,this.pos+4)*Zf;this.pos+=8;return t},readSFixed64:function(){var t=l_(this.buf,this.pos)+c_(this.buf,this.pos+4)*Zf;this.pos+=8;return t},readFloat:function(){var t=Vf(this.buf,this.pos,!0,23,4);this.pos+=4;return t},readDouble:function(){var t=Vf(this.buf,this.pos,!0,52,8);this.pos+=8;return t},readVarint:function(t){var e,i,r=this.buf;e=127&(i=r[this.pos++]);if(i<128)return e;e|=(127&(i=r[this.pos++]))<<7;if(i<128)return e;e|=(127&(i=r[this.pos++]))<<14;if(i<128)return e;e|=(127&(i=r[this.pos++]))<<21;return i<128?e:function(t,e,i){var r,n,o=i.buf;n=o[i.pos++];r=(112&n)>>4;if(n<128)return Qf(t,r,e);n=o[i.pos++];r|=(127&n)<<3;if(n<128)return Qf(t,r,e);n=o[i.pos++];r|=(127&n)<<10;if(n<128)return Qf(t,r,e);n=o[i.pos++];r|=(127&n)<<17;if(n<128)return Qf(t,r,e);n=o[i.pos++];r|=(127&n)<<24;if(n<128)return Qf(t,r,e);n=o[i.pos++];r|=(1&n)<<31;if(n<128)return Qf(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=r[this.pos]))<<28,t,this)},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=function(t,e,i){var r="",n=e;for(;n<i;){var o,s,a,h=t[n],l=null,u=239<h?4:223<h?3:191<h?2:1;if(i<n+u)break;if(1===u)h<128&&(l=h);else if(2===u)128==(192&(o=t[n+1]))&&(l=(31&h)<<6|63&o)<=127&&(l=null);else if(3===u){o=t[n+1];s=t[n+2];128==(192&o)&&128==(192&s)&&((l=(15&h)<<12|(63&o)<<6|63&s)<=2047||55296<=l&&l<=57343)&&(l=null)}else if(4===u){o=t[n+1];s=t[n+2];a=t[n+3];128==(192&o)&&128==(192&s)&&128==(192&a)&&((l=(15&h)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||1114112<=l)&&(l=null)}if(null===l){l=65533;u=1}else if(65535<l){l-=65536;r+=String.fromCharCode(l>>>10&1023|55296);l=56320|1023&l}r+=String.fromCharCode(l);n+=u}return r}(this.buf,this.pos,t);this.pos=t;return e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);this.pos=t;return e},readPackedVarint:function(t,e){var i=Jf(this);t=t||[];for(;this.pos<i;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){var e=Jf(this);t=t||[];for(;this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Hf.Varint)for(;127<this.buf[this.pos++];);else if(e===Hf.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Hf.Fixed32)this.pos+=4;else{if(e!==Hf.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf);this.buf=i;this.length=e}},finish:function(){this.length=this.pos;this.pos=0;return this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4);u_(this.buf,t,this.pos);this.pos+=4},writeSFixed32:function(t){this.realloc(4);u_(this.buf,t,this.pos);this.pos+=4},writeFixed64:function(t){this.realloc(8);u_(this.buf,-1&t,this.pos);u_(this.buf,Math.floor(t*qf),this.pos+4);this.pos+=8},writeSFixed64:function(t){this.realloc(8);u_(this.buf,-1&t,this.pos);u_(this.buf,Math.floor(t*qf),this.pos+4);this.pos+=8},writeVarint:function(t){if(268435455<(t=+t||0)||t<0)!function(t,e){var i,r;if(0<=t){i=t%4294967296|0;r=t/4294967296|0}else{r=~(-t/4294967296);4294967295^(i=~(-t%4294967296))?i=i+1|0:r=r+1|(i=0)}if(0x10000000000000000<=t||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10);!function(t,e,i){i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos++]=127&t|128;t>>>=7;i.buf[i.pos]=127&t}(i,0,e);!function(t,e){var i=(7&t)<<4;e.buf[e.pos++]|=i|((t>>>=3)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t|((t>>>=7)?128:0);if(!t)return;e.buf[e.pos++]=127&t}(r,e)}(t,this);else{this.realloc(4);this.buf[this.pos++]=127&t|(127<t?128:0);if(!(t<=127)){this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0);if(!(t<=127)){this.buf[this.pos++]=127&(t>>>=7)|(127<t?128:0);t<=127||(this.buf[this.pos++]=t>>>7&127)}}}},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);this.realloc(4*t.length);this.pos++;var e=this.pos;this.pos=function(t,e,i){for(var r,n,o=0;o<e.length;o++){if(55295<(r=e.charCodeAt(o))&&r<57344){if(!n){if(56319<r||o+1===e.length){t[i++]=239;t[i++]=191;t[i++]=189}else n=r;continue}if(r<56320){t[i++]=239;t[i++]=191;t[i++]=189;n=r;continue}r=n-55296<<10|r-56320|65536;n=null}else if(n){t[i++]=239;t[i++]=191;t[i++]=189;n=null}if(r<128)t[i++]=r;else{if(r<2048)t[i++]=r>>6|192;else{if(r<65536)t[i++]=r>>12|224;else{t[i++]=r>>18|240;t[i++]=r>>12&63|128}t[i++]=r>>6&63|128}t[i++]=63&r|128}}return i}(this.buf,t,this.pos);var i=this.pos-e;128<=i&&$f(e,i,this);this.pos=e-1;this.writeVarint(i);this.pos+=i},writeFloat:function(t){this.realloc(4);Wf(this.buf,t,this.pos,!0,23,4);this.pos+=4},writeDouble:function(t){this.realloc(8);Wf(this.buf,t,this.pos,!0,52,8);this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e);this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var r=this.pos-i;128<=r&&$f(i,r,this);this.pos=i-1;this.writeVarint(r);this.pos+=r},writeMessage:function(t,e,i){this.writeTag(t,Hf.Bytes);this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,t_,e)},writePackedSVarint:function(t,e){this.writeMessage(t,e_,e)},writePackedBoolean:function(t,e){this.writeMessage(t,n_,e)},writePackedFloat:function(t,e){this.writeMessage(t,i_,e)},writePackedDouble:function(t,e){this.writeMessage(t,r_,e)},writePackedFixed32:function(t,e){this.writeMessage(t,o_,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,s_,e)},writePackedFixed64:function(t,e){this.writeMessage(t,a_,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,h_,e)},writeBytesField:function(t,e){this.writeTag(t,Hf.Bytes);this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Hf.Fixed32);this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Hf.Fixed32);this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Hf.Fixed64);this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Hf.Fixed64);this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Hf.Varint);this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Hf.Varint);this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Hf.Bytes);this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Hf.Fixed32);this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Hf.Fixed64);this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};function Jf(t){return t.type===Hf.Bytes?t.readVarint()+t.pos:t.pos+1}function Qf(t,e,i){return i?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function $f(t,e,i){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(r);for(var n=i.pos-1;t<=n;n--)i.buf[n+r]=i.buf[n]}function t_(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function e_(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function i_(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function r_(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function n_(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function o_(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function s_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function a_(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function h_(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}function l_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function u_(t,e,i){t[i]=e;t[i+1]=e>>>8;t[i+2]=e>>>16;t[i+3]=e>>>24}function c_(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}var p_=[1,0,0,1,0,0],d_=function(t,e,i,r,n){this.extent_;this.id_=n;this.type_=t;this.flatCoordinates_=e;this.flatInteriorPoints_=null;this.flatMidpoints_=null;this.ends_=i;this.properties_=r};d_.prototype.get=function(t){return this.properties_[t]};d_.prototype.getExtent=function(){this.extent_||(this.extent_=this.type_===jt.POINT?at(this.flatCoordinates_):lt(this.flatCoordinates_,0,this.flatCoordinates_.length,2));return this.extent_};d_.prototype.getFlatInteriorPoint=function(){if(!this.flatInteriorPoints_){var t=Tt(this.getExtent());this.flatInteriorPoints_=Ui(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_};d_.prototype.getFlatInteriorPoints=function(){if(!this.flatInteriorPoints_){var t=aa(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=Yi(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_};d_.prototype.getFlatMidpoint=function(){this.flatMidpoints_||(this.flatMidpoints_=ta(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5));return this.flatMidpoints_};d_.prototype.getFlatMidpoints=function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,i=this.ends_,r=0,n=i.length;r<n;++r){var o=i[r],s=ta(t,e,o,2,.5);B(this.flatMidpoints_,s);e=o}}return this.flatMidpoints_};d_.prototype.getId=function(){return this.id_};d_.prototype.getOrientedFlatCoordinates=function(){return this.flatCoordinates_};d_.prototype.getGeometry=function(){return this};d_.prototype.getSimplifiedGeometry=function(t){return this};d_.prototype.getProperties=function(){return this.properties_};d_.prototype.getStride=function(){return 2};d_.prototype.getStyleFunction=function(){};d_.prototype.getType=function(){return this.type_};d_.prototype.transform=function(t,e){var i=(t=be(t)).getExtent(),r=t.getWorldExtent(),n=Rt(r)/Rt(i);ei(p_,r[0],r[3],n,-n,0,0,0);Ut(this.flatCoordinates_,0,this.flatCoordinates_.length,2,p_,this.flatCoordinates_)};d_.prototype.getEnds=d_.prototype.getEndss=function(){return this.ends_};d_.prototype.getFlatCoordinates=d_.prototype.getOrientedFlatCoordinates;var f_=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=new se({code:"",units:ne.TILE_PIXELS});this.featureClass_=e.featureClass?e.featureClass:d_;this.geometryName_=e.geometryName;this.layerName_=e.layerName?e.layerName:"layer";this.layers_=e.layers?e.layers:null;this.extent_=null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readRawGeometry_=function(t,e,i,r){t.pos=e.geometry;for(var n=t.readVarint()+t.pos,o=1,s=0,a=0,h=0,l=0,u=0;t.pos<n;){if(!s){var c=t.readVarint();o=7&c;s=c>>3}s--;if(1===o||2===o){a+=t.readSVarint();h+=t.readSVarint();if(1===o&&u<l){r.push(l);u=l}i.push(a,h);l+=2}else if(7===o){if(u<l){i.push(i[u],i[u+1]);l+=2}}else A(!1,59)}if(u<l){r.push(l);u=l}};t.prototype.createFeature_=function(t,e,i){var r,n=e.type;if(0===n)return null;var o=e.id,s=e.properties;s[this.layerName_]=e.layer.name;var a=[],h=[];this.readRawGeometry_(t,e,a,h);var l=function(t,e){var i;1===t?i=1===e?jt.POINT:jt.MULTI_POINT:2===t?i=1===e?jt.LINE_STRING:jt.MULTI_LINE_STRING:3===t&&(i=jt.POLYGON);return i}(n,h.length);if(this.featureClass_===d_)r=new this.featureClass_(l,a,h,s,o);else{var u;if(l==jt.POLYGON){for(var c=[],p=0,d=0,f=0,_=h.length;f<_;++f){var g=h[f];if(!Zi(a,p,g,2)){c.push(h.slice(d,f));d=f}p=g}u=1<c.length?new ha(a,kt.XY,c):new tr(a,kt.XY,h)}else u=l===jt.POINT?new Ai(a,kt.XY):l===jt.LINE_STRING?new na(a,kt.XY):l===jt.POLYGON?new tr(a,kt.XY,h):l===jt.MULTI_POINT?new sa(a,kt.XY):l===jt.MULTI_LINE_STRING?new oa(a,kt.XY,h):null;r=new this.featureClass_;this.geometryName_&&r.setGeometryName(this.geometryName_);var y=Yu(u,!1,this.adaptOptions(i));r.setGeometry(y);r.setId(o);r.setProperties(s)}return r};t.prototype.getLastExtent=function(){return this.extent_};t.prototype.getType=function(){return nl.ARRAY_BUFFER};t.prototype.readFeatures=function(t,e){var i=this.layers_,r=new Kf(t),n=r.readFields(__,{}),o=[];for(var s in n)if(!i||-1!=i.indexOf(s)){for(var a=n[s],h=0,l=a.length;h<l;++h){var u=m_(r,a,h);o.push(this.createFeature_(r,u))}this.extent_=a?[0,0,a.extent,a.extent]:null}return o};t.prototype.readProjection=function(t){return this.dataProjection};t.prototype.setLayers=function(t){this.layers_=t};return t}(Uu);function __(t,e,i){if(3===t){var r={keys:[],values:[],features:[]},n=i.readVarint()+i.pos;i.readFields(g_,r,n);r.length=r.features.length;r.length&&(e[r.name]=r)}}function g_(t,e,i){if(15===t)e.version=i.readVarint();else if(1===t)e.name=i.readString();else if(5===t)e.extent=i.readVarint();else if(2===t)e.features.push(i.pos);else if(3===t)e.keys.push(i.readString());else if(4===t){for(var r=null,n=i.readVarint()+i.pos;i.pos<n;)r=1===(t=i.readVarint()>>3)?i.readString():2===t?i.readFloat():3===t?i.readDouble():4===t?i.readVarint64():5===t?i.readVarint():6===t?i.readSVarint():7===t?i.readBoolean():null;e.values.push(r)}}function y_(t,e,i){if(1==t)e.id=i.readVarint();else if(2==t)for(var r=i.readVarint()+i.pos;i.pos<r;){var n=e.layer.keys[i.readVarint()],o=e.layer.values[i.readVarint()];e.properties[n]=o}else 3==t?e.type=i.readVarint():4==t&&(e.geometry=i.pos)}function m_(t,e,i){t.pos=e.features[i];var r=t.readVarint()+t.pos,n={layer:e,type:0,properties:{}};t.readFields(y_,n,r);return n}var v_=[null],E_=_c(v_,{nd:function(t,e){e[e.length-1].ndrefs.push(t.getAttribute("ref"))},tag:R_}),T_=_c(v_,{node:function(t,e){var i=e[0],r=e[e.length-1],n=t.getAttribute("id"),o=[parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))];r.nodes[n]=o;var s=yc({tags:{}},x_,t,e);if(!Mt(s.tags)){var a=new Ai(o);Yu(a,!1,i);var h=new G(a);h.setId(n);h.setProperties(s.tags);r.features.push(h)}},way:function(t,e){var i=yc({id:t.getAttribute("id"),ndrefs:[],tags:{}},E_,t,e);e[e.length-1].ways.push(i)}}),S_=function(t){function e(){t.call(this);this.dataProjection=be("EPSG:4326")}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFeaturesFromNode=function(t,e){var i=this.getReadOptions(t,e);if("osm"==t.localName){for(var r=yc({nodes:{},ways:[],features:[]},T_,t,[i]),n=0;n<r.ways.length;n++){for(var o=r.ways[n],s=[],a=0,h=o.ndrefs.length;a<h;a++){B(s,r.nodes[o.ndrefs[a]])}var l=void 0;Yu(l=o.ndrefs[0]==o.ndrefs[o.ndrefs.length-1]?new tr(s,kt.XY,[s.length]):new na(s,kt.XY),!1,i);var u=new G(l);u.setId(o.id);u.setProperties(o.tags);r.features.push(u)}if(r.features)return r.features}return[]};return e}(Ec),x_=_c(v_,{tag:R_});function R_(t,e){e[e.length-1].tags[t.getAttribute("k")]=t.getAttribute("v")}var C_="http://www.w3.org/1999/xlink";function w_(t){return t.getAttributeNS(C_,"href")}var I_=function(){};I_.prototype.read=function(t){if(t){if("string"!=typeof t)return ic(t)?this.readFromDocument(t):this.readFromNode(t);var e=nc(t);return this.readFromDocument(e)}return null};I_.prototype.readFromDocument=function(t){};I_.prototype.readFromNode=function(t){};var L_=[null,"http://www.opengis.net/ows/1.1"],O_=_c(L_,{ServiceIdentification:lc(function(t,e){return yc({},X_,t,e)}),ServiceProvider:lc(function(t,e){return yc({},B_,t,e)}),OperationsMetadata:lc(function(t,e){return yc({},k_,t,e)})}),P_=function(t){function e(){t.call(this)}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){var e=yc({},O_,t,[]);return e||null};return e}(I_),b_=_c(L_,{DeliveryPoint:lc(bc),City:lc(bc),AdministrativeArea:lc(bc),PostalCode:lc(bc),Country:lc(bc),ElectronicMailAddress:lc(bc)}),M_=_c(L_,{Value:hc(function(t,e){return bc(t)})}),F_=_c(L_,{AllowedValues:lc(function(t,e){return yc({},M_,t,e)})}),N_=_c(L_,{Phone:lc(function(t,e){return yc({},j_,t,e)}),Address:lc(function(t,e){return yc({},b_,t,e)})}),A_=_c(L_,{HTTP:lc(function(t,e){return yc({},G_,t,e)})}),G_=_c(L_,{Get:hc(function(t,e){var i=w_(t);return i?yc({href:i},U_,t,e):void 0}),Post:void 0}),D_=_c(L_,{DCP:lc(function(t,e){return yc({},A_,t,e)})}),k_=_c(L_,{Operation:function(t,e){var i=t.getAttribute("name"),r=yc({},D_,t,e);if(!r)return;e[e.length-1][i]=r}}),j_=_c(L_,{Voice:lc(bc),Facsimile:lc(bc)}),U_=_c(L_,{Constraint:hc(function(t,e){var i=t.getAttribute("name");return i?yc({name:i},F_,t,e):void 0})}),Y_=_c(L_,{IndividualName:lc(bc),PositionName:lc(bc),ContactInfo:lc(function(t,e){return yc({},N_,t,e)})}),X_=_c(L_,{Abstract:lc(bc),AccessConstraints:lc(bc),Fees:lc(bc),Title:lc(bc),ServiceTypeVersion:lc(bc),ServiceType:lc(bc)}),B_=_c(L_,{ProviderName:lc(bc),ProviderSite:lc(w_),ServiceContact:lc(function(t,e){return yc({},Y_,t,e)})});function z_(t,e,i,r,n,o){var s,a;if(void 0!==n){s=n;a=void 0!==o?o:0}else{s=[];a=0}for(var h=e;h<i;){var l=t[h++];s[a++]=t[h++];s[a++]=l;for(var u=2;u<r;++u)s[a++]=t[h++]}s.length=a;return s}var V_=function(i){function t(t){i.call(this);var e=t||{};this.dataProjection=be("EPSG:4326");this.factor_=e.factor?e.factor:1e5;this.geometryLayout_=e.geometryLayout?e.geometryLayout:kt.XY}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeatureFromText=function(t,e){var i=this.readGeometryFromText(t,e);return new G(i)};t.prototype.readFeaturesFromText=function(t,e){return[this.readFeatureFromText(t,e)]};t.prototype.readGeometryFromText=function(t,e){var i=hi(this.geometryLayout_),r=K_(t,i,this.factor_);z_(r,0,r.length,i,r);var n=Ri(r,0,r.length,i);return Yu(new na(n,this.geometryLayout_),!1,this.adaptOptions(e))};t.prototype.writeFeatureText=function(t,e){var i=t.getGeometry();if(i)return this.writeGeometryText(i,e);A(!1,40);return""};t.prototype.writeFeaturesText=function(t,e){return this.writeFeatureText(t[0],e)};t.prototype.writeGeometryText=function(t,e){var i=(t=Yu(t,!0,this.adaptOptions(e))).getFlatCoordinates(),r=t.getStride();z_(i,0,i.length,r,i);return W_(i,r,this.factor_)};return t}(bp);function W_(t,e,i){var r,n=i||1e5,o=new Array(e);for(r=0;r<e;++r)o[r]=0;for(var s=0,a=t.length;s<a;)for(r=0;r<e;++r,++s){var h=t[s],l=h-o[r];o[r]=h;t[s]=l}return H_(t,n)}function K_(t,e,i){var r,n=i||1e5,o=new Array(e);for(r=0;r<e;++r)o[r]=0;for(var s=Z_(t,n),a=0,h=s.length;a<h;)for(r=0;r<e;++r,++a){o[r]+=s[a];s[a]=o[r]}return s}function H_(t,e){for(var i=e||1e5,r=0,n=t.length;r<n;++r)t[r]=Math.round(t[r]*i);return q_(t)}function Z_(t,e){for(var i=e||1e5,r=J_(t),n=0,o=r.length;n<o;++n)r[n]/=i;return r}function q_(t){for(var e=0,i=t.length;e<i;++e){var r=t[e];t[e]=r<0?~(r<<1):r<<1}return Q_(t)}function J_(t){for(var e=$_(t),i=0,r=e.length;i<r;++i){var n=e[i];e[i]=1&n?~(n>>1):n>>1}return e}function Q_(t){for(var e="",i=0,r=t.length;i<r;++i)e+=tg(t[i]);return e}function $_(t){for(var e=[],i=0,r=0,n=0,o=t.length;n<o;++n){var s=t.charCodeAt(n)-63;i|=(31&s)<<r;if(s<32){e.push(i);r=i=0}else r+=5}return e}function tg(t){for(var e,i="";32<=t;){e=63+(32|31&t);i+=String.fromCharCode(e);t>>=5}e=t+63;return i+=String.fromCharCode(e)}var eg=function(i){function t(t){i.call(this);var e=t||{};this.layerName_=e.layerName;this.layers_=e.layers?e.layers:null;this.dataProjection=be(e.dataProjection?e.dataProjection:"EPSG:4326")}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.readFeaturesFromObject=function(t,e){if("Topology"!=t.type)return[];var i,r=t,n=null,o=null;if(r.transform){n=(i=r.transform).scale;o=i.translate}var s=r.arcs;i&&function(t,e,i){for(var r=0,n=t.length;r<n;++r)sg(t[r],e,i)}(s,n,o);var a,h=[],l=r.objects,u=this.layerName_;for(var c in l)if(!this.layers_||-1!=this.layers_.indexOf(c))if("GeometryCollection"===l[c].type){a=l[c];h.push.apply(h,ng(a,s,n,o,u,c,e))}else{a=l[c];h.push(og(a,s,n,o,u,c,e))}return h};t.prototype.readProjectionFromObject=function(t){return this.dataProjection};return t}(Xu),ig={Point:function(t,e,i){var r=t.coordinates;e&&i&&ag(r,e,i);return new Ai(r)},LineString:function(t,e){var i=rg(t.arcs,e);return new na(i)},Polygon:function(t,e){for(var i=[],r=0,n=t.arcs.length;r<n;++r)i[r]=rg(t.arcs[r],e);return new tr(i)},MultiPoint:function(t,e,i){var r=t.coordinates;if(e&&i)for(var n=0,o=r.length;n<o;++n)ag(r[n],e,i);return new sa(r)},MultiLineString:function(t,e){for(var i=[],r=0,n=t.arcs.length;r<n;++r)i[r]=rg(t.arcs[r],e);return new oa(i)},MultiPolygon:function(t,e){for(var i=[],r=0,n=t.arcs.length;r<n;++r){for(var o=t.arcs[r],s=[],a=0,h=o.length;a<h;++a)s[a]=rg(o[a],e);i[r]=s}return new ha(i)}};function rg(t,e){for(var i,r,n=[],o=0,s=t.length;o<s;++o){i=t[o];0<o&&n.pop();r=0<=i?e[i]:e[~i].slice().reverse();n.push.apply(n,r)}for(var a=0,h=n.length;a<h;++a)n[a]=n[a].slice();return n}function ng(t,e,i,r,n,o,s){for(var a=t.geometries,h=[],l=0,u=a.length;l<u;++l)h[l]=og(a[l],e,i,r,n,o,s);return h}function og(t,e,i,r,n,o,s){var a,h=t.type,l=ig[h];a="Point"===h||"MultiPoint"===h?l(t,i,r):l(t,e);var u=new G;u.setGeometry(Yu(a,!1,s));void 0!==t.id&&u.setId(t.id);var c=t.properties;if(n){c||(c={});c[n]=o}c&&u.setProperties(c);return u}function sg(t,e,i){for(var r=0,n=0,o=0,s=t.length;o<s;++o){var a=t[o];r+=a[0];n+=a[1];a[0]=r;a[1]=n;ag(a,e,i)}}function ag(t,e,i){t[0]=t[0]*e[0]+i[0];t[1]=t[1]*e[1]+i[1]}var hg=function(t){this.tagName_=t};hg.prototype.getTagName=function(){return this.tagName_};var lg=function(i){function t(t,e){i.call(this,t);this.conditions=e;A(2<=this.conditions.length,57)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(hg),ug=function(e){function t(t){e.call(this,"And",Array.prototype.slice.call(arguments))}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(lg),cg=function(r){function t(t,e,i){r.call(this,"BBOX");this.geometryName=t;this.extent=e;this.srsName=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(hg),pg=function(n){function t(t,e,i,r){n.call(this,t);this.geometryName=e||"the_geom";this.geometry=i;this.srsName=r}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(hg),dg=function(r){function t(t,e,i){r.call(this,"Contains",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(pg),fg=function(i){function t(t,e){i.call(this,t);this.propertyName=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(hg),_g=function(r){function t(t,e,i){r.call(this,"During",t);this.begin=e;this.end=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(fg),gg=function(n){function t(t,e,i,r){n.call(this,t,e);this.expression=i;this.matchCase=r}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(fg),yg=function(r){function t(t,e,i){r.call(this,"PropertyIsEqualTo",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(gg),mg=function(i){function t(t,e){i.call(this,"PropertyIsGreaterThan",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(gg),vg=function(i){function t(t,e){i.call(this,"PropertyIsGreaterThanOrEqualTo",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(gg),Eg=function(r){function t(t,e,i){r.call(this,"Intersects",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(pg),Tg=function(r){function t(t,e,i){r.call(this,"PropertyIsBetween",t);this.lowerBoundary=e;this.upperBoundary=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(fg),Sg=function(s){function t(t,e,i,r,n,o){s.call(this,"PropertyIsLike",t);this.pattern=e;this.wildCard=void 0!==i?i:"*";this.singleChar=void 0!==r?r:".";this.escapeChar=void 0!==n?n:"!";this.matchCase=o}s&&(t.__proto__=s);return(t.prototype=Object.create(s&&s.prototype)).constructor=t}(fg),xg=function(e){function t(t){e.call(this,"PropertyIsNull",t)}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(fg),Rg=function(i){function t(t,e){i.call(this,"PropertyIsLessThan",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(gg),Cg=function(i){function t(t,e){i.call(this,"PropertyIsLessThanOrEqualTo",t,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(gg),wg=function(e){function t(t){e.call(this,"Not");this.condition=t}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(hg),Ig=function(r){function t(t,e,i){r.call(this,"PropertyIsNotEqualTo",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(gg),Lg=function(e){function t(t){e.call(this,"Or",Array.prototype.slice.call(arguments))}e&&(t.__proto__=e);return(t.prototype=Object.create(e&&e.prototype)).constructor=t}(lg),Og=function(r){function t(t,e,i){r.call(this,"Within",t,e,i)}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(pg);function Pg(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(ug,e))}function bg(t,e,i){return new cg(t,e,i)}var Mg={"http://www.opengis.net/gml":{boundedBy:lc(xc.prototype.readGeometryElement,"bounds")}},Fg={"http://www.opengis.net/wfs":{totalInserted:lc(Oc),totalUpdated:lc(Oc),totalDeleted:lc(Oc)}},Ng={"http://www.opengis.net/wfs":{TransactionSummary:lc(function(t,e){return yc({},Fg,t,e)},"transactionSummary"),InsertResults:lc(function(t,e){return yc([],zg,t,e)},"insertIds")}},Ag={"http://www.opengis.net/wfs":{PropertyName:uc(Dc)}},Gg={"http://www.opengis.net/wfs":{Insert:uc(function(t,e,i){var r=i[i.length-1],n=r.featureType,o=r.featureNS,s=r.gmlVersion,a=$u(o,n);t.appendChild(a);2===s?zc.prototype.writeFeatureElement(a,e,i):Uc.prototype.writeFeatureElement(a,e,i)}),Update:uc(function(t,e,i){var r=i[i.length-1];A(void 0!==e.getId(),27);var n=r.featureType,o=r.featurePrefix,s=r.featureNS,a=Wg(o,n),h=e.getGeometryName();t.setAttribute("typeName",a);t.setAttributeNS(kg,"xmlns:"+o,s);var l=e.getId();if(void 0!==l){for(var u=e.getKeys(),c=[],p=0,d=u.length;p<d;p++){var f=e.get(u[p]);if(void 0!==f){var _=u[p];f&&"function"==typeof f.getSimplifiedGeometry&&(_=h);c.push({name:_,value:f})}}vc({gmlVersion:r.gmlVersion,node:t,hasZ:r.hasZ,srsName:r.srsName},Gg,pc("Property"),c,i);Vg(t,l,i)}}),Delete:uc(function(t,e,i){var r=i[i.length-1];A(void 0!==e.getId(),26);var n=r.featureType,o=r.featurePrefix,s=r.featureNS,a=Wg(o,n);t.setAttribute("typeName",a);t.setAttributeNS(kg,"xmlns:"+o,s);var h=e.getId();void 0!==h&&Vg(t,h,i)}),Property:uc(function(t,e,i){var r=$u(Ug,"Name"),n=i[i.length-1].gmlVersion;t.appendChild(r);Dc(r,e.name);if(void 0!==e.value&&null!==e.value){var o=$u(Ug,"Value");t.appendChild(o);e.value&&"function"==typeof e.value.getSimplifiedGeometry?2===n?zc.prototype.writeGeometryElement(o,e.value,i):Uc.prototype.writeGeometryElement(o,e.value,i):Dc(o,e.value)}}),Native:uc(function(t,e,i){e.vendorId&&t.setAttribute("vendorId",e.vendorId);void 0!==e.safeToIgnore&&t.setAttribute("safeToIgnore",String(e.safeToIgnore));void 0!==e.value&&Dc(t,e.value)})}},Dg="feature",kg="http://www.w3.org/2000/xmlns/",jg="http://www.opengis.net/ogc",Ug="http://www.opengis.net/wfs",Yg={"1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},Xg=function(i){function t(t){i.call(this);var e=t||{};this.featureType_=e.featureType;this.featureNS_=e.featureNS;this.gmlFormat_=e.gmlFormat?e.gmlFormat:new Uc;this.schemaLocation_=e.schemaLocation?e.schemaLocation:Yg["1.1.0"]}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getFeatureType=function(){return this.featureType_};t.prototype.setFeatureType=function(t){this.featureType_=t};t.prototype.readFeaturesFromNode=function(t,e){var i={node:t};y(i,{featureType:this.featureType_,featureNS:this.featureNS_});y(i,this.getReadOptions(t,e||{}));var r=[i];this.gmlFormat_.FEATURE_COLLECTION_PARSERS[Tc].featureMember=sc(xc.prototype.readFeaturesInternal);var n=yc([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,r,this.gmlFormat_);n||(n=[]);return n};t.prototype.readTransactionResponse=function(t){if(t){if("string"!=typeof t)return ic(t)?this.readTransactionResponseFromDocument(t):this.readTransactionResponseFromNode(t);var e=nc(t);return this.readTransactionResponseFromDocument(e)}};t.prototype.readFeatureCollectionMetadata=function(t){if(t){if("string"!=typeof t)return ic(t)?this.readFeatureCollectionMetadataFromDocument(t):this.readFeatureCollectionMetadataFromNode(t);var e=nc(t);return this.readFeatureCollectionMetadataFromDocument(e)}};t.prototype.readFeatureCollectionMetadataFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(e)};t.prototype.readFeatureCollectionMetadataFromNode=function(t){var e={},i=Pc(t.getAttribute("numberOfFeatures"));e.numberOfFeatures=i;return yc(e,Mg,t,[],this.gmlFormat_)};t.prototype.readTransactionResponseFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(e)};t.prototype.readTransactionResponseFromNode=function(t){return yc({},Ng,t,[])};t.prototype.writeGetFeature=function(t){var e,i=$u(Ug,"GetFeature");i.setAttribute("service","WFS");i.setAttribute("version","1.1.0");if(t){t.handle&&i.setAttribute("handle",t.handle);t.outputFormat&&i.setAttribute("outputFormat",t.outputFormat);void 0!==t.maxFeatures&&i.setAttribute("maxFeatures",String(t.maxFeatures));t.resultType&&i.setAttribute("resultType",t.resultType);void 0!==t.startIndex&&i.setAttribute("startIndex",String(t.startIndex));void 0!==t.count&&i.setAttribute("count",String(t.count));void 0!==t.viewParams&&i.setAttribute("viewParams ",t.viewParams);e=t.filter;if(t.bbox){A(t.geometryName,12);var r=bg(t.geometryName,t.bbox,t.srsName);e=e?Pg(e,r):r}}i.setAttributeNS(Qu,"xsi:schemaLocation",this.schemaLocation_);var n={node:i};y(n,{srsName:t.srsName,featureNS:t.featureNS?t.featureNS:this.featureNS_,featurePrefix:t.featurePrefix,geometryName:t.geometryName,filter:e,propertyNames:t.propertyNames?t.propertyNames:[]});A(Array.isArray(t.featureTypes),11);!function(t,e,i){var r=i[i.length-1],n=y({},r);n.node=t;vc(n,Kg,pc("Query"),e,i)}(i,t.featureTypes,[n]);return i};t.prototype.writeTransaction=function(t,e,i,r){var n,o,s=[],a=$u(Ug,"Transaction"),h=r.version?r.version:"1.1.0",l="1.0.0"===h?2:3;a.setAttribute("service","WFS");a.setAttribute("version",h);if(r){n=r.gmlOptions?r.gmlOptions:{};r.handle&&a.setAttribute("handle",r.handle)}var u=Yg[h];a.setAttributeNS(Qu,"xsi:schemaLocation",u);var c=r.featurePrefix?r.featurePrefix:Dg;if(t){o=y({node:a},{featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:l,hasZ:r.hasZ,srsName:r.srsName});y(o,n);vc(o,Gg,pc("Insert"),t,s)}if(e){o=y({node:a},{featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:l,hasZ:r.hasZ,srsName:r.srsName});y(o,n);vc(o,Gg,pc("Update"),e,s)}i&&vc({node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:l,srsName:r.srsName},Gg,pc("Delete"),i,s);r.nativeElements&&vc({node:a,featureNS:r.featureNS,featureType:r.featureType,featurePrefix:c,gmlVersion:l,srsName:r.srsName},Gg,pc("Native"),r.nativeElements,s);return a};t.prototype.readProjectionFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(e);return null};t.prototype.readProjectionFromNode=function(t){if(t.firstElementChild&&t.firstElementChild.firstElementChild)for(var e=(t=t.firstElementChild.firstElementChild).firstElementChild;e;e=e.nextElementSibling)if(0!==e.childNodes.length&&(1!==e.childNodes.length||3!==e.firstChild.nodeType)){var i=[{}];this.gmlFormat_.readGeometryElement(e,i);return be(i.pop().srsName)}return null};return t}(Ec);var Bg={"http://www.opengis.net/ogc":{FeatureId:sc(function(t,e){return t.getAttribute("fid")})}};var zg={"http://www.opengis.net/wfs":{Feature:function(t,e){gc(Bg,t,e)}}};function Vg(t,e,i){var r=$u(jg,"Filter"),n=$u(jg,"FeatureId");r.appendChild(n);n.setAttribute("fid",e);t.appendChild(r)}function Wg(t,e){var i=(t=t||Dg)+":";return 0===e.indexOf(i)?e:i+e}var Kg={"http://www.opengis.net/wfs":{Query:uc(function(t,e,i){var r,n=i[i.length-1],o=n.featurePrefix,s=n.featureNS,a=n.propertyNames,h=n.srsName;r=o?Wg(o,e):e;t.setAttribute("typeName",r);h&&t.setAttribute("srsName",h);s&&t.setAttributeNS(kg,"xmlns:"+o,s);var l=y({},n);l.node=t;vc(l,Ag,pc("PropertyName"),a,i);var u=n.filter;if(u){var c=$u(jg,"Filter");t.appendChild(c);Hg(c,u,i)}})},"http://www.opengis.net/ogc":{During:uc(function(t,e,i){var r=$u("http://www.opengis.net/fes","ValueReference");Dc(r,e.propertyName);t.appendChild(r);var n=$u(Tc,"TimePeriod");t.appendChild(n);var o=$u(Tc,"begin");n.appendChild(o);ty(o,e.begin);var s=$u(Tc,"end");n.appendChild(s);ty(s,e.end)}),And:uc(Zg),Or:uc(Zg),Not:uc(function(t,e,i){var r={node:t},n=e.condition;vc(r,Kg,pc(n.getTagName()),[n],i)}),BBOX:uc(function(t,e,i){i[i.length-1].srsName=e.srsName;Qg(t,e.geometryName);Uc.prototype.writeGeometryElement(t,e.extent,i)}),Contains:uc(function(t,e,i){i[i.length-1].srsName=e.srsName;Qg(t,e.geometryName);Uc.prototype.writeGeometryElement(t,e.geometry,i)}),Intersects:uc(function(t,e,i){i[i.length-1].srsName=e.srsName;Qg(t,e.geometryName);Uc.prototype.writeGeometryElement(t,e.geometry,i)}),Within:uc(function(t,e,i){i[i.length-1].srsName=e.srsName;Qg(t,e.geometryName);Uc.prototype.writeGeometryElement(t,e.geometry,i)}),PropertyIsEqualTo:uc(qg),PropertyIsNotEqualTo:uc(qg),PropertyIsLessThan:uc(qg),PropertyIsLessThanOrEqualTo:uc(qg),PropertyIsGreaterThan:uc(qg),PropertyIsGreaterThanOrEqualTo:uc(qg),PropertyIsNull:uc(function(t,e,i){Qg(t,e.propertyName)}),PropertyIsBetween:uc(function(t,e,i){Qg(t,e.propertyName);var r=$u(jg,"LowerBoundary");t.appendChild(r);$g(r,""+e.lowerBoundary);var n=$u(jg,"UpperBoundary");t.appendChild(n);$g(n,""+e.upperBoundary)}),PropertyIsLike:uc(function(t,e,i){t.setAttribute("wildCard",e.wildCard);t.setAttribute("singleChar",e.singleChar);t.setAttribute("escapeChar",e.escapeChar);void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());Qg(t,e.propertyName);$g(t,""+e.pattern)})}};function Hg(t,e,i){vc({node:t},Kg,pc(e.getTagName()),[e],i)}function Zg(t,e,i){for(var r={node:t},n=e.conditions,o=0,s=n.length;o<s;++o){var a=n[o];vc(r,Kg,pc(a.getTagName()),[a],i)}}function qg(t,e,i){void 0!==e.matchCase&&t.setAttribute("matchCase",e.matchCase.toString());Qg(t,e.propertyName);$g(t,""+e.expression)}function Jg(t,e,i){var r=$u(jg,t);Dc(r,i);e.appendChild(r)}function Qg(t,e){Jg("PropertyName",t,e)}function $g(t,e){Jg("Literal",t,e)}function ty(t,e){var i=$u(Tc,"TimeInstant");t.appendChild(i);var r=$u(Tc,"timePosition");i.appendChild(r);Dc(r,e)}var ey={POINT:Ai,LINESTRING:na,POLYGON:tr,MULTIPOINT:sa,MULTILINESTRING:oa,MULTIPOLYGON:ha},iy="EMPTY",ry="Z",ny="M",oy=1,sy=2,ay=3,hy=4,ly=5,uy=6,cy={};for(var py in jt)cy[py]=jt[py].toUpperCase();var dy=function(t){this.wkt=t;this.index_=-1};dy.prototype.isAlpha_=function(t){return"a"<=t&&t<="z"||"A"<=t&&t<="Z"};dy.prototype.isNumeric_=function(t,e){return"0"<=t&&t<="9"||"."==t&&!(void 0!==e&&e)};dy.prototype.isWhiteSpace_=function(t){return" "==t||"\t"==t||"\r"==t||"\n"==t};dy.prototype.nextChar_=function(){return this.wkt.charAt(++this.index_)};dy.prototype.nextToken=function(){var t,e=this.nextChar_(),i=this.index_,r=e;if("("==e)t=sy;else if(","==e)t=ly;else if(")"==e)t=ay;else if(this.isNumeric_(e)||"-"==e){t=hy;r=this.readNumber_()}else if(this.isAlpha_(e)){t=oy;r=this.readText_()}else{if(this.isWhiteSpace_(e))return this.nextToken();if(""!==e)throw new Error("Unexpected character: "+e);t=uy}return{position:i,value:r,type:t}};dy.prototype.readNumber_=function(){var t,e=this.index_,i=!1,r=!1;do{"."==t?i=!0:"e"!=t&&"E"!=t||(r=!0);t=this.nextChar_()}while(this.isNumeric_(t,i)||!r&&("e"==t||"E"==t)||r&&("-"==t||"+"==t));return parseFloat(this.wkt.substring(e,this.index_--))};dy.prototype.readText_=function(){for(var t,e=this.index_;t=this.nextChar_(),this.isAlpha_(t););return this.wkt.substring(e,this.index_--).toUpperCase()};var fy=function(t){this.lexer_=t;this.token_;this.layout_=kt.XY};fy.prototype.consume_=function(){this.token_=this.lexer_.nextToken()};fy.prototype.isTokenType=function(t){return this.token_.type==t};fy.prototype.match=function(t){var e=this.isTokenType(t);e&&this.consume_();return e};fy.prototype.parse=function(){this.consume_();return this.parseGeometry_()};fy.prototype.parseGeometryLayout_=function(){var t=kt.XY,e=this.token_;if(this.isTokenType(oy)){var i=e.value;i===ry?t=kt.XYZ:i===ny?t=kt.XYM:"ZM"===i&&(t=kt.XYZM);t!==kt.XY&&this.consume_()}return t};fy.prototype.parseGeometryCollectionText_=function(){if(this.match(sy)){for(var t=[];t.push(this.parseGeometry_()),this.match(ly););if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parsePointText_=function(){if(this.match(sy)){var t=this.parsePoint_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return null;throw new Error(this.formatErrorMessage_())};fy.prototype.parseLineStringText_=function(){if(this.match(sy)){var t=this.parsePointList_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parsePolygonText_=function(){if(this.match(sy)){var t=this.parseLineStringTextList_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parseMultiPointText_=function(){if(this.match(sy)){var t;t=this.token_.type==sy?this.parsePointTextList_():this.parsePointList_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parseMultiLineStringText_=function(){if(this.match(sy)){var t=this.parseLineStringTextList_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parseMultiPolygonText_=function(){if(this.match(sy)){var t=this.parsePolygonTextList_();if(this.match(ay))return t}else if(this.isEmptyGeometry_())return[];throw new Error(this.formatErrorMessage_())};fy.prototype.parsePoint_=function(){for(var t=[],e=this.layout_.length,i=0;i<e;++i){var r=this.token_;if(!this.match(hy))break;t.push(r.value)}if(t.length==e)return t;throw new Error(this.formatErrorMessage_())};fy.prototype.parsePointList_=function(){for(var t=[this.parsePoint_()];this.match(ly);)t.push(this.parsePoint_());return t};fy.prototype.parsePointTextList_=function(){for(var t=[this.parsePointText_()];this.match(ly);)t.push(this.parsePointText_());return t};fy.prototype.parseLineStringTextList_=function(){for(var t=[this.parseLineStringText_()];this.match(ly);)t.push(this.parseLineStringText_());return t};fy.prototype.parsePolygonTextList_=function(){for(var t=[this.parsePolygonText_()];this.match(ly);)t.push(this.parsePolygonText_());return t};fy.prototype.isEmptyGeometry_=function(){var t=this.isTokenType(oy)&&this.token_.value==iy;t&&this.consume_();return t};fy.prototype.formatErrorMessage_=function(){return"Unexpected `"+this.token_.value+"` at position "+this.token_.position+" in `"+this.lexer_.wkt+"`"};fy.prototype.parseGeometry_=function(){var t=this.token_;if(this.match(oy)){var e=t.value;this.layout_=this.parseGeometryLayout_();if("GEOMETRYCOLLECTION"==e){var i=this.parseGeometryCollectionText_();return new wp(i)}var r,n=ey[e];if(!n)throw new Error("Invalid geometry type: "+e);switch(e){case"POINT":r=this.parsePointText_();break;case"LINESTRING":r=this.parseLineStringText_();break;case"POLYGON":r=this.parsePolygonText_();break;case"MULTIPOINT":r=this.parseMultiPointText_();break;case"MULTILINESTRING":r=this.parseMultiLineStringText_();break;case"MULTIPOLYGON":r=this.parseMultiPolygonText_();break;default:throw new Error("Invalid geometry type: "+e)}r||(r=n===ey.POINT?[NaN,NaN]:[]);return new n(r,this.layout_)}throw new Error(this.formatErrorMessage_())};var _y=function(i){function t(t){i.call(this);var e=t||{};this.splitCollection_=void 0!==e.splitCollection&&e.splitCollection}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.parse_=function(t){var e=new dy(t);return new fy(e).parse()};t.prototype.readFeatureFromText=function(t,e){var i=this.readGeometryFromText(t,e);if(i){var r=new G;r.setGeometry(i);return r}return null};t.prototype.readFeaturesFromText=function(t,e){for(var i=[],r=this.readGeometryFromText(t,e),n=[],o=0,s=(i=this.splitCollection_&&r.getType()==jt.GEOMETRY_COLLECTION?r.getGeometriesArray():[r]).length;o<s;++o){var a=new G;a.setGeometry(i[o]);n.push(a)}return n};t.prototype.readGeometryFromText=function(t,e){var i=this.parse_(t);return i?Yu(i,!1,e):null};t.prototype.writeFeatureText=function(t,e){var i=t.getGeometry();return i?this.writeGeometryText(i,e):""};t.prototype.writeFeaturesText=function(t,e){if(1==t.length)return this.writeFeatureText(t[0],e);for(var i=[],r=0,n=t.length;r<n;++r)i.push(t[r].getGeometry());var o=new wp(i);return this.writeGeometryText(o,e)};t.prototype.writeGeometryText=function(t,e){return Ey(Yu(t,!0,e))};return t}(bp);function gy(t){var e=t.getCoordinates();return 0===e.length?"":e.join(" ")}function yy(t){for(var e=t.getCoordinates(),i=[],r=0,n=e.length;r<n;++r)i.push(e[r].join(" "));return i.join(",")}function my(t){for(var e=[],i=t.getLinearRings(),r=0,n=i.length;r<n;++r)e.push("("+yy(i[r])+")");return e.join(",")}var vy={Point:gy,LineString:yy,Polygon:my,MultiPoint:function(t){for(var e=[],i=t.getPoints(),r=0,n=i.length;r<n;++r)e.push("("+gy(i[r])+")");return e.join(",")},MultiLineString:function(t){for(var e=[],i=t.getLineStrings(),r=0,n=i.length;r<n;++r)e.push("("+yy(i[r])+")");return e.join(",")},MultiPolygon:function(t){for(var e=[],i=t.getPolygons(),r=0,n=i.length;r<n;++r)e.push("("+my(i[r])+")");return e.join(",")},GeometryCollection:function(t){for(var e=[],i=t.getGeometries(),r=0,n=i.length;r<n;++r)e.push(Ey(i[r]));return e.join(",")}};function Ey(t){var e=t.getType(),i=(0,vy[e])(t);e=e.toUpperCase();if("function"==typeof t.getFlatCoordinates){var r=function(t){var e=t.getLayout(),i="";e!==kt.XYZ&&e!==kt.XYZM||(i+=ry);e!==kt.XYM&&e!==kt.XYZM||(i+=ny);return i}(t);0<r.length&&(e+=" "+r)}return 0===i.length?e+" "+iy:e+"("+i+")"}var Ty=[null,"http://www.opengis.net/wms"],Sy=_c(Ty,{Service:lc(function(t,e){return yc({},Cy,t,e)}),Capability:lc(function(t,e){return yc({},xy,t,e)})}),xy=_c(Ty,{Request:lc(function(t,e){return yc({},Fy,t,e)}),Exception:lc(function(t,e){return yc([],Oy,t,e)}),Layer:lc(function(t,e){return yc({},Py,t,e)})}),Ry=function(t){function e(){t.call(this);this.version=void 0}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){this.version=t.getAttribute("version").trim();var e=yc({version:this.version},Sy,t,[]);return e||null};return e}(I_),Cy=_c(Ty,{Name:lc(bc),Title:lc(bc),Abstract:lc(bc),KeywordList:lc(By),OnlineResource:lc(w_),ContactInformation:lc(function(t,e){return yc({},wy,t,e)}),Fees:lc(bc),AccessConstraints:lc(bc),LayerLimit:lc(Oc),MaxWidth:lc(Oc),MaxHeight:lc(Oc)}),wy=_c(Ty,{ContactPersonPrimary:lc(function(t,e){return yc({},Iy,t,e)}),ContactPosition:lc(bc),ContactAddress:lc(function(t,e){return yc({},Ly,t,e)}),ContactVoiceTelephone:lc(bc),ContactFacsimileTelephone:lc(bc),ContactElectronicMailAddress:lc(bc)}),Iy=_c(Ty,{ContactPerson:lc(bc),ContactOrganization:lc(bc)}),Ly=_c(Ty,{AddressType:lc(bc),Address:lc(bc),City:lc(bc),StateOrProvince:lc(bc),PostCode:lc(bc),Country:lc(bc)}),Oy=_c(Ty,{Format:sc(bc)}),Py=_c(Ty,{Name:lc(bc),Title:lc(bc),Abstract:lc(bc),KeywordList:lc(By),CRS:hc(bc),EX_GeographicBoundingBox:lc(function(t,e){var i=yc({},My,t,e);if(!i)return;var r=i.westBoundLongitude,n=i.southBoundLatitude,o=i.eastBoundLongitude,s=i.northBoundLatitude;return void 0!==r&&void 0!==n&&void 0!==o&&void 0!==s?[r,n,o,s]:void 0}),BoundingBox:hc(function(t,e){var i=[Lc(t.getAttribute("minx")),Lc(t.getAttribute("miny")),Lc(t.getAttribute("maxx")),Lc(t.getAttribute("maxy"))],r=[Lc(t.getAttribute("resx")),Lc(t.getAttribute("resy"))];return{crs:t.getAttribute("CRS"),extent:i,res:r}}),Dimension:hc(function(t,e){return{name:t.getAttribute("name"),units:t.getAttribute("units"),unitSymbol:t.getAttribute("unitSymbol"),default:t.getAttribute("default"),multipleValues:Cc(t.getAttribute("multipleValues")),nearestValue:Cc(t.getAttribute("nearestValue")),current:Cc(t.getAttribute("current")),values:bc(t)}}),Attribution:lc(function(t,e){return yc({},by,t,e)}),AuthorityURL:hc(function(t,e){var i=Uy(t,e);if(i){i.name=t.getAttribute("name");return i}return}),Identifier:hc(bc),MetadataURL:hc(function(t,e){var i=Uy(t,e);if(i){i.type=t.getAttribute("type");return i}return}),DataURL:hc(Uy),FeatureListURL:hc(Uy),Style:hc(function(t,e){return yc({},Dy,t,e)}),MinScaleDenominator:lc(Ic),MaxScaleDenominator:lc(Ic),Layer:hc(function(t,e){var i=e[e.length-1],r=yc({},Py,t,e);if(!r)return;var n=Cc(t.getAttribute("queryable"));void 0===n&&(n=i.queryable);r.queryable=void 0!==n&&n;var o=Pc(t.getAttribute("cascaded"));void 0===o&&(o=i.cascaded);r.cascaded=o;var s=Cc(t.getAttribute("opaque"));void 0===s&&(s=i.opaque);r.opaque=void 0!==s&&s;var a=Cc(t.getAttribute("noSubsets"));void 0===a&&(a=i.noSubsets);r.noSubsets=void 0!==a&&a;var h=Lc(t.getAttribute("fixedWidth"));h||(h=i.fixedWidth);r.fixedWidth=h;var l=Lc(t.getAttribute("fixedHeight"));l||(l=i.fixedHeight);r.fixedHeight=l;["Style","CRS","AuthorityURL"].forEach(function(t){if(t in i){var e=r[t]||[];r[t]=e.concat(i[t])}});["EX_GeographicBoundingBox","BoundingBox","Dimension","Attribution","MinScaleDenominator","MaxScaleDenominator"].forEach(function(t){if(!(t in r)){var e=i[t];r[t]=e}});return r})}),by=_c(Ty,{Title:lc(bc),OnlineResource:lc(w_),LogoURL:lc(Xy)}),My=_c(Ty,{westBoundLongitude:lc(Ic),eastBoundLongitude:lc(Ic),southBoundLatitude:lc(Ic),northBoundLatitude:lc(Ic)}),Fy=_c(Ty,{GetCapabilities:lc(Yy),GetMap:lc(Yy),GetFeatureInfo:lc(Yy)}),Ny=_c(Ty,{Format:hc(bc),DCPType:hc(function(t,e){return yc({},Ay,t,e)})}),Ay=_c(Ty,{HTTP:lc(function(t,e){return yc({},Gy,t,e)})}),Gy=_c(Ty,{Get:lc(Uy),Post:lc(Uy)}),Dy=_c(Ty,{Name:lc(bc),Title:lc(bc),Abstract:lc(bc),LegendURL:hc(Xy),StyleSheetURL:lc(Uy),StyleURL:lc(Uy)}),ky=_c(Ty,{Format:lc(bc),OnlineResource:lc(w_)}),jy=_c(Ty,{Keyword:sc(bc)});function Uy(t,e){return yc({},ky,t,e)}function Yy(t,e){return yc({},Ny,t,e)}function Xy(t,e){var i=Uy(t,e);if(i){var r=[Pc(t.getAttribute("width")),Pc(t.getAttribute("height"))];i.size=r;return i}}function By(t,e){return yc([],jy,t,e)}var zy=function(i){function t(t){i.call(this);var e=t||{};this.featureNS_="http://mapserver.gis.umn.edu/mapserver";this.gmlFormat_=new zc;this.layers_=e.layers?e.layers:null}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getLayers=function(){return this.layers_};t.prototype.setLayers=function(t){this.layers_=t};t.prototype.readFeatures_=function(t,e){t.setAttribute("namespaceURI",this.featureNS_);var i=t.localName,r=[];if(0===t.childNodes.length)return r;if("msGMLOutput"==i)for(var n=0,o=t.childNodes.length;n<o;n++){var s=t.childNodes[n];if(s.nodeType===Node.ELEMENT_NODE){var a=s,h=e[0],l=a.localName.replace("_layer","");if(!this.layers_||U(this.layers_,l)){var u=l+"_feature";h.featureType=u;h.featureNS=this.featureNS_;var c={};c[u]=sc(this.gmlFormat_.readFeatureElement,this.gmlFormat_);var p=_c([h.featureNS,null],c);a.setAttribute("namespaceURI",this.featureNS_);var d=yc([],p,a,e,this.gmlFormat_);d&&B(r,d)}}}if("FeatureCollection"==i){var f=yc([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,t,[{}],this.gmlFormat_);f&&(r=f)}return r};t.prototype.readFeaturesFromNode=function(t,e){var i={};e&&y(i,this.getReadOptions(t,e));return this.readFeatures_(t,[i])};return t}(Ec),Vy=[null,"http://www.opengis.net/wmts/1.0"],Wy=[null,"http://www.opengis.net/ows/1.1"],Ky=_c(Vy,{Contents:lc(function(t,e){return yc({},Zy,t,e)})}),Hy=function(t){function e(){t.call(this);this.owsParser_=new P_}t&&(e.__proto__=t);((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.readFromDocument=function(t){for(var e=t.firstChild;e;e=e.nextSibling)if(e.nodeType==Node.ELEMENT_NODE)return this.readFromNode(e);return null};e.prototype.readFromNode=function(t){var e=t.getAttribute("version").trim(),i=this.owsParser_.readFromNode(t);if(!i)return null;i.version=e;return(i=yc(i,Ky,t,[]))||null};return e}(I_),Zy=_c(Vy,{Layer:hc(function(t,e){return yc({},qy,t,e)}),TileMatrixSet:hc(function(t,e){return yc({},rm,t,e)})}),qy=_c(Vy,{Style:hc(function(t,e){var i=yc({},Jy,t,e);if(!i)return;var r="true"===t.getAttribute("isDefault");i.isDefault=r;return i}),Format:hc(bc),TileMatrixSetLink:hc(function(t,e){return yc({},Qy,t,e)}),Dimension:hc(function(t,e){return yc({},em,t,e)}),ResourceURL:hc(function(t,e){var i=t.getAttribute("format"),r=t.getAttribute("template"),n=t.getAttribute("resourceType"),o={};i&&(o.format=i);r&&(o.template=r);n&&(o.resourceType=n);return o})},_c(Wy,{Title:lc(bc),Abstract:lc(bc),WGS84BoundingBox:lc(function(t,e){var i=yc([],im,t,e);return 2==i.length?q(i):void 0}),Identifier:lc(bc)})),Jy=_c(Vy,{LegendURL:hc(function(t,e){var i={};i.format=t.getAttribute("format");i.href=w_(t);return i})},_c(Wy,{Title:lc(bc),Identifier:lc(bc)})),Qy=_c(Vy,{TileMatrixSet:lc(bc),TileMatrixSetLimits:lc(function(t,e){return yc([],$y,t,e)})}),$y=_c(Vy,{TileMatrixLimits:sc(function(t,e){return yc({},tm,t,e)})}),tm=_c(Vy,{TileMatrix:lc(bc),MinTileRow:lc(Oc),MaxTileRow:lc(Oc),MinTileCol:lc(Oc),MaxTileCol:lc(Oc)}),em=_c(Vy,{Default:lc(bc),Value:hc(bc)},_c(Wy,{Identifier:lc(bc)})),im=_c(Wy,{LowerCorner:sc(om),UpperCorner:sc(om)}),rm=_c(Vy,{WellKnownScaleSet:lc(bc),TileMatrix:hc(function(t,e){return yc({},nm,t,e)})},_c(Wy,{SupportedCRS:lc(bc),Identifier:lc(bc)})),nm=_c(Vy,{TopLeftCorner:lc(om),ScaleDenominator:lc(Ic),TileWidth:lc(Oc),TileHeight:lc(Oc),MatrixWidth:lc(Oc),MatrixHeight:lc(Oc)},_c(Wy,{Identifier:lc(bc)}));function om(t,e){var i=bc(t).split(/\s+/);if(i&&2==i.length){var r=+i[0],n=+i[1];if(!isNaN(r)&&!isNaN(n))return[r,n]}}var sm=function(i){function t(t){var e=t||{};i.call(this,e)}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(Zo);sm.prototype.getSource;var am={PRELOAD:"preload",USE_INTERIM_TILES_ON_ERROR:"useInterimTilesOnError"},hm=function(r){function t(t){var e=t||{},i=y({},e);delete i.preload;delete i.useInterimTilesOnError;r.call(this,i);this.setPreload(void 0!==e.preload?e.preload:0);this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getPreload=function(){return this.get(am.PRELOAD)};t.prototype.setPreload=function(t){this.set(am.PRELOAD,t)};t.prototype.getUseInterimTilesOnError=function(){return this.get(am.USE_INTERIM_TILES_ON_ERROR)};t.prototype.setUseInterimTilesOnError=function(t){this.set(am.USE_INTERIM_TILES_ON_ERROR,t)};return t}(Zo);hm.prototype.getSource;function lm(t,e,i){for(var r,n,o,s,a,h,l=[],u=t(0),c=t(1),p=e(u),d=e(c),f=[c,u],_=[d,p],g=[1,0],y={},m=1e5;0<--m&&0<g.length;){o=g.pop();u=f.pop();p=_.pop();if(!((h=o.toString())in y)){l.push(p[0],p[1]);y[h]=!0}s=g.pop();c=f.pop();d=_.pop();if(Wt((n=e(r=t(a=(o+s)/2)))[0],n[1],p[0],p[1],d[0],d[1])<i){l.push(d[0],d[1]);y[h=s.toString()]=!0}else{g.push(s,a,a,o);_.push(d,n,n,p);f.push(c,r,r,u)}}return l}function um(e,i,r,t,n){return lm(function(t){return[e,i+(r-i)*t]},Ue(be("EPSG:4326"),t),n)}function cm(e,i,r,t,n){return lm(function(t){return[i+(r-i)*t,e]},Ue(be("EPSG:4326"),t),n)}var pm=new Ha({color:"rgba(0,0,0,0.2)"}),dm=[90,45,30,20,10,5,2,1,.5,.2,.1,.05,.01,.005,.002,.001],fm=function(r){function t(t){var i=t||{},e=y({},i);delete e.maxLines;delete e.strokeStyle;delete e.targetSize;delete e.showLabels;delete e.lonLabelFormatter;delete e.latLabelFormatter;delete e.lonLabelPosition;delete e.latLabelPosition;delete e.lonLabelStyle;delete e.latLabelStyle;delete e.intervals;r.call(this,e);this.projection_=null;this.maxLat_=1/0;this.maxLon_=1/0;this.minLat_=-1/0;this.minLon_=-1/0;this.maxLatP_=1/0;this.maxLonP_=1/0;this.minLatP_=-1/0;this.minLonP_=-1/0;this.targetSize_=void 0!==i.targetSize?i.targetSize:100;this.maxLines_=void 0!==i.maxLines?i.maxLines:100;this.meridians_=[];this.parallels_=[];this.strokeStyle_=void 0!==i.strokeStyle?i.strokeStyle:pm;this.fromLonLatTransform_=void 0;this.toLonLatTransform_=void 0;this.projectionCenterLonLat_=null;this.meridiansLabels_=null;this.parallelsLabels_=null;if(i.showLabels){this.lonLabelFormatter_=null==i.lonLabelFormatter?fo.bind(this,"EW"):i.lonLabelFormatter;this.latLabelFormatter_=null==i.latLabelFormatter?fo.bind(this,"NS"):i.latLabelFormatter;this.lonLabelPosition_=null==i.lonLabelPosition?0:i.lonLabelPosition;this.latLabelPosition_=null==i.latLabelPosition?1:i.latLabelPosition;this.lonLabelStyleCache_={};this.lonLabelStyle_=function(t){var e=t.get("graticule_label");this.lonLabelStyleCache_[e]||(this.lonLabelStyleCache_[e]=new Za({text:void 0!==i.lonLabelStyle?i.lonLabelStyle:new Wp({text:e,font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new Ka({color:"rgba(0,0,0,1)"}),stroke:new Ha({color:"rgba(255,255,255,1)",width:3})})}));return this.lonLabelStyleCache_[e]}.bind(this);this.latLabelStyleCache_={};this.latLabelStyle_=function(t){var e=t.get("graticule_label");this.latLabelStyleCache_[e]||(this.latLabelStyleCache_[e]=new Za({text:void 0!==i.latLabelStyle?i.latLabelStyle:new Wp({text:e,font:"12px Calibri,sans-serif",textAlign:"right",fill:new Ka({color:"rgba(0,0,0,1)"}),stroke:new Ha({color:"rgba(255,255,255,1)",width:3})})}));return this.latLabelStyleCache_[e]}.bind(this);this.meridiansLabels_=[];this.parallelsLabels_=[]}this.intervals_=void 0!==i.intervals?i.intervals:dm;this.setSource(new fl({loader:this.loaderFunction.bind(this),strategy:hl,features:new N,overlaps:!1,useSpatialIndex:!1,wrapX:i.wrapX}));this.featurePool_=[];this.lineStyle_=new Za({stroke:this.strokeStyle_});this.renderedExtent_=null;this.setRenderOrder(null);this.renderBuffer_=0;this.updateWhileAnimating_=!0;this.updateWhileInteracting_=!0;this.tmpExtent_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.loaderFunction=function(t,e,i){var r=this.getSource(),n=Ct(this.getExtent()||[-1/0,-1/0,1/0,1/0],t,this.tmpExtent_);setTimeout(function(){r.removeLoadedExtent(t)},0);if(!(this.renderedExtent_&&ut(this.renderedExtent_,n)||Ot(this.renderedExtent_=n))){var o=Tt(n),s=e*e/4;(!this.projection_||!ke(this.projection_,i))&&this.updateProjectionInfo_(i);this.createGraticule_(n,o,e,s);var a,h=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(h+=this.meridiansLabels_.length);this.parallelsLabels_&&(h+=this.parallelsLabels_.length);for(;h>this.featurePool_.length;){a=new G;this.featurePool_.push(a)}var l=r.getFeaturesCollection();l.clear();var u,c,p,d=0;for(u=0,c=this.meridians_.length;u<c;++u){(a=this.featurePool_[d++]).setGeometry(this.meridians_[u]);a.setStyle(this.lineStyle_);l.push(a)}for(u=0,c=this.parallels_.length;u<c;++u){(a=this.featurePool_[d++]).setGeometry(this.parallels_[u]);a.setStyle(this.lineStyle_);l.push(a)}if(this.meridiansLabels_)for(u=0,c=this.meridiansLabels_.length;u<c;++u){p=this.meridiansLabels_[u];(a=this.featurePool_[d++]).setGeometry(p.geom);a.setStyle(this.lonLabelStyle_);a.set("graticule_label",p.text);l.push(a)}if(this.parallelsLabels_)for(u=0,c=this.parallelsLabels_.length;u<c;++u){p=this.parallelsLabels_[u];(a=this.featurePool_[d++]).setGeometry(p.geom);a.setStyle(this.latLabelStyle_);a.set("graticule_label",p.text);l.push(a)}}};t.prototype.addMeridian_=function(t,e,i,r,n,o){var s=this.getMeridian_(t,e,i,r,o);if(Nt(s.getExtent(),n)){if(this.meridiansLabels_){var a=this.getMeridianPoint_(s,n,o);this.meridiansLabels_[o]={geom:a,text:this.lonLabelFormatter_(t)}}this.meridians_[o++]=s}return o};t.prototype.addParallel_=function(t,e,i,r,n,o){var s=this.getParallel_(t,e,i,r,o);if(Nt(s.getExtent(),n)){if(this.parallelsLabels_){var a=this.getParallelPoint_(s,n,o);this.parallelsLabels_[o]={geom:a,text:this.latLabelFormatter_(t)}}this.parallels_[o++]=s}return o};t.prototype.createGraticule_=function(t,e,i,r){var n=this.getInterval_(i);if(-1!=n){var o,s,a,h,l=this.toLonLatTransform_(e),u=l[0],c=l[1],p=this.maxLines_,d=[Math.max(t[0],this.minLonP_),Math.max(t[1],this.minLatP_),Math.min(t[2],this.maxLonP_),Math.min(t[3],this.maxLatP_)],f=(d=Xe(d,this.projection_,"EPSG:4326"))[3],_=d[2],g=d[1],y=d[0];h=zt(u=Math.floor(u/n)*n,this.minLon_,this.maxLon_);s=this.addMeridian_(h,g,f,r,t,0);o=0;for(;h!=this.minLon_&&o++<p;){h=Math.max(h-n,this.minLon_);s=this.addMeridian_(h,g,f,r,t,s)}h=zt(u,this.minLon_,this.maxLon_);o=0;for(;h!=this.maxLon_&&o++<p;){h=Math.min(h+n,this.maxLon_);s=this.addMeridian_(h,g,f,r,t,s)}this.meridians_.length=s;this.meridiansLabels_&&(this.meridiansLabels_.length=s);a=zt(c=Math.floor(c/n)*n,this.minLat_,this.maxLat_);s=this.addParallel_(a,y,_,r,t,0);o=0;for(;a!=this.minLat_&&o++<p;){a=Math.max(a-n,this.minLat_);s=this.addParallel_(a,y,_,r,t,s)}a=zt(c,this.minLat_,this.maxLat_);o=0;for(;a!=this.maxLat_&&o++<p;){a=Math.min(a+n,this.maxLat_);s=this.addParallel_(a,y,_,r,t,s)}this.parallels_.length=s;this.parallelsLabels_&&(this.parallelsLabels_.length=s)}else{this.meridians_.length=this.parallels_.length=0;this.meridiansLabels_&&(this.meridiansLabels_.length=0);this.parallelsLabels_&&(this.parallelsLabels_.length=0)}};t.prototype.getInterval_=function(t){for(var e=this.projectionCenterLonLat_[0],i=this.projectionCenterLonLat_[1],r=-1,n=Math.pow(this.targetSize_*t,2),o=[],s=[],a=0,h=this.intervals_.length;a<h;++a){var l=this.intervals_[a]/2;o[0]=e-l;o[1]=i-l;s[0]=e+l;s[1]=i+l;this.fromLonLatTransform_(o,o);this.fromLonLatTransform_(s,s);if(Math.pow(s[0]-o[0],2)+Math.pow(s[1]-o[1],2)<=n)break;r=this.intervals_[a]}return r};t.prototype.getMeridian_=function(t,e,i,r,n){var o=um(t,e,i,this.projection_,r),s=this.meridians_[n];if(s){s.setFlatCoordinates(kt.XY,o);s.changed()}else s=this.meridians_[n]=new na(o,kt.XY);return s};t.prototype.getMeridianPoint_=function(t,e,i){var r,n=t.getFlatCoordinates(),o=Math.max(e[1],n[1]),s=Math.min(e[3],n[n.length-1]),a=zt(e[1]+Math.abs(e[1]-e[3])*this.lonLabelPosition_,o,s),h=[n[0],a];i in this.meridiansLabels_?(r=this.meridiansLabels_[i].geom).setCoordinates(h):r=new Ai(h);return r};t.prototype.getMeridians=function(){return this.meridians_};t.prototype.getParallel_=function(t,e,i,r,n){var o=cm(t,e,i,this.projection_,r),s=this.parallels_[n];if(s){s.setFlatCoordinates(kt.XY,o);s.changed()}else s=new na(o,kt.XY);return s};t.prototype.getParallelPoint_=function(t,e,i){var r,n=t.getFlatCoordinates(),o=Math.max(e[0],n[0]),s=Math.min(e[2],n[n.length-2]),a=[zt(e[0]+Math.abs(e[0]-e[2])*this.latLabelPosition_,o,s),n[1]];i in this.parallelsLabels_?(r=this.parallelsLabels_[i].geom).setCoordinates(a):r=new Ai(a);return r};t.prototype.getParallels=function(){return this.parallels_};t.prototype.updateProjectionInfo_=function(t){var e=be("EPSG:4326"),i=t.getWorldExtent(),r=Xe(i,e,t);this.maxLat_=i[3];this.maxLon_=i[2];this.minLat_=i[1];this.minLon_=i[0];this.maxLatP_=r[3];this.maxLonP_=r[2];this.minLatP_=r[1];this.minLonP_=r[0];this.fromLonLatTransform_=Ue(e,t);this.toLonLatTransform_=Ue(t,e);this.projectionCenterLonLat_=this.toLonLatTransform_(Tt(t.getExtent()));this.projection_=t};return t}(rl),_m=35044,gm=function(t,e){this.arr_=void 0!==t?t:[];this.usage_=void 0!==e?e:_m};gm.prototype.getArray=function(){return this.arr_};gm.prototype.getUsage=function(){return this.usage_};var ym={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"};function mm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function vm(t,e){t[0]=e[0];t[1]=e[1];t[4]=e[2];t[5]=e[3];t[12]=e[4];t[13]=e[5];return t}var Em=function(e){this.gl_=e.webGlContext;var i=this.gl_;this.scaleRatio_=e.scaleRatio||1;this.renderTargetTexture_=i.createTexture();this.renderTargetTextureSize_=null;this.frameBuffer_=i.createFramebuffer();var t=i.createShader(i.VERTEX_SHADER);i.shaderSource(t,e.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n");i.compileShader(t);var r=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(r,e.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n   \n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord);\n    gl_FragColor.rgb *= gl_FragColor.a;\n  }\n");i.compileShader(r);this.renderTargetProgram_=i.createProgram();i.attachShader(this.renderTargetProgram_,t);i.attachShader(this.renderTargetProgram_,r);i.linkProgram(this.renderTargetProgram_);this.renderTargetVerticesBuffer_=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_);i.bufferData(i.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),i.STATIC_DRAW);this.renderTargetAttribLocation_=i.getAttribLocation(this.renderTargetProgram_,"a_position");this.renderTargetUniformLocation_=i.getUniformLocation(this.renderTargetProgram_,"u_screenSize");this.renderTargetTextureLocation_=i.getUniformLocation(this.renderTargetProgram_,"u_image");this.uniforms_=[];e.uniforms&&Object.keys(e.uniforms).forEach(function(t){this.uniforms_.push({value:e.uniforms[t],location:i.getUniformLocation(this.renderTargetProgram_,t)})}.bind(this))};Em.prototype.getGL=function(){return this.gl_};Em.prototype.init=function(t){var e=this.getGL(),i=e.canvas,r=t.size;e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer());e.viewport(0,0,i.width*this.scaleRatio_,i.height*this.scaleRatio_);if(!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=e.RGBA,o=e.RGBA,s=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_);e.texImage2D(e.TEXTURE_2D,0,n,i.width*this.scaleRatio_,i.height*this.scaleRatio_,0,o,s,null);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE);e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}};Em.prototype.apply=function(t,e){var i=this.getGL(),r=i.canvas;i.bindFramebuffer(i.FRAMEBUFFER,e?e.getFrameBuffer():null);i.activeTexture(i.TEXTURE0);i.bindTexture(i.TEXTURE_2D,this.renderTargetTexture_);i.clearColor(0,0,0,0);i.clear(i.COLOR_BUFFER_BIT);i.enable(i.BLEND);i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA);i.viewport(0,0,r.width,r.height);i.bindBuffer(i.ARRAY_BUFFER,this.renderTargetVerticesBuffer_);i.useProgram(this.renderTargetProgram_);i.enableVertexAttribArray(this.renderTargetAttribLocation_);i.vertexAttribPointer(this.renderTargetAttribLocation_,2,i.FLOAT,!1,0,0);i.uniform2f(this.renderTargetUniformLocation_,r.width,r.height);i.uniform1i(this.renderTargetTextureLocation_,0);this.applyUniforms(t);i.drawArrays(i.TRIANGLES,0,6)};Em.prototype.getFrameBuffer=function(){return this.frameBuffer_};Em.prototype.applyUniforms=function(e){var i,r=this.getGL(),n=1;this.uniforms_.forEach(function(t){if((i="function"==typeof t.value?t.value(e):t.value)instanceof HTMLCanvasElement||i instanceof ImageData){t.texture||(t.texture=r.createTexture());r.activeTexture(r["TEXTURE"+n]);r.bindTexture(r.TEXTURE_2D,t.texture);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);i instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i.width,i.height,0,r.UNSIGNED_BYTE,new Uint8Array(i.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i);r.uniform1i(t.location,n++)}else if(Array.isArray(i))switch(i.length){case 2:r.uniform2f(t.location,i[0],i[1]);return;case 3:r.uniform3f(t.location,i[0],i[1],i[2]);return;case 4:r.uniform4f(t.location,i[0],i[1],i[2],i[3]);return;default:return}else"number"==typeof i&&r.uniform1f(t.location,i)})};var Tm={PROJECTION_MATRIX:"u_projectionMatrix",OFFSET_SCALE_MATRIX:"u_offsetScaleMatrix",OFFSET_ROTATION_MATRIX:"u_offsetRotateMatrix"},Sm={POSITION:"a_position",TEX_COORD:"a_texCoord",OPACITY:"a_opacity",ROTATE_WITH_VIEW:"a_rotateWithView",OFFSETS:"a_offsets"},xm=function(r){function t(t){r.call(this);var e=t||{};this.canvas_=document.createElement("canvas");this.canvas_.style.position="absolute";this.gl_=this.canvas_.getContext("webgl");var i=this.getGL();this.bufferCache_={};this.shaderCache_=[];this.programCache_=[];this.currentProgram_=null;this.hasOESElementIndexUint=U(ur,"OES_element_index_uint");this.hasOESElementIndexUint&&i.getExtension("OES_element_index_uint");m(this.canvas_,ym.LOST,this.handleWebGLContextLost,this);m(this.canvas_,ym.RESTORED,this.handleWebGLContextRestored,this);this.projectionMatrix_=[1,0,0,1,0,0];this.offsetRotateMatrix_=[1,0,0,1,0,0];this.offsetScaleMatrix_=[1,0,0,1,0,0];this.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];this.uniformLocations_={};this.attribLocations_={};this.uniforms_=[];e.uniforms&&Object.keys(e.uniforms).forEach(function(t){this.uniforms_.push({name:t,value:e.uniforms[t]})}.bind(this));this.postProcessPasses_=e.postProcesses?e.postProcesses.map(function(t){return new Em({webGlContext:i,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})}):[new Em({webGlContext:i})];this.shaderCompileErrors_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.bindBuffer=function(t,e){var i,r=this.getGL(),n=e.getArray(),o=bt(e),s=this.bufferCache_[o];if(!s){var a=r.createBuffer();s=this.bufferCache_[o]={buf:e,buffer:a}}r.bindBuffer(t,s.buffer);34962==t?i=new Float32Array(n):34963==t&&(i=this.hasOESElementIndexUint?new Uint32Array(n):new Uint16Array(n));r.bufferData(t,i,e.getUsage())};t.prototype.deleteBuffer=function(t){var e=this.getGL(),i=bt(t),r=this.bufferCache_[i];e.isContextLost()||e.deleteBuffer(r.buffer);delete this.bufferCache_[i]};t.prototype.disposeInternal=function(){v(this.canvas_);var t=this.getGL();if(!t.isContextLost()){for(var e in this.bufferCache_)t.deleteBuffer(this.bufferCache_[e].buffer);for(var i in this.programCache_)t.deleteProgram(this.programCache_[i]);for(var r in this.shaderCache_)t.deleteShader(this.shaderCache_[r])}};t.prototype.prepareDraw=function(t){var e=this.getGL(),i=this.getCanvas(),r=t.size,n=t.pixelRatio;i.width=r[0]*n;i.height=r[1]*n;i.style.width=r[0]+"px";i.style.height=r[1]+"px";e.useProgram(this.currentProgram_);for(var o=this.postProcessPasses_.length-1;0<=o;o--)this.postProcessPasses_[o].init(t);e.bindTexture(e.TEXTURE_2D,null);e.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);e.enable(e.BLEND);e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA);this.applyFrameState(t);this.applyUniforms(t)};t.prototype.drawElements=function(t,e){var i=this.getGL(),r=this.hasOESElementIndexUint?i.UNSIGNED_INT:i.UNSIGNED_SHORT,n=e-t,o=t*(this.hasOESElementIndexUint?4:2);i.drawElements(i.TRIANGLES,n,r,o)};t.prototype.finalizeDraw=function(t){for(var e=0;e<this.postProcessPasses_.length;e++)this.postProcessPasses_[e].apply(t,this.postProcessPasses_[e+1]||null)};t.prototype.getCanvas=function(){return this.canvas_};t.prototype.getGL=function(){return this.gl_};t.prototype.applyFrameState=function(t){var e=t.size,i=t.viewState.rotation,r=t.viewState.resolution,n=t.viewState.center,o=We(this.projectionMatrix_);Qe(o,2/(r*e[0]),2/(r*e[1]));Je(o,-i);ti(o,-n[0],-n[1]);var s=We(this.offsetScaleMatrix_);Qe(s,2/e[0],2/e[1]);var a=We(this.offsetRotateMatrix_);0!==i&&Je(a,-i);this.setUniformMatrixValue(Tm.PROJECTION_MATRIX,vm(this.tmpMat4_,o));this.setUniformMatrixValue(Tm.OFFSET_SCALE_MATRIX,vm(this.tmpMat4_,s));this.setUniformMatrixValue(Tm.OFFSET_ROTATION_MATRIX,vm(this.tmpMat4_,a))};t.prototype.applyUniforms=function(e){var i,r=this.getGL(),n=0;this.uniforms_.forEach(function(t){if((i="function"==typeof t.value?t.value(e):t.value)instanceof HTMLCanvasElement||i instanceof ImageData){t.texture||(t.texture=r.createTexture());r.activeTexture(r["TEXTURE"+n]);r.bindTexture(r.TEXTURE_2D,t.texture);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE);r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE);i instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,i.width,i.height,0,r.UNSIGNED_BYTE,new Uint8Array(i.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,i);r.uniform1i(this.getUniformLocation(t.name),n++)}else if(Array.isArray(i))switch(i.length){case 2:r.uniform2f(this.getUniformLocation(t.name),i[0],i[1]);return;case 3:r.uniform3f(this.getUniformLocation(t.name),i[0],i[1],i[2]);return;case 4:r.uniform4f(this.getUniformLocation(t.name),i[0],i[1],i[2],i[3]);return;default:return}else"number"==typeof i&&r.uniform1f(this.getUniformLocation(t.name),i)}.bind(this))};t.prototype.useProgram=function(t){if(t==this.currentProgram_)return!1;this.getGL().useProgram(t);this.currentProgram_=t;this.uniformLocations_={};this.attribLocations_={};return!0};t.prototype.compileShader=function(t,e){var i=this.getGL(),r=i.createShader(e);i.shaderSource(r,t);i.compileShader(r);this.shaderCache_.push(r);return r};t.prototype.getProgram=function(t,e){var i=this.getGL(),r=this.compileShader(t,i.FRAGMENT_SHADER),n=this.compileShader(e,i.VERTEX_SHADER);this.shaderCompileErrors_=null;i.getShaderInfoLog(r)&&(this.shaderCompileErrors_="Fragment shader compilation failed:\n"+i.getShaderInfoLog(r));i.getShaderInfoLog(n)&&(this.shaderCompileErrors_=(this.shaderCompileErrors_||"")+"Vertex shader compilation failed:\n"+i.getShaderInfoLog(n));var o=i.createProgram();i.attachShader(o,r);i.attachShader(o,n);i.linkProgram(o);this.programCache_.push(o);return o};t.prototype.getShaderCompileErrors=function(){return this.shaderCompileErrors_};t.prototype.getUniformLocation=function(t){void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t));return this.uniformLocations_[t]};t.prototype.getAttributeLocation=function(t){void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t));return this.attribLocations_[t]};t.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)};t.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)};t.prototype.enableAttributeArray=function(t,e,i,r,n){var o=this.getAttributeLocation(t);if(!(o<0)){this.getGL().enableVertexAttribArray(o);this.getGL().vertexAttribPointer(o,e,i,!1,r,n)}};t.prototype.handleWebGLContextLost=function(){_(this.bufferCache_);_(this.shaderCache_);_(this.programCache_);this.currentProgram_=null};t.prototype.handleWebGLContextRestored=function(){};t.prototype.createTextureInternal=function(t,e){var i=this.getGL(),r=i.createTexture();i.bindTexture(i.TEXTURE_2D,r);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR);i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR);void 0!==t&&i.texParameteri(3553,10242,t);void 0!==e&&i.texParameteri(3553,10243,e);return r};t.prototype.createEmptyTexture=function(t,e,i,r){var n=this.getGL(),o=this.createTextureInternal(i,r);n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t,e,0,n.RGBA,n.UNSIGNED_BYTE,null);return o};t.prototype.createTexture=function(t,e,i){var r=this.getGL(),n=this.createTextureInternal(e,i);r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t);return n};return t}(i),Rm=function(r){function t(t,e){r.call(this,t);var i=e||{};this.helper_=new xm({postProcesses:i.postProcesses,uniforms:i.uniforms});this.sourceRevision_=-1;this.verticesBuffer_=new gm([],or);this.indicesBuffer_=new gm([],or);this.program_=this.helper_.getProgram(i.fragmentShader||"\n  precision mediump float;\n  \n  varying vec2 v_texCoord;\n  varying float v_opacity;\n  \n  void main(void) {\n    gl_FragColor.rgb = vec3(1.0, 1.0, 1.0);\n    float alpha = v_opacity;\n    if (alpha == 0.0) {\n      discard;\n    }\n    gl_FragColor.a = alpha;\n  }",i.vertexShader||"\n  precision mediump float;\n  attribute vec2 a_position;\n  attribute vec2 a_texCoord;\n  attribute float a_rotateWithView;\n  attribute vec2 a_offsets;\n  attribute float a_opacity;\n  \n  uniform mat4 u_projectionMatrix;\n  uniform mat4 u_offsetScaleMatrix;\n  uniform mat4 u_offsetRotateMatrix;\n  \n  varying vec2 v_texCoord;\n  varying float v_opacity;\n  \n  void main(void) {\n    mat4 offsetMatrix = u_offsetScaleMatrix;\n    if (a_rotateWithView == 1.0) {\n      offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n    }\n    vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n    gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets;\n    v_texCoord = a_texCoord;\n    v_opacity = a_opacity;\n  }");this.helper_.useProgram(this.program_);this.sizeCallback_=i.sizeCallback||function(){return 1};this.coordCallback_=i.coordCallback||function(t,e){return t.getGeometry().getCoordinates()[e]};this.opacityCallback_=i.opacityCallback||function(){return 1};this.texCoordCallback_=i.texCoordCallback||function(t,e){return e<2?0:1};this.rotateWithViewCallback_=i.rotateWithViewCallback||function(){return!1}}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.disposeInternal=function(){r.prototype.disposeInternal.call(this)};t.prototype.renderFrame=function(t,e){this.helper_.drawElements(0,this.indicesBuffer_.getArray().length);this.helper_.finalizeDraw(t);var i=this.helper_.getCanvas(),r=e.opacity;r!==i.style.opacity&&(i.style.opacity=r);return i};t.prototype.prepareFrame=function(t){var c=this,e=this.getLayer().getSource();this.helper_.prepareDraw(t);if(this.sourceRevision_<e.getRevision()){this.sourceRevision_=e.getRevision();var i=t.viewState,r=i.projection,n=i.resolution;e.loadFeatures([-1/0,-1/0,1/0,1/0],n,r);e.forEachFeature(function(t){if(t.getGeometry()&&t.getGeometry().getType()===jt.POINT){var e=c.coordCallback_(t,0),i=c.coordCallback_(t,1),r=c.texCoordCallback_(t,0),n=c.texCoordCallback_(t,1),o=c.texCoordCallback_(t,2),s=c.texCoordCallback_(t,3),a=c.sizeCallback_(t),h=c.opacityCallback_(t),l=c.rotateWithViewCallback_(t)?1:0,u=c.verticesBuffer_.getArray().length/8;c.verticesBuffer_.getArray().push(e,i,-a/2,-a/2,r,n,h,l,e,i,+a/2,-a/2,o,n,h,l,e,i,+a/2,+a/2,o,s,h,l,e,i,-a/2,+a/2,r,s,h,l);c.indicesBuffer_.getArray().push(u,u+1,u+3,u+1,u+2,u+3)}})}this.helper_.bindBuffer(34962,this.verticesBuffer_);this.helper_.bindBuffer(34963,this.indicesBuffer_);var o=Float32Array.BYTES_PER_ELEMENT;this.helper_.enableAttributeArray(Sm.POSITION,2,sr,8*o,0);this.helper_.enableAttributeArray(Sm.OFFSETS,2,sr,8*o,2*o);this.helper_.enableAttributeArray(Sm.TEX_COORD,2,sr,8*o,4*o);this.helper_.enableAttributeArray(Sm.OPACITY,1,sr,8*o,6*o);this.helper_.enableAttributeArray(Sm.ROTATE_WITH_VIEW,1,sr,8*o,7*o);return!0};t.prototype.getShaderCompileErrors=function(){return this.helper_.getShaderCompileErrors()};return t}(Hh),Cm="blur",wm="gradient",Im="radius",Lm=["#00f","#0ff","#0f0","#ff0","#f00"],Om=function(n){function t(t){var e=t||{},i=y({},e);delete i.gradient;delete i.radius;delete i.blur;delete i.shadow;delete i.weight;n.call(this,i);this.gradient_=null;this.shadow_=void 0!==e.shadow?e.shadow:250;this.circleImage_=void 0;this.styleCache_=null;m(this,b(wm),this.handleGradientChanged_,this);this.setGradient(e.gradient?e.gradient:Lm);this.setBlur(void 0!==e.blur?e.blur:15);this.setRadius(void 0!==e.radius?e.radius:8);var r=e.weight?e.weight:"weight";this.weightFunction_="string"==typeof r?function(t){return t.get(r)}:r;this.setRenderOrder(null)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.getBlur=function(){return this.get(Cm)};t.prototype.getGradient=function(){return this.get(wm)};t.prototype.getRadius=function(){return this.get(Im)};t.prototype.handleGradientChanged_=function(){this.gradient_=function(t){for(var e=zr(1,256),i=e.createLinearGradient(0,0,1,256),r=1/(t.length-1),n=0,o=t.length;n<o;++n)i.addColorStop(n*r,t[n]);e.fillStyle=i;e.fillRect(0,0,1,256);return e.canvas}(this.getGradient())};t.prototype.setBlur=function(t){this.set(Cm,t)};t.prototype.setGradient=function(t){this.set(wm,t)};t.prototype.setRadius=function(t){this.set(Im,t)};t.prototype.createRenderer=function(){return new Rm(this,{vertexShader:"\n        precision mediump float;\n        attribute vec2 a_position;\n        attribute vec2 a_texCoord;\n        attribute float a_rotateWithView;\n        attribute vec2 a_offsets;\n        attribute float a_opacity;\n        \n        uniform mat4 u_projectionMatrix;\n        uniform mat4 u_offsetScaleMatrix;\n        uniform mat4 u_offsetRotateMatrix;\n        uniform float u_size;\n        \n        varying vec2 v_texCoord;\n        varying float v_opacity;\n        \n        void main(void) {\n          mat4 offsetMatrix = u_offsetScaleMatrix;\n          if (a_rotateWithView == 1.0) {\n            offsetMatrix = u_offsetScaleMatrix * u_offsetRotateMatrix;\n          }\n          vec4 offsets = offsetMatrix * vec4(a_offsets, 0.0, 0.0);\n          gl_Position = u_projectionMatrix * vec4(a_position, 0.0, 1.0) + offsets * u_size;\n          v_texCoord = a_texCoord;\n          v_opacity = a_opacity;\n        }",fragmentShader:"\n        precision mediump float;\n        uniform float u_resolution;\n        uniform float u_blurSlope;\n        \n        varying vec2 v_texCoord;\n        varying float v_opacity;\n        \n        void main(void) {\n          vec2 texCoord = v_texCoord * 2.0 - vec2(1.0, 1.0);\n          float sqRadius = texCoord.x * texCoord.x + texCoord.y * texCoord.y;\n          float value = (1.0 - sqrt(sqRadius)) * u_blurSlope;\n          float alpha = smoothstep(0.0, 1.0, value) * v_opacity;\n          gl_FragColor = vec4(1.0, 1.0, 1.0, alpha);\n        }",uniforms:{u_size:function(){return 2*(this.get(Im)+this.get(Cm))}.bind(this),u_blurSlope:function(){return this.get(Im)/Math.max(1,this.get(Cm))}.bind(this),u_resolution:function(t){return t.viewState.resolution}},postProcesses:[{fragmentShader:"\n            precision mediump float;\n\n            uniform sampler2D u_image;\n            uniform sampler2D u_gradientTexture;\n\n            varying vec2 v_texCoord;\n            varying vec2 v_screenCoord;\n\n            void main() {\n              vec4 color = texture2D(u_image, v_texCoord);\n              gl_FragColor.a = color.a;\n              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;\n              gl_FragColor.rgb *= gl_FragColor.a;\n            }",uniforms:{u_gradientTexture:this.gradient_}}],opacityCallback:function(t){return this.weightFunction_(t)}.bind(this)})};return t}(rl);var Pm=function(e){function t(t){e.call(this,t);this.image_=null}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getImage=function(){return this.image_?this.image_.getImage():null};t.prototype.prepareFrame=function(t,e){var i=t.pixelRatio,r=t.viewState,n=r.resolution,o=this.getLayer().getSource(),s=t.viewHints,a=t.extent;void 0!==e.extent&&(a=Ct(a,e.extent));if(!s[so.ANIMATING]&&!s[so.INTERACTING]&&!Ot(a)){var h=r.projection,l=o.getImage(a,n,i,h);l&&this.loadImage(l)&&(this.image_=l)}return!!this.image_};t.prototype.renderFrame=function(t,e){var i=this.image_,r=i.getExtent(),n=i.getResolution(),o=i.getPixelRatio(),s=t.pixelRatio,a=t.viewState,h=a.center,l=a.resolution,u=t.size,c=s*n/(l*o),p=Math.round(u[0]*s),d=Math.round(u[1]*s),f=a.rotation;if(f){p=d=Math.round(Math.sqrt(p*p+d*d))}ei(this.pixelTransform_,t.size[0]/2,t.size[1]/2,1/s,1/s,f,-p/2,-d/2);ii(this.inversePixelTransform_,this.pixelTransform_);var _=this.context,g=_.canvas;if(g.width!=p||g.height!=d){g.width=p;g.height=d}else _.clearRect(0,0,p,d);var y=e.extent,m=void 0!==y&&!et(y,t.extent)&&Nt(y,t.extent);m&&this.clip(_,t,y);var v=i.getImage(),E=ei(this.tempTransform_,p/2,d/2,c,c,0,o*(r[0]-h[0])/n,o*(h[1]-r[3])/n);this.renderedResolution=n*s/o;var T=E[4],S=E[5],x=v.width*E[0],R=v.height*E[3];this.preRender(_,t);.5<=x&&.5<=R&&this.context.drawImage(v,0,0,+v.width,+v.height,Math.round(T),Math.round(S),Math.round(x),Math.round(R));this.postRender(_,t);m&&_.restore();var C=e.opacity;C!==g.style.opacity&&(g.style.opacity=C);var w=ni(this.pixelTransform_);w!==g.style.transform&&(g.style.transform=w);return g};return t}(Zh),bm=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){return new Pm(this)};return t}(sm),Mm=function(e){function t(t){e.call(this,t);this.renderedExtent_=null;this.renderedRevision;this.renderedTiles=[];this.newTiles_=!1;this.tmpExtent=[1/0,1/0,-1/0,-1/0];this.tmpTileRange_=new pu(0,0,0,0);this.zDirection=0}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.isDrawableTile=function(t){var e=this.getLayer(),i=t.getState(),r=e.getUseInterimTilesOnError();return i==kr.LOADED||i==kr.EMPTY||i==kr.ERROR&&!r};t.prototype.getTile=function(t,e,i,r,n){var o=this.getLayer(),s=o.getSource().getTile(t,e,i,r,n);s.getState()==kr.ERROR&&(o.getUseInterimTilesOnError()?0<o.getPreload()&&(this.newTiles_=!0):s.setState(kr.LOADED));this.isDrawableTile(s)||(s=s.getInterimTile());return s};t.prototype.prepareFrame=function(t,e){return!0};t.prototype.renderFrame=function(t,e){var i=this.context,r=t.viewState,n=r.projection,o=r.resolution,s=r.center,a=r.rotation,h=t.pixelRatio,l=this.getLayer(),u=l.getSource(),c=u.getRevision(),p=u.getTileGridForProjection(n),d=p.getZForResolution(o,this.zDirection),f=p.getResolution(d),_=t.extent;e.extent&&(_=Ct(_,e.extent));var g=u.getTilePixelRatio(h),y=Math.round(t.size[0]*g),m=Math.round(t.size[1]*g);if(a){y=m=Math.round(Math.sqrt(y*y+m*m))}var v=f*y/2/g,E=f*m/2/g,T=[s[0]-v,s[1]-E,s[0]+v,s[1]+E],S=p.getTileRangeForExtentAndZ(_,d),x={};x[d]={};var R=this.createLoadedTileFinder(u,n,x),C=this.tmpExtent,w=this.tmpTileRange_;this.newTiles_=!1;for(var I=S.minX;I<=S.maxX;++I)for(var L=S.minY;L<=S.maxY;++L){var O=this.getTile(d,I,L,h,n);if(this.isDrawableTile(O)){var P=bt(this);if(O.getState()==kr.LOADED){var b=(x[d][O.tileCoord.toString()]=O).inTransition(P);this.newTiles_||!b&&-1!==this.renderedTiles.indexOf(O)||(this.newTiles_=!0)}if(1===O.getAlpha(P,t.time))continue}var M=p.getTileCoordChildTileRange(O.tileCoord,w,C),F=!1;M&&(F=R(d+1,M));F||p.forEachTileCoordParentTileRange(O.tileCoord,R,null,w,C)}var N=i.canvas,A=f/o;ei(this.pixelTransform_,t.size[0]/2,t.size[1]/2,1/g,1/g,a,-y/2,-m/2);ii(this.inversePixelTransform_,this.pixelTransform_);ei(this.tempTransform_,y/2,m/2,A,A,0,-y/2,-m/2);if(N.width!=y||N.height!=m){N.width=y;N.height=m}else i.clearRect(0,0,y,m);e.extent&&this.clipUnrotated(i,t,e.extent);this.preRender(i,t);this.renderedTiles.length=0;var G=Object.keys(x).map(Number);G.sort(function(t,e){return t===d?1:e===d?-1:e<t?1:t<e?-1:0});for(var D=0,k=G.length;D<k;++D){var j=G[D],U=u.getTilePixelSize(j,h,n),Y=p.getResolution(j)/f,X=U[0]*Y*A,B=U[1]*Y*A,z=p.getTileCoordForCoordAndZ(wt(T),j),V=p.getTileCoordExtent(z),W=qe(this.tempTransform_,[Math.round(g*(V[0]-T[0])/f),Math.round(g*(T[3]-V[3])/f)]),K=g*u.getGutterForProjection(n),H=x[j];for(var Z in H){var q=H[Z],J=q.tileCoord,Q=W[0]-(z[1]-J[1])*X,$=Math.round(Q+X),tt=W[1]-(z[2]-J[2])*B,et=Math.round(tt+B),it=Math.round(Q),rt=Math.round(tt),nt=$-it,ot=et-rt;this.drawTileImage(q,t,e,it,rt,nt,ot,K,d===j);this.renderedTiles.push(q)}}this.renderedRevision=c;this.renderedResolution=f;this.renderedExtent_=T;this.updateUsedTiles(t.usedTiles,u,d,S);this.manageTilePyramid(t,u,p,h,n,_,d,l.getPreload());this.scheduleExpireCache(t,u);this.postRender(i,t);e.extent&&i.restore();var st=e.opacity;st!==N.style.opacity&&(N.style.opacity=st);var at=ni(this.pixelTransform_);at!==N.style.transform&&(N.style.transform=at);return N};t.prototype.drawTileImage=function(t,e,i,r,n,o,s,a,h){var l=this.getTileImage(t);if(l){var u=bt(this),c=h?t.getAlpha(u,e.time):1,p=this.getLayer().getSource();1!==c||p.getOpaque(e.viewState.projection)||this.context.clearRect(r,n,o,s);var d=c!==this.context.globalAlpha;if(d){this.context.save();this.context.globalAlpha=c}this.context.drawImage(l,a,a,l.width-2*a,l.height-2*a,r,n,o,s);d&&this.context.restore();1!==c?e.animate=!0:h&&t.endTransition(u)}};t.prototype.getImage=function(){var t=this.context;return t?t.canvas:null};t.prototype.getTileImage=function(t){return t.getImage()};return t}(Zh);Mm.prototype.getLayer;var Fm=function(e){function t(t){e.call(this,t)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.createRenderer=function(){return new Mm(this)};return t}(hm),Nm=function(n){function t(t){n.call(this,t);this.skippedFeatures_=[];this.vectorRenderer_=new il(t);this.layerImageRatio_=t.getImageRatio()}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.disposeInternal=function(){this.vectorRenderer_.dispose();n.prototype.disposeInternal.call(this)};t.prototype.prepareFrame=function(t,e){var i=t.pixelRatio,r=t.viewState.resolution,n=t.viewHints,o=this.vectorRenderer_,s=t.extent;1!==this.layerImageRatio_&&At(s=s.slice(0),this.layerImageRatio_);if(!n[so.ANIMATING]&&!n[so.INTERACTING]&&!Ot(s)){var a=this.skippedFeatures_,h=o.context,l=y({},t,{size:[Lt(s)/r,Rt(s)/r],viewState:y({},t.viewState,{rotation:0})}),u=Object.keys(l.skippedFeatureUids).sort(),c=new Dr(s,r,i,h.canvas,function(t){if(o.prepareFrame(l,e)&&(o.replayGroupChanged||!Ft(a,u))){h.canvas.width=l.size[0]*i;h.canvas.height=l.size[1]*i;o.renderFrame(l,e);a=u;t()}});if(this.loadImage(c)){this.image_=c;this.skippedFeatures_=a}}if(this.image_){var p=this.image_,d=p.getResolution(),f=p.getPixelRatio();this.renderedResolution=d*i/f}return!!this.image_};t.prototype.preRender=function(){};t.prototype.postRender=function(){};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(t,e,i,r):n.prototype.forEachFeatureAtCoordinate.call(this,t,e,i,r)};return t}(Pm),Am=function(r){function t(t){var e=t||{},i=y({},e);delete i.imageRatio;r.call(this,i);this.imageRatio_=void 0!==e.imageRatio?e.imageRatio:1}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getImageRatio=function(){return this.imageRatio_};t.prototype.createRenderer=function(){return new Nm(this)};return t}(ih),Gm={IMAGE:"image",HYBRID:"hybrid"},Dm={image:[Gh.POLYGON,Gh.CIRCLE,Gh.LINE_STRING,Gh.IMAGE,Gh.TEXT],hybrid:[Gh.POLYGON,Gh.LINE_STRING]},km={image:[Gh.DEFAULT],hybrid:[Gh.IMAGE,Gh.TEXT,Gh.DEFAULT]},jm=function(G){function t(t){G.call(this,t);var e=this.context.canvas;this.overlayContext_=zr();var i=this.overlayContext_.canvas;i.style.position="absolute";i.style.transformOrigin="top left";var r=document.createElement("div"),n=r.style;n.position="absolute";n.width="100%";n.height="100%";r.appendChild(e);r.appendChild(i);this.container_=r;this.overlayPixelTransform_=[1,0,0,1,0,0];this.inverseOverlayPixelTransform_=[1,0,0,1,0,0];this.declutterTree_=t.getDeclutter()?oh(9,void 0):null;this.dirty_=!1;this.renderedLayerRevision_;this.tilesWithoutImage_=null;this.tileChangeKeys_={};this.tmpTransform_=[1,0,0,1,0,0];this.zDirection=0;m(Oa,C.CLEAR,this.handleFontsChanged_,this)}G&&(t.__proto__=G);((t.prototype=Object.create(G&&G.prototype)).constructor=t).prototype.disposeInternal=function(){f(Oa,C.CLEAR,this.handleFontsChanged_,this);h(this.tileChangeKeys_).forEach(g);G.prototype.disposeInternal.call(this)};t.prototype.listenTileChange_=function(t,e,i){var r=bt(t);r in this.tileChangeKeys_||t.getState()!==kr.IDLE||(this.tileChangeKeys_[r]=m(t,C.CHANGE,function(){if(t.getState()===kr.ABORT||t.sourceTilesLoaded){g(this.tileChangeKeys_[r]);delete this.tileChangeKeys_[r];if(t.sourceTilesLoaded){this.updateExecutorGroup_(t,e,i);t.setState(kr.LOADED)}}}.bind(this)))};t.prototype.getTile=function(t,e,i,r,n){var o=G.prototype.getTile.call(this,t,e,i,r,n);this.listenTileChange_(o,r,n);if(o.isInterimTile){var s=this.getLayer().getSource().getTile(t,e,i,r,n);this.listenTileChange_(s,r,n)}if(o.getState()===kr.LOADED){this.updateExecutorGroup_(o,r,n);var a=this.getLayer();-1!==o.getReplayState(a).renderedTileRevision?this.renderTileImage_(o,r,n):this.tilesWithoutImage_.push(o)}return o};t.prototype.loadedTileCallback=function(t,e,i){if(i.hasContext(this.getLayer()))return G.prototype.loadedTileCallback.call(this,t,e,i);this.tilesWithoutImage_.push(i);return!1};t.prototype.isDrawableTile=function(t){return G.prototype.isDrawableTile.call(this,t)&&t.hasContext(this.getLayer())};t.prototype.getTileImage=function(t){var e=this.getLayer();return t.getImage(e)};t.prototype.prepareFrame=function(t,e){var i=this.getLayer().getRevision();this.renderedLayerRevision_!=i&&(this.renderedTiles.length=0);this.renderedLayerRevision_=i;return G.prototype.prepareFrame.call(this,t,e)};t.prototype.updateExecutorGroup_=function(m,v,E){var T=this,S=this.getLayer(),t=S.getRevision(),x=S.getRenderOrder()||null,R=m.getReplayState(S);if(R.dirty||R.renderedRevision!=t||R.renderedRenderOrder!=x){for(var C=S.getSource(),w=C.getTileGrid(),e=C.getTileGridForProjection(E),i=m.tileCoord[0],I=e.getResolution(i),L=m.extent,r=function(t,e){var i=m.getTile(m.tileKeys[t]);if(i.getState()==kr.LOADED){var r=i.tileCoord,n=w.getTileCoordExtent(r),o=Ct(L,n),s=ut(n,o)?null:J(o,S.getRenderBuffer()*I,T.tmpExtent),a=i.getProjection(),h=!1;if(!ke(E,a)){h=!0;i.setProjection(E)}R.dirty=!1;var l=new Ah(0,o,I,v,!!T.declutterTree_),u=$h(I,v),c=function(t){var e,i=t.getStyleFunction()||S.getStyleFunction();i&&(e=i(t,I));if(e){var r=this.renderFeature(t,u,e,l);this.dirty_=this.dirty_||r;R.dirty=R.dirty||r}},p=i.getFeatures();x&&x!==R.renderedRenderOrder&&p.sort(x);for(var d=0,f=p.length;d<f;++d){var _=p[d];if(h){if(a.getUnits()==ne.TILE_PIXELS){a.setWorldExtent(n);a.setExtent(i.getExtent())}_.getGeometry().transform(a,E)}s&&!Nt(s,_.getGeometry().getExtent())||c.call(T,_)}var g=l.finish(),y=new Xh(o,I,v,C.getOverlaps(),T.declutterTree_,g,S.getRenderBuffer());i.setExecutorGroup(bt(S),m.tileCoord.toString(),y)}},n=0,o=m.tileKeys.length;n<o;++n)r(n);R.renderedRevision=t;R.renderedRenderOrder=x}};t.prototype.forEachFeatureAtCoordinate=function(t,e,i,r,n){var o=e.viewState.resolution,s=e.viewState.rotation;i=null==i?0:i;var a,h,l,u,c=this.getLayer(),p={},d=this.renderedTiles;for(l=0,u=d.length;l<u;++l){var f=d[l];if(tt(a=J(f.extent,i*o,a),t))for(var _=0,g=f.tileKeys.length;_<g;++_){var y=f.getTile(f.tileKeys[_]);if(y.getState()==kr.LOADED){var m=y.getExecutorGroup(bt(c),f.tileCoord.toString());h=h||m.forEachFeatureAtCoordinate(t,o,s,i,{},function(t){var e=bt(t);if(!(e in p)){p[e]=!0;return r.call(n,t,c)}},null)}}}return h};t.prototype.getReplayTransform_=function(t,e){var i=this.getLayer().getSource().getTileGrid(),r=t.tileCoord,n=i.getResolution(r[0]),o=e.viewState,s=e.pixelRatio,a=o.resolution/s,h=i.getTileCoordExtent(r,this.tmpExtent),l=o.center,u=wt(h),c=e.size,p=Math.round(s*c[0]/2),d=Math.round(s*c[1]/2);return ei(this.tmpTransform_,p,d,n/a,n/a,o.rotation,(u[0]-l[0])/n,(l[1]-u[1])/n)};t.prototype.handleFontsChanged_=function(t){var e=this.getLayer();e.getVisible()&&void 0!==this.renderedLayerRevision_&&e.changed()};t.prototype.handleStyleImageChange_=function(t){this.renderIfReadyAndVisible()};t.prototype.renderFrame=function(t,e){this.tilesWithoutImage_=[];G.prototype.renderFrame.call(this,t,e);var i=this.getLayer(),r=t.viewHints,n=!(r[so.ANIMATING]||r[so.INTERACTING]),o=i.getRenderMode();if(o===Gm.IMAGE){this.renderMissingTileImages_(n,t);return this.container_}var s=this.overlayContext_,a=i.getDeclutter()?{}:null,h=i.getSource(),l=km[o],u=t.pixelRatio,c=t.viewState.rotation,p=t.size;$e(this.overlayPixelTransform_,1/u,1/u);ii(this.inverseOverlayPixelTransform_,this.overlayPixelTransform_);var d=s.canvas,f=Math.round(p[0]*u),_=Math.round(p[1]*u);if(d.width!=f||d.height!=_){d.width=f;d.height=_;var g=ni(this.overlayPixelTransform_);d.style.transform!==g&&(d.style.transform=g)}else s.clearRect(0,0,f,_);a&&this.declutterTree_.clear();for(var y=this.renderedTiles,m=h.getTileGridForProjection(t.viewState.projection),v=[],E=[],T=y.length-1;0<=T;--T){var S=y[T];if(S.getState()!=kr.ABORT)for(var x=S.tileCoord,R=m.getTileCoordExtent(x,this.tmpExtent)[0]-S.extent[0],C=this.getRenderTransform(t,f,_,R),w=0,I=S.tileKeys.length;w<I;++w){var L=S.getTile(S.tileKeys[w]);if(L.getState()==kr.LOADED){var O=L.getExecutorGroup(bt(i),x.toString());if(O&&O.hasExecutors(l)){var P=L.tileCoord[0],b=O.getClipCoords(C);s.save();for(var M=0,F=v.length;M<F;++M){var N=v[M];if(P<E[M]){s.beginPath();s.moveTo(b[0],b[1]);s.lineTo(b[2],b[3]);s.lineTo(b[4],b[5]);s.lineTo(b[6],b[7]);s.moveTo(N[6],N[7]);s.lineTo(N[4],N[5]);s.lineTo(N[2],N[3]);s.lineTo(N[0],N[1]);s.clip()}}O.execute(s,C,c,{},n,l,a);s.restore();v.push(b);E.push(P)}}}}a&&Wh(a,s,c,n);var A=e.opacity;A!==d.style.opacity&&(d.style.opacity=A);this.renderMissingTileImages_(n,t);return this.container_};t.prototype.renderMissingTileImages_=function(t,e){for(;this.tilesWithoutImage_.length&&Date.now()-e.time<100;){e.animate=!0;var i=this.tilesWithoutImage_.pop();(t||i.isInterimTile&&Date.now()-e.time<8)&&this.renderTileImage_(i,e.pixelRatio,e.viewState.projection)}this.tilesWithoutImage_.length&&(e.animate=!0)};t.prototype.renderFeature=function(t,e,i,r){if(!i)return!1;var n=!1;if(Array.isArray(i))for(var o=0,s=i.length;o<s;++o)n=el(r,t,i[o],e,this.handleStyleImageChange_,this)||n;else n=el(r,t,i,e,this.handleStyleImageChange_,this);return n};t.prototype.renderTileImage_=function(t,e,i){var r=this.getLayer(),n=t.getReplayState(r),o=r.getRevision(),s=Dm[r.getRenderMode()];if(s&&n.renderedTileRevision!==o){n.renderedTileRevision=o;var a=t.wrappedTileCoord,h=a[0],l=r.getSource(),u=l.getTileGridForProjection(i),c=u.getResolution(h),p=t.getContext(r),d=l.getTilePixelSize(h,e,i);p.canvas.width=d[0];p.canvas.height=d[1];for(var f=u.getTileCoordExtent(a,this.tmpExtent),_=0,g=t.tileKeys.length;_<g;++_){var y=t.getTile(t.tileKeys[_]);if(y.getState()==kr.LOADED){var m=e/c,v=We(this.tmpTransform_);Qe(v,m,-m);ti(v,-f[0],-f[3]);y.getExecutorGroup(bt(r),t.tileCoord.toString()).execute(p,v,0,{},!0,s)}}}};t.prototype.getDataAtPixel=function(t,e,i){var r=G.prototype.getDataAtPixel.call(this,t,e,i);if(r)return r;var n=qe(this.inverseOverlayPixelTransform_,t.slice()),o=this.overlayContext_;try{r=o.getImageData(Math.round(n[0]),Math.round(n[1]),1,1).data}catch(t){return"SecurityError"===t.name?new Uint8Array:r}return 0===r[3]?null:r};return t}(Mm),Um=function(n){function t(t){var e=t||{},i=y({},e);delete i.preload;delete i.useInterimTilesOnError;n.call(this,i);var r=e.renderMode||Gm.HYBRID;A(null==r||r==Gm.IMAGE||r==Gm.HYBRID,28);e.declutter&&r==Gm.IMAGE&&(r=Gm.HYBRID);this.renderMode_=r;this.setPreload(e.preload?e.preload:0);this.setUseInterimTilesOnError(void 0===e.useInterimTilesOnError||e.useInterimTilesOnError)}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.createRenderer=function(){return new jm(this)};t.prototype.getRenderMode=function(){return this.renderMode_};t.prototype.getPreload=function(){return this.get(am.PRELOAD)};t.prototype.getUseInterimTilesOnError=function(){return this.get(am.USE_INTERIM_TILES_ON_ERROR)};t.prototype.setPreload=function(t){this.set(am.PRELOAD,t)};t.prototype.setUseInterimTilesOnError=function(t){this.set(am.USE_INTERIM_TILES_ON_ERROR,t)};return t}(ih);Um.prototype.getSource;var Ym=function(o){function t(t,e,i,r,n){o.call(this);this.context_=t;this.pixelRatio_=e;this.extent_=i;this.transform_=r;this.viewRotation_=n;this.contextFillState_=null;this.contextStrokeState_=null;this.contextTextState_=null;this.fillState_=null;this.strokeState_=null;this.image_=null;this.imageAnchorX_=0;this.imageAnchorY_=0;this.imageHeight_=0;this.imageOpacity_=0;this.imageOriginX_=0;this.imageOriginY_=0;this.imageRotateWithView_=!1;this.imageRotation_=0;this.imageScale_=0;this.imageWidth_=0;this.text_="";this.textOffsetX_=0;this.textOffsetY_=0;this.textRotateWithView_=!1;this.textRotation_=0;this.textScale_=0;this.textFillState_=null;this.textStrokeState_=null;this.textState_=null;this.pixelCoordinates_=[];this.tmpLocalTransform_=[1,0,0,1,0,0]}o&&(t.__proto__=o);((t.prototype=Object.create(o&&o.prototype)).constructor=t).prototype.drawImages_=function(t,e,i,r){if(this.image_){var n=Ut(t,e,i,2,this.transform_,this.pixelCoordinates_),o=this.context_,s=this.tmpLocalTransform_,a=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=a*this.imageOpacity_);var h=this.imageRotation_;this.imageRotateWithView_&&(h+=this.viewRotation_);for(var l=0,u=n.length;l<u;l+=2){var c=n[l]-this.imageAnchorX_,p=n[l+1]-this.imageAnchorY_;if(0!==h||1!=this.imageScale_){var d=c+this.imageAnchorX_,f=p+this.imageAnchorY_;ei(s,d,f,this.imageScale_,this.imageScale_,h,-d,-f);o.setTransform.apply(o,s)}o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,c,p,this.imageWidth_,this.imageHeight_)}0===h&&1==this.imageScale_||o.setTransform(1,0,0,1,0,0);1!=this.imageOpacity_&&(o.globalAlpha=a)}};t.prototype.drawText_=function(t,e,i,r){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_);this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_);this.setContextTextState_(this.textState_);var n=Ut(t,e,i,r,this.transform_,this.pixelCoordinates_),o=this.context_,s=this.textRotation_;this.textRotateWithView_&&(s+=this.viewRotation_);for(;e<i;e+=r){var a=n[e]+this.textOffsetX_,h=n[e+1]+this.textOffsetY_;if(0!==s||1!=this.textScale_){var l=ei(this.tmpLocalTransform_,a,h,this.textScale_,this.textScale_,s,-a,-h);o.setTransform.apply(o,l)}this.textStrokeState_&&o.strokeText(this.text_,a,h);this.textFillState_&&o.fillText(this.text_,a,h)}0===s&&1==this.textScale_||o.setTransform(1,0,0,1,0,0)}};t.prototype.moveToLineTo_=function(t,e,i,r,n){var o=this.context_,s=Ut(t,e,i,r,this.transform_,this.pixelCoordinates_);o.moveTo(s[0],s[1]);var a=s.length;n&&(a-=2);for(var h=2;h<a;h+=2)o.lineTo(s[h],s[h+1]);n&&o.closePath();return i};t.prototype.drawRings_=function(t,e,i,r){for(var n=0,o=i.length;n<o;++n)e=this.moveToLineTo_(t,e,i[n],r,!0);return e};t.prototype.drawCircle=function(t){if(Nt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=li(t,this.transform_,this.pixelCoordinates_),i=e[2]-e[0],r=e[3]-e[1],n=Math.sqrt(i*i+r*r),o=this.context_;o.beginPath();o.arc(e[0],e[1],n,0,2*Math.PI);this.fillState_&&o.fill();this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}};t.prototype.setStyle=function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke());this.setImageStyle(t.getImage());this.setTextStyle(t.getText())};t.prototype.drawGeometry=function(t){switch(t.getType()){case jt.POINT:this.drawPoint(t);break;case jt.LINE_STRING:this.drawLineString(t);break;case jt.POLYGON:this.drawPolygon(t);break;case jt.MULTI_POINT:this.drawMultiPoint(t);break;case jt.MULTI_LINE_STRING:this.drawMultiLineString(t);break;case jt.MULTI_POLYGON:this.drawMultiPolygon(t);break;case jt.GEOMETRY_COLLECTION:this.drawGeometryCollection(t);break;case jt.CIRCLE:this.drawCircle(t)}};t.prototype.drawFeature=function(t,e){var i=e.getGeometryFunction()(t);if(i&&Nt(this.extent_,i.getExtent())){this.setStyle(e);this.drawGeometry(i)}};t.prototype.drawGeometryCollection=function(t){for(var e=t.getGeometriesArray(),i=0,r=e.length;i<r;++i)this.drawGeometry(e[i])};t.prototype.drawPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i);""!==this.text_&&this.drawText_(e,0,e.length,i)};t.prototype.drawMultiPoint=function(t){var e=t.getFlatCoordinates(),i=t.getStride();this.image_&&this.drawImages_(e,0,e.length,i);""!==this.text_&&this.drawText_(e,0,e.length,i)};t.prototype.drawLineString=function(t){if(Nt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getFlatCoordinates();e.beginPath();this.moveToLineTo_(i,0,i.length,t.getStride(),!1);e.stroke()}if(""!==this.text_){var r=t.getFlatMidpoint();this.drawText_(r,0,2,2)}}};t.prototype.drawMultiLineString=function(t){var e=t.getExtent();if(Nt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var i=this.context_,r=t.getFlatCoordinates(),n=0,o=t.getEnds(),s=t.getStride();i.beginPath();for(var a=0,h=o.length;a<h;++a)n=this.moveToLineTo_(r,n,o[a],s,!1);i.stroke()}if(""!==this.text_){var l=t.getFlatMidpoints();this.drawText_(l,0,l.length,2)}}};t.prototype.drawPolygon=function(t){if(Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath();this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride());this.fillState_&&e.fill();this.strokeState_&&e.stroke()}if(""!==this.text_){var i=t.getFlatInteriorPoint();this.drawText_(i,0,2,2)}}};t.prototype.drawMultiPolygon=function(t){if(Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_);this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,i=t.getOrientedFlatCoordinates(),r=0,n=t.getEndss(),o=t.getStride();e.beginPath();for(var s=0,a=n.length;s<a;++s){var h=n[s];r=this.drawRings_(i,r,h,o)}this.fillState_&&e.fill();this.strokeState_&&e.stroke()}if(""!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}};t.prototype.setContextFillState_=function(t){var e=this.context_,i=this.contextFillState_;if(i)i.fillStyle!=t.fillStyle&&(i.fillStyle=e.fillStyle=t.fillStyle);else{e.fillStyle=t.fillStyle;this.contextFillState_={fillStyle:t.fillStyle}}};t.prototype.setContextStrokeState_=function(t){var e=this.context_,i=this.contextStrokeState_;if(i){i.lineCap!=t.lineCap&&(i.lineCap=e.lineCap=t.lineCap);if(e.setLineDash){Ft(i.lineDash,t.lineDash)||e.setLineDash(i.lineDash=t.lineDash);i.lineDashOffset!=t.lineDashOffset&&(i.lineDashOffset=e.lineDashOffset=t.lineDashOffset)}i.lineJoin!=t.lineJoin&&(i.lineJoin=e.lineJoin=t.lineJoin);i.lineWidth!=t.lineWidth&&(i.lineWidth=e.lineWidth=t.lineWidth);i.miterLimit!=t.miterLimit&&(i.miterLimit=e.miterLimit=t.miterLimit);i.strokeStyle!=t.strokeStyle&&(i.strokeStyle=e.strokeStyle=t.strokeStyle)}else{e.lineCap=t.lineCap;if(e.setLineDash){e.setLineDash(t.lineDash);e.lineDashOffset=t.lineDashOffset}e.lineJoin=t.lineJoin;e.lineWidth=t.lineWidth;e.miterLimit=t.miterLimit;e.strokeStyle=t.strokeStyle;this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle}}};t.prototype.setContextTextState_=function(t){var e=this.context_,i=this.contextTextState_,r=t.textAlign?t.textAlign:wa;if(i){i.font!=t.font&&(i.font=e.font=t.font);i.textAlign!=r&&(i.textAlign=e.textAlign=r);i.textBaseline!=t.textBaseline&&(i.textBaseline=e.textBaseline=t.textBaseline)}else{e.font=t.font;e.textAlign=r;e.textBaseline=t.textBaseline;this.contextTextState_={font:t.font,textAlign:r,textBaseline:t.textBaseline}}};t.prototype.setFillStrokeStyle=function(t,e){if(t){var i=t.getColor();this.fillState_={fillStyle:ma(i||Ta)}}else this.fillState_=null;if(e){var r=e.getColor(),n=e.getLineCap(),o=e.getLineDash(),s=e.getLineDashOffset(),a=e.getLineJoin(),h=e.getWidth(),l=e.getMiterLimit();this.strokeState_={lineCap:void 0!==n?n:Sa,lineDash:o||xa,lineDashOffset:s||0,lineJoin:void 0!==a?a:Ra,lineWidth:this.pixelRatio_*(void 0!==h?h:1),miterLimit:void 0!==l?l:10,strokeStyle:ma(r||Ca)}}else this.strokeState_=null};t.prototype.setImageStyle=function(t){if(t){var e=t.getAnchor(),i=t.getImage(1),r=t.getOrigin(),n=t.getSize();this.imageAnchorX_=e[0];this.imageAnchorY_=e[1];this.imageHeight_=n[1];this.image_=i;this.imageOpacity_=t.getOpacity();this.imageOriginX_=r[0];this.imageOriginY_=r[1];this.imageRotateWithView_=t.getRotateWithView();this.imageRotation_=t.getRotation();this.imageScale_=t.getScale()*this.pixelRatio_;this.imageWidth_=n[0]}else this.image_=null};t.prototype.setTextStyle=function(t){if(t){var e=t.getFill();if(e){var i=e.getColor();this.textFillState_={fillStyle:ma(i||Ta)}}else this.textFillState_=null;var r=t.getStroke();if(r){var n=r.getColor(),o=r.getLineCap(),s=r.getLineDash(),a=r.getLineDashOffset(),h=r.getLineJoin(),l=r.getWidth(),u=r.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:Sa,lineDash:s||xa,lineDashOffset:a||0,lineJoin:void 0!==h?h:Ra,lineWidth:void 0!==l?l:1,miterLimit:void 0!==u?u:10,strokeStyle:ma(n||Ca)}}else this.textStrokeState_=null;var c=t.getFont(),p=t.getOffsetX(),d=t.getOffsetY(),f=t.getRotateWithView(),_=t.getRotation(),g=t.getScale(),y=t.getText(),m=t.getTextAlign(),v=t.getTextBaseline();this.textState_={font:void 0!==c?c:Ea,textAlign:void 0!==m?m:wa,textBaseline:void 0!==v?v:Ia};this.text_=void 0!==y?y:"";this.textOffsetX_=void 0!==p?this.pixelRatio_*p:0;this.textOffsetY_=void 0!==d?this.pixelRatio_*d:0;this.textRotateWithView_=void 0!==f&&f;this.textRotation_=void 0!==_?_:0;this.textScale_=this.pixelRatio_*(void 0!==g?g:1)}else this.text_=""};return t}(Eh);function Xm(t,e,i,r){var n=Ye(i,e,t),o=Me(e,r,i),s=e.getMetersPerUnit();void 0!==s&&(o*=s);var a=t.getMetersPerUnit();void 0!==a&&(o/=a);var h=t.getExtent();if(!h||tt(h,n)){var l=Me(t,o,n)/o;isFinite(l)&&0<l&&(o/=l)}return o}function Bm(t,e,i,r){var n=i-t,o=r-e,s=Math.sqrt(n*n+o*o);return[Math.round(i+n/s),Math.round(r+o/s)]}function zm(t,e,C,w,i,I,r,n,o,a,s){var L=zr(Math.round(C*t),Math.round(C*e));if(0===o.length)return L.canvas;L.scale(C,C);var O=[1/0,1/0,-1/0,-1/0];o.forEach(function(t,e,i){ct(O,t.extent)});var h=Lt(O),l=Rt(O),P=zr(Math.round(C*h/w),Math.round(C*l/w)),u=C/w;o.forEach(function(t,e,i){var r=t.extent[0]-O[0],n=-(t.extent[3]-O[3]),o=Lt(t.extent),s=Rt(t.extent);P.drawImage(t.image,a,a,t.image.width-2*a,t.image.height-2*a,r*u,n*u,o*u,s*u)});var b=wt(r);n.getTriangles().forEach(function(t,e,i){var r=t.source,n=t.target,o=r[0][0],s=r[0][1],a=r[1][0],h=r[1][1],l=r[2][0],u=r[2][1],c=(n[0][0]-b[0])/I,p=-(n[0][1]-b[1])/I,d=(n[1][0]-b[0])/I,f=-(n[1][1]-b[1])/I,_=(n[2][0]-b[0])/I,g=-(n[2][1]-b[1])/I,y=o,m=s,v=Ht([[a-=y,h-=m,s=o=0,0,d-c],[l-=y,u-=m,0,0,_-c],[0,0,a,h,f-p],[0,0,l,u,g-p]]);if(v){L.save();L.beginPath();var E=(c+d+_)/3,T=(p+f+g)/3,S=Bm(E,T,c,p),x=Bm(E,T,d,f),R=Bm(E,T,_,g);L.moveTo(x[0],x[1]);L.lineTo(S[0],S[1]);L.lineTo(R[0],R[1]);L.clip();L.transform(v[0],v[2],v[1],v[3],c,p);L.translate(O[0]-y,O[3]-m);L.scale(w/C,-w/C);L.drawImage(P.canvas,0,0);L.restore()}});if(s){L.save();L.strokeStyle="black";L.lineWidth=1;n.getTriangles().forEach(function(t,e,i){var r=t.target,n=(r[0][0]-b[0])/I,o=-(r[0][1]-b[1])/I,s=(r[1][0]-b[0])/I,a=-(r[1][1]-b[1])/I,h=(r[2][0]-b[0])/I,l=-(r[2][1]-b[1])/I;L.beginPath();L.moveTo(s,a);L.lineTo(n,o);L.lineTo(h,l);L.closePath();L.stroke()});L.restore()}return L.canvas}var Vm=function(t,e,i,r,n){this.sourceProj_=t;this.targetProj_=e;var o={},s=Ue(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];o[e]||(o[e]=s(t));return o[e]};this.maxSourceExtent_=r;this.errorThresholdSquared_=n*n;this.triangles_=[];this.wrapsXInSource_=!1;this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!r&&!!this.sourceProj_.getExtent()&&Lt(r)==Lt(this.sourceProj_.getExtent());this.sourceWorldWidth_=this.sourceProj_.getExtent()?Lt(this.sourceProj_.getExtent()):null;this.targetWorldWidth_=this.targetProj_.getExtent()?Lt(this.targetProj_.getExtent()):null;var a=wt(i),h=It(i),l=Et(i),u=vt(i),c=this.transformInv_(a),p=this.transformInv_(h),d=this.transformInv_(l),f=this.transformInv_(u);this.addQuad_(a,h,l,u,c,p,d,f,10);if(this.wrapsXInSource_){var _=1/0;this.triangles_.forEach(function(t,e,i){_=Math.min(_,t.source[0][0],t.source[1][0],t.source[2][0])});this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-_>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-_>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_);e[1][0]-_>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_);e[2][0]-_>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var i=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-i<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}o={}};Vm.prototype.addTriangle_=function(t,e,i,r,n,o){this.triangles_.push({source:[r,n,o],target:[t,e,i]})};Vm.prototype.addQuad_=function(t,e,i,r,n,o,s,a,h){var l=q([n,o,s,a]),u=this.sourceWorldWidth_?Lt(l)/this.sourceWorldWidth_:null,c=this.sourceWorldWidth_,p=this.sourceProj_.canWrapX()&&.5<u&&u<1,d=!1;if(0<h){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){d=.25<Lt(q([t,e,i,r]))/this.targetWorldWidth_||d}!p&&this.sourceProj_.isGlobal()&&u&&(d=.25<u||d)}if(d||!this.maxSourceExtent_||Nt(l,this.maxSourceExtent_)){if(!(d||isFinite(n[0])&&isFinite(n[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(s[0])&&isFinite(s[1])&&isFinite(a[0])&&isFinite(a[1]))){if(!(0<h))return;d=!0}if(0<h){if(!d){var f,_=[(t[0]+i[0])/2,(t[1]+i[1])/2],g=this.transformInv_(_);if(p){f=(Jt(n[0],c)+Jt(s[0],c))/2-Jt(g[0],c)}else f=(n[0]+s[0])/2-g[0];var y=(n[1]+s[1])/2-g[1];d=f*f+y*y>this.errorThresholdSquared_}if(d){if(Math.abs(t[0]-i[0])<=Math.abs(t[1]-i[1])){var m=[(e[0]+i[0])/2,(e[1]+i[1])/2],v=this.transformInv_(m),E=[(r[0]+t[0])/2,(r[1]+t[1])/2],T=this.transformInv_(E);this.addQuad_(t,e,m,E,n,o,v,T,h-1);this.addQuad_(E,m,i,r,T,v,s,a,h-1)}else{var S=[(t[0]+e[0])/2,(t[1]+e[1])/2],x=this.transformInv_(S),R=[(i[0]+r[0])/2,(i[1]+r[1])/2],C=this.transformInv_(R);this.addQuad_(t,S,R,r,n,x,C,a,h-1);this.addQuad_(S,e,i,R,x,o,s,C,h-1)}return}}if(p){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}this.addTriangle_(t,i,r,n,s,a);this.addTriangle_(t,e,i,n,o,s)}};Vm.prototype.calculateSourceExtent=function(){var n=[1/0,1/0,-1/0,-1/0];this.triangles_.forEach(function(t,e,i){var r=t.source;pt(n,r[0]);pt(n,r[1]);pt(n,r[2])});return n};Vm.prototype.getTriangles=function(){return this.triangles_};var Wm=function(f){function t(t,e,i,r,n,o){var s=t.getExtent(),a=e.getExtent(),h=a?Ct(i,a):i,l=Xm(t,e,Tt(h),r),u=new Vm(t,e,h,s,.5*l),c=o(u.calculateSourceExtent(),l,n),p=Ar.LOADED;c&&(p=Ar.IDLE);var d=c?c.getPixelRatio():1;f.call(this,i,r,d,p);this.targetProj_=e;this.maxSourceExtent_=s;this.triangulation_=u;this.targetResolution_=r;this.targetExtent_=i;this.sourceImage_=c;this.sourcePixelRatio_=d;this.canvas_=null;this.sourceListenerKey_=null}f&&(t.__proto__=f);((t.prototype=Object.create(f&&f.prototype)).constructor=t).prototype.disposeInternal=function(){this.state==Ar.LOADING&&this.unlistenSource_();f.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.canvas_};t.prototype.getProjection=function(){return this.targetProj_};t.prototype.reproject_=function(){var t=this.sourceImage_.getState();if(t==Ar.LOADED){var e=Lt(this.targetExtent_)/this.targetResolution_,i=Rt(this.targetExtent_)/this.targetResolution_;this.canvas_=zm(e,i,this.sourcePixelRatio_,this.sourceImage_.getResolution(),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0)}this.state=t;this.changed()};t.prototype.load=function(){if(this.state==Ar.IDLE){this.state=Ar.LOADING;this.changed();var t=this.sourceImage_.getState();if(t==Ar.LOADED||t==Ar.ERROR)this.reproject_();else{this.sourceListenerKey_=m(this.sourceImage_,C.CHANGE,function(t){var e=this.sourceImage_.getState();if(e==Ar.LOADED||e==Ar.ERROR){this.unlistenSource_();this.reproject_()}},this);this.sourceImage_.load()}}};t.prototype.unlistenSource_=function(){g(this.sourceListenerKey_);this.sourceListenerKey_=null};return t}(Nr),Km=function(R){function t(t,e,i,r,n,o,s,a,h,l,u){R.call(this,n,kr.IDLE);this.renderEdges_=void 0!==u&&u;this.pixelRatio_=s;this.gutter_=a;this.canvas_=null;this.sourceTileGrid_=e;this.targetTileGrid_=r;this.wrappedTileCoord_=o||n;this.sourceTiles_=[];this.sourcesListenerKeys_=null;this.sourceZ_=0;var c=r.getTileCoordExtent(this.wrappedTileCoord_),p=this.targetTileGrid_.getExtent(),d=this.sourceTileGrid_.getExtent(),f=p?Ct(c,p):c;if(0!==mt(f)){var _=t.getExtent();_&&(d=d?Ct(d,_):_);var g=r.getResolution(this.wrappedTileCoord_[0]),y=Xm(t,i,Tt(f),g);if(!isFinite(y)||y<=0)this.state=kr.EMPTY;else{var m=void 0!==l?l:.5;this.triangulation_=new Vm(t,i,f,d,y*m);if(0!==this.triangulation_.getTriangles().length){this.sourceZ_=e.getZForResolution(y);var v=this.triangulation_.calculateSourceExtent();if(d)if(t.canWrapX()){v[1]=zt(v[1],d[1],d[3]);v[3]=zt(v[3],d[1],d[3])}else v=Ct(v,d);if(mt(v)){for(var E=e.getTileRangeForExtentAndZ(v,this.sourceZ_),T=E.minX;T<=E.maxX;T++)for(var S=E.minY;S<=E.maxY;S++){var x=h(this.sourceZ_,T,S,s);x&&this.sourceTiles_.push(x)}0===this.sourceTiles_.length&&(this.state=kr.EMPTY)}else this.state=kr.EMPTY}else this.state=kr.EMPTY}}else this.state=kr.EMPTY}R&&(t.__proto__=R);((t.prototype=Object.create(R&&R.prototype)).constructor=t).prototype.disposeInternal=function(){this.state==kr.LOADING&&this.unlistenSources_();R.prototype.disposeInternal.call(this)};t.prototype.getImage=function(){return this.canvas_};t.prototype.reproject_=function(){var r=[];this.sourceTiles_.forEach(function(t,e,i){t&&t.getState()==kr.LOADED&&r.push({extent:this.sourceTileGrid_.getTileCoordExtent(t.tileCoord),image:t.getImage()})}.bind(this));if((this.sourceTiles_.length=0)===r.length)this.state=kr.ERROR;else{var t=this.wrappedTileCoord_[0],e=this.targetTileGrid_.getTileSize(t),i="number"==typeof e?e:e[0],n="number"==typeof e?e:e[1],o=this.targetTileGrid_.getResolution(t),s=this.sourceTileGrid_.getResolution(this.sourceZ_),a=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=zm(i,n,this.pixelRatio_,s,this.sourceTileGrid_.getExtent(),o,a,this.triangulation_,r,this.gutter_,this.renderEdges_);this.state=kr.LOADED}this.changed()};t.prototype.load=function(){if(this.state==kr.IDLE){this.state=kr.LOADING;this.changed();var o=0;this.sourcesListenerKeys_=[];this.sourceTiles_.forEach(function(i,t,e){var r=i.getState();if(r==kr.IDLE||r==kr.LOADING){o++;var n=m(i,C.CHANGE,function(t){var e=i.getState();if(e==kr.LOADED||e==kr.ERROR||e==kr.EMPTY){g(n);if(0===--o){this.unlistenSources_();this.reproject_()}}},this);this.sourcesListenerKeys_.push(n)}}.bind(this));this.sourceTiles_.forEach(function(t,e,i){t.getState()==kr.IDLE&&t.load()});0===o&&setTimeout(this.reproject_.bind(this),0)}};t.prototype.unlistenSources_=function(){this.sourcesListenerKeys_.forEach(g);this.sourcesListenerKeys_=null};return t}(Br);function Hm(r,n){var o=/\{z\}/g,s=/\{x\}/g,a=/\{y\}/g,h=/\{-y\}/g;return function(i,t,e){return i?r.replace(o,i[0].toString()).replace(s,i[1].toString()).replace(a,i[2].toString()).replace(h,function(){var t=i[0],e=n.getFullTileRange(t);A(e,55);return(e.getHeight()-i[2]-1).toString()}):void 0}}function Zm(t,e){for(var i=t.length,r=new Array(i),n=0;n<i;++n)r[n]=Hm(t[n],e);return qm(r)}function qm(n){return 1===n.length?n[0]:function(t,e,i){if(t){var r=Jt(lu(t),n.length);return n[r](t,e,i)}}}function Jm(t,e,i){}function Qm(t){var e=[],i=/\{([a-z])-([a-z])\}/.exec(t);if(i){var r,n=i[1].charCodeAt(0),o=i[2].charCodeAt(0);for(r=n;r<=o;++r)e.push(t.replace(i[0],String.fromCharCode(r)));return e}if(i=i=/\{(\d+)-(\d+)\}/.exec(t)){for(var s=parseInt(i[2],10),a=parseInt(i[1],10);a<=s;a++)e.push(t.replace(i[0],a.toString()));return e}e.push(t);return e}function $m(t,e,i,r){var n=document.createElement("script"),o="olc_"+bt(e);function s(){delete window[o];n.parentNode.removeChild(n)}n.async=!0;n.src=t+(-1==t.indexOf("?")?"?":"&")+(r||"callback")+"="+o;var a=setTimeout(function(){s();i&&i()},1e4);window[o]=function(t){clearTimeout(a);s();e(t)};document.getElementsByTagName("head")[0].appendChild(n)}var tv=[0,0,0],ev=function(t){this.minZoom=void 0!==t.minZoom?t.minZoom:0;this.resolutions_=t.resolutions;A(K(this.resolutions_,function(t,e){return e-t},!0),17);var e;if(!t.origins)for(var i=0,r=this.resolutions_.length-1;i<r;++i)if(e){if(this.resolutions_[i]/this.resolutions_[i+1]!==e){e=void 0;break}}else e=this.resolutions_[i]/this.resolutions_[i+1];this.zoomFactor_=e;this.maxZoom=this.resolutions_.length-1;this.origin_=void 0!==t.origin?t.origin:null;this.origins_=null;if(void 0!==t.origins){this.origins_=t.origins;A(this.origins_.length==this.resolutions_.length,20)}var n=t.extent;void 0===n||this.origin_||this.origins_||(this.origin_=wt(n));A(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18);this.tileSizes_=null;if(void 0!==t.tileSizes){this.tileSizes_=t.tileSizes;A(this.tileSizes_.length==this.resolutions_.length,19)}this.tileSize_=void 0!==t.tileSize?t.tileSize:this.tileSizes_?null:Jn;A(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22);this.extent_=void 0!==n?n:null;this.fullTileRanges_=null;this.tmpSize_=[0,0];void 0!==t.sizes?this.fullTileRanges_=t.sizes.map(function(t,e){return new pu(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1))},this):n&&this.calculateTileRanges_(n)};ev.prototype.forEachTileCoord=function(t,e,i){for(var r=this.getTileRangeForExtentAndZ(t,e),n=r.minX,o=r.maxX;n<=o;++n)for(var s=r.minY,a=r.maxY;s<=a;++s)i([e,n,s])};ev.prototype.forEachTileCoordParentTileRange=function(t,e,i,r,n){var o,s,a,h=null,l=t[0]-1;if(2===this.zoomFactor_){s=t[1];a=t[2]}else h=this.getTileCoordExtent(t,n);for(;l>=this.minZoom;){o=2===this.zoomFactor_?du(s=Math.floor(s/2),s,a=Math.floor(a/2),a,r):this.getTileRangeForExtentAndZ(h,l,r);if(e.call(i,l,o))return!0;--l}return!1};ev.prototype.getExtent=function(){return this.extent_};ev.prototype.getMaxZoom=function(){return this.maxZoom};ev.prototype.getMinZoom=function(){return this.minZoom};ev.prototype.getOrigin=function(t){return this.origin_?this.origin_:this.origins_[t]};ev.prototype.getResolution=function(t){return this.resolutions_[t]};ev.prototype.getResolutions=function(){return this.resolutions_};ev.prototype.getTileCoordChildTileRange=function(t,e,i){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var r=2*t[1],n=2*t[2];return du(r,r+1,n,n+1,e)}var o=this.getTileCoordExtent(t,i);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null};ev.prototype.getTileRangeExtent=function(t,e,i){var r=this.getOrigin(t),n=this.getResolution(t),o=Do(this.getTileSize(t),this.tmpSize_),s=r[0]+e.minX*o[0]*n,a=r[0]+(e.maxX+1)*o[0]*n;return ot(s,r[1]+e.minY*o[1]*n,a,r[1]+(e.maxY+1)*o[1]*n,i)};ev.prototype.getTileRangeForExtentAndZ=function(t,e,i){var r=tv;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,r);var n=r[1],o=r[2];this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,r);return du(n,r[1],o,r[2],i)};ev.prototype.getTileCoordCenter=function(t){var e=this.getOrigin(t[0]),i=this.getResolution(t[0]),r=Do(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*r[0]*i,e[1]-(t[2]+.5)*r[1]*i]};ev.prototype.getTileCoordExtent=function(t,e){var i=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=Do(this.getTileSize(t[0]),this.tmpSize_),o=i[0]+t[1]*n[0]*r,s=i[1]-(t[2]+1)*n[1]*r;return ot(o,s,o+n[0]*r,s+n[1]*r,e)};ev.prototype.getTileCoordForCoordAndResolution=function(t,e,i){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,i)};ev.prototype.getTileCoordForXYAndResolution_=function(t,e,i,r,n){var o=this.getZForResolution(i),s=i/this.getResolution(o),a=this.getOrigin(o),h=Do(this.getTileSize(o),this.tmpSize_),l=r?.5:0,u=r?.5:0,c=Math.floor((t-a[0])/i+l),p=Math.floor((a[1]-e)/i+u),d=s*c/h[0],f=s*p/h[1];if(r){d=Math.ceil(d)-1;f=Math.ceil(f)-1}else{d=Math.floor(d);f=Math.floor(f)}return ou(o,d,f,n)};ev.prototype.getTileCoordForXYAndZ_=function(t,e,i,r,n){var o=this.getOrigin(i),s=this.getResolution(i),a=Do(this.getTileSize(i),this.tmpSize_),h=r?.5:0,l=r?.5:0,u=Math.floor((t-o[0])/s+h),c=Math.floor((o[1]-e)/s+l),p=u/a[0],d=c/a[1];if(r){p=Math.ceil(p)-1;d=Math.ceil(d)-1}else{p=Math.floor(p);d=Math.floor(d)}return ou(i,p,d,n)};ev.prototype.getTileCoordForCoordAndZ=function(t,e,i){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,i)};ev.prototype.getTileCoordResolution=function(t){return this.resolutions_[t[0]]};ev.prototype.getTileSize=function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]};ev.prototype.getFullTileRange=function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:null};ev.prototype.getZForResolution=function(t,e){return zt(Y(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)};ev.prototype.calculateTileRanges_=function(t){for(var e=this.resolutions_.length,i=new Array(e),r=this.minZoom;r<e;++r)i[r]=this.getTileRangeForExtentAndZ(t,r);this.fullTileRanges_=i};function iv(t){var e=t.getDefaultTileGrid();if(!e){e=av(t);t.setDefaultTileGrid(e)}return e}function rv(t,e,i){var r=e[0],n=t.getTileCoordCenter(e),o=hv(i);if(tt(o,n))return e;var s=Lt(o),a=Math.ceil((o[0]-n[0])/s);n[0]+=s*a;return t.getTileCoordForCoordAndZ(n,r)}function nv(t,e,i,r){var n=void 0!==r?r:H.TOP_LEFT,o=sv(t,e,i);return new ev({extent:t,origin:St(t,n),resolutions:o,tileSize:i})}function ov(t){var e=t||{},i=e.extent||be("EPSG:3857").getExtent(),r={extent:i,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:sv(i,e.maxZoom,e.tileSize)};return new ev(r)}function sv(t,e,i){for(var r=void 0!==e?e:qn,n=Rt(t),o=Lt(t),s=Do(void 0!==i?i:Jn),a=Math.max(o/s[0],n/s[1]),h=r+1,l=new Array(h),u=0;u<h;++u)l[u]=a/Math.pow(2,u);return l}function av(t,e,i,r){return nv(hv(t),e,i,r)}function hv(t){var e=(t=be(t)).getExtent();if(!e){var i=180*oe[ne.DEGREES]/t.getMetersPerUnit();e=ot(-i,-i,i,i)}return e}var lv=function(e){function t(t){e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX});this.opaque_=void 0!==t.opaque&&t.opaque;this.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1;this.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;this.tileCache=new cu(t.cacheSize);this.tmpSize=[0,0];this.key_=t.key||"";this.tileOptions={transition:t.transition}}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){return this.tileCache.canExpireCache()};t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);i&&i.expireCache(e)};t.prototype.forEachLoadedTile=function(t,e,i,r){var n=this.getTileCacheForProjection(t);if(!n)return!1;for(var o,s,a,h=!0,l=i.minX;l<=i.maxX;++l)for(var u=i.minY;u<=i.maxY;++u){s=su(e,l,u);a=!1;n.containsKey(s)&&(a=(o=n.get(s)).getState()===kr.LOADED)&&(a=!1!==r(o));a||(h=!1)}return h};t.prototype.getGutterForProjection=function(t){return 0};t.prototype.getKey=function(){return this.key_};t.prototype.setKey=function(t){if(this.key_!==t){this.key_=t;this.changed()}};t.prototype.getOpaque=function(t){return this.opaque_};t.prototype.getResolutions=function(){return this.tileGrid.getResolutions()};t.prototype.getTile=function(t,e,i,r,n){return o()};t.prototype.getTileGrid=function(){return this.tileGrid};t.prototype.getTileGridForProjection=function(t){return this.tileGrid?this.tileGrid:iv(t)};t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();return e&&!ke(e,t)?null:this.tileCache};t.prototype.getTilePixelRatio=function(t){return this.tilePixelRatio_};t.prototype.getTilePixelSize=function(t,e,i){var r=this.getTileGridForProjection(i),n=this.getTilePixelRatio(e),o=Do(r.getTileSize(t),this.tmpSize);return 1==n?o:Go(o,n,this.tmpSize)};t.prototype.getTileCoordForTileUrlFunction=function(t,e){var i=void 0!==e?e:this.getProjection(),r=this.getTileGridForProjection(i);this.getWrapX()&&i.isGlobal()&&(t=rv(r,t,i));return uu(t,r)?t:null};t.prototype.refresh=function(){this.tileCache.clear();this.changed()};t.prototype.useTile=function(t,e,i,r){};return t}(ll),uv=function(i){function t(t,e){i.call(this,t);this.tile=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(S),cv={TILELOADSTART:"tileloadstart",TILELOADEND:"tileloadend",TILELOADERROR:"tileloaderror"},pv=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible});this.generateTileUrlFunction_=!t.tileUrlFunction;this.tileLoadFunction=t.tileLoadFunction;this.tileUrlFunction=t.tileUrlFunction?t.tileUrlFunction.bind(this):Jm;this.urls=null;t.urls?this.setUrls(t.urls):t.url&&this.setUrl(t.url);this.tileLoadingKeys_={}}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getTileLoadFunction=function(){return this.tileLoadFunction};t.prototype.getTileUrlFunction=function(){return this.tileUrlFunction};t.prototype.getUrls=function(){return this.urls};t.prototype.handleTileChange=function(t){var e,i=t.target,r=bt(i),n=i.getState();if(n==kr.LOADING){this.tileLoadingKeys_[r]=!0;e=cv.TILELOADSTART}else if(r in this.tileLoadingKeys_){delete this.tileLoadingKeys_[r];e=n==kr.ERROR?cv.TILELOADERROR:n==kr.LOADED||n==kr.ABORT?cv.TILELOADEND:void 0}null!=e&&this.dispatchEvent(new uv(e,i))};t.prototype.setTileLoadFunction=function(t){this.tileCache.clear();this.tileLoadFunction=t;this.changed()};t.prototype.setTileUrlFunction=function(t,e){this.tileUrlFunction=t;this.tileCache.pruneExceptNewestZ();void 0!==e?this.setKey(e):this.changed()};t.prototype.setUrl=function(t){var e=this.urls=Qm(t);this.setUrls(e)};t.prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(Zm(t,this.tileGrid),e):this.setKey(e)};t.prototype.useTile=function(t,e,i){var r=su(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)};return t}(lv),dv=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:fv,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:t.wrapX,transition:t.transition,key:t.key,attributionsCollapsible:t.attributionsCollapsible});this.crossOrigin=void 0!==t.crossOrigin?t.crossOrigin:null;this.tileClass=void 0!==t.tileClass?t.tileClass:Jr;this.tileCacheForProjection={};this.tileGridForProjection={};this.reprojectionErrorThreshold_=t.reprojectionErrorThreshold;this.renderReprojectionEdges_=!1}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.canExpireCache=function(){if(this.tileCache.canExpireCache())return!0;for(var t in this.tileCacheForProjection)if(this.tileCacheForProjection[t].canExpireCache())return!0;return!1};t.prototype.expireCache=function(t,e){var i=this.getTileCacheForProjection(t);this.tileCache.expireCache(this.tileCache==i?e:{});for(var r in this.tileCacheForProjection){var n=this.tileCacheForProjection[r];n.expireCache(n==i?e:{})}};t.prototype.getGutterForProjection=function(t){return this.getProjection()&&t&&!ke(this.getProjection(),t)?0:this.getGutter()};t.prototype.getGutter=function(){return 0};t.prototype.getOpaque=function(t){return!(this.getProjection()&&t&&!ke(this.getProjection(),t))&&e.prototype.getOpaque.call(this,t)};t.prototype.getTileGridForProjection=function(t){var e=this.getProjection();if(!this.tileGrid||e&&!ke(e,t)){var i=bt(t);i in this.tileGridForProjection||(this.tileGridForProjection[i]=iv(t));return this.tileGridForProjection[i]}return this.tileGrid};t.prototype.getTileCacheForProjection=function(t){var e=this.getProjection();if(!e||ke(e,t))return this.tileCache;var i=bt(t);i in this.tileCacheForProjection||(this.tileCacheForProjection[i]=new cu(this.tileCache.highWaterMark));return this.tileCacheForProjection[i]};t.prototype.createTile_=function(t,e,i,r,n,o){var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,n),h=a?this.tileUrlFunction(a,r,n):void 0,l=new this.tileClass(s,void 0!==h?kr.IDLE:kr.EMPTY,void 0!==h?h:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);l.key=o;m(l,C.CHANGE,this.handleTileChange,this);return l};t.prototype.getTile=function(t,e,i,r,n){var o=this.getProjection();if(o&&n&&!ke(o,n)){var s,a=this.getTileCacheForProjection(n),h=[t,e,i],l=au(h);a.containsKey(l)&&(s=a.get(l));var u=this.getKey();if(s&&s.key==u)return s;var c=this.getTileGridForProjection(o),p=this.getTileGridForProjection(n),d=this.getTileCoordForTileUrlFunction(h,n),f=new Km(o,c,n,p,h,d,this.getTilePixelRatio(r),this.getGutter(),function(t,e,i,r){return this.getTileInternal(t,e,i,r,o)}.bind(this),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_);f.key=u;if(s){f.interimTile=s;f.refreshInterimChain();a.replace(l,f)}else a.set(l,f);return f}return this.getTileInternal(t,e,i,r,o||n)};t.prototype.getTileInternal=function(t,e,i,r,n){var o=null,s=su(t,e,i),a=this.getKey();if(this.tileCache.containsKey(s)){if((o=this.tileCache.get(s)).key!=a){var h=o;o=this.createTile_(t,e,i,r,n,a);h.getState()==kr.IDLE?o.interimTile=h.interimTile:o.interimTile=h;o.refreshInterimChain();this.tileCache.replace(s,o)}}else{o=this.createTile_(t,e,i,r,n,a);this.tileCache.set(s,o)}return o};t.prototype.setRenderReprojectionEdges=function(t){if(this.renderReprojectionEdges_!=t){this.renderReprojectionEdges_=t;for(var e in this.tileCacheForProjection)this.tileCacheForProjection[e].clear();this.changed()}};t.prototype.setTileGridForProjection=function(t,e){var i=be(t);if(i){var r=bt(i);r in this.tileGridForProjection||(this.tileGridForProjection[r]=e)}};return t}(pv);function fv(t,e){t.getImage().src=e}function _v(t){var e,i,r=t[0],n=new Array(r),o=1<<r-1;for(e=0;e<r;++e){i=48;t[1]&o&&(i+=1);t[2]&o&&(i+=2);n[e]=String.fromCharCode(i);o>>=1}return n.join("")}var gv=function(i){function t(t){var e=void 0!==t.hidpi&&t.hidpi;i.call(this,{cacheSize:t.cacheSize,crossOrigin:"anonymous",opaque:!0,projection:be("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:bo.LOADING,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:e?2:1,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.hidpi_=e;this.culture_=void 0!==t.culture?t.culture:"en-us";this.maxZoom_=void 0!==t.maxZoom?t.maxZoom:-1;this.apiKey_=t.key;this.imagerySet_=t.imagerySet;$m("https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_,this.handleImageryMetadataResponse.bind(this),void 0,"jsonp")}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getApiKey=function(){return this.apiKey_};t.prototype.getImagerySet=function(){return this.imagerySet_};t.prototype.handleImageryMetadataResponse=function(t){if(200==t.statusCode&&"OK"==t.statusDescription&&"ValidCredentials"==t.authenticationResultCode&&1==t.resourceSets.length&&1==t.resourceSets[0].resources.length){var e=t.resourceSets[0].resources[0],i=-1==this.maxZoom_?e.zoomMax:this.maxZoom_,r=hv(this.getProjection()),n=this.hidpi_?2:1,o=e.imageWidth==e.imageHeight?e.imageWidth/n:[e.imageWidth/n,e.imageHeight/n],s=ov({extent:r,minZoom:e.zoomMin,maxZoom:i,tileSize:o});this.tileGrid=s;var a=this.culture_,h=this.hidpi_;this.tileUrlFunction=qm(e.imageUrlSubdomains.map(function(t){var n=[0,0,0],o=e.imageUrl.replace("{subdomain}",t).replace("{culture}",a);return function(t,e,i){if(t){ou(t[0],t[1],t[2],n);var r=o;h&&(r+="&dpi=d1&device=mobile");return r.replace("{quadkey}",_v(n))}}}));if(e.imageryProviders){var u=je(be("EPSG:4326"),this.getProjection());this.setAttributions(function(a){var h=[],t=a.viewState,l=this.getTileGrid().getTileCoordForCoordAndResolution(t.center,t.resolution)[0];e.imageryProviders.map(function(t){for(var e=!1,i=t.coverageAreas,r=0,n=i.length;r<n;++r){var o=i[r];if(l>=o.zoomMin&&l<=o.zoomMax){var s=o.bbox;if(Nt(Dt([s[1],s[0],s[3],s[2]],u),a.extent)){e=!0;break}}}e&&h.push(t.attribution)});h.push('<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html">Terms of Use</a>');return h}.bind(this))}this.setState(bo.READY)}else this.setState(bo.ERROR)};return t}(dv),yv=function(n){function t(t){var e=t||{},i=void 0!==e.projection?e.projection:"EPSG:3857",r=void 0!==e.tileGrid?e.tileGrid:ov({extent:hv(i),maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize});n.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,opaque:e.opaque,projection:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:r,tileLoadFunction:e.tileLoadFunction,tilePixelRatio:e.tilePixelRatio,tileUrlFunction:e.tileUrlFunction,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition,attributionsCollapsible:e.attributionsCollapsible})}n&&(t.__proto__=n);return(t.prototype=Object.create(n&&n.prototype)).constructor=t}(dv),mv=function(e){function t(t){e.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,maxZoom:void 0!==t.maxZoom?t.maxZoom:18,minZoom:t.minZoom,projection:t.projection,wrapX:t.wrapX});this.account_=t.account;this.mapId_=t.map||"";this.config_=t.config||{};this.templateCache_={};this.initializeMap_()}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getConfig=function(){return this.config_};t.prototype.updateConfig=function(t){y(this.config_,t);this.initializeMap_()};t.prototype.setConfig=function(t){this.config_=t||{};this.initializeMap_()};t.prototype.initializeMap_=function(){var t=JSON.stringify(this.config_);if(this.templateCache_[t])this.applyTemplate_(this.templateCache_[t]);else{var e="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(e+="/named/"+this.mapId_);var i=new XMLHttpRequest;i.addEventListener("load",this.handleInitResponse_.bind(this,t));i.addEventListener("error",this.handleInitError_.bind(this));i.open("POST",e);i.setRequestHeader("Content-type","application/json");i.send(JSON.stringify(this.config_))}};t.prototype.handleInitResponse_=function(t,e){var i=e.target;if(!i.status||200<=i.status&&i.status<300){var r;try{r=JSON.parse(i.responseText)}catch(t){this.setState(bo.ERROR);return}this.applyTemplate_(r);this.templateCache_[t]=r;this.setState(bo.READY)}else this.setState(bo.ERROR)};t.prototype.handleInitError_=function(t){this.setState(bo.ERROR)};t.prototype.applyTemplate_=function(t){var e="https://"+t.cdn_url.https+"/"+this.account_+"/api/v1/map/"+t.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(e)};return t}(yv),vv=function(e){function t(t){e.call(this,{attributions:t.attributions,wrapX:t.wrapX});this.resolution=void 0;this.distance=void 0!==t.distance?t.distance:20;this.features=[];this.geometryFunction=t.geometryFunction||function(t){var e=t.getGeometry();A(e.getType()==jt.POINT,10);return e};this.source=t.source;m(this.source,C.CHANGE,this.refresh,this)}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getDistance=function(){return this.distance};t.prototype.getSource=function(){return this.source};t.prototype.loadFeatures=function(t,e,i){this.source.loadFeatures(t,e,i);if(e!==this.resolution){this.clear();this.resolution=e;this.cluster();this.addFeatures(this.features)}};t.prototype.setDistance=function(t){this.distance=t;this.refresh()};t.prototype.refresh=function(){this.clear();this.cluster();this.addFeatures(this.features);e.prototype.refresh.call(this)};t.prototype.cluster=function(){if(void 0!==this.resolution)for(var t=[1/(this.features.length=0),1/0,-1/0,-1/0],e=this.distance*this.resolution,i=this.source.getFeatures(),r={},n=0,o=i.length;n<o;n++){var s=i[n];if(!(bt(s)in r)){var a=this.geometryFunction(s);if(a){at(a.getCoordinates(),t);J(t,e,t);var h=this.source.getFeaturesInExtent(t);h=h.filter(function(t){var e=bt(t);return!(e in r)&&(r[e]=!0)});this.features.push(this.createCluster(h))}}}};t.prototype.createCluster=function(t){for(var e=[0,0],i=t.length-1;0<=i;--i){var r=this.geometryFunction(t[i]);r?uo(e,r.getCoordinates()):t.splice(i,1)}mo(e,1/t.length);var n=new G(new Ai(e));n.set("features",t);return n};return t}(fl),Ev="imageloadstart",Tv="imageloadend",Sv="imageloaderror",xv=function(i){function t(t,e){i.call(this,t);this.image=e}i&&(t.__proto__=i);return(t.prototype=Object.create(i&&i.prototype)).constructor=t}(S),Rv=function(e){function t(t){e.call(this,{attributions:t.attributions,projection:t.projection,state:t.state});this.resolutions_=void 0!==t.resolutions?t.resolutions:null;this.reprojectedImage_=null;this.reprojectedRevision_=0}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getResolutions=function(){return this.resolutions_};t.prototype.findNearestResolution=function(t){if(this.resolutions_){var e=Y(this.resolutions_,t,0);t=this.resolutions_[e]}return t};t.prototype.getImage=function(t,e,i,r){var n=this.getProjection();if(n&&r&&!ke(n,r)){if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&ke(this.reprojectedImage_.getProjection(),r)&&this.reprojectedImage_.getResolution()==e&&ut(this.reprojectedImage_.getExtent(),t))return this.reprojectedImage_;this.reprojectedImage_.dispose();this.reprojectedImage_=null}this.reprojectedImage_=new Wm(n,r,t,e,i,function(t,e,i){return this.getImageInternal(t,e,i,n)}.bind(this));this.reprojectedRevision_=this.getRevision();return this.reprojectedImage_}n&&(r=n);return this.getImageInternal(t,e,i,r)};t.prototype.getImageInternal=function(t,e,i,r){return o()};t.prototype.handleImageChange=function(t){var e=t.target;switch(e.getState()){case Ar.LOADING:this.loading=!0;this.dispatchEvent(new xv(Ev,e));break;case Ar.LOADED:this.loading=!1;this.dispatchEvent(new xv(Tv,e));break;case Ar.ERROR:this.loading=!1;this.dispatchEvent(new xv(Sv,e))}};return t}(ll);function Cv(t,e){t.getImage().src=e}function wv(t,e){var i=[];Object.keys(e).forEach(function(t){null!==e[t]&&void 0!==e[t]&&i.push(t+"="+encodeURIComponent(e[t]))});var r=i.join("&");return(t=-1===(t=t.replace(/[?&]$/,"")).indexOf("?")?t+"?":t+"&")+r}var Iv=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.hidpi_=void 0===e.hidpi||e.hidpi;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:Cv;this.params_=e.params||{};this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e);i=this.hidpi_?i:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==e&&n.getPixelRatio()==i&&et(n.getExtent(),t))return n;var o={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};y(o,this.params_);var s=((t=t.slice())[0]+t[2])/2,a=(t[1]+t[3])/2;if(1!=this.ratio_){var h=this.ratio_*Lt(t)/2,l=this.ratio_*Rt(t)/2;t[0]=s-h;t[1]=a-l;t[2]=s+h;t[3]=a+l}var u=e/i,c=Math.ceil(Lt(t)/u),p=Math.ceil(Rt(t)/u);t[0]=s-u*c/2;t[2]=s+u*c/2;t[1]=a-u*p/2;t[3]=a+u*p/2;this.imageSize_[0]=c;this.imageSize_[1]=p;var d=this.getRequestUrl_(t,this.imageSize_,i,r,o);this.image_=new Gr(t,e,i,d,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();m(this.image_,C.CHANGE,this.handleImageChange,this);return this.image_};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.getRequestUrl_=function(t,e,i,r,n){var o=r.getCode().split(":").pop();n.SIZE=e[0]+","+e[1];n.BBOX=t.join(",");n.BBOXSR=o;n.IMAGESR=o;n.DPI=Math.round(90*i);var s=this.url_,a=s.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");a==s&&A(!1,50);return wv(a,n)};t.prototype.getUrl=function(){return this.url_};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};t.prototype.setUrl=function(t){if(t!=this.url_){this.url_=t;this.image_=null;this.changed()}};t.prototype.updateParams=function(t){y(this.params_,t);this.image_=null;this.changed()};return t}(Rv),Lv=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions,state:e.state});this.canvasFunction_=e.canvasFunction;this.canvas_=null;this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getImageInternal=function(t,e,i,r){e=this.findNearestResolution(e);var n=this.canvas_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==e&&n.getPixelRatio()==i&&et(n.getExtent(),t))return n;At(t=t.slice(),this.ratio_);var o=[Lt(t)/e*i,Rt(t)/e*i],s=this.canvasFunction_.call(this,t,e,i,o,r);s&&(n=new Dr(t,e,i,s));this.canvas_=n;this.renderedRevision_=this.getRevision();return n};return t}(Rv),Ov=function(e){function t(t){e.call(this,{projection:t.projection,resolutions:t.resolutions});this.crossOrigin_=void 0!==t.crossOrigin?t.crossOrigin:null;this.displayDpi_=void 0!==t.displayDpi?t.displayDpi:96;this.params_=t.params||{};this.url_=t.url;this.imageLoadFunction_=void 0!==t.imageLoadFunction?t.imageLoadFunction:Cv;this.hidpi_=void 0===t.hidpi||t.hidpi;this.metersPerUnit_=void 0!==t.metersPerUnit?t.metersPerUnit:1;this.ratio_=void 0!==t.ratio?t.ratio:1;this.useOverlay_=void 0!==t.useOverlay&&t.useOverlay;this.image_=null;this.renderedRevision_=0}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){e=this.findNearestResolution(e);i=this.hidpi_?i:1;var n=this.image_;if(n&&this.renderedRevision_==this.getRevision()&&n.getResolution()==e&&n.getPixelRatio()==i&&et(n.getExtent(),t))return n;1!=this.ratio_&&At(t=t.slice(),this.ratio_);var o=[Lt(t)/e*i,Rt(t)/e*i];if(void 0!==this.url_){var s=this.getUrl(this.url_,this.params_,t,o,r);m(n=new Gr(t,e,i,s,this.crossOrigin_,this.imageLoadFunction_),C.CHANGE,this.handleImageChange,this)}else n=null;this.image_=n;this.renderedRevision_=this.getRevision();return n};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.updateParams=function(t){y(this.params_,t);this.changed()};t.prototype.getUrl=function(t,e,i,r,n){var o,s,a,h,l,u,c,p,d,f=(o=i,s=r,a=this.metersPerUnit_,h=this.displayDpi_,l=Lt(o),u=Rt(o),c=s[0],p=s[1],d=.0254/h,c*u<p*l?l*a/(c*d):u*a/(p*d)),_=Tt(i),g={OPERATION:this.useOverlay_?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:this.displayDpi_,SETDISPLAYWIDTH:Math.round(r[0]),SETDISPLAYHEIGHT:Math.round(r[1]),SETVIEWSCALE:f,SETVIEWCENTERX:_[0],SETVIEWCENTERY:_[1]};y(g,e);return wv(t,g)};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};return t}(Rv);var Pv=function(l){function t(t){var e=void 0!==t.crossOrigin?t.crossOrigin:null,i=void 0!==t.imageLoadFunction?t.imageLoadFunction:Cv;l.call(this,{attributions:t.attributions,projection:be(t.projection)});this.url_=t.url;this.imageExtent_=t.imageExtent;this.image_=new Gr(this.imageExtent_,void 0,1,this.url_,e,i);this.imageSize_=t.imageSize?t.imageSize:null;m(this.image_,C.CHANGE,this.handleImageChange,this)}l&&(t.__proto__=l);((t.prototype=Object.create(l&&l.prototype)).constructor=t).prototype.getImageExtent=function(){return this.imageExtent_};t.prototype.getImageInternal=function(t,e,i,r){return Nt(t,this.image_.getExtent())?this.image_:null};t.prototype.getUrl=function(){return this.url_};t.prototype.handleImageChange=function(t){if(this.image_.getState()==Ar.LOADED){var e,i,r=this.image_.getExtent(),n=this.image_.getImage();if(this.imageSize_){e=this.imageSize_[0];i=this.imageSize_[1]}else{e=n.width;i=n.height}var o=Rt(r)/i,s=Math.ceil(Lt(r)/o);if(s!=e){var a=zr(s,i),h=a.canvas;a.drawImage(n,0,0,e,i,0,0,h.width,h.height);this.image_.setImage(h)}}l.prototype.handleImageChange.call(this,t)};return t}(Rv),bv="1.3.0",Mv={CARMENTA_SERVER:"carmentaserver",GEOSERVER:"geoserver",MAPSERVER:"mapserver",QGIS:"qgis"},Fv=[101,101],Nv=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,projection:e.projection,resolutions:e.resolutions});this.crossOrigin_=void 0!==e.crossOrigin?e.crossOrigin:null;this.url_=e.url;this.imageLoadFunction_=void 0!==e.imageLoadFunction?e.imageLoadFunction:Cv;this.params_=e.params||{};this.v13_=!0;this.updateV13_();this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.image_=null;this.imageSize_=[0,0];this.renderedRevision_=0;this.ratio_=void 0!==e.ratio?e.ratio:1.5}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getGetFeatureInfoUrl=function(t,e,i,r){if(void 0!==this.url_){var n=be(i),o=this.getProjection();if(o&&o!==n){e=Xm(o,n,t,e);t=Ye(t,n,o)}var s=xt(t,e,0,Fv),a={SERVICE:"WMS",VERSION:bv,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};y(a,this.params_,r);var h=Math.floor((t[0]-s[0])/e),l=Math.floor((s[3]-t[1])/e);a[this.v13_?"I":"X"]=h;a[this.v13_?"J":"Y"]=l;return this.getRequestUrl_(s,Fv,1,o||n,a)}};t.prototype.getParams=function(){return this.params_};t.prototype.getImageInternal=function(t,e,i,r){if(void 0===this.url_)return null;e=this.findNearestResolution(e);1==i||this.hidpi_&&void 0!==this.serverType_||(i=1);var n=e/i,o=Tt(t),s=xt(o,n,0,[Math.ceil(Lt(t)/n),Math.ceil(Rt(t)/n)]),a=xt(o,n,0,[Math.ceil(this.ratio_*Lt(t)/n),Math.ceil(this.ratio_*Rt(t)/n)]),h=this.image_;if(h&&this.renderedRevision_==this.getRevision()&&h.getResolution()==e&&h.getPixelRatio()==i&&et(h.getExtent(),s))return h;var l={SERVICE:"WMS",VERSION:bv,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};y(l,this.params_);this.imageSize_[0]=Math.round(Lt(a)/n);this.imageSize_[1]=Math.round(Rt(a)/n);var u=this.getRequestUrl_(a,this.imageSize_,i,r,l);this.image_=new Gr(a,e,i,u,this.crossOrigin_,this.imageLoadFunction_);this.renderedRevision_=this.getRevision();m(this.image_,C.CHANGE,this.handleImageChange,this);return this.image_};t.prototype.getImageLoadFunction=function(){return this.imageLoadFunction_};t.prototype.getRequestUrl_=function(t,e,i,r,n){A(void 0!==this.url_,9);n[this.v13_?"CRS":"SRS"]=r.getCode();"STYLES"in this.params_||(n.STYLES="");if(1!=i)switch(this.serverType_){case Mv.GEOSERVER:var o=90*i+.5|0;"FORMAT_OPTIONS"in n?n.FORMAT_OPTIONS+=";dpi:"+o:n.FORMAT_OPTIONS="dpi:"+o;break;case Mv.MAPSERVER:n.MAP_RESOLUTION=90*i;break;case Mv.CARMENTA_SERVER:case Mv.QGIS:n.DPI=90*i;break;default:A(!1,8)}n.WIDTH=e[0];n.HEIGHT=e[1];var s,a=r.getAxisOrientation();s=this.v13_&&"ne"==a.substr(0,2)?[t[1],t[0],t[3],t[2]]:t;n.BBOX=s.join(",");return wv(this.url_,n)};t.prototype.getUrl=function(){return this.url_};t.prototype.setImageLoadFunction=function(t){this.image_=null;this.imageLoadFunction_=t;this.changed()};t.prototype.setUrl=function(t){if(t!=this.url_){this.url_=t;this.image_=null;this.changed()}};t.prototype.updateParams=function(t){y(this.params_,t);this.updateV13_();this.image_=null;this.changed()};t.prototype.updateV13_=function(){var t=this.params_.VERSION||bv;this.v13_=0<=lo(t,"1.3")};return t}(Rv),Av='&#169; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors.',Gv=function(o){function t(t){var e,i=t||{};e=void 0!==i.attributions?i.attributions:[Av];var r=void 0!==i.crossOrigin?i.crossOrigin:"anonymous",n=void 0!==i.url?i.url:"https://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png";o.call(this,{attributions:e,cacheSize:i.cacheSize,crossOrigin:r,opaque:void 0===i.opaque||i.opaque,maxZoom:void 0!==i.maxZoom?i.maxZoom:19,reprojectionErrorThreshold:i.reprojectionErrorThreshold,tileLoadFunction:i.tileLoadFunction,url:n,wrapX:i.wrapX,attributionsCollapsible:!1})}o&&(t.__proto__=o);return(t.prototype=Object.create(o&&o.prototype)).constructor=t}(yv),Dv=!0;try{new ImageData(10,10)}catch(t){Dv=!1}var kv=document.createElement("canvas").getContext("2d");var jv={newImageData:function(t,e,i){if(Dv)return new ImageData(t,e,i);var r=kv.createImageData(e,i);r.data.set(t);return r}}.newImageData;function Uv(E){var T=!0;try{new ImageData(10,10)}catch(t){T=!1}return function(t){var e,i,r,n,o,s=t.buffers,a=t.meta,h=t.imageOps,l=t.width,u=t.height,c=s.length,p=s[0].byteLength;if(h){var d=new Array(c);for(i=0;i<c;++i)d[i]=(r=new Uint8ClampedArray(s[i]),n=l,o=u,T?new ImageData(r,n,o):{data:r,width:n,height:o});e=E(d,a).data}else{e=new Uint8ClampedArray(p);var f=new Array(c),_=new Array(c);for(i=0;i<c;++i){f[i]=new Uint8ClampedArray(s[i]);_[i]=[0,0,0,0]}for(var g=0;g<p;g+=4){for(var y=0;y<c;++y){var m=f[y];_[y][0]=m[g];_[y][1]=m[g+1];_[y][2]=m[g+2];_[y][3]=m[g+3]}var v=E(_,a);e[g]=v[0];e[g+1]=v[1];e[g+2]=v[2];e[g+3]=v[3]}}return e.buffer}}function Yv(e,t){var i=Object.keys(e.lib||{}).map(function(t){return"var "+t+" = "+e.lib[t].toString()+";"}).concat(["var __minion__ = ("+Uv.toString()+")(",e.operation.toString(),");",'self.addEventListener("message", function(event) {',"  var buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),r=new Blob(i,{type:"text/javascript"}),n=URL.createObjectURL(r),o=new Worker(n);o.addEventListener("message",t);return o}function Xv(t){this._imageOps=!!t.imageOps;var e,i,r,n,o=[];if(e=0===t.threads?0:this._imageOps?1:t.threads||1)for(var s=0;s<e;++s)o[s]=Yv(t,this._onWorkerMessage.bind(this,s));else o[0]=(i=t,r=this._onWorkerMessage.bind(this,0),n=Uv(i.operation),{postMessage:function(t){setTimeout(function(){r({data:{buffer:n(t),meta:t.meta}})},0)}});this._workers=o;this._queue=[];this._maxQueueLength=t.queue||1/0;this._running=0;this._dataLookup={};this._job=null}Xv.prototype.process=function(t,e,i){this._enqueue({inputs:t,meta:e,callback:i});this._dispatch()};Xv.prototype.destroy=function(){for(var t in this)this[t]=null;this._destroyed=!0};Xv.prototype._enqueue=function(t){this._queue.push(t);for(;this._queue.length>this._maxQueueLength;)this._queue.shift().callback(null,null)};Xv.prototype._dispatch=function(){if(0===this._running&&0<this._queue.length){var t=this._job=this._queue.shift(),e=t.inputs[0].width,i=t.inputs[0].height,r=t.inputs.map(function(t){return t.data.buffer}),n=this._workers.length;if(1===(this._running=n))this._workers[0].postMessage({buffers:r,meta:t.meta,imageOps:this._imageOps,width:e,height:i},r);else for(var o=t.inputs[0].data.length,s=4*Math.ceil(o/4/n),a=0;a<n;++a){for(var h=a*s,l=[],u=0,c=r.length;u<c;++u)l.push(r[a].slice(h,h+s));this._workers[a].postMessage({buffers:l,meta:t.meta,imageOps:this._imageOps,width:e,height:i},l)}}};Xv.prototype._onWorkerMessage=function(t,e){if(!this._destroyed){this._dataLookup[t]=e.data;--this._running;0===this._running&&this._resolveJob()}};Xv.prototype._resolveJob=function(){var t,e,i=this._job,r=this._workers.length;if(1===r){t=new Uint8ClampedArray(this._dataLookup[0].buffer);e=this._dataLookup[0].meta}else{var n=i.inputs[0].data.length;t=new Uint8ClampedArray(n);e=new Array(n);for(var o=4*Math.ceil(n/4/r),s=0;s<r;++s){var a=this._dataLookup[s].buffer,h=s*o;t.set(new Uint8ClampedArray(a),h);e[s]=this._dataLookup[s].meta}}this._job=null;this._dataLookup={};i.callback(null,jv(t,i.inputs[0].width,i.inputs[0].height),e);this._dispatch()};var Bv=Xv,zv="beforeoperations",Vv="afteroperations",Wv="pixel",Kv="image",Hv=function(r){function t(t,e,i){r.call(this,t);this.extent=e.extent;this.resolution=e.viewState.resolution/e.pixelRatio;this.data=i}r&&(t.__proto__=r);return(t.prototype=Object.create(r&&r.prototype)).constructor=t}(S),Zv=function(a){function t(t){a.call(this,{projection:null});this.worker_=null;this.operationType_=void 0!==t.operationType?t.operationType:Wv;this.threads_=void 0!==t.threads?t.threads:1;this.layers_=function(t){for(var e=t.length,i=new Array(e),r=0;r<e;++r)i[r]=Qv(t[r]);return i}(t.sources);for(var e=0,i=this.layers_.length;e<i;++e)m(this.layers_[e],C.CHANGE,this.changed,this);this.tileQueue_=new Zn(function(){return 1},this.changed.bind(this));for(var r=this.layers_.map(function(t){return t.getLayerState()}),n={},o=0,s=r.length;o<s;++o)n[bt(r[o].layer)]=r[o];this.requestedFrameState_;this.renderedImageCanvas_=null;this.renderedRevision_;this.frameState_={animate:!1,coordinateToPixelTransform:[1,0,0,1,0,0],extent:null,focus:null,index:0,layerStates:n,layerStatesArray:r,pixelRatio:1,pixelToCoordinateTransform:[1,0,0,1,0,0],postRenderFunctions:[],size:[0,0],skippedFeatureUids:{},tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{}};void 0!==t.operation&&this.setOperation(t.operation,t.lib)}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.setOperation=function(t,e){this.worker_=new Bv({operation:t,imageOps:this.operationType_===Kv,queue:1,lib:e,threads:this.threads_});this.changed()};t.prototype.updateFrameState_=function(t,e,i){var r=y({},this.frameState_);r.viewState=y({},r.viewState);var n=Tt(t);r.extent=t.slice();r.focus=n;r.size[0]=Math.round(Lt(t)/e);r.size[1]=Math.round(Rt(t)/e);r.time=Date.now();r.animate=!1;var o=r.viewState;o.center=n;o.projection=i;o.resolution=e;return r};t.prototype.allSourcesReady_=function(){for(var t=!0,e=0,i=this.layers_.length;e<i;++e)if(this.layers_[e].getSource().getState()!==bo.READY){t=!1;break}return t};t.prototype.getImage=function(t,e,i,r){if(!this.allSourcesReady_())return null;var n=this.updateFrameState_(t,e,r);this.requestedFrameState_=n;if(this.renderedImageCanvas_){var o=this.renderedImageCanvas_.getResolution(),s=this.renderedImageCanvas_.getExtent();e===o&&ut(t,s)||(this.renderedImageCanvas_=null)}this.renderedImageCanvas_&&this.getRevision()===this.renderedRevision_||this.processSources_();n.tileQueue.loadMoreTiles(16,16);n.animate&&requestAnimationFrame(this.changed.bind(this));return this.renderedImageCanvas_};t.prototype.processSources_=function(){for(var t=this.requestedFrameState_,e=this.layers_.length,i=new Array(e),r=0;r<e;++r){var n=Jv(this.layers_[r],t,t.layerStatesArray[r]);if(!n)return;i[r]=n}var o={};this.dispatchEvent(new Hv(zv,t,o));this.worker_.process(i,o,this.onWorkerComplete_.bind(this,t))};t.prototype.onWorkerComplete_=function(t,e,i,r){if(!e&&i){var n=t.extent,o=t.viewState.resolution;if(o===this.requestedFrameState_.viewState.resolution&&ut(n,this.requestedFrameState_.extent)){var s;if(this.renderedImageCanvas_)s=this.renderedImageCanvas_.getImage().getContext("2d");else{s=zr(Math.round(Lt(n)/o),Math.round(Rt(n)/o));this.renderedImageCanvas_=new Dr(n,o,1,s.canvas)}s.putImageData(i,0,0);this.changed();this.renderedRevision_=this.getRevision();this.dispatchEvent(new Hv(Vv,t,r))}}};t.prototype.getImageInternal=function(){return null};return t}(Rv),qv=null;function Jv(t,e,i){var r=t.getRenderer();if(!r)throw new Error("Unsupported layer type: "+t);if(!r.prepareFrame(e,i))return null;var n=e.size[0],o=e.size[1],s=r.renderFrame(e,i);if(!(s instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+s);if(s.width===n&&s.height===o){return s.getContext("2d").getImageData(0,0,n,o)}if(qv){var a=qv.canvas;a.width!==n||a.height!==o?qv=zr(n,o):qv.clearRect(0,0,n,o)}else qv=zr(n,o);qv.drawImage(s,0,0,n,o);return qv.getImageData(0,0,n,o)}function Qv(t){var e;t instanceof ll?t instanceof lv?e=new Fm({source:t}):t instanceof Rv&&(e=new bm({source:t})):e=t;return e}var $v=['Map tiles by <a href="https://stamen.com/">Stamen Design</a>, under <a href="https://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.',Av],tE={terrain:{extension:"jpg",opaque:!0},"terrain-background":{extension:"jpg",opaque:!0},"terrain-labels":{extension:"png",opaque:!1},"terrain-lines":{extension:"png",opaque:!1},"toner-background":{extension:"png",opaque:!0},toner:{extension:"png",opaque:!0},"toner-hybrid":{extension:"png",opaque:!1},"toner-labels":{extension:"png",opaque:!1},"toner-lines":{extension:"png",opaque:!1},"toner-lite":{extension:"png",opaque:!0},watercolor:{extension:"jpg",opaque:!0}},eE={terrain:{minZoom:4,maxZoom:18},toner:{minZoom:0,maxZoom:20},watercolor:{minZoom:1,maxZoom:16}},iE=function(s){function t(t){var e=t.layer.indexOf("-"),i=-1==e?t.layer:t.layer.slice(0,e),r=eE[i],n=tE[t.layer],o=void 0!==t.url?t.url:"https://stamen-tiles-{a-d}.a.ssl.fastly.net/"+t.layer+"/{z}/{x}/{y}."+n.extension;s.call(this,{attributions:$v,cacheSize:t.cacheSize,crossOrigin:"anonymous",maxZoom:null!=t.maxZoom?t.maxZoom:r.maxZoom,minZoom:null!=t.minZoom?t.minZoom:r.minZoom,opaque:n.opaque,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileLoadFunction:t.tileLoadFunction,url:o,wrapX:t.wrapX})}s&&(t.__proto__=s);return(t.prototype=Object.create(s&&s.prototype)).constructor=t}(yv),rE=function(i){function t(t){var e=t||{};i.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,tileUrlFunction:nE,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.params_=e.params||{};this.tmpExtent_=[1/0,1/0,-1/0,-1/0];this.setKey(this.getKeyForParams_())}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getKeyForParams_=function(){var t=0,e=[];for(var i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")};t.prototype.getParams=function(){return this.params_};t.prototype.getRequestUrl_=function(t,e,i,r,n,o){var s=this.urls;if(s){var a,h=n.getCode().split(":").pop();o.SIZE=e[0]+","+e[1];o.BBOX=i.join(",");o.BBOXSR=h;o.IMAGESR=h;o.DPI=Math.round(o.DPI?o.DPI*r:90*r);if(1==s.length)a=s[0];else{a=s[Jt(lu(t),s.length)]}return wv(a.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage"),o)}};t.prototype.getTilePixelRatio=function(t){return t};t.prototype.updateParams=function(t){y(this.params_,t);this.setKey(this.getKeyForParams_())};return t}(dv);function nE(t,e,i){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(i));if(!(r.getResolutions().length<=t[0])){var n=r.getTileCoordExtent(t,this.tmpExtent_),o=Do(r.getTileSize(t[0]),this.tmpSize);1!=e&&(o=Go(o,e,this.tmpSize));var s={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};y(s,this.params_);return this.getRequestUrl_(t,o,n,e,i,s)}}var oE=function(r){function t(t,e,i){r.call(this,t,kr.LOADED);this.tileSize_=e;this.text_=i;this.canvas_=null}r&&(t.__proto__=r);((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.getImage=function(){if(this.canvas_)return this.canvas_;var t=this.tileSize_,e=zr(t[0],t[1]);e.strokeStyle="grey";e.strokeRect(.5,.5,t[0]+.5,t[1]+.5);e.fillStyle="grey";e.textAlign="center";e.textBaseline="middle";e.font="24px sans-serif";e.fillText(this.text_,t[0]/2,t[1]/2);this.canvas_=e.canvas;return e.canvas};t.prototype.load=function(){};return t}(Br),sE=function(i){function t(t){var e=t||{};i.call(this,{opaque:!1,projection:e.projection,tileGrid:e.tileGrid,wrapX:void 0===e.wrapX||e.wrapX})}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.getTile=function(t,e,i){var r=su(t,e,i);if(this.tileCache.containsKey(r))return this.tileCache.get(r);var n,o=Do(this.tileGrid.getTileSize(t)),s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s);n=a?"z:"+a[0]+" x:"+a[1]+" y:"+a[2]:"none";var h=new oE(s,o,n);this.tileCache.set(r,h);return h};return t}(yv),aE=function(i){function t(t){i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:be("EPSG:3857"),reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:bo.LOADING,tileLoadFunction:t.tileLoadFunction,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.tileJSON_=null;if(t.url)if(t.jsonp)$m(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",t.url);e.send()}else t.tileJSON?this.handleTileJSONResponse(t.tileJSON):A(!1,51)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()};t.prototype.onXHRError_=function(t){this.handleTileJSONError()};t.prototype.getTileJSON=function(){return this.tileJSON_};t.prototype.handleTileJSONResponse=function(e){var t,i=be("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var n=je(i,r);t=Dt(e.bounds,n)}var o=e.minzoom||0,s=e.maxzoom||22,a=ov({extent:hv(r),maxZoom:s,minZoom:o});this.tileGrid=a;this.tileUrlFunction=Zm(e.tiles,a);if(void 0!==e.attribution&&!this.getAttributions()){var h=void 0!==t?t:i.getExtent();this.setAttributions(function(t){return Nt(h,t.extent)?[e.attribution]:null})}this.tileJSON_=e;this.setState(bo.READY)};t.prototype.handleTileJSONError=function(){this.setState(bo.ERROR)};return t}(dv),hE=function(n){function t(t){var e=t||{},i=e.params||{},r=!("TRANSPARENT"in i)||i.TRANSPARENT;n.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,opaque:!r,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:e.tileClass,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,tileUrlFunction:lE,url:e.url,urls:e.urls,wrapX:void 0===e.wrapX||e.wrapX,transition:e.transition});this.gutter_=void 0!==e.gutter?e.gutter:0;this.params_=i;this.v13_=!0;this.serverType_=e.serverType;this.hidpi_=void 0===e.hidpi||e.hidpi;this.tmpExtent_=[1/0,1/0,-1/0,-1/0];this.updateV13_();this.setKey(this.getKeyForParams_())}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.getGetFeatureInfoUrl=function(t,e,i,r){var n=be(i),o=this.getProjection(),s=this.getTileGrid();s||(s=this.getTileGridForProjection(n));var a=s.getTileCoordForCoordAndResolution(t,e);if(!(s.getResolutions().length<=a[0])){var h=s.getResolution(a[0]),l=s.getTileCoordExtent(a,this.tmpExtent_),u=Do(s.getTileSize(a[0]),this.tmpSize),c=this.gutter_;if(0!==c){u=No(u,c,this.tmpSize);l=J(l,h*c,l)}if(o&&o!==n){h=Xm(o,n,t,h);l=Xe(l,n,o);t=Ye(t,n,o)}var p={SERVICE:"WMS",VERSION:bv,REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this.params_.LAYERS};y(p,this.params_,r);var d=Math.floor((t[0]-l[0])/h),f=Math.floor((l[3]-t[1])/h);p[this.v13_?"I":"X"]=d;p[this.v13_?"J":"Y"]=f;return this.getRequestUrl_(a,u,l,1,o||n,p)}};t.prototype.getGutter=function(){return this.gutter_};t.prototype.getParams=function(){return this.params_};t.prototype.getRequestUrl_=function(t,e,i,r,n,o){var s=this.urls;if(s){o.WIDTH=e[0];o.HEIGHT=e[1];o[this.v13_?"CRS":"SRS"]=n.getCode();"STYLES"in this.params_||(o.STYLES="");if(1!=r)switch(this.serverType_){case Mv.GEOSERVER:var a=90*r+.5|0;"FORMAT_OPTIONS"in o?o.FORMAT_OPTIONS+=";dpi:"+a:o.FORMAT_OPTIONS="dpi:"+a;break;case Mv.MAPSERVER:o.MAP_RESOLUTION=90*r;break;case Mv.CARMENTA_SERVER:case Mv.QGIS:o.DPI=90*r;break;default:A(!1,52)}var h,l=n.getAxisOrientation(),u=i;if(this.v13_&&"ne"==l.substr(0,2)){var c;c=i[0];u[0]=i[1];u[1]=c;c=i[2];u[2]=i[3];u[3]=c}o.BBOX=u.join(",");if(1==s.length)h=s[0];else{h=s[Jt(lu(t),s.length)]}return wv(h,o)}};t.prototype.getTilePixelRatio=function(t){return this.hidpi_&&void 0!==this.serverType_?t:1};t.prototype.getKeyForParams_=function(){var t=0,e=[];for(var i in this.params_)e[t++]=i+"-"+this.params_[i];return e.join("/")};t.prototype.updateParams=function(t){y(this.params_,t);this.updateV13_();this.setKey(this.getKeyForParams_())};t.prototype.updateV13_=function(){var t=this.params_.VERSION||bv;this.v13_=0<=lo(t,"1.3")};return t}(dv);function lE(t,e,i){var r=this.getTileGrid();r||(r=this.getTileGridForProjection(i));if(!(r.getResolutions().length<=t[0])){1==e||this.hidpi_&&void 0!==this.serverType_||(e=1);var n=r.getResolution(t[0]),o=r.getTileCoordExtent(t,this.tmpExtent_),s=Do(r.getTileSize(t[0]),this.tmpSize),a=this.gutter_;if(0!==a){s=No(s,a,this.tmpSize);o=J(o,n*a,o)}1!=e&&(s=Go(s,e,this.tmpSize));var h={SERVICE:"WMS",VERSION:bv,REQUEST:"GetMap",FORMAT:"image/png",TRANSPARENT:!0};y(h,this.params_);return this.getRequestUrl_(t,s,o,e,i,h)}}var uE=function(s){function t(t,e,i,r,n,o){s.call(this,t,e);this.src_=i;this.extent_=r;this.preemptive_=n;this.grid_=null;this.keys_=null;this.data_=null;this.jsonp_=o}s&&(t.__proto__=s);((t.prototype=Object.create(s&&s.prototype)).constructor=t).prototype.getImage=function(){return null};t.prototype.getData=function(t){if(!this.grid_||!this.keys_)return null;var e=(t[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),i=(t[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),r=this.grid_[Math.floor((1-i)*this.grid_.length)];if("string"!=typeof r)return null;var n=r.charCodeAt(Math.floor(e*r.length));93<=n&&n--;35<=n&&n--;var o=null;if((n-=32)in this.keys_){var s=this.keys_[n];o=this.data_&&s in this.data_?this.data_[s]:s}return o};t.prototype.forDataAtCoordinate=function(e,i,r,t){if(this.state==kr.IDLE&&!0===t){d(this,C.CHANGE,function(t){i.call(r,this.getData(e))},this);this.loadInternal_()}else!0===t?setTimeout(function(){i.call(r,this.getData(e))}.bind(this),0):i.call(r,this.getData(e))};t.prototype.getKey=function(){return this.src_};t.prototype.handleError_=function(){this.state=kr.ERROR;this.changed()};t.prototype.handleLoad_=function(t){this.grid_=t.grid;this.keys_=t.keys;this.data_=t.data;this.state=kr.EMPTY;this.changed()};t.prototype.loadInternal_=function(){if(this.state==kr.IDLE){this.state=kr.LOADING;if(this.jsonp_)$m(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{var t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this));t.addEventListener("error",this.onXHRError_.bind(this));t.open("GET",this.src_);t.send()}}};t.prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleError_();return}this.handleLoad_(i)}else this.handleError_()};t.prototype.onXHRError_=function(t){this.handleError_()};t.prototype.load=function(){this.preemptive_&&this.loadInternal_()};return t}(Br),cE=function(i){function t(t){i.call(this,{projection:be("EPSG:3857"),state:bo.LOADING});this.preemptive_=void 0===t.preemptive||t.preemptive;this.tileUrlFunction_=Jm;this.template_=void 0;this.jsonp_=t.jsonp||!1;if(t.url)if(this.jsonp_)$m(t.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{var e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this));e.addEventListener("error",this.onXHRError_.bind(this));e.open("GET",t.url);e.send()}else t.tileJSON?this.handleTileJSONResponse(t.tileJSON):A(!1,51)}i&&(t.__proto__=i);((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.onXHRLoad_=function(t){var e=t.target;if(!e.status||200<=e.status&&e.status<300){var i;try{i=JSON.parse(e.responseText)}catch(t){this.handleTileJSONError();return}this.handleTileJSONResponse(i)}else this.handleTileJSONError()};t.prototype.onXHRError_=function(t){this.handleTileJSONError()};t.prototype.getTemplate=function(){return this.template_};t.prototype.forDataAtCoordinateAndResolution=function(t,e,i,r){if(this.tileGrid){var n=this.tileGrid.getTileCoordForCoordAndResolution(t,e);this.getTile(n[0],n[1],n[2],1,this.getProjection()).forDataAtCoordinate(t,i,null,r)}else!0===r?setTimeout(function(){i(null)},0):i(null)};t.prototype.handleTileJSONError=function(){this.setState(bo.ERROR)};t.prototype.handleTileJSONResponse=function(e){var t,i=be("EPSG:4326"),r=this.getProjection();if(void 0!==e.bounds){var n=je(i,r);t=Dt(e.bounds,n)}var o=e.minzoom||0,s=e.maxzoom||22,a=ov({extent:hv(r),maxZoom:s,minZoom:o});this.tileGrid=a;this.template_=e.template;var h=e.grids;if(h){this.tileUrlFunction_=Zm(h,a);if(void 0!==e.attribution){var l=void 0!==t?t:i.getExtent();this.setAttributions(function(t){return Nt(l,t.extent)?[e.attribution]:null})}this.setState(bo.READY)}else this.setState(bo.ERROR)};t.prototype.getTile=function(t,e,i,r,n){var o=su(t,e,i);if(this.tileCache.containsKey(o))return this.tileCache.get(o);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,n),h=this.tileUrlFunction_(a,r,n),l=new uE(s,void 0!==h?kr.IDLE:kr.EMPTY,void 0!==h?h:"",this.tileGrid.getTileCoordExtent(s),this.preemptive_,this.jsonp_);this.tileCache.set(o,l);return l};t.prototype.useTile=function(t,e,i){var r=su(t,e,i);this.tileCache.containsKey(r)&&this.tileCache.get(r)};return t}(lv),pE=function(n){function t(t){var e=t.projection||"EPSG:3857",i=t.extent||hv(e),r=t.tileGrid||ov({extent:i,maxZoom:t.maxZoom||22,minZoom:t.minZoom,tileSize:t.tileSize||512});n.call(this,{attributions:t.attributions,cacheSize:void 0!==t.cacheSize?t.cacheSize:128,opaque:!1,projection:e,state:t.state,tileGrid:r,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:_u,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition});this.format_=t.format?t.format:null;this.sourceTiles_={};this.overlaps_=null==t.overlaps||t.overlaps;this.tileClass=t.tileClass?t.tileClass:mu;this.tileGrids_={}}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.getOverlaps=function(){return this.overlaps_};t.prototype.clear=function(){this.tileCache.clear();this.sourceTiles_={}};t.prototype.getTile=function(t,e,i,r,n){var o=su(t,e,i);if(this.tileCache.containsKey(o))return this.tileCache.get(o);var s=[t,e,i],a=this.getTileCoordForTileUrlFunction(s,n),h=new fu(s,null!==a?kr.IDLE:kr.EMPTY,this.getRevision(),this.format_,this.tileLoadFunction,a,this.tileUrlFunction,this.tileGrid,this.getTileGridForProjection(n),this.sourceTiles_,r,n,this.tileClass,this.handleTileChange.bind(this));this.tileCache.set(o,h);return h};t.prototype.getTileGridForProjection=function(t){var e=t.getCode(),i=this.tileGrids_[e];if(!i){var r=this.tileGrid;i=this.tileGrids_[e]=av(t,void 0,r?r.getTileSize(r.getMinZoom()):void 0)}return i};t.prototype.getTilePixelRatio=function(t){return t};t.prototype.getTilePixelSize=function(t,e,i){var r=Do(this.getTileGridForProjection(i).getTileSize(t),this.tmpSize);return[Math.round(r[0]*e),Math.round(r[1]*e)]};return t}(pv),dE={KVP:"KVP",REST:"REST"},fE=function(e){function t(t){e.call(this,{extent:t.extent,origin:t.origin,origins:t.origins,resolutions:t.resolutions,tileSize:t.tileSize,tileSizes:t.tileSizes,sizes:t.sizes});this.matrixIds_=t.matrixIds}e&&(t.__proto__=e);((t.prototype=Object.create(e&&e.prototype)).constructor=t).prototype.getMatrixId=function(t){return this.matrixIds_[t]};t.prototype.getMatrixIds=function(){return this.matrixIds_};return t}(ev);function _E(n,t,e){var o=[],s=[],a=[],h=[],l=[],u=void 0!==e?e:[],c="TileMatrix",p="Identifier",d="ScaleDenominator",f="TopLeftCorner",i=n.SupportedCRS,r=be(i.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||be(i),_=r.getMetersPerUnit(),g="ne"==r.getAxisOrientation().substr(0,2);n[c].sort(function(t,e){return e[d]-t[d]});n[c].forEach(function(e){if(!(0<u.length)||V(u,function(t){return e[p]==t[c]||-1===e[p].indexOf(":")&&n[p]+":"+e[p]===t[c]})){s.push(e[p]);var t=28e-5*e[d]/_,i=e.TileWidth,r=e.TileHeight;g?a.push([e[f][1],e[f][0]]):a.push(e[f]);o.push(t);h.push(i==r?i:[i,r]);l.push([e.MatrixWidth,e.MatrixHeight])}});return new fE({extent:t,origins:a,resolutions:o,matrixIds:s,tileSizes:h,sizes:l})}var gE=function(n){function t(t){var e=void 0!==t.requestEncoding?t.requestEncoding:dE.KVP,i=t.tileGrid,r=t.urls;void 0===r&&void 0!==t.url&&(r=Qm(t.url));n.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,tileClass:t.tileClass,tileGrid:i,tileLoadFunction:t.tileLoadFunction,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:Jm,urls:r,wrapX:void 0!==t.wrapX&&t.wrapX,transition:t.transition});this.version_=void 0!==t.version?t.version:"1.0.0";this.format_=void 0!==t.format?t.format:"image/jpeg";this.dimensions_=void 0!==t.dimensions?t.dimensions:{};this.layer_=t.layer;this.matrixSet_=t.matrixSet;this.style_=t.style;this.requestEncoding_=e;this.setKey(this.getKeyForDimensions_());r&&0<r.length&&(this.tileUrlFunction=qm(r.map(yE.bind(this))))}n&&(t.__proto__=n);((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.setUrls=function(t){var e=(this.urls=t).join("\n");this.setTileUrlFunction(qm(t.map(yE.bind(this))),e)};t.prototype.getDimensions=function(){return this.dimensions_};t.prototype.getFormat=function(){return this.format_};t.prototype.getLayer=function(){return this.layer_};t.prototype.getMatrixSet=function(){return this.matrixSet_};t.prototype.getRequestEncoding=function(){return this.requestEncoding_};t.prototype.getStyle=function(){return this.style_};t.prototype.getVersion=function(){return this.version_};t.prototype.getKeyForDimensions_=function(){var t=0,e=[];for(var i in this.dimensions_)e[t++]=i+"-"+this.dimensions_[i];return e.join("/")};t.prototype.updateDimensions=function(t){y(this.dimensions_,t);this.setKey(this.getKeyForDimensions_())};return t}(dv);function yE(o){var s=this.requestEncoding_,i={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};s==dE.KVP&&y(i,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_});o=s==dE.KVP?wv(o,i):o.replace(/\{(\w+?)\}/g,function(t,e){return e.toLowerCase()in i?i[e.toLowerCase()]:t});var a=this.tileGrid,h=this.dimensions_;return function(t,e,i){if(t){var r={TileMatrix:a.getMatrixId(t[0]),TileCol:t[1],TileRow:t[2]};y(r,h);var n=o;return n=s==dE.KVP?wv(n,r):n.replace(/\{(\w+?)\}/g,function(t,e){return r[e]})}}}var mE="default",vE="truncated",EE=function(a){function t(t,e,i,r,n,o,s){a.call(this,e,i,r,n,o,s);this.zoomifyImage_=null;this.tileSize_=Do(t.getTileSize(e[0]))}a&&(t.__proto__=a);((t.prototype=Object.create(a&&a.prototype)).constructor=t).prototype.getImage=function(){if(this.zoomifyImage_)return this.zoomifyImage_;var t=a.prototype.getImage.call(this);if(this.state!=kr.LOADED)return t;var e=this.tileSize_;if(t.width==e[0]&&t.height==e[1])return this.zoomifyImage_=t;var i=zr(e[0],e[1]);i.drawImage(t,0,0);this.zoomifyImage_=i.canvas;return i.canvas};return t}(Jr),TE=function(E){function t(t){var e=t||{},i=e.size,r=void 0!==e.tierSizeCalculation?e.tierSizeCalculation:mE,n=i[0],o=i[1],s=e.extent||[0,-i[1],i[0],0],c=[],a=e.tileSize||Jn,h=a;switch(r){case mE:for(;h<n||h<o;){c.push([Math.ceil(n/h),Math.ceil(o/h)]);h+=h}break;case vE:for(var l=n,u=o;h<l||h<u;){c.push([Math.ceil(l/h),Math.ceil(u/h)]);l>>=1;u>>=1}break;default:A(!1,53)}c.push([1,1]);c.reverse();for(var p=[1],d=[0],f=1,_=c.length;f<_;f++){p.push(1<<f);d.push(c[f-1][0]*c[f-1][1]+d[f-1])}p.reverse();var g=new ev({tileSize:a,extent:s,origin:wt(s),resolutions:p}),y=e.url;y&&-1==y.indexOf("{TileGroup}")&&-1==y.indexOf("{tileIndex}")&&(y+="{TileGroup}/{z}-{x}-{y}.jpg");var m=qm(Qm(y).map(function(u){return function(t,e,i){if(t){var r=t[0],n=t[1],o=t[2],s=n+o*c[r][0],a=g.getTileSize(r),h=Array.isArray(a)?a[0]:a,l={z:r,x:n,y:o,tileIndex:s,TileGroup:"TileGroup"+((s+d[r])/h|0)};return u.replace(/\{(\w+?)\}/g,function(t,e){return l[e]})}}})),v=EE.bind(null,g);E.call(this,{attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:v,tileGrid:g,tileUrlFunction:m,transition:e.transition})}E&&(t.__proto__=E);return(t.prototype=Object.create(E&&E.prototype)).constructor=t}(dv),SE=function(t){this.first_;this.last_;this.head_;this.circular_=void 0===t||t;this.length_=0};SE.prototype.insertItem=function(t){var e={prev:void 0,next:void 0,data:t},i=this.head_;if(i){var r=i.next;e.prev=i;e.next=r;i.next=e;r&&(r.prev=e);i===this.last_&&(this.last_=e)}else{this.first_=e;this.last_=e;this.circular_&&((e.next=e).prev=e)}this.head_=e;this.length_++};SE.prototype.removeItem=function(){var t=this.head_;if(t){var e=t.next,i=t.prev;e&&(e.prev=i);i&&(i.next=e);this.head_=e||i;if(this.first_===this.last_){this.head_=void 0;this.first_=void 0;this.last_=void 0}else this.first_===t?this.first_=this.head_:this.last_===t&&(this.last_=i?this.head_.prev:this.head_);this.length_--}};SE.prototype.firstItem=function(){this.head_=this.first_;if(this.head_)return this.head_.data};SE.prototype.lastItem=function(){this.head_=this.last_;if(this.head_)return this.head_.data};SE.prototype.nextItem=function(){if(this.head_&&this.head_.next){this.head_=this.head_.next;return this.head_.data}};SE.prototype.getNextItem=function(){if(this.head_&&this.head_.next)return this.head_.next.data};SE.prototype.prevItem=function(){if(this.head_&&this.head_.prev){this.head_=this.head_.prev;return this.head_.data}};SE.prototype.getPrevItem=function(){if(this.head_&&this.head_.prev)return this.head_.prev.data};SE.prototype.getCurrItem=function(){if(this.head_)return this.head_.data};SE.prototype.setFirstItem=function(){if(this.circular_&&this.head_){this.first_=this.head_;this.last_=this.head_.prev}};SE.prototype.concat=function(t){if(t.head_){if(this.head_){var e=this.head_.next;this.head_.next=t.first_;t.first_.prev=this.head_;e.prev=t.last_;t.last_.next=e;this.length_+=t.length_}else{this.head_=t.head_;this.first_=t.first_;this.last_=t.last_;this.length_=t.length_}t.head_=void 0;t.first_=void 0;t.last_=void 0;t.length_=0}};SE.prototype.getLength=function(){return this.length_};var xE=function(t,e){this.space_=e;this.emptyBlocks_=[{x:0,y:0,width:t,height:t}];this.entries_={};this.context_=zr(t,t);this.canvas_=this.context_.canvas};xE.prototype.get=function(t){return this.entries_[t]||null};xE.prototype.add=function(t,e,i,r,n){for(var o=0,s=this.emptyBlocks_.length;o<s;++o){var a=this.emptyBlocks_[o];if(a.width>=e+this.space_&&a.height>=i+this.space_){var h={offsetX:a.x+this.space_,offsetY:a.y+this.space_,image:this.canvas_};this.entries_[t]=h;r.call(n,this.context_,a.x+this.space_,a.y+this.space_);this.split_(o,a,e+this.space_,i+this.space_);return h}}return null};xE.prototype.split_=function(t,e,i,r){var n,o,s=e.width-i;if(e.height-r<s){n={x:e.x+i,y:e.y,width:e.width-i,height:e.height};o={x:e.x,y:e.y+r,width:i,height:e.height-r};this.updateBlocks_(t,n,o)}else{n={x:e.x+i,y:e.y,width:e.width-i,height:r};o={x:e.x,y:e.y+r,width:e.width,height:e.height-r};this.updateBlocks_(t,n,o)}};xE.prototype.updateBlocks_=function(t,e,i){var r=[t,1];0<e.width&&0<e.height&&r.push(e);0<i.width&&0<i.height&&r.push(i);this.emptyBlocks_.splice.apply(this.emptyBlocks_,r)};var RE=function(t){var e=t||{};this.currentSize_=void 0!==e.initialSize?e.initialSize:256;this.maxSize_=void 0!==e.maxSize?e.maxSize:void 0!==lr?lr:2048;this.space_=void 0!==e.space?e.space:1;this.atlases_=[new xE(this.currentSize_,this.space_)];this.currentHitSize_=this.currentSize_;this.hitAtlases_=[new xE(this.currentHitSize_,this.space_)]};RE.prototype.getInfo=function(t){var e=this.getInfo_(this.atlases_,t);if(!e)return null;var i=this.getInfo_(this.hitAtlases_,t);return this.mergeInfos_(e,i)};RE.prototype.getInfo_=function(t,e){for(var i=0,r=t.length;i<r;++i){var n=t[i].get(e);if(n)return n}return null};RE.prototype.mergeInfos_=function(t,e){return{offsetX:t.offsetX,offsetY:t.offsetY,image:t.image,hitImage:e.image}};RE.prototype.add=function(t,e,i,r,n,o){if(e+this.space_>this.maxSize_||i+this.space_>this.maxSize_)return null;var s=this.add_(!1,t,e,i,r,o);if(!s)return null;var a=void 0!==n?n:L,h=this.add_(!0,t,e,i,a,o);return this.mergeInfos_(s,h)};RE.prototype.add_=function(t,e,i,r,n,o){var s,a,h,l,u=t?this.hitAtlases_:this.atlases_;for(h=0,l=u.length;h<l;++h){if(a=(s=u[h]).add(e,i,r,n,o))return a;if(!a&&h===l-1){var c=void 0;if(t){c=Math.min(2*this.currentHitSize_,this.maxSize_);this.currentHitSize_=c}else{c=Math.min(2*this.currentSize_,this.maxSize_);this.currentSize_=c}s=new xE(c,this.space_);u.push(s);++l}}return null};var CE=function(t){this.source_=t};CE.prototype.isAnimated=function(){return!1};CE.prototype.getType=function(){return o()};CE.prototype.getSource=function(){return this.source_};var wE=Number.EPSILON||2220446049250313e-31,IE=window.ol={};IE.AssertionError=n;IE.Collection=N;IE.Collection.CollectionEvent=F;IE.CollectionEventType=a;IE.Disposable=i;IE.Feature=G;IE.Feature.createStyleFunction=D;IE.Geolocation=Fr;IE.Image=Gr;IE.ImageBase=Nr;IE.ImageCanvas=Dr;IE.ImageState=Ar;IE.ImageTile=Jr;IE.Kinetic=$r;IE.Map=Jl;IE.MapBrowserEvent=en;IE.MapBrowserEventHandler=zn;IE.MapBrowserEventType=rn;IE.MapBrowserPointerEvent=nn;IE.MapEvent=tn;IE.MapEventType=Vn;IE.MapProperty=Wn;IE.Object=O;IE.Object.ObjectEvent=I;IE.Object.getChangeEventType=b;IE.ObjectEventType=s;IE.Observable=w;IE.Observable.unByKey=function(t){if(Array.isArray(t))for(var e=0,i=t.length;e<i;++e)g(t[e]);else g(t)};IE.Overlay=nu;IE.OverlayPositioning=Ql;IE.PluggableMap=ko;IE.Tile=Br;IE.TileCache=cu;IE.TileQueue=Zn;IE.TileRange=pu;IE.TileRange.createOrUpdate=du;IE.TileState=kr;IE.VectorImageTile=fu;IE.VectorImageTile.defaultLoadFunction=_u;IE.VectorTile=mu;IE.View=xo;IE.View.createCenterConstraint=Co;IE.View.createResolutionConstraint=wo;IE.View.createRotationConstraint=Io;IE.View.isNoopAnimation=Lo;IE.ViewHint=so;IE.ViewProperty=ao;IE.array={};IE.array.binarySearch=k;IE.array.equals=Ft;IE.array.extend=B;IE.array.find=V;IE.array.findIndex=W;IE.array.includes=U;IE.array.isSorted=K;IE.array.linearFindNearest=Y;IE.array.numberSafeCompareFunction=j;IE.array.remove=z;IE.array.reverseSubArray=X;IE.array.stableSort=function(t,i){var e,r=t.length,n=Array(t.length);for(e=0;e<r;e++)n[e]={index:e,value:t[e]};n.sort(function(t,e){return i(t.value,e.value)||t.index-e.index});for(e=0;e<t.length;e++)t[e]=n[e].value};IE.asserts={};IE.asserts.assert=A;IE.centerconstraint={};IE.centerconstraint.createExtent=Qn;IE.centerconstraint.none=$n;IE.color={};IE.color.asArray=_a;IE.color.asString=ca;IE.color.fromString=fa;IE.color.normalize=ga;IE.color.toString=ya;IE.colorlike={};IE.colorlike.asColorLike=ma;IE.control={};IE.control.Attribution=Jo;IE.control.Attribution.render=Qo;IE.control.Control=Yo;IE.control.FullScreen=Eu;IE.control.MousePosition=wu;IE.control.MousePosition.render=Iu;IE.control.OverviewMap=Lu;IE.control.OverviewMap.render=Ou;IE.control.Rotate=$o;IE.control.Rotate.render=ts;IE.control.ScaleLine=Fu;IE.control.ScaleLine.Units=bu;IE.control.ScaleLine.render=Nu;IE.control.Zoom=es;IE.control.ZoomSlider=Du;IE.control.ZoomSlider.render=ku;IE.control.ZoomToExtent=ju;IE.control.util={};IE.control.util.defaults=is;IE.coordinate={};IE.coordinate.add=uo;IE.coordinate.closestOnCircle=co;IE.coordinate.closestOnSegment=po;IE.coordinate.createStringXY=function(e){return function(t){return So(t,e)}};IE.coordinate.degreesToStringHDMS=fo;IE.coordinate.distance=Eo;IE.coordinate.equals=go;IE.coordinate.format=_o;IE.coordinate.rotate=yo;IE.coordinate.scale=mo;IE.coordinate.squaredDistance=vo;IE.coordinate.squaredDistanceToSegment=To;IE.coordinate.toStringHDMS=function(t,e){return t?fo("NS",t[1],e)+" "+fo("EW",t[0],e):""};IE.coordinate.toStringXY=So;IE.css={};IE.css.CLASS_COLLAPSED=Ko;IE.css.CLASS_CONTROL=Wo;IE.css.CLASS_HIDDEN=Xo;IE.css.CLASS_SELECTABLE=Bo;IE.css.CLASS_UNSELECTABLE=zo;IE.css.CLASS_UNSUPPORTED=Vo;IE.css.getFontFamilies=Ho;IE.dom={};IE.dom.createCanvasContext2D=zr;IE.dom.outerHeight=Wr;IE.dom.outerWidth=Vr;IE.dom.removeChildren=Zr;IE.dom.removeNode=Hr;IE.dom.replaceChildren=qr;IE.dom.replaceNode=Kr;IE.easing={};IE.easing.easeIn=jr;IE.easing.easeOut=Ur;IE.easing.inAndOut=Yr;IE.easing.linear=Xr;IE.easing.upAndDown=function(t){return t<.5?Yr(2*t):1-Yr(2*(t-.5))};IE.events={};IE.events.Event=S;IE.events.Event.preventDefault=function(t){t.preventDefault()};IE.events.Event.stopPropagation=x;IE.events.EventType=C;IE.events.KeyCode=ks;IE.events.Target=R;IE.events.bindListener=l;IE.events.condition={};IE.events.condition.altKeyOnly=ds;IE.events.condition.altShiftKeysOnly=fs;IE.events.condition.always=gs;IE.events.condition.click=function(t){return t.type==rn.CLICK};IE.events.condition.doubleClick=function(t){return t.type==rn.DBLCLICK};IE.events.condition.focus=_s;IE.events.condition.mouseActionButton=ys;IE.events.condition.mouseOnly=Rs;IE.events.condition.never=ms;IE.events.condition.noModifierKeys=Ts;IE.events.condition.platformModifierKeyOnly=function(t){var e=t.originalEvent;return!e.altKey&&(gr?e.metaKey:e.ctrlKey)&&!e.shiftKey};IE.events.condition.pointerMove=vs;IE.events.condition.primaryAction=Cs;IE.events.condition.shiftKeyOnly=Ss;IE.events.condition.singleClick=Es;IE.events.condition.targetNotEditable=xs;IE.events.findListener=u;IE.events.getListeners=c;IE.events.listen=m;IE.events.listenOnce=d;IE.events.unlisten=f;IE.events.unlistenAll=v;IE.events.unlistenByKey=g;IE.extent={};IE.extent.Corner=H;IE.extent.Relationship=Z;IE.extent.applyTransform=Dt;IE.extent.boundingExtent=q;IE.extent.buffer=J;IE.extent.clone=Q;IE.extent.closestSquaredDistanceXY=$;IE.extent.containsCoordinate=tt;IE.extent.containsExtent=et;IE.extent.containsXY=it;IE.extent.coordinateRelationship=rt;IE.extent.createEmpty=nt;IE.extent.createOrUpdate=ot;IE.extent.createOrUpdateEmpty=st;IE.extent.createOrUpdateFromCoordinate=at;IE.extent.createOrUpdateFromCoordinates=ht;IE.extent.createOrUpdateFromFlatCoordinates=lt;IE.extent.createOrUpdateFromRings=function(t,e){return _t(st(e),t)};IE.extent.equals=ut;IE.extent.extend=ct;IE.extent.extendCoordinate=pt;IE.extent.extendCoordinates=dt;IE.extent.extendFlatCoordinates=ft;IE.extent.extendRings=_t;IE.extent.extendXY=gt;IE.extent.forEachCorner=yt;IE.extent.getArea=mt;IE.extent.getBottomLeft=vt;IE.extent.getBottomRight=Et;IE.extent.getCenter=Tt;IE.extent.getCorner=St;IE.extent.getEnlargedArea=function(t,e){var i=Math.min(t[0],e[0]),r=Math.min(t[1],e[1]);return(Math.max(t[2],e[2])-i)*(Math.max(t[3],e[3])-r)};IE.extent.getForViewAndSize=xt;IE.extent.getHeight=Rt;IE.extent.getIntersection=Ct;IE.extent.getIntersectionArea=function(t,e){return mt(Ct(t,e))};IE.extent.getMargin=function(t){return Lt(t)+Rt(t)};IE.extent.getSize=function(t){return[t[2]-t[0],t[3]-t[1]]};IE.extent.getTopLeft=wt;IE.extent.getTopRight=It;IE.extent.getWidth=Lt;IE.extent.intersects=Nt;IE.extent.intersectsSegment=Gt;IE.extent.isEmpty=Ot;IE.extent.returnOrUpdate=Pt;IE.extent.scaleFromCenter=At;IE.featureloader={};IE.featureloader.loadFeaturesXhr=ol;IE.featureloader.xhr=sl;IE.format={};IE.format.EsriJSON=Wu;IE.format.Feature=Uu;IE.format.Feature.transformWithOptions=Yu;IE.format.FormatType=nl;IE.format.GML=Yc;IE.format.GML2=zc;IE.format.GML3=Uc;IE.format.GML32=Vc;IE.format.GMLBase=xc;IE.format.GMLBase.GMLNS=Tc;IE.format.GPX=Jc;IE.format.GeoJSON=Lp;IE.format.IGC=Up;IE.format.JSONFeature=Xu;IE.format.KML=yd;IE.format.KML.getDefaultFillStyle=function(){return ld};IE.format.KML.getDefaultImageStyle=function(){return cd};IE.format.KML.getDefaultStrokeStyle=function(){return dd};IE.format.KML.getDefaultStyle=function(){return _d};IE.format.KML.getDefaultStyleArray=function(){return gd};IE.format.KML.getDefaultTextStyle=function(){return fd};IE.format.KML.readFlatCoordinates=Ed;IE.format.MVT=f_;IE.format.OSMXML=S_;IE.format.OWS=P_;IE.format.Polyline=V_;IE.format.Polyline.decodeDeltas=K_;IE.format.Polyline.decodeFloats=Z_;IE.format.Polyline.decodeSignedIntegers=J_;IE.format.Polyline.decodeUnsignedIntegers=$_;IE.format.Polyline.encodeDeltas=W_;IE.format.Polyline.encodeFloats=H_;IE.format.Polyline.encodeSignedIntegers=q_;IE.format.Polyline.encodeUnsignedInteger=tg;IE.format.Polyline.encodeUnsignedIntegers=Q_;IE.format.TextFeature=bp;IE.format.TopoJSON=eg;IE.format.WFS=Xg;IE.format.WFS.writeFilter=function(t){var e=$u(jg,"Filter");Hg(e,t,[]);return e};IE.format.WKT=_y;IE.format.WMSCapabilities=Ry;IE.format.WMSGetFeatureInfo=zy;IE.format.WMTSCapabilities=Hy;IE.format.XLink={};IE.format.XLink.readHref=w_;IE.format.XML=I_;IE.format.XMLFeature=Ec;IE.format.filter={};IE.format.filter.And=ug;IE.format.filter.Bbox=cg;IE.format.filter.Comparison=fg;IE.format.filter.ComparisonBinary=gg;IE.format.filter.Contains=dg;IE.format.filter.During=_g;IE.format.filter.EqualTo=yg;IE.format.filter.Filter=hg;IE.format.filter.GreaterThan=mg;IE.format.filter.GreaterThanOrEqualTo=vg;IE.format.filter.Intersects=Eg;IE.format.filter.IsBetween=Tg;IE.format.filter.IsLike=Sg;IE.format.filter.IsNull=xg;IE.format.filter.LessThan=Rg;IE.format.filter.LessThanOrEqualTo=Cg;IE.format.filter.LogicalNary=lg;IE.format.filter.Not=wg;IE.format.filter.NotEqualTo=Ig;IE.format.filter.Or=Lg;IE.format.filter.Spatial=pg;IE.format.filter.Within=Og;IE.format.filter.and=Pg;IE.format.filter.bbox=bg;IE.format.filter.between=function(t,e,i){return new Tg(t,e,i)};IE.format.filter.contains=function(t,e,i){return new dg(t,e,i)};IE.format.filter.during=function(t,e,i){return new _g(t,e,i)};IE.format.filter.equalTo=function(t,e,i){return new yg(t,e,i)};IE.format.filter.greaterThan=function(t,e){return new mg(t,e)};IE.format.filter.greaterThanOrEqualTo=function(t,e){return new vg(t,e)};IE.format.filter.intersects=function(t,e,i){return new Eg(t,e,i)};IE.format.filter.isNull=function(t){return new xg(t)};IE.format.filter.lessThan=function(t,e){return new Rg(t,e)};IE.format.filter.lessThanOrEqualTo=function(t,e){return new Cg(t,e)};IE.format.filter.like=function(t,e,i,r,n,o){return new Sg(t,e,i,r,n,o)};IE.format.filter.not=function(t){return new wg(t)};IE.format.filter.notEqualTo=function(t,e,i){return new Ig(t,e,i)};IE.format.filter.or=function(t){var e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(Lg,e))};IE.format.filter.within=function(t,e,i){return new Og(t,e,i)};IE.format.xsd={};IE.format.xsd.readBoolean=Rc;IE.format.xsd.readBooleanString=Cc;IE.format.xsd.readDateTime=wc;IE.format.xsd.readDecimal=Ic;IE.format.xsd.readDecimalString=Lc;IE.format.xsd.readNonNegativeInteger=Oc;IE.format.xsd.readNonNegativeIntegerString=Pc;IE.format.xsd.readString=bc;IE.format.xsd.writeBooleanTextNode=Mc;IE.format.xsd.writeCDATASection=Fc;IE.format.xsd.writeDateTimeTextNode=Nc;IE.format.xsd.writeDecimalTextNode=Ac;IE.format.xsd.writeNonNegativeIntegerTextNode=Gc;IE.format.xsd.writeStringTextNode=Dc;IE.functions={};IE.functions.FALSE=T;IE.functions.TRUE=E;IE.functions.VOID=L;IE.geom={};IE.geom.Circle=$s;IE.geom.Geometry=si;IE.geom.GeometryCollection=wp;IE.geom.GeometryLayout=kt;IE.geom.GeometryType=jt;IE.geom.LineString=na;IE.geom.LinearRing=Ni;IE.geom.MultiLineString=oa;IE.geom.MultiPoint=sa;IE.geom.MultiPolygon=ha;IE.geom.Point=Ai;IE.geom.Polygon=tr;IE.geom.Polygon.circular=er;IE.geom.Polygon.fromCircle=rr;IE.geom.Polygon.fromExtent=ir;IE.geom.Polygon.makeRegular=nr;IE.geom.SimpleGeometry=ai;IE.geom.SimpleGeometry.getStrideForLayout=hi;IE.geom.SimpleGeometry.transformGeom2D=li;IE.geom.flat={};IE.geom.flat.area={};IE.geom.flat.area.linearRing=ui;IE.geom.flat.area.linearRings=ci;IE.geom.flat.area.linearRingss=pi;IE.geom.flat.center={};IE.geom.flat.center.linearRingss=aa;IE.geom.flat.closest={};IE.geom.flat.closest.arrayMaxSquaredDelta=_i;IE.geom.flat.closest.assignClosestArrayPoint=mi;IE.geom.flat.closest.assignClosestMultiArrayPoint=vi;IE.geom.flat.closest.assignClosestPoint=yi;IE.geom.flat.closest.maxSquaredDelta=fi;IE.geom.flat.closest.multiArrayMaxSquaredDelta=gi;IE.geom.flat.contains={};IE.geom.flat.contains.linearRingContainsExtent=Gi;IE.geom.flat.contains.linearRingContainsXY=Di;IE.geom.flat.contains.linearRingsContainsXY=ki;IE.geom.flat.contains.linearRingssContainsXY=ji;IE.geom.flat.deflate={};IE.geom.flat.deflate.deflateCoordinate=Ei;IE.geom.flat.deflate.deflateCoordinates=Ti;IE.geom.flat.deflate.deflateCoordinatesArray=Si;IE.geom.flat.deflate.deflateMultiCoordinatesArray=xi;IE.geom.flat.flip={};IE.geom.flat.flip.flipXY=z_;IE.geom.flat.geodesic={};IE.geom.flat.geodesic.greatCircleArc=function(h,t,l,u,e,i){var r=be("EPSG:4326"),c=Math.cos(qt(t)),p=Math.sin(qt(t)),d=Math.cos(qt(u)),f=Math.sin(qt(u)),_=Math.cos(qt(l-h)),g=Math.sin(qt(l-h)),y=p*f+c*d*_;return lm(function(t){if(1<=y)return[l,u];var e=t*Math.acos(y),i=Math.cos(e),r=Math.sin(e),n=g*d,o=c*f-p*d*_,s=Math.atan2(n,o),a=Math.asin(p*i+c*r*Math.cos(s));return[Zt(qt(h)+Math.atan2(Math.sin(s)*r*c,i-p*Math.sin(a))),Zt(a)]},Ue(r,e),i)};IE.geom.flat.geodesic.meridian=um;IE.geom.flat.geodesic.parallel=cm;IE.geom.flat.inflate={};IE.geom.flat.inflate.inflateCoordinates=Ri;IE.geom.flat.inflate.inflateCoordinatesArray=Ci;IE.geom.flat.inflate.inflateMultiCoordinatesArray=wi;IE.geom.flat.interiorpoint={};IE.geom.flat.interiorpoint.getInteriorPointOfArray=Ui;IE.geom.flat.interiorpoint.getInteriorPointsOfMultiArray=Yi;IE.geom.flat.interpolate={};IE.geom.flat.interpolate.interpolatePoint=ta;IE.geom.flat.interpolate.lineStringCoordinateAtM=ea;IE.geom.flat.interpolate.lineStringsCoordinateAtM=ia;IE.geom.flat.intersectsextent={};IE.geom.flat.intersectsextent.intersectsLineString=Bi;IE.geom.flat.intersectsextent.intersectsLineStringArray=zi;IE.geom.flat.intersectsextent.intersectsLinearRing=Vi;IE.geom.flat.intersectsextent.intersectsLinearRingArray=Wi;IE.geom.flat.intersectsextent.intersectsLinearRingMultiArray=Ki;IE.geom.flat.length={};IE.geom.flat.length.lineStringLength=ra;IE.geom.flat.length.linearRingLength=function(t,e,i,r){var n=ra(t,e,i,r),o=t[i-r]-t[e],s=t[i-r+1]-t[e+1];return n+=Math.sqrt(o*o+s*s)};IE.geom.flat.orient={};IE.geom.flat.orient.linearRingIsClockwise=Zi;IE.geom.flat.orient.linearRingIsOriented=qi;IE.geom.flat.orient.linearRingsAreOriented=Ji;IE.geom.flat.orient.orientLinearRings=Qi;IE.geom.flat.orient.orientLinearRingsArray=$i;IE.geom.flat.reverse={};IE.geom.flat.reverse.coordinates=Hi;IE.geom.flat.segments={};IE.geom.flat.segments.forEach=Xi;IE.geom.flat.simplify={};IE.geom.flat.simplify.douglasPeucker=Ii;IE.geom.flat.simplify.douglasPeuckerArray=Li;IE.geom.flat.simplify.douglasPeuckerMultiArray=function(t,e,i,r,n,o,s,a){for(var h=0,l=i.length;h<l;++h){var u=i[h],c=[];s=Li(t,e,u,r,n,o,s,c);a.push(c);e=u[u.length-1]}return s};IE.geom.flat.simplify.quantize=bi;IE.geom.flat.simplify.quantizeArray=Mi;IE.geom.flat.simplify.quantizeMultiArray=Fi;IE.geom.flat.simplify.radialDistance=Oi;IE.geom.flat.simplify.simplifyLineString=function(t,e,i,r,n,o,s){var a=void 0!==s?s:[];if(!o){i=Oi(t,e,i,r,n,a,0);t=a;e=0;r=2}a.length=Ii(t,e,i,r,n,a,0);return a};IE.geom.flat.simplify.snap=Pi;IE.geom.flat.straightchunk={};IE.geom.flat.straightchunk.matchingChunk=Ph;IE.geom.flat.textpath={};IE.geom.flat.textpath.drawTextOnPath=Dh;IE.geom.flat.topology={};IE.geom.flat.topology.lineStringIsClosed=function(t,e,i,r){var n=i-r;return t[e]===t[n]&&t[e+1]===t[n+1]&&3<(i-e)/r&&!!ui(t,e,i,r)};IE.geom.flat.transform={};IE.geom.flat.transform.rotate=Yt;IE.geom.flat.transform.scale=Xt;IE.geom.flat.transform.transform2D=Ut;IE.geom.flat.transform.translate=Bt;IE.has={};IE.has.DEVICE_PIXEL_RATIO=yr;IE.has.FIREFOX=dr;IE.has.GEOLOCATION=mr;IE.has.MAC=gr;IE.has.MSPOINTER=Tr;IE.has.POINTER=Er;IE.has.SAFARI=fr;IE.has.TOUCH=vr;IE.has.WEBKIT=_r;IE.interaction={};IE.interaction.DoubleClickZoom=cs;IE.interaction.DragAndDrop=Zs;IE.interaction.DragBox=As;IE.interaction.DragPan=Ls;IE.interaction.DragRotate=Os;IE.interaction.DragRotateAndZoom=Qs;IE.interaction.DragZoom=Gs;IE.interaction.Draw=vl;IE.interaction.Draw.createBox=function(){return function(t,e){var i=q(t),r=[[vt(i),Et(i),It(i),wt(i),vt(i)]],n=e;n?n.setCoordinates(r):n=new tr(r);return n}};IE.interaction.Draw.createRegularPolygon=function(l,u){return function(t,e){var i=t[0],r=t[1],n=Math.sqrt(vo(i,r)),o=e||rr(new $s(i),l),s=u;if(!u){var a=r[0]-i[0],h=r[1]-i[1];s=Math.atan(h/a)-(a<0?Math.PI:0)}nr(o,i,n,s);return o}};IE.interaction.Extent=Sl;IE.interaction.Interaction=ns;IE.interaction.Interaction.pan=os;IE.interaction.Interaction.rotate=ss;IE.interaction.Interaction.rotateWithoutConstraints=as;IE.interaction.Interaction.zoom=hs;IE.interaction.Interaction.zoomByDelta=ls;IE.interaction.Interaction.zoomWithoutConstraints=us;IE.interaction.KeyboardPan=js;IE.interaction.KeyboardZoom=Ys;IE.interaction.Modify=Ol;IE.interaction.Modify.ModifyEvent=Ll;IE.interaction.MouseWheelZoom=zs;IE.interaction.MouseWheelZoom.Mode=Bs;IE.interaction.PinchRotate=Vs;IE.interaction.PinchZoom=Ws;IE.interaction.Pointer=ws;IE.interaction.Pointer.centroid=Is;IE.interaction.Property=rs;IE.interaction.Select=Al;IE.interaction.Snap=kl;IE.interaction.Translate=Bl;IE.interaction.Translate.TranslateEvent=Xl;IE.interaction.defaults=zl;IE.layer={};IE.layer.Base=Po;IE.layer.BaseImage=sm;IE.layer.BaseTile=hm;IE.layer.BaseVector=ih;IE.layer.Graticule=fm;IE.layer.Group=Fo;IE.layer.Heatmap=Om;IE.layer.Image=bm;IE.layer.Layer=Zo;IE.layer.Layer.visibleAtResolution=qo;IE.layer.Property=Oo;IE.layer.Tile=Fm;IE.layer.TileProperty=am;IE.layer.Vector=rl;IE.layer.VectorImage=Am;IE.layer.VectorTile=Um;IE.layer.VectorTileRenderType=Gm;IE.loadingstrategy={};IE.loadingstrategy.all=al;IE.loadingstrategy.bbox=hl;IE.loadingstrategy.tile=function(s){return function(t,e){var i=s.getZForResolution(e),r=s.getTileRangeForExtentAndZ(t,i),n=[],o=[i,0,0];for(o[1]=r.minX;o[1]<=r.maxX;++o[1])for(o[2]=r.minY;o[2]<=r.maxY;++o[2])n.push(s.getTileCoordExtent(o));return n}};IE.math={};IE.math.clamp=zt;IE.math.cosh=Vt;IE.math.lerp=Qt;IE.math.modulo=Jt;IE.math.roundUpToPowerOfTwo=function(t){A(0<t,29);return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))};IE.math.solveLinearSystem=Ht;IE.math.squaredDistance=Kt;IE.math.squaredSegmentDistance=Wt;IE.math.toDegrees=Zt;IE.math.toRadians=qt;IE.net={};IE.net.jsonp=$m;IE.obj={};IE.obj.assign=y;IE.obj.clear=_;IE.obj.getValues=h;IE.obj.isEmpty=Mt;IE.pointer={};IE.pointer.EventSource=sn;IE.pointer.EventType=on;IE.pointer.MouseSource=fn;IE.pointer.MouseSource.POINTER_ID=an;IE.pointer.MouseSource.POINTER_TYPE=hn;IE.pointer.MouseSource.prepareEvent=_n;IE.pointer.MsSource=Cn;IE.pointer.NativeSource=Nn;IE.pointer.PointerEvent=Gn;IE.pointer.PointerEventHandler=Bn;IE.pointer.TouchSource=Yn;IE.proj={};IE.proj.Projection=se;IE.proj.Units=ne;IE.proj.Units.METERS_PER_UNIT=oe;IE.proj.addCommon=Be;IE.proj.addCoordinateTransforms=De;IE.proj.addEquivalentProjections=Fe;IE.proj.addEquivalentTransforms=Ne;IE.proj.addProjection=Oe;IE.proj.addProjections=Pe;IE.proj.clearAllProjections=function(){Ee();Re()};IE.proj.cloneTransform=Ie;IE.proj.createProjection=Ae;IE.proj.createTransformFromCoordinateTransform=Ge;IE.proj.epsg3857={};IE.proj.epsg3857.EXTENT=le;IE.proj.epsg3857.HALF_SIZE=he;IE.proj.epsg3857.PROJECTIONS=pe;IE.proj.epsg3857.RADIUS=ae;IE.proj.epsg3857.WORLD_EXTENT=ue;IE.proj.epsg3857.fromEPSG4326=de;IE.proj.epsg3857.toEPSG4326=fe;IE.proj.epsg4326={};IE.proj.epsg4326.EXTENT=_e;IE.proj.epsg4326.METERS_PER_UNIT=ge;IE.proj.epsg4326.PROJECTIONS=me;IE.proj.epsg4326.RADIUS=6378137;IE.proj.equivalent=ke;IE.proj.fromLonLat=function(t,e){return Ye(t,"EPSG:4326",void 0!==e?e:"EPSG:3857")};IE.proj.get=be;IE.proj.getPointResolution=Me;IE.proj.getTransform=Ue;IE.proj.getTransformFromProjections=je;IE.proj.identityTransform=Le;IE.proj.proj4={};IE.proj.proj4.register=function(t){var e,i,r=Object.keys(t.defs),n=r.length;for(e=0;e<n;++e){var o=r[e];if(!be(o)){var s=t.defs(o);Oe(new se({code:o,axisOrientation:s.axis,metersPerUnit:s.to_meter,units:s.units}))}}for(e=0;e<n;++e){var a=r[e],h=be(a);for(i=0;i<n;++i){var l=r[i],u=be(l);if(!we(a,l))if(t.defs[a]===t.defs[l])Fe([h,u]);else{var c=t(a,l);De(h,u,c.forward,c.inverse)}}}};IE.proj.projections={};IE.proj.projections.add=Se;IE.proj.projections.clear=Ee;IE.proj.projections.get=Te;IE.proj.toLonLat=function(t,e){var i=Ye(t,void 0!==e?e:"EPSG:3857","EPSG:4326"),r=i[0];(r<-180||180<r)&&(i[0]=Jt(r+180,360)-180);return i};IE.proj.transform=Ye;IE.proj.transformExtent=Xe;IE.proj.transformWithProjections=function(t,e,i){return je(e,i)(t)};IE.proj.transforms={};IE.proj.transforms.add=Ce;IE.proj.transforms.clear=Re;IE.proj.transforms.get=we;IE.proj.transforms.remove=function(t,e){var i=t.getCode(),r=e.getCode(),n=xe[i][r];delete xe[i][r];Mt(xe[i])&&delete xe[i];return n};IE.render={};IE.render.Box=Ps;IE.render.Event=Kh;IE.render.EventType=Kn;IE.render.Feature=d_;IE.render.VectorContext=Eh;IE.render.canvas={};IE.render.canvas.Builder=wh;IE.render.canvas.BuilderGroup=Ah;IE.render.canvas.BuilderType=Gh;IE.render.canvas.Executor=Uh;IE.render.canvas.ExecutorGroup=Xh;IE.render.canvas.ExecutorGroup.getCircleArray=Vh;IE.render.canvas.ExecutorGroup.replayDeclutter=Wh;IE.render.canvas.ImageBuilder=Ih;IE.render.canvas.Immediate=Ym;IE.render.canvas.Instruction=Th;IE.render.canvas.Instruction.beginPathInstruction=Rh;IE.render.canvas.Instruction.closePathInstruction=Ch;IE.render.canvas.Instruction.fillInstruction=Sh;IE.render.canvas.Instruction.strokeInstruction=xh;IE.render.canvas.LineStringBuilder=Lh;IE.render.canvas.PolygonBuilder=Oh;IE.render.canvas.TextBuilder=Fh;IE.render.canvas.TextBuilder.TEXT_ALIGN=Mh;IE.render.canvas.checkFont=Fa;IE.render.canvas.checkedFonts=Pa;IE.render.canvas.defaultFillStyle=Ta;IE.render.canvas.defaultFont=Ea;IE.render.canvas.defaultLineCap=Sa;IE.render.canvas.defaultLineDash=xa;IE.render.canvas.defaultLineDashOffset=0;IE.render.canvas.defaultLineJoin=Ra;IE.render.canvas.defaultLineWidth=1;IE.render.canvas.defaultMiterLimit=10;IE.render.canvas.defaultPadding=La;IE.render.canvas.defaultStrokeStyle=Ca;IE.render.canvas.defaultTextAlign=wa;IE.render.canvas.defaultTextBaseline=Ia;IE.render.canvas.drawImage=Ba;IE.render.canvas.labelCache=Oa;IE.render.canvas.measureAndCacheTextWidth=ja;IE.render.canvas.measureTextHeight=Da;IE.render.canvas.measureTextWidth=ka;IE.render.canvas.measureTextWidths=Ua;IE.render.canvas.resetTransform=Xa;IE.render.canvas.rotateAtOffset=Ya;IE.render.canvas.textHeights=Ma;IE.render.getRenderPixel=function(t,e){var i=e.slice(0);qe(t.inversePixelTransform.slice(),i);return i};IE.render.getVectorContext=function(t){var e=t.frameState,i=Ke(t.inversePixelTransform.slice(),e.coordinateToPixelTransform);return new Ym(t.context,e.pixelRatio,e.extent,i,e.viewState.rotation)};IE.render.toContext=function(t,e){var i=t.canvas,r=e||{},n=r.pixelRatio||yr,o=r.size;if(o){i.width=o[0]*n;i.height=o[1]*n;i.style.width=o[0]+"px";i.style.height=o[1]+"px"}var s=[0,0,i.width,i.height],a=Qe([1,0,0,1,0,0],n,n);return new Ym(t,n,s,a,0)};IE.render.webgl={};IE.render.webgl.DEFAULT_FILLSTYLE=[0,0,0,1];IE.render.webgl.DEFAULT_FONT="10px sans-serif";IE.render.webgl.DEFAULT_LINECAP="round";IE.render.webgl.DEFAULT_LINEDASH=[];IE.render.webgl.DEFAULT_LINEDASHOFFSET=0;IE.render.webgl.DEFAULT_LINEJOIN="round";IE.render.webgl.DEFAULT_LINEWIDTH=1;IE.render.webgl.DEFAULT_MITERLIMIT=10;IE.render.webgl.DEFAULT_STROKESTYLE=[0,0,0,1];IE.render.webgl.DEFAULT_TEXTALIGN=.5;IE.render.webgl.DEFAULT_TEXTBASELINE=.5;IE.render.webgl.EPSILON=wE;IE.render.webgl.triangleIsCounterClockwise=function(t,e,i,r,n,o){var s=(i-t)*(o-e)-(n-t)*(r-e);return s<=wE&&-wE<=s?void 0:0<s};IE.renderer={};IE.renderer.Composite=ql;IE.renderer.Layer=Hh;IE.renderer.Map=Hl;IE.renderer.Map.sortByZIndex=function(t,e){return t.zIndex-e.zIndex};IE.renderer.canvas={};IE.renderer.canvas.ImageLayer=Pm;IE.renderer.canvas.Layer=Zh;IE.renderer.canvas.TileLayer=Mm;IE.renderer.canvas.VectorLayer=il;IE.renderer.canvas.VectorTileLayer=jm;IE.renderer.vector={};IE.renderer.vector.defaultOrder=Qh;IE.renderer.vector.getSquaredTolerance=$h;IE.renderer.vector.getTolerance=tl;IE.renderer.vector.renderFeature=el;IE.renderer.webgl={};IE.renderer.webgl.PointsLayer=Rm;IE.reproj={};IE.reproj.Image=Wm;IE.reproj.Tile=Km;IE.reproj.Triangulation=Vm;IE.reproj.calculateSourceResolution=Xm;IE.reproj.common={};IE.reproj.common.ENABLE_RASTER_REPROJECTION=!0;IE.reproj.common.ERROR_THRESHOLD=.5;IE.reproj.render=zm;IE.resolutionconstraint={};IE.resolutionconstraint.createSnapToPower=eo;IE.resolutionconstraint.createSnapToResolutions=to;IE.rotationconstraint={};IE.rotationconstraint.createSnapToN=no;IE.rotationconstraint.createSnapToZero=oo;IE.rotationconstraint.disable=io;IE.rotationconstraint.none=ro;IE.size={};IE.size.buffer=No;IE.size.hasArea=Ao;IE.size.scale=Go;IE.size.toSize=Do;IE.source={};IE.source.BingMaps=gv;IE.source.BingMaps.quadKey=_v;IE.source.CartoDB=mv;IE.source.Cluster=vv;IE.source.Image=Rv;IE.source.Image.defaultImageLoadFunction=Cv;IE.source.ImageArcGISRest=Iv;IE.source.ImageCanvas=Lv;IE.source.ImageMapGuide=Ov;IE.source.ImageStatic=Pv;IE.source.ImageWMS=Nv;IE.source.OSM=Gv;IE.source.OSM.ATTRIBUTION=Av;IE.source.Raster=Zv;IE.source.Source=ll;IE.source.Stamen=iE;IE.source.State=bo;IE.source.Tile=lv;IE.source.Tile.TileSourceEvent=uv;IE.source.TileArcGISRest=rE;IE.source.TileDebug=sE;IE.source.TileEventType=cv;IE.source.TileImage=dv;IE.source.TileJSON=aE;IE.source.TileWMS=hE;IE.source.UTFGrid=cE;IE.source.UTFGrid.CustomTile=uE;IE.source.UrlTile=pv;IE.source.Vector=fl;IE.source.Vector.VectorSourceEvent=dl;IE.source.VectorEventType=cl;IE.source.VectorTile=pE;IE.source.WMSServerType=Mv;IE.source.WMTS=gE;IE.source.WMTS.optionsFromCapabilities=function(t,s){var e=V(t.Contents.Layer,function(t,e,i){return t.Identifier==s.layer});if(null===e)return null;var i,a=t.Contents.TileMatrixSet;(i=1<e.TileMatrixSetLink.length?W(e.TileMatrixSetLink,"projection"in s?function(e,t,i){var r=V(a,function(t){return t.Identifier==e.TileMatrixSet}).SupportedCRS,n=be(r.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||be(r),o=be(s.projection);return n&&o?ke(n,o):r==s.projection}:function(t,e,i){return t.TileMatrixSet==s.matrixSet}):0)<0&&(i=0);var r=e.TileMatrixSetLink[i].TileMatrixSet,n=e.TileMatrixSetLink[i].TileMatrixSetLimits,o=e.Format[0];"format"in s&&(o=s.format);(i=W(e.Style,function(t,e,i){return"style"in s?t.Title==s.style:t.isDefault}))<0&&(i=0);var h=e.Style[i].Identifier,l={};"Dimension"in e&&e.Dimension.forEach(function(t,e,i){var r=t.Identifier,n=t.Default;void 0===n&&(n=t.Value[0]);l[r]=n});var u,c=V(t.Contents.TileMatrixSet,function(t,e,i){return t.Identifier==r}),p=c.SupportedCRS;p&&(u=be(p.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"))||be(p));if("projection"in s){var d=be(s.projection);d&&(u&&!ke(d,u)||(u=d))}var f,_,g=e.WGS84BoundingBox;if(void 0!==g){var y=be("EPSG:4326").getExtent();_=g[0]==y[0]&&g[2]==y[2];f=Xe(g,"EPSG:4326",u);var m=u.getExtent();m&&(et(m,f)||(f=void 0))}var v=_E(c,f,n),E=[],T=s.requestEncoding;T=void 0!==T?T:"";if("OperationsMetadata"in t&&"GetTile"in t.OperationsMetadata)for(var S=t.OperationsMetadata.GetTile.DCP.HTTP.Get,x=0,R=S.length;x<R;++x)if(S[x].Constraint){var C=V(S[x].Constraint,function(t){return"GetEncoding"==t.name}).AllowedValues.Value;""===T&&(T=C[0]);if(T!==dE.KVP)break;U(C,dE.KVP)&&E.push(S[x].href)}else if(S[x].href){T=dE.KVP;E.push(S[x].href)}if(0===E.length){T=dE.REST;e.ResourceURL.forEach(function(t){if("tile"===t.resourceType){o=t.format;E.push(t.template)}})}return{urls:E,layer:s.layer,matrixSet:r,format:o,projection:u,requestEncoding:T,tileGrid:v,style:h,dimensions:l,wrapX:_,crossOrigin:s.crossOrigin}};IE.source.WMTSRequestEncoding=dE;IE.source.XYZ=yv;IE.source.Zoomify=TE;IE.source.Zoomify.CustomTile=EE;IE.source.common={};IE.source.common.DEFAULT_WMS_VERSION=bv;IE.sphere={};IE.sphere.DEFAULT_RADIUS=$t;IE.sphere.getArea=function t(e,i){var r=i||{},n=r.radius||$t,o=r.projection||"EPSG:3857",s=e.getType();s!==jt.GEOMETRY_COLLECTION&&(e=e.clone().transform(o,"EPSG:4326"));var a,h,l,u,c,p,d=0;switch(s){case jt.POINT:case jt.MULTI_POINT:case jt.LINE_STRING:case jt.MULTI_LINE_STRING:case jt.LINEAR_RING:break;case jt.POLYGON:a=e.getCoordinates();d=Math.abs(ie(a[0],n));for(l=1,u=a.length;l<u;++l)d-=Math.abs(ie(a[l],n));break;case jt.MULTI_POLYGON:for(l=0,u=(a=e.getCoordinates()).length;l<u;++l){h=a[l];d+=Math.abs(ie(h[0],n));for(c=1,p=h.length;c<p;++c)d-=Math.abs(ie(h[c],n))}break;case jt.GEOMETRY_COLLECTION:var f=e.getGeometries();for(l=0,u=f.length;l<u;++l)d+=t(f[l],i);break;default:throw new Error("Unsupported geometry type: "+s)}return d};IE.sphere.getDistance=te;IE.sphere.getLength=function t(e,i){var r=i||{},n=r.radius||$t,o=r.projection||"EPSG:3857",s=e.getType();s!==jt.GEOMETRY_COLLECTION&&(e=e.clone().transform(o,"EPSG:4326"));var a,h,l,u,c,p,d=0;switch(s){case jt.POINT:case jt.MULTI_POINT:break;case jt.LINE_STRING:case jt.LINEAR_RING:d=ee(a=e.getCoordinates(),n);break;case jt.MULTI_LINE_STRING:case jt.POLYGON:for(l=0,u=(a=e.getCoordinates()).length;l<u;++l)d+=ee(a[l],n);break;case jt.MULTI_POLYGON:for(l=0,u=(a=e.getCoordinates()).length;l<u;++l)for(c=0,p=(h=a[l]).length;c<p;++c)d+=ee(h[c],n);break;case jt.GEOMETRY_COLLECTION:var f=e.getGeometries();for(l=0,u=f.length;l<u;++l)d+=t(f[l],i);break;default:throw new Error("Unsupported geometry type: "+s)}return d};IE.sphere.offset=re;IE.string={};IE.string.compareVersions=lo;IE.string.padNumber=ho;IE.structs={};IE.structs.LRUCache=va;IE.structs.LinkedList=SE;IE.structs.PriorityQueue=Hn;IE.structs.PriorityQueue.DROP=1/0;IE.structs.RBush=pl;IE.style={};IE.style.Atlas=xE;IE.style.AtlasManager=RE;IE.style.Circle=Wa;IE.style.Fill=Ka;IE.style.Icon=Vp;IE.style.IconAnchorUnits=Yp;IE.style.IconImage=Xp;IE.style.IconImage.get=Bp;IE.style.IconImageCache=Vl;IE.style.IconImageCache.shared=Kl;IE.style.IconOrigin=zp;IE.style.Image=za;IE.style.RegularShape=Va;IE.style.Stroke=Ha;IE.style.Style=Za;IE.style.Style.createDefaultStyle=Qa;IE.style.Style.createEditingStyle=$a;IE.style.Style.toFunction=qa;IE.style.Text=Wp;IE.style.TextPlacement=bh;IE.tilecoord={};IE.tilecoord.createOrUpdate=ou;IE.tilecoord.fromKey=hu;IE.tilecoord.getKey=au;IE.tilecoord.getKeyZXY=su;IE.tilecoord.hash=lu;IE.tilecoord.withinExtentAndZ=uu;IE.tilegrid={};IE.tilegrid.TileGrid=ev;IE.tilegrid.WMTS=fE;IE.tilegrid.WMTS.createFromCapabilitiesMatrixSet=_E;IE.tilegrid.common={};IE.tilegrid.common.DEFAULT_MAX_ZOOM=qn;IE.tilegrid.common.DEFAULT_TILE_SIZE=Jn;IE.tilegrid.createForExtent=nv;IE.tilegrid.createForProjection=av;IE.tilegrid.createXYZ=ov;IE.tilegrid.extentFromProjection=hv;IE.tilegrid.getForProjection=iv;IE.tilegrid.wrapX=rv;IE.tileurlfunction={};IE.tileurlfunction.createFromTemplate=Hm;IE.tileurlfunction.createFromTemplates=Zm;IE.tileurlfunction.createFromTileUrlFunctions=qm;IE.tileurlfunction.expandUrl=Qm;IE.tileurlfunction.nullTileUrlFunction=Jm;IE.transform={};IE.transform.apply=qe;IE.transform.compose=ei;IE.transform.create=Ve;IE.transform.determinant=ri;IE.transform.invert=function(t){return ii(t,t)};IE.transform.makeInverse=ii;IE.transform.makeScale=$e;IE.transform.multiply=Ke;IE.transform.reset=We;IE.transform.rotate=Je;IE.transform.scale=Qe;IE.transform.set=He;IE.transform.setFromArray=Ze;IE.transform.toString=ni;IE.transform.translate=ti;IE.uri={};IE.uri.appendParams=wv;IE.util={};IE.util.VERSION=t;IE.util.abstract=o;IE.util.getUid=bt;IE.util.inherits=function(t,e){t.prototype=Object.create(e.prototype);t.prototype.constructor=t};IE.vec={};IE.vec.mat4={};IE.vec.mat4.create=mm;IE.vec.mat4.fromTransform=vm;IE.webgl={};IE.webgl.ARRAY_BUFFER=34962;IE.webgl.BLEND=3042;IE.webgl.Buffer=gm;IE.webgl.CLAMP_TO_EDGE=33071;IE.webgl.COLOR_ATTACHMENT0=36064;IE.webgl.COLOR_BUFFER_BIT=16384;IE.webgl.COMPILE_STATUS=35713;IE.webgl.CULL_FACE=2884;IE.webgl.ContextEventType=ym;IE.webgl.DEBUG=!0;IE.webgl.DEPTH_TEST=2929;IE.webgl.DYNAMIC_DRAW=or;IE.webgl.ELEMENT_ARRAY_BUFFER=34963;IE.webgl.FLOAT=sr;IE.webgl.FRAGMENT_SHADER=35632;IE.webgl.FRAMEBUFFER=36160;IE.webgl.Helper=xm;IE.webgl.Helper.DefaultAttrib=Sm;IE.webgl.Helper.DefaultUniform=Tm;IE.webgl.Helper.ShaderType={FRAGMENT_SHADER:35632,VERTEX_SHADER:35633};IE.webgl.LINEAR=9729;IE.webgl.LINK_STATUS=35714;IE.webgl.ONE=1;IE.webgl.ONE_MINUS_SRC_ALPHA=771;IE.webgl.PostProcessingPass=Em;IE.webgl.RGBA=6408;IE.webgl.SCISSOR_TEST=3089;IE.webgl.SRC_ALPHA=770;IE.webgl.STATIC_DRAW=35044;IE.webgl.STENCIL_TEST=2960;IE.webgl.STREAM_DRAW=35040;IE.webgl.Shader=CE;IE.webgl.TEXTURE0=33984;IE.webgl.TEXTURE_2D=3553;IE.webgl.TEXTURE_MAG_FILTER=10240;IE.webgl.TEXTURE_MIN_FILTER=10241;IE.webgl.TEXTURE_WRAP_S=10242;IE.webgl.TEXTURE_WRAP_T=10243;IE.webgl.TRIANGLES=4;IE.webgl.TRIANGLE_STRIP=5;IE.webgl.UNSIGNED_BYTE=5121;IE.webgl.UNSIGNED_INT=5125;IE.webgl.UNSIGNED_SHORT=5123;IE.webgl.VERTEX_SHADER=35633;IE.webgl.getContext=hr;IE.xml={};IE.xml.DOCUMENT=Ju;IE.xml.OBJECT_PROPERTY_NODE_FACTORY=dc;IE.xml.XML_SCHEMA_INSTANCE_URI=Qu;IE.xml.createElementNS=$u;IE.xml.getAllTextContent=tc;IE.xml.getAllTextContent_=ec;IE.xml.getAttributeNS=rc;IE.xml.isDocument=ic;IE.xml.makeArrayExtender=oc;IE.xml.makeArrayPusher=sc;IE.xml.makeArraySerializer=cc;IE.xml.makeChildAppender=uc;IE.xml.makeObjectPropertyPusher=hc;IE.xml.makeObjectPropertySetter=lc;IE.xml.makeReplacer=ac;IE.xml.makeSequence=fc;IE.xml.makeSimpleNodeFactory=pc;IE.xml.makeStructureNS=_c;IE.xml.parse=nc;IE.xml.parseNode=gc;IE.xml.pushParseAndPop=yc;IE.xml.pushSerializeAndPop=vc;IE.xml.serialize=mc}();
//# sourceMappingURL=ol.js.map
var olcs_unused_var=function(e){var t={};function i(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=22)}([function(e,t){e.exports=ol.proj},function(e,t){e.exports=ol.Observable},function(e,t){e.exports=ol.source.Vector},function(e,t){e.exports=ol.layer.Layer},function(e,t){e.exports=ol.layer.Group},function(e,t){e.exports=ol.layer.Vector},function(e,t){e.exports=ol.layer.Image},function(e,t){e.exports=ol.source.Cluster},function(e,t){e.exports=ol.geom.Geometry},function(e,t){e.exports=ol.style.Icon},function(e,t){e.exports=ol.extent},function(e,t){e.exports=ol.geom.Point},function(e,t){e.exports=ol.easing},function(e,t){e.exports=ol.layer.Tile},function(e,t){e.exports=ol.source.ImageStatic},function(e,t){e.exports=ol.source.ImageWMS},function(e,t){e.exports=ol.source.TileImage},function(e,t){e.exports=ol.source.TileWMS},function(e,t){e.exports=ol.source.Image},function(e,t){e.exports=ol.geom.Polygon},function(e,t){e.exports=ol.geom.SimpleGeometry},function(e,t){e.exports=ol.Overlay},function(e,t,i){"use strict";i.r(t);i(11);var r=i(0),n={};function o(e,t,i){return e.on(t,i)}n.obj=function(e){return e},n.supportsImageRenderingPixelatedResult_=void 0,n.imageRenderingValueResult_=void 0,n.supportsImageRenderingPixelated=function(){if(void 0===n.supportsImageRenderingPixelatedResult_){var e=document.createElement("canvas");e.setAttribute("style","image-rendering: -moz-crisp-edges; image-rendering: pixelated;");var t=e.style.imageRendering;n.supportsImageRenderingPixelatedResult_=!!t,n.supportsImageRenderingPixelatedResult_&&(n.imageRenderingValueResult_=t)}return n.supportsImageRenderingPixelatedResult_},n.imageRenderingValue=function(){return n.supportsImageRenderingPixelated(),n.imageRenderingValueResult_||""},n.getSourceProjection=function(e){return e.get("olcs.projection")||e.getProjection()};var a=0;function s(e){return e.olcs_uid||(e.olcs_uid=++a)}function u(e){var t=Cesium.GroundPolylinePrimitive;return t&&t.isSupported(e)}var l=n,c=i(12),h=i(13),m=i.n(h),d=i(6),g=i.n(d),p=i(14),v=i.n(p),f=i(15),y=i.n(f),C=i(16),_=i.n(C),b=i(17),w=i.n(b),S=i(18),L=function(){function e(e,t,i){var r=this;this.source_=t,this.projection_=null,this.fallbackProj_=i||null,this.ready_=!1,this.tilingScheme_=null,this.rectangle_=null,this.map_=e;var n=this.source_.get("olcs.proxy");n&&("function"==typeof n?this.proxy_={getURL:n}:"string"==typeof n&&(this.proxy_=new Cesium.DefaultProxy(n))),this.errorEvent_=new Cesium.Event,this.emptyCanvas_=document.createElement("canvas"),this.emptyCanvas_.width=1,this.emptyCanvas_.height=1,this.source_.on("change",function(e){r.handleSourceChanged_()}),this.handleSourceChanged_()}var t=e.prototype;return t.handleSourceChanged_=function(e){if(!this.ready_&&"ready"==this.source_.getState()){if(this.projection_=l.getSourceProjection(this.source_)||this.fallbackProj_,this.projection_==Object(r.get)("EPSG:4326"))this.tilingScheme_=new Cesium.GeographicTilingScheme;else{if(this.projection_!=Object(r.get)("EPSG:3857"))return;this.tilingScheme_=new Cesium.WebMercatorTilingScheme}this.rectangle_=this.tilingScheme_.rectangle,this.ready_=!0}},t.getTileCredits=function(e,t,i){var r=this.map_.getView().calculateExtent(this.map_.getSize()),n=this.map_.getView().getCenter(),o={viewState:{zoom:this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i,center:n},extent:r},a=this.source_.getAttributions();if(!a)return[];var s=a(o);return Array.isArray(s)||(s=[s]),s.map(function(e){return new Cesium.Credit(e,!0)})},t.requestImage=function(e,t,i){var r=this.source_.getTileUrlFunction();if(r&&this.projection_){var n=this.tilingScheme_ instanceof Cesium.GeographicTilingScheme?i+1:i,o=-t-1,a=r.call(this.source_,[n,e,o],1,this.projection_);return this.proxy_&&(a=this.proxy_.getURL(a)),a?Cesium.ImageryProvider.loadImage(this,a):this.emptyCanvas_}return this.emptyCanvas_},e}();Object.defineProperties(L.prototype,{ready:{get:function(){return this.ready_}},rectangle:{get:function(){return this.rectangle_}},tileWidth:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[0]:e.getTileSize(0):256}},tileHeight:{get:function(){var e=this.source_.getTileGrid();return e?Array.isArray(e.getTileSize(0))?e.getTileSize(0)[1]:e.getTileSize(0):256}},maximumLevel:{get:function(){var e=this.source_.getTileGrid();return e?e.getMaxZoom():18}},minimumLevel:{get:function(){return 0}},tilingScheme:{get:function(){return this.tilingScheme_}},tileDiscardPolicy:{get:function(){}},errorEvent:{get:function(){return this.errorEvent_}},proxy:{get:function(){return this.proxy_}},hasAlphaChannel:{get:function(){return!0}},pickFeatures:{get:function(){}}});var P=L,T={computePixelSizeAtCoordinate:function(e,t){var i=e.camera,r=e.canvas,n=i.frustum,o=Cesium.Cartesian3.magnitude(Cesium.Cartesian3.subtract(i.position,t,new Cesium.Cartesian3)),a=new Cesium.Cartesian2;return n.getPixelDimensions(r.clientWidth,r.clientHeight,o,a)},computeBoundingBoxAtTarget:function(e,t,i){var r=T.computePixelSizeAtCoordinate(e,t),n=Cesium.Transforms.eastNorthUpToFixedFrame(t),o=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(-r.x*i,-r.y*i,0),new Cesium.Cartesian3),a=Cesium.Matrix4.multiplyByPoint(n,new Cesium.Cartesian3(r.x*i,r.y*i,0),new Cesium.Cartesian3);return Cesium.Ellipsoid.WGS84.cartesianArrayToCartographicArray([o,a])},applyHeightOffsetToGeometry:function(e,t){e.applyTransform(function(e,i,r){if(void 0!==r&&r>=3)for(var n=0;n<i.length;n+=r)i[n+2]=i[n+2]+t;return i})},createMatrixAtCoordinates:function(e,t,i,r){void 0===t&&(t=0),void 0===i&&(i=Cesium.Cartesian3.ZERO),void 0===r&&(r=new Cesium.Cartesian3(1,1,1));var n=T.ol4326CoordinateToCesiumCartesian(e),o=Cesium.Transforms.eastNorthUpToFixedFrame(n),a=Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z,-t),s=Cesium.Matrix4.fromTranslationQuaternionRotationScale(i,a,r);return Cesium.Matrix4.multiply(o,s,new Cesium.Matrix4)},rotateAroundAxis:function(e,t,i,r,n){var o=Cesium.Math.clamp,a=Cesium.defaultValue,s=n||{},u=a(s.duration,500),l=a(s.easing,c.linear),h=s.callback,m=0,d=new Cesium.Matrix4,g=Date.now();window.requestAnimationFrame(function n(){var a=Date.now(),s=l(o((a-g)/u,0,1));e.transform.clone(d);var c=(s-m)*t;m=s,e.lookAtTransform(r),e.rotate(i,c),e.lookAtTransform(d),s<1?window.requestAnimationFrame(n):h&&h()})},setHeadingUsingBottomCenter:function(e,t,i,r){var n=e.camera,o=T.computeAngleToZenith(e,i),a=n.right,s=Cesium.Quaternion.fromAxisAngle(a,o),u=Cesium.Matrix3.fromQuaternion(s),l=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(n.position,i,l);var c=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(u,l,c),Cesium.Cartesian3.add(c,i,c);var h=Cesium.Matrix4.fromTranslation(c);(0,T.rotateAroundAxis)(n,t,c,h,r)},pickOnTerrainOrEllipsoid:function(e,t){var i=e.camera.getPickRay(t);return e.globe.pick(i,e)||e.camera.pickEllipsoid(t)},pickBottomPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return T.pickOnTerrainOrEllipsoid(e,i)},pickCenterPoint:function(e){var t=e.canvas,i=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return T.pickOnTerrainOrEllipsoid(e,i)},computeSignedTiltAngleOnGlobe:function(e){var t=e.camera,i=new Cesium.Ray(t.position,t.direction),r=e.globe.pick(i,e);if(!r){var n=Cesium.Ellipsoid.WGS84,o=Cesium.IntersectionTests.rayEllipsoid(i,n);o&&(r=Cesium.Ray.getPoint(i,o.start))}if(r){var a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(r,a);var s=(0,T.signedAngleBetween)(t.direction,a,t.right)-Math.PI;return Cesium.Math.convertLongitudeRange(s)}},bottomFovRay:function(e){var t=e.camera,i=t.frustum.fovy/2,r=t.direction,n=Cesium.Quaternion.fromAxisAngle(t.right,i),o=Cesium.Matrix3.fromQuaternion(n),a=new Cesium.Cartesian3;return Cesium.Matrix3.multiplyByVector(o,r,a),new Cesium.Ray(t.position,a)},signedAngleBetween:function(e,t,i){var r=new Cesium.Cartesian3,n=new Cesium.Cartesian3,o=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,r),Cesium.Cartesian3.normalize(t,n),Cesium.Cartesian3.cross(r,n,o);var a=Cesium.Cartesian3.dot(r,n),s=Cesium.Cartesian3.magnitude(o),u=Cesium.Cartesian3.dot(i,o),l=Math.atan2(s,a);return u>=0?l:-l},computeAngleToZenith:function(e,t){var i=e.camera,r=i.frustum.fovy/2,n=T.bottomFovRay(e),o=Cesium.Cartesian3.clone(n.direction);Cesium.Cartesian3.negate(o,o);var a=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,a);var s=new Cesium.Cartesian3;return Cesium.Cartesian3.negate(i.right,s),T.signedAngleBetween(a,o,s)+r},extentToRectangle:function(e,t){if(e&&t){var i=Object(r.transformExtent)(e,t,"EPSG:4326");return Cesium.Rectangle.fromDegrees(i[0],i[1],i[2],i[3])}return null},tileLayerToImageryLayer:function(e,t,i){if(!(t instanceof m.a||t instanceof g.a))return null;var r=null,n=t.getSource();if(n instanceof y.a&&n.getUrl()&&n.getImageLoadFunction()===S.defaultImageLoadFunction){var o={"olcs.proxy":n.get("olcs.proxy"),"olcs.extent":n.get("olcs.extent"),"olcs.projection":n.get("olcs.projection"),"olcs.imagesource":n};(n=new w.a({url:n.getUrl(),attributions:n.getAttributions(),projection:n.getProjection(),params:n.getParams()})).setProperties(o)}if(n instanceof _.a){var a=l.getSourceProjection(n);if(a||(a=i),!T.isCesiumProjection(a))return null;r=new P(e,n,i)}else{if(!(n instanceof v.a))return null;var s=l.getSourceProjection(n);if(s||(s=i),!T.isCesiumProjection(s))return null;r=new Cesium.SingleTileImageryProvider({url:n.getUrl(),rectangle:new Cesium.Rectangle.fromDegrees(n.getImageExtent()[0],n.getImageExtent()[1],n.getImageExtent()[2],n.getImageExtent()[3])})}var u={},c=t.get("olcs.extent")||t.getExtent();return c&&(u.rectangle=T.extentToRectangle(c,i)),new Cesium.ImageryLayer(r,u)},updateCesiumLayerProperties:function(e,t){var i=1,r=!0;[e.layer].concat(e.parents).forEach(function(e){var t=e.getOpacity();void 0!==t&&(i*=t);var n=e.getVisible();void 0!==n&&(r&=n)}),t.alpha=i,t.show=r},ol4326CoordinateToCesiumCartesian:function(e){var t=e;return t.length>2?Cesium.Cartesian3.fromDegrees(t[0],t[1],t[2]):Cesium.Cartesian3.fromDegrees(t[0],t[1])},ol4326CoordinateArrayToCsCartesians:function(e){for(var t=T.ol4326CoordinateToCesiumCartesian,i=[],r=0;r<e.length;++r)i.push(t(e[r]));return i},olGeometryCloneTo4326:function(e,t){var i=Object(r.get)("EPSG:4326"),n=Object(r.get)(t);if(n!==i){var o=e.getProperties();(e=e.clone()).transform(n,i),e.setProperties(o)}return e},convertColorToCesium:function(e){if(e=e||"black",Array.isArray(e))return new Cesium.Color(Cesium.Color.byteToFloat(e[0]),Cesium.Color.byteToFloat(e[1]),Cesium.Color.byteToFloat(e[2]),e[3]);if("string"==typeof e)return Cesium.Color.fromCssColorString(e);if(e instanceof CanvasPattern||e instanceof CanvasGradient){var t=document.createElement("canvas"),i=t.getContext("2d");return t.width=t.height=256,i.fillStyle=e,i.fillRect(0,0,t.width,t.height),new Cesium.ImageMaterialProperty({image:t})}},convertUrlToCesium:function(e){var t="",i=/\{(\d|[a-z])-(\d|[a-z])\}/,r=i.exec(e);if(r){e=e.replace(i,"{s}");var n,o=r[1].charCodeAt(0),a=r[2].charCodeAt(0);for(n=o;n<=a;++n)t+=String.fromCharCode(n)}return{url:e,subdomains:t}},resetToNorthZenith:function(e,t){return new Promise(function(i,r){var n=t.camera,o=T.pickBottomPoint(t);if(o){var a=e.getView().getRotation();if(void 0!==a){var s=T.computeAngleToZenith(t,o);T.setHeadingUsingBottomCenter(t,a,o);var u=Cesium.Matrix4.fromTranslation(o),l=n.right,c={callback:function(){var t=e.getView();T.normalizeView(t),i()}};T.rotateAroundAxis(n,-s,l,u,c)}else r("The view is not initialized")}else r("Could not get bottom pivot")})},rotateAroundBottomCenter:function(e,t){return new Promise(function(i,r){var n=e.camera,o=T.pickBottomPoint(e);if(o){var a={callback:i},s=Cesium.Matrix4.fromTranslation(o),u=n.right;(0,T.rotateAroundAxis)(n,-t,u,s,a)}else r("could not get bottom pivot")})},normalizeView:function(e,t){void 0===t&&(t=0);var i=e.getResolution();e.setRotation(t),e.setResolution(e.constrainResolution(i))},isCesiumProjection:function(e){var t=e===Object(r.get)("EPSG:3857"),i=e===Object(r.get)("EPSG:4326");return t||i}},O=T,R=function(){function e(e){this.ol3d=e,this.scene_=e.getCesiumScene(),this.canvas_=this.scene_.canvas,this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this),this.repaintEventNames_=["mousemove","mousedown","mouseup","touchstart","touchend","touchmove","pointerdown","pointerup","pointermove","wheel"],this.enable()}var t=e.prototype;return t.enable=function(){this.scene_.requestRenderMode=!0,this.scene_.maximumRenderTimeChange=1e3;var e=this.repaintEventNames_,t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;this.canvas_.addEventListener(n,this._boundNotifyRepaintRequired,!1)}window.addEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().on("change",this._boundNotifyRepaintRequired)},t.disable=function(){var e=this.repaintEventNames_,t=Array.isArray(e),i=0;for(e=t?e:e[Symbol.iterator]();;){var r;if(t){if(i>=e.length)break;r=e[i++]}else{if((i=e.next()).done)break;r=i.value}var n=r;this.canvas_.removeEventListener(n,this._boundNotifyRepaintRequired,!1)}window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1),this.ol3d.getOlMap().getLayerGroup().un("change",this._boundNotifyRepaintRequired),this.scene_.requestRenderMode=!1},t.restartRenderLoop=function(){this.notifyRepaintRequired()},t.notifyRepaintRequired=function(){this.scene_.requestRender()},e}(),A=i(1);function E(e){return 180*e/Math.PI}function x(e){return e*Math.PI/180}var G=function(){function e(t,i){var r=this;this.scene_=t,this.cam_=t.camera,this.map_=i,this.view_=null,this.viewListenKey_=null,this.toLonLat_=e.identityProjection,this.fromLonLat_=e.identityProjection,this.tilt_=0,this.distance_=0,this.lastCameraViewMatrix_=null,this.viewUpdateInProgress_=!1,this.map_.on("change:view",function(e){r.setView_(r.map_.getView())}),this.setView_(this.map_.getView())}e.identityProjection=function(e,t,i){var r=i||e.length;if(t)for(var n=0;n<r;++n)t[n]=e[n];return e};var t=e.prototype;return t.setView_=function(t){var i=this;if(this.view_&&(Object(A.unByKey)(this.viewListenKey_),this.viewListenKey_=null),this.view_=t,t){var n=Object(r.getTransform)(t.getProjection(),"EPSG:4326"),o=Object(r.getTransform)("EPSG:4326",t.getProjection());this.toLonLat_=n,this.fromLonLat_=o,this.viewListenKey_=t.on("propertychange",function(e){return i.handleViewEvent_(e)}),this.readFromView()}else this.toLonLat_=e.identityProjection,this.fromLonLat_=e.identityProjection},t.handleViewEvent_=function(e){this.viewUpdateInProgress_||this.readFromView()},t.setHeading=function(e){this.view_&&this.view_.setRotation(e)},t.getHeading=function(){if(this.view_)return this.view_.getRotation()||0},t.setTilt=function(e){this.tilt_=e,this.updateCamera_()},t.getTilt=function(){return this.tilt_},t.setDistance=function(e){this.distance_=e,this.updateCamera_(),this.updateView()},t.getDistance=function(){return this.distance_},t.setCenter=function(e){this.view_&&this.view_.setCenter(e)},t.getCenter=function(){if(this.view_)return this.view_.getCenter()},t.setPosition=function(e){if(this.toLonLat_){var t=this.toLonLat_(e),i=new Cesium.Cartographic(x(t[0]),x(t[1]),this.getAltitude());this.cam_.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}),this.updateView()}},t.getPosition=function(){if(this.fromLonLat_){var e=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);return this.fromLonLat_([E(e.longitude),E(e.latitude)])}},t.setAltitude=function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position);t.height=e,this.cam_.position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),this.updateView()},t.getAltitude=function(){return Cesium.Ellipsoid.WGS84.cartesianToCartographic(this.cam_.position).height},t.updateCamera_=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(e){var t=this.toLonLat_(e),i=new Cesium.Cartographic(x(t[0]),x(t[1]));if(this.scene_.globe){var r=this.scene_.globe.getHeight(i);i.height=r||0}var n=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:this.tilt_-Cesium.Math.PI_OVER_TWO,heading:-this.view_.getRotation(),roll:void 0};this.cam_.setView({destination:n,orientation:o}),this.cam_.moveBackward(this.distance_),this.checkCameraChange(!0)}}},t.readFromView=function(){if(this.view_&&this.toLonLat_){var e=this.view_.getCenter();if(null!=e){var t=this.toLonLat_(e),i=this.view_.getResolution();this.distance_=this.calcDistanceForResolution(i||0,x(t[1])),this.updateCamera_()}}},t.updateView=function(){if(this.view_&&this.fromLonLat_){this.viewUpdateInProgress_=!0;var e=Cesium.Ellipsoid.WGS84,t=this.scene_,i=O.pickCenterPoint(t),r=i;if(!r){var n=t.globe,o=this.cam_.positionCartographic.clone(),a=n.getHeight(o);o.height=a||0,r=Cesium.Ellipsoid.WGS84.cartographicToCartesian(o)}this.distance_=Cesium.Cartesian3.distance(r,this.cam_.position);var s=e.cartesianToCartographic(r);if(this.view_.setCenter(this.fromLonLat_([E(s.longitude),E(s.latitude)])),this.view_.setResolution(this.calcResolutionForDistance(this.distance_,s?s.latitude:0)),i){var u=this.cam_.position,l=new Cesium.Cartesian3;e.geocentricSurfaceNormal(i,l);var c=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(u,i,c),Cesium.Cartesian3.normalize(c,c);var h=this.cam_.up,m=this.cam_.right,d=new Cesium.Cartesian3(-i.y,i.x,0),g=Cesium.Cartesian3.angleBetween(m,d),p=Cesium.Cartesian3.cross(i,h,new Cesium.Cartesian3).z;this.view_.setRotation(p<0?g:-g);var v=Math.acos(Cesium.Cartesian3.dot(l,c));this.tilt_=isNaN(v)?0:v}else this.view_.setRotation(this.cam_.heading),this.tilt_=-this.cam_.pitch+Math.PI/2;this.viewUpdateInProgress_=!1}},t.checkCameraChange=function(e){var t=this.lastCameraViewMatrix_,i=this.cam_.viewMatrix;t&&Cesium.Matrix4.equalsEpsilon(t,i,1e-5)||(this.lastCameraViewMatrix_=i.clone(),!0!==e&&this.updateView())},t.calcDistanceForResolution=function(e,t){var i=this.scene_.canvas,r=this.cam_.frustum.fovy,n=this.view_.getProjection().getMetersPerUnit();return e*i.clientHeight*n*Math.cos(Math.abs(t))/2/Math.tan(r/2)},t.calcResolutionForDistance=function(e,t){var i=this.scene_.canvas,r=this.cam_.frustum.fovy,n=this.view_.getProjection().getMetersPerUnit();return 2*e*Math.tan(r/2)/n/Math.cos(Math.abs(t))/i.clientHeight},e}(),M=i(4),I=i.n(M),F=function(){function e(e,t){this.map=e,this.view=e.getView(),this.scene=t,this.olLayers=e.getLayerGroup().getLayers(),this.mapLayerGroup=e.getLayerGroup(),this.layerMap={},this.olLayerListenKeys={},this.olGroupListenKeys_={}}var t=e.prototype;return t.synchronize=function(){this.destroyAll(),this.addLayers_(this.mapLayerGroup)},t.orderLayers=function(){},t.addLayers_=function(e){for(var t=this,i=[{layer:e,parents:[]}],r=function(){var e=i.splice(0,1)[0],r=e.layer,n=s(r).toString();t.olLayerListenKeys[n]=[];var a=null;if(r instanceof I.a)t.listenForGroupChanges_(r),r!==t.mapLayerGroup&&(a=t.createSingleLayerCounterparts(e)),a||r.getLayers().forEach(function(n){if(n){var o={layer:n,parents:r===t.mapLayerGroup?[]:[e.layer].concat(e.parents)};i.push(o)}});else if(!(a=t.createSingleLayerCounterparts(e))){var u=n,l=e;t.olLayerListenKeys[n].push(o(l.layer,"change",function e(i){var r=t.createSingleLayerCounterparts(l);r&&(l.layer.un("change",e),t.addCesiumObjects_(r,u,l.layer),t.orderLayers())}))}a&&t.addCesiumObjects_(a,n,r)};i.length>0;)r();this.orderLayers()},t.addCesiumObjects_=function(e,t,i){var r=this;this.layerMap[t]=e,this.olLayerListenKeys[t].push(o(i,"change:zIndex",function(){return r.orderLayers()})),e.forEach(function(e){r.addCesiumObject(e)})},t.removeAndDestroySingleLayer_=function(e){var t=this,i=s(e).toString(),r=this.layerMap[i];return r&&(r.forEach(function(e){t.removeSingleCesiumObject(e,!1),t.destroyCesiumObject(e)}),this.olLayerListenKeys[i].forEach(A.unByKey),delete this.olLayerListenKeys[i]),delete this.layerMap[i],!!r},t.unlistenSingleGroup_=function(e){if(e!==this.mapLayerGroup){var t=s(e).toString();this.olGroupListenKeys_[t].forEach(function(e){Object(A.unByKey)(e)}),delete this.olGroupListenKeys_[t],delete this.layerMap[t]}},t.removeLayer_=function(e){var t=this;e&&function(){for(var i=[e];i.length>0;){var r=i.splice(0,1)[0],n=t.removeAndDestroySingleLayer_(r);r instanceof I.a&&(t.unlistenSingleGroup_(r),n||r.getLayers().forEach(function(e){i.push(e)}))}}()},t.listenForGroupChanges_=function(e){var t=s(e).toString(),i=[];this.olGroupListenKeys_[t]=i;var r=[],n=function(){var t=this,n=e.getLayers();n&&(r=[n.on("add",function(e){t.addLayers_(e.element)}),n.on("remove",function(e){t.removeLayer_(e.element)})],i.push.apply(i,r))}.bind(this);n(),i.push(e.on("change:layers",function(e){r.forEach(function(e){var t=i.indexOf(e);t>=0&&i.splice(t,1),Object(A.unByKey)(e)}),n()}))},t.destroyAll=function(){var e;for(e in this.removeAllCesiumObjects(!0),this.olGroupListenKeys_){this.olGroupListenKeys_[e].forEach(A.unByKey)}for(e in this.olLayerListenKeys)this.olLayerListenKeys[e].forEach(A.unByKey);this.olGroupListenKeys_={},this.olLayerListenKeys={},this.layerMap={}},t.addCesiumObject=function(e){},t.destroyCesiumObject=function(e){},t.removeSingleCesiumObject=function(e,t){},t.removeAllCesiumObjects=function(e){},t.createSingleLayerCounterparts=function(e){},e}();var j=function(e){var t,i;function r(t,i){var r;return(r=e.call(this,t,i)||this).cesiumLayers_=i.imageryLayers,r.ourLayers_=new Cesium.ImageryLayerCollection,r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.addCesiumObject=function(e){this.cesiumLayers_.add(e),this.ourLayers_.add(e)},n.destroyCesiumObject=function(e){e.destroy()},n.removeSingleCesiumObject=function(e,t){this.cesiumLayers_.remove(e,t),this.ourLayers_.remove(e,!1)},n.removeAllCesiumObjects=function(e){for(var t=0;t<this.ourLayers_.length;++t)this.cesiumLayers_.remove(this.ourLayers_.get(t),e);this.ourLayers_.removeAll(!1)},n.convertLayerToCesiumImageries=function(e,t){var i=O.tileLayerToImageryLayer(this.map,e,t);return i?[i]:null},n.createSingleLayerCounterparts=function(e){var t=this,i=e.layer,r=s(i).toString(),n=this.view.getProjection(),o=this.convertLayerToCesiumImageries(i,n);if(o){var a,u=[];[e.layer].concat(e.parents).forEach(function(t){u.push(t.on(["change:opacity","change:visible"],function(){for(var t=0;t<o.length;++t)O.updateCesiumLayerProperties(e,o[t])}))});for(var l=0;l<o.length;++l)O.updateCesiumLayerProperties(e,o[l]);u.push(i.on("change:extent",function(e){for(var r=0;r<o.length;++r)t.cesiumLayers_.remove(o[r],!0),t.ourLayers_.remove(o[r],!1);delete t.layerMap[s(i)],t.synchronize()})),u.push(i.on("change",function(e){for(var i=0;i<o.length;++i){var r=t.cesiumLayers_.indexOf(o[i]);r>=0&&(t.cesiumLayers_.remove(o[i],!1),t.cesiumLayers_.add(o[i],r))}})),(a=this.olLayerListenKeys[r]).push.apply(a,u)}return Array.isArray(o)?o:null},n.orderLayers=function(){for(var e=this,t=[],i={},r=[this.mapLayerGroup];r.length>0;){var n=r.splice(0,1)[0];if(t.push(n),i[s(n)]=n.getZIndex(),n instanceof I.a){var o=n.getLayers();o&&r.unshift.apply(r,o.getArray())}}!function(e,t){for(var i=e.length,r=Array(e.length),n=0;n<i;n++)r[n]={index:n,value:e[n]};r.sort(function(e,i){return t(e.value,i.value)||e.index-i.index});for(var o=0;o<e.length;o++)e[o]=r[o].value}(t,function(e,t){return i[s(e)]-i[s(t)]}),t.forEach(function(t){var i=s(t).toString(),r=e.layerMap[i];r&&r.forEach(function(t){e.raiseToTop(t)})})},n.raiseToTop=function(e){this.cesiumLayers_.raiseToTop(e)},r}(F),k=i(2),V=i.n(k),N=i(3),D=i.n(N),z=i(7),B=i.n(z),K=i(5),H=i.n(K),U=i(8),W=i.n(U),q=i(9),Z=i.n(q),Q=i(19),Y=i(10),X=i(20),J=i.n(X),$=function(){function e(e,t){var i=new Cesium.BillboardCollection({scene:t}),r=new Cesium.PrimitiveCollection;this.olListenKeys=[],this.rootCollection_=new Cesium.PrimitiveCollection,this.context={projection:e,billboards:i,featureToCesiumMap:{},primitives:r},this.rootCollection_.add(i),this.rootCollection_.add(r)}var t=e.prototype;return t.destroy=function(){this.olListenKeys.forEach(A.unByKey),this.olListenKeys.length=0},t.getRootPrimitive=function(){return this.rootCollection_},e}(),ee=function(){function e(e){this.scene=e,this.boundOnRemoveOrClearFeatureListener_=this.onRemoveOrClearFeature_.bind(this),this.defaultBillboardEyeOffset_=new Cesium.Cartesian3(0,0,10)}var t=e.prototype;return t.onRemoveOrClearFeature_=function(e){var t=e.target,i=l.obj(t).olcs_cancellers;if(i){var r=e.feature;if(r){var n=s(r),o=i[n];o&&(o(),delete i[n])}else{for(var a in i)i.hasOwnProperty(a)&&i[a]();l.obj(t).olcs_cancellers={}}}},t.setReferenceForPicking=function(e,t,i){i.olLayer=e,i.olFeature=t},t.createColoredPrimitive=function(e,t,i,r,n,o){var a={flat:!0,renderState:{depthTest:{enabled:!0}}};void 0!==o&&(a.renderState||(a.renderState={}),a.renderState.lineWidth=o);var s,u=function(e,t){var i=new Cesium.GeometryInstance({geometry:e});return!t||t instanceof Cesium.ImageMaterialProperty||(i.attributes={color:Cesium.ColorGeometryInstanceAttribute.fromColor(t)}),i}(r,n);if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var l=u.geometry.constructor;if(l&&!l.createShadowVolume)return null;s=new Cesium.GroundPrimitive({geometryInstances:u})}else s=new Cesium.Primitive({geometryInstances:u});if(n instanceof Cesium.ImageMaterialProperty){var c=n.image.getValue().toDataURL();s.appearance=new Cesium.MaterialAppearance({flat:!0,renderState:{depthTest:{enabled:!0}},material:new Cesium.Material({fabric:{type:"Image",uniforms:{image:c}}})})}else s.appearance=new Cesium.PerInstanceColorAppearance(a);return this.setReferenceForPicking(e,t,s),s},t.extractColorFromOlStyle=function(e,t){var i=e.getFill()?e.getFill().getColor():null,r=e.getStroke()?e.getStroke().getColor():null,n="black";return r&&t?n=r:i&&(n=i),O.convertColorToCesium(n)},t.extractLineWidthFromOlStyle=function(e){var t=e.getStroke()?e.getStroke().getWidth():void 0;return void 0!==t?t:1},t.wrapFillAndOutlineGeometries=function(e,t,i,r,n,o){var a=this.extractColorFromOlStyle(o,!1),s=this.extractColorFromOlStyle(o,!0),u=new Cesium.PrimitiveCollection;if(o.getFill()){var l=this.createColoredPrimitive(e,t,i,r,a);u.add(l)}if(o.getStroke()&&n){var c=this.extractLineWidthFromOlStyle(o),h=this.createColoredPrimitive(e,t,i,n,s,c);h&&u.add(h)}return u},t.addTextStyle=function(e,t,i,r,n){var o;if(n instanceof Cesium.PrimitiveCollection?o=n:(o=new Cesium.PrimitiveCollection).add(n),!r.getText())return o;var a=r.getText(),s=this.olGeometry4326TextPartToCesium(e,t,i,a);return s&&o.add(s),o},t.csAddBillboard=function(e,t,i,r,n,o){t.eyeOffset||(t.eyeOffset=this.defaultBillboardEyeOffset_);var a=e.add(t);return this.setReferenceForPicking(i,r,a),a},t.olCircleGeometryToCesium=function(e,t,i,r,n){var o=this,a=(i=O.olGeometryCloneTo4326(i,r)).getCenter(),s=3==a.length?a[2]:0,l=a.slice();l[0]+=i.getRadius(),a=O.ol4326CoordinateToCesiumCartesian(a),l=O.ol4326CoordinateToCesiumCartesian(l);var c,h,m=Cesium.Cartesian3.distance(a,l),d=new Cesium.CircleGeometry({center:a,radius:m,height:s});if(this.getHeightReference(e,t,i)===Cesium.HeightReference.CLAMP_TO_GROUND){var g=this.extractLineWidthFromOlStyle(n);if(g){var p=Object(Q.circular)(i.getCenter(),m),v=O.ol4326CoordinateArrayToCsCartesians(p.getLinearRing(0).getCoordinates());if(u(this.scene))(c=new Cesium.GroundPolylinePrimitive({geometryInstances:new Cesium.GeometryInstance({geometry:new Cesium.GroundPolylineGeometry({positions:v,width:g})}),appearance:new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),classificationType:Cesium.ClassificationType.TERRAIN})).readyPromise.then(function(){o.setReferenceForPicking(e,t,c._primitive)});else{var f=this.extractColorFromOlStyle(n,!0);c=this.createStackedGroundCorridors(e,t,g,f,v)}}}else h=new Cesium.CircleOutlineGeometry({center:a,radius:m,extrudedHeight:s,height:s});var y=this.wrapFillAndOutlineGeometries(e,t,i,d,h,n);return c&&y.add(c),this.addTextStyle(e,t,i,n,y)},t.createStackedGroundCorridors=function(e,t,i,r,n){Array.isArray(n[0])||(n=[n]),i=Math.max(3,i);for(var o=[],a=0,s=[1e3,4e3,16e3,64e3,254e3,1e6,1e7],u=0;u<s.length;u++){var l=s[u],c={width:i*=2.14,vertexFormat:Cesium.VertexFormat.POSITION_ONLY},h=n,m=Array.isArray(h),d=0;for(h=m?h:h[Symbol.iterator]();;){var g;if(m){if(d>=h.length)break;g=h[d++]}else{if((d=h.next()).done)break;g=d.value}var p=g;c.positions=p,o.push(new Cesium.GeometryInstance({geometry:new Cesium.CorridorGeometry(c),attributes:{color:Cesium.ColorGeometryInstanceAttribute.fromColor(r),distanceDisplayCondition:new Cesium.DistanceDisplayConditionGeometryInstanceAttribute(a,l-1)}}))}a=l}return new Cesium.GroundPrimitive({geometryInstances:o})},t.olLineStringGeometryToCesium=function(e,t,i,r,n){var o=this;i=O.olGeometryCloneTo4326(i,r);var a,s=O.ol4326CoordinateArrayToCsCartesians(i.getCoordinates()),l=this.extractLineWidthFromOlStyle(n),c=this.getHeightReference(e,t,i);if(c!==Cesium.HeightReference.CLAMP_TO_GROUND||u(this.scene)){var h=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),m={positions:s,width:l},d={appearance:h};if(c===Cesium.HeightReference.CLAMP_TO_GROUND){var g=new Cesium.GroundPolylineGeometry(m);d.geometryInstances=new Cesium.GeometryInstance({geometry:g}),(a=new Cesium.GroundPolylinePrimitive(d)).readyPromise.then(function(){o.setReferenceForPicking(e,t,a._primitive)})}else{m.vertexFormat=h.vertexFormat;var p=new Cesium.PolylineGeometry(m);d.geometryInstances=new Cesium.GeometryInstance({geometry:p}),a=new Cesium.Primitive(d)}}else{var v=this.extractColorFromOlStyle(n,!0);a=this.createStackedGroundCorridors(e,t,l,v,s)}return this.setReferenceForPicking(e,t,a),this.addTextStyle(e,t,i,n,a)},t.olPolygonGeometryToCesium=function(e,t,i,r,n){var o=this;i=O.olGeometryCloneTo4326(i,r);var a,s,l,c=this.getHeightReference(e,t,i);if(5==i.getCoordinates()[0].length&&"rectangle"===t.getGeometry().get("olcs.polygon_kind")){var h=i.getCoordinates()[0],m=Object(Y.boundingExtent)(h),d=Cesium.Rectangle.fromDegrees(m[0],m[1],m[2],m[3]),g=0;if(3==h[0].length)for(var p=0;p<h.length;p++)g=Math.max(g,h[p][2]);a=new Cesium.RectangleGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:d,height:g}),s=new Cesium.RectangleOutlineGeometry({ellipsoid:Cesium.Ellipsoid.WGS84,rectangle:d,height:g})}else{for(var v=i.getLinearRings(),f={},y=f,C=0;C<v.length;++C){var _=v[C].getCoordinates(),b=O.ol4326CoordinateArrayToCsCartesians(_);0==C?f.positions=b:(f.holes||(f.holes=[]),f.holes.push({positions:b}))}if(a=new Cesium.PolygonGeometry({polygonHierarchy:y,perPositionHeight:!0}),c===Cesium.HeightReference.CLAMP_TO_GROUND){var w=this.extractLineWidthFromOlStyle(n);if(w>0){var S=[f.positions];if(f.holes)for(var L=0;L<f.holes.length;++L)S.push(f.holes[L].positions);if(u(this.scene)){for(var P=new Cesium.PolylineMaterialAppearance({material:this.olStyleToCesium(t,n,!0)}),T=[],R=0;R<S.length;R++){var A=S[R],E=new Cesium.GroundPolylineGeometry({positions:A,width:w});T.push(new Cesium.GeometryInstance({geometry:E}))}var x={appearance:P,geometryInstances:T};(l=new Cesium.GroundPolylinePrimitive(x)).readyPromise.then(function(){o.setReferenceForPicking(e,t,l._primitive)})}else{var G=this.extractColorFromOlStyle(n,!0);l=this.createStackedGroundCorridors(e,t,w,G,S)}}}else s=new Cesium.PolygonOutlineGeometry({polygonHierarchy:f,perPositionHeight:!0})}var M=this.wrapFillAndOutlineGeometries(e,t,i,a,s,n);return l&&M.add(l),this.addTextStyle(e,t,i,n,M)},t.getHeightReference=function(e,t,i){var r=i.get("altitudeMode");void 0===r&&(r=t.get("altitudeMode")),void 0===r&&(r=e.get("altitudeMode"));var n=Cesium.HeightReference.NONE;return"clampToGround"===r?n=Cesium.HeightReference.CLAMP_TO_GROUND:"relativeToGround"===r&&(n=Cesium.HeightReference.RELATIVE_TO_GROUND),n},t.createBillboardFromImage=function(e,t,i,r,n,o,a,u){o instanceof Z.a&&o.load();var c=o.getImage(1),h=function(){if(c&&(c instanceof HTMLCanvasElement||c instanceof Image||c instanceof HTMLImageElement)){var r,s=i.getCoordinates(),l=O.ol4326CoordinateToCesiumCartesian(s),h=o.getOpacity();void 0!==h&&(r=new Cesium.Color(1,1,1,h));var m=this.getHeightReference(e,t,i),d={image:c,color:r,scale:o.getScale(),heightReference:m,position:l};if(o instanceof Z.a){var g=o.getAnchor();g&&(d.pixelOffset=new Cesium.Cartesian2(c.width/2-g[0],c.height/2-g[1]))}var p=this.csAddBillboard(a,d,e,t,i,n);u&&u(p)}}.bind(this);if(c instanceof Image&&!function(e){return""!=e.src&&0!=e.naturalHeight&&0!=e.naturalWidth&&e.complete}(c)){var m=!1,d=e.getSource();d.on(["removefeature","clear"],this.boundOnRemoveOrClearFeatureListener_);var g=l.obj(d).olcs_cancellers;g||(g=l.obj(d).olcs_cancellers={});var p=s(t);g[p]&&g[p](),g[p]=function(){m=!0};c.addEventListener("load",function e(){c.removeEventListener("load",e),a.isDestroyed()||m||h()})}else h()},t.olPointGeometryToCesium=function(e,t,i,r,n,o,a){i=O.olGeometryCloneTo4326(i,r);var s=null,u=n.getImage();if(u){var l=i.get("olcs_model")||t.get("olcs_model");if(l){var c=l(),h=Object.assign({},{scene:this.scene},c.cesiumOptions),m=Cesium.Model.fromGltf(h);(s=new Cesium.PrimitiveCollection).add(m),c.debugModelMatrix&&s.add(new Cesium.DebugModelMatrixPrimitive({modelMatrix:c.debugModelMatrix}))}else this.createBillboardFromImage(e,t,i,r,n,u,o,a)}return n.getText()?this.addTextStyle(e,t,i,n,s||new Cesium.Primitive):s},t.olMultiGeometryToCesium=function(e,t,i,r,n,o,a){var s,u=this,l=function(i,o){var a=new Cesium.PrimitiveCollection;return i.forEach(function(i){a.add(o(e,t,i,r,n))}),a};switch(i.getType()){case"MultiPoint":if(s=(i=i).getPoints(),n.getText()){var c=new Cesium.PrimitiveCollection;return s.forEach(function(i){var s=u.olPointGeometryToCesium(e,t,i,r,n,o,a);s&&c.add(s)}),c}return s.forEach(function(i){u.olPointGeometryToCesium(e,t,i,r,n,o,a)}),null;case"MultiLineString":return l(s=(i=i).getLineStrings(),this.olLineStringGeometryToCesium.bind(this));case"MultiPolygon":return l(s=(i=i).getPolygons(),this.olPolygonGeometryToCesium.bind(this))}},t.olGeometry4326TextPartToCesium=function(e,t,i,r){var n=r.getText();if(!n)return null;var o=new Cesium.LabelCollection({scene:this.scene}),a=Object(Y.getCenter)(i.getExtent());if(i instanceof J.a){var s=i.getFirstCoordinate();a[2]=3==s.length?s[2]:0}var u={};u.position=O.ol4326CoordinateToCesiumCartesian(a),u.text=n,u.heightReference=this.getHeightReference(e,t,i);var l=r.getOffsetX(),c=r.getOffsetY();if(0!=l&&0!=c){var h=new Cesium.Cartesian2(l,c);u.pixelOffset=h}u.font=r.getFont()||"10px sans-serif";var m,d=void 0;switch(r.getFill()&&(u.fillColor=this.extractColorFromOlStyle(r,!1),d=Cesium.LabelStyle.FILL),r.getStroke()&&(u.outlineWidth=this.extractLineWidthFromOlStyle(r),u.outlineColor=this.extractColorFromOlStyle(r,!0),d=Cesium.LabelStyle.OUTLINE),r.getFill()&&r.getStroke()&&(d=Cesium.LabelStyle.FILL_AND_OUTLINE),u.style=d,r.getTextAlign()){case"left":m=Cesium.HorizontalOrigin.LEFT;break;case"right":m=Cesium.HorizontalOrigin.RIGHT;break;case"center":default:m=Cesium.HorizontalOrigin.CENTER}if(u.horizontalOrigin=m,r.getTextBaseline()){var g;switch(r.getTextBaseline()){case"top":g=Cesium.VerticalOrigin.TOP;break;case"middle":g=Cesium.VerticalOrigin.CENTER;break;case"bottom":g=Cesium.VerticalOrigin.BOTTOM;break;case"alphabetic":g=Cesium.VerticalOrigin.TOP;break;case"hanging":g=Cesium.VerticalOrigin.BOTTOM}u.verticalOrigin=g}var p=o.add(u);return this.setReferenceForPicking(e,t,p),o},t.olStyleToCesium=function(e,t,i){var r=t.getFill(),n=t.getStroke();if(i&&!n||!i&&!r)return null;var o=i?n.getColor():r.getColor();return o=O.convertColorToCesium(o),i&&n.getLineDash()?Cesium.Material.fromType("Stripe",{horizontal:!1,repeat:500,evenColor:o,oddColor:new Cesium.Color(0,0,0,0)}):Cesium.Material.fromType("Color",{color:o})},t.computePlainStyle=function(e,t,i,r){var n=t.getStyleFunction(),o=null;return n&&(o=n(t,r)),!o&&i&&(o=i(t,r)),o?Array.isArray(o)?o:[o]:null},t.getGeometryFromFeature=function(e,t,i){if(i)return i;var r=e.get("olcs.3d_geometry");if(r&&r instanceof W.a)return r;if(t){var n=t.getGeometryFunction()(e);if(n instanceof W.a)return n}return e.getGeometry()},t.olFeatureToCesium=function(e,t,i,r,n){var o=this,a=this.getGeometryFromFeature(t,i,n);if(!a)return null;var u=r.projection,l=function(e){var i=r.featureToCesiumMap[s(t)];i instanceof Array?i.push(e):r.featureToCesiumMap[s(t)]=[e]};switch(a.getType()){case"GeometryCollection":var c=new Cesium.PrimitiveCollection;return a.getGeometries().forEach(function(n){if(n){var a=o.olFeatureToCesium(e,t,i,r,n);a&&c.add(a)}}),c;case"Point":a=a;var h=r.billboards,m=this.olPointGeometryToCesium(e,t,a,u,i,h,l);return m||null;case"Circle":return a=a,this.olCircleGeometryToCesium(e,t,a,u,i);case"LineString":return a=a,this.olLineStringGeometryToCesium(e,t,a,u,i);case"Polygon":return a=a,this.olPolygonGeometryToCesium(e,t,a,u,i);case"MultiPoint":case"MultiLineString":case"MultiPolygon":var d=this.olMultiGeometryToCesium(e,t,a,u,i,r.billboards,l);return d||null;case"LinearRing":throw new Error("LinearRing should only be part of polygon.");default:throw new Error("Ol geom type not handled : "+a.getType())}},t.olVectorLayerToCesium=function(e,t,i){var r=t.getProjection(),n=t.getResolution();if(void 0===n||!r)throw new Error("View not ready");var o=e.getSource();o instanceof B.a&&(o=o.getSource());for(var a=o.getFeatures(),u=new $(r,this.scene),l=u.context,c=0;c<a.length;++c){var h=a[c];if(h){var m=e.getStyleFunction(),d=this.computePlainStyle(e,h,m,n);if(d&&d.length){for(var g=null,p=0;p<d.length;p++){var v=this.olFeatureToCesium(e,h,d[p],l);if(v)if(g){if(v)for(var f=0,y=void 0;y=v.get(f);)g.add(y),f++}else g=v}g&&(i[s(h)]=g,u.getRootPrimitive().add(g))}}}return u},t.convert=function(e,t,i,r){var n=t.getProjection(),o=t.getResolution();if(null==o||!n)return null;var a=e.getStyleFunction(),s=this.computePlainStyle(e,i,a,o);if(!s.length)return null;r.projection=n;for(var u=null,l=0;l<s.length;l++){var c=this.olFeatureToCesium(e,i,s[l],r);if(u){if(c)for(var h=0,m=void 0;m=c.get(h);)u.add(m),h++}else u=c}return u},e}();var te=function(e){var t,i;function r(t,i,r){var n;return(n=e.call(this,t,i)||this).converter=r||new ee(i),n.csAllPrimitives_=new Cesium.PrimitiveCollection,i.primitives.add(n.csAllPrimitives_),n.csAllPrimitives_.destroyPrimitives=!1,n}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.addCesiumObject=function(e){e.getRootPrimitive().counterpart=e,this.csAllPrimitives_.add(e.getRootPrimitive())},n.destroyCesiumObject=function(e){e.getRootPrimitive().destroy()},n.removeSingleCesiumObject=function(e,t){e.destroy(),this.csAllPrimitives_.destroyPrimitives=t,this.csAllPrimitives_.remove(e.getRootPrimitive()),this.csAllPrimitives_.destroyPrimitives=!1},n.removeAllCesiumObjects=function(e){if(this.csAllPrimitives_.destroyPrimitives=e,e)for(var t=0;t<this.csAllPrimitives_.length;++t)this.csAllPrimitives_.get(t).counterpart.destroy();this.csAllPrimitives_.removeAll(),this.csAllPrimitives_.destroyPrimitives=!1},n.updateLayerVisibility=function(e,t){var i=!0;[e.layer].concat(e.parents).forEach(function(e){var t=e.getVisible();void 0!==t?i&=t:i=!1}),t.show=i},n.createSingleLayerCounterparts=function(e){var t=this,i=e.layer;if(!(i instanceof H.a))return null;var r=i.getSource();if(r instanceof B.a&&(r=r.getSource()),!r)return null;var n=this.view,a={},u=this.converter.olVectorLayerToCesium(i,n,a),l=u.getRootPrimitive(),c=u.olListenKeys;[e.layer].concat(e.parents).forEach(function(i){c.push(o(i,"change:visible",function(){t.updateLayerVisibility(e,l)}))}),this.updateLayerVisibility(e,l);var h=function(e){var t=u.context,r=this.converter.convert(i,n,e,t);r&&(a[s(e)]=r,l.add(r))}.bind(this),m=function(e){var t=s(e),i=u.context,r=i.featureToCesiumMap[t];r&&(delete i.featureToCesiumMap[t],r.forEach(function(e){e instanceof Cesium.Billboard&&i.billboards.remove(e)}));var n=a[t];delete a[t],n&&l.remove(n)}.bind(this);return c.push(o(r,"addfeature",function(e){h(e.feature)})),c.push(o(r,"removefeature",function(e){m(e.feature)})),c.push(o(r,"changefeature",function(e){var t=e.feature;m(t),h(t)})),u?[u]:null},r}(F),ie=i(21);function re(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var ne=function(e){var t,i;function n(t){var i,r=t.parent;(i=e.call(this,r.getOptions())||this).scenePostRenderListenerRemover_=null,i.scene_=t.scene,i.synchronizer_=t.synchronizer,i.parent_=r,i.positionWGS84_=void 0,i.observer_=new MutationObserver(i.handleElementChanged.bind(re(re(i)))),i.attributeObserver_=[],i.listenerKeys_=[];var n=function(e){return i.setPropertyFromEvent_(e)};return i.listenerKeys_.push(i.parent_.on("change:position",n)),i.listenerKeys_.push(i.parent_.on("change:element",n)),i.listenerKeys_.push(i.parent_.on("change:offset",n)),i.listenerKeys_.push(i.parent_.on("change:position",n)),i.listenerKeys_.push(i.parent_.on("change:positioning",n)),i.setProperties(i.parent_.getProperties()),i.handleMapChanged(),i.handleElementChanged(),i}i=e,(t=n).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var o=n.prototype;return o.observeTarget_=function(e){if(this.observer_){this.observer_.disconnect(),this.observer_.observe(e,{attributes:!1,childList:!0,characterData:!0,subtree:!0}),this.attributeObserver_.forEach(function(e){e.disconnect()}),this.attributeObserver_.length=0;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType){var r=new MutationObserver(this.handleElementChanged.bind(this));r.observe(i,{attributes:!0,subtree:!0}),this.attributeObserver_.push(r)}}}},o.setPropertyFromEvent_=function(e){e.target&&e.key&&this.set(e.key,e.target.get(e.key))},o.getScene=function(){return this.scene_},o.handleMapChanged=function(){var e;this.scenePostRenderListenerRemover_&&(this.scenePostRenderListenerRemover_(),(e=this.element)&&e.parentNode&&e.parentNode.removeChild(e)),this.scenePostRenderListenerRemover_=null;var t=this.getScene();if(t){this.scenePostRenderListenerRemover_=t.postRender.addEventListener(this.updatePixelPosition.bind(this)),this.updatePixelPosition();var i=this.stopEvent?this.synchronizer_.getOverlayContainerStopEvent():this.synchronizer_.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element)}},o.handlePositionChanged=function(){var e=this.getPosition();if(e){var t=this.parent_.getMap().getView().getProjection();this.positionWGS84_=Object(r.transform)(e,t,"EPSG:4326")}else this.positionWGS84_=void 0;this.updatePixelPosition()},o.handleElementChanged=function(){function e(t,i){var r=t.cloneNode();i&&i.appendChild(r),t.nodeType!=Node.TEXT_NODE&&r.addEventListener("click",function(e){t.dispatchEvent(new MouseEvent("click",e)),e.stopPropagation()});for(var n=t.childNodes,o=0;o<n.length;o++)n[o]&&e(n[o],r);return r}!function(e){for(;e.lastChild;)e.removeChild(e.lastChild)}(this.element);var t=this.getElement();if(t&&t.parentNode&&t.parentNode.childNodes){var i=t.parentNode.childNodes,r=Array.isArray(i),n=0;for(i=r?i:i[Symbol.iterator]();;){var o;if(r){if(n>=i.length)break;o=i[n++]}else{if((n=i.next()).done)break;o=n.value}var a=e(o,null);this.element.appendChild(a)}}t.parentNode&&this.observeTarget_(t.parentNode)},o.updatePixelPosition=function(){var e=this.positionWGS84_;if(this.scene_&&e){var t=0;if(2===e.length){var i=this.scene_.globe.getHeight(Cesium.Cartographic.fromDegrees(e[0],e[1]));i&&this.scene_.globe.tilesLoaded&&(e[2]=i),i&&(t=i)}else t=e[2];var r=Cesium.Cartesian3.fromDegrees(e[0],e[1],t),n=this.scene_.camera,o=new Cesium.BoundingSphere(new Cesium.Cartesian3,6356752);if(new Cesium.Occluder(o,n.position).isPointVisible(r))if(1===n.frustum.computeCullingVolume(n.position,n.direction,n.up).computeVisibility(new Cesium.BoundingSphere(r))){this.setVisible(!0);var a=this.scene_.cartesianToCanvasCoordinates(r),s=[a.x,a.y],u=[this.scene_.canvas.width,this.scene_.canvas.height];this.updateRenderedPosition(s,u)}else this.setVisible(!1);else this.setVisible(!1)}else this.setVisible(!1)},o.destroy=function(){this.scenePostRenderListenerRemover_&&this.scenePostRenderListenerRemover_(),this.observer_&&this.observer_.disconnect(),Object(A.unByKey)(this.listenerKeys_),this.listenerKeys_.splice(0),this.element.removeNode?this.element.removeNode(!0):this.element.remove(),this.element=null},n}(i.n(ie).a),oe=function(){function e(e,t){var i=this;this.map=e,this.overlays_=this.map.getOverlays(),this.scene=t,this.overlayContainerStopEvent_=document.createElement("DIV"),this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent";["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"].forEach(function(e){i.overlayContainerStopEvent_.addEventListener(e,function(e){return e.stopPropagation()})}),this.scene.canvas.parentElement.appendChild(this.overlayContainerStopEvent_),this.overlayContainer_=document.createElement("DIV"),this.overlayContainer_.className="ol-overlaycontainer",this.scene.canvas.parentElement.appendChild(this.overlayContainer_),this.overlayMap_={}}var t=e.prototype;return t.getOverlayContainerStopEvent=function(){return this.overlayContainerStopEvent_},t.getOverlayContainer=function(){return this.overlayContainer_},t.synchronize=function(){this.destroyAll(),this.addOverlays(),this.overlays_.on("add",this.addOverlayFromEvent_.bind(this)),this.overlays_.on("remove",this.removeOverlayFromEvent_.bind(this))},t.addOverlayFromEvent_=function(e){var t=e.element;this.addOverlay(t)},t.addOverlays=function(){var e=this;this.overlays_.forEach(function(t){e.addOverlay(t)})},t.addOverlay=function(e){if(e){var t=new ne({scene:this.scene,synchronizer:this,parent:e}),i=s(e).toString();this.overlayMap_[i]=t}},t.removeOverlayFromEvent_=function(e){var t=e.element;this.removeOverlay(t)},t.removeOverlay=function(e){var t=s(e).toString(),i=this.overlayMap_[t];i&&(i.destroy(),delete this.overlayMap_[t])},t.destroyAll=function(){var e=this;Object.keys(this.overlayMap_).forEach(function(t){e.overlayMap_[t].destroy(),delete e.overlayMap_[t]})},e}(),ae=function(){function e(t){this.autoRenderLoop_=null,this.map_=t.map,this.time_=t.time||function(){return Cesium.JulianDate.now()},this.to4326Transform_=Object(r.getTransform)(this.map_.getView().getProjection(),"EPSG:4326"),this.resolutionScale_=1,this.canvasClientWidth_=0,this.canvasClientHeight_=0,this.resolutionScaleChanged_=!0;var i="position:absolute;top:0;left:0;width:100%;height:100%;";this.container_=document.createElement("DIV");var n=document.createAttribute("style");n.value=i+"visibility:hidden;",this.container_.setAttributeNode(n);var o=t.target||null;if(o)"string"==typeof o&&(o=document.getElementById(o)),o.appendChild(this.container_);else{var a=this.map_.getViewport().querySelector(".ol-overlaycontainer");a&&a.parentNode&&a.parentNode.insertBefore(this.container_,a)}if(this.isOverMap_=!o,this.isOverMap_&&t.stopOpenLayersEventsPropagation)for(var s=["click","dblclick","mousedown","touchstart","MSPointerDown","pointerdown","mousewheel","wheel"],u=0,c=s.length;u<c;++u)this.container_.addEventListener(s[u],function(e){return e.stopPropagation()});this.canvas_=document.createElement("CANVAS");var h=document.createAttribute("style");h.value=i,this.canvas_.setAttributeNode(h),l.supportsImageRenderingPixelated()&&(this.canvas_.style.imageRendering=l.imageRenderingValue()),this.canvas_.oncontextmenu=function(){return!1},this.canvas_.onselectstart=function(){return!1},this.container_.appendChild(this.canvas_),this.enabled_=!1,this.pausedInteractions_=[],this.hiddenRootGroup_=null;var m=void 0!==t.sceneOptions?t.sceneOptions:{};m.canvas=this.canvas_,m.scene3DOnly=!0,this.scene_=new Cesium.Scene(m);var d=this.scene_.screenSpaceCameraController;d.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.SHIFT}),d.tiltEventTypes.push({eventType:Cesium.CameraEventType.LEFT_DRAG,modifier:Cesium.KeyboardEventModifier.ALT}),d.enableLook=!1,this.scene_.camera.constrainedAxis=Cesium.Cartesian3.UNIT_Z,this.camera_=new G(this.scene_,this.map_),this.globe_=new Cesium.Globe(Cesium.Ellipsoid.WGS84),this.globe_.baseColor=Cesium.Color.WHITE,this.scene_.globe=this.globe_,this.scene_.skyAtmosphere=new Cesium.SkyAtmosphere;var g=new Cesium.SingleTileImageryProvider({url:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",rectangle:Cesium.Rectangle.fromDegrees(0,0,1,1)});this.globe_.imageryLayers.addImageryProvider(g,0),this.dataSourceCollection_=new Cesium.DataSourceCollection,this.dataSourceDisplay_=new Cesium.DataSourceDisplay({scene:this.scene_,dataSourceCollection:this.dataSourceCollection_});var p=t.createSynchronizers?t.createSynchronizers(this.map_,this.scene_,this.dataSourceCollection_):[new j(this.map_,this.scene_),new te(this.map_,this.scene_),new oe(this.map_,this.scene_)];this.handleResize_();for(var v=p.length-1;v>=0;--v)p[v].synchronize();this.lastFrameTime_=0,this.renderId_=void 0,this.targetFrameRate_=Number.POSITIVE_INFINITY,this.blockCesiumRendering_=!1,this.warmingUp_=!1,this.trackedFeature_=null,this.trackedEntity_=null,this.entityView_=null,this.needTrackedEntityUpdate_=!1,this.boundingSphereScratch_=new Cesium.BoundingSphere,(new Cesium.EventHelper).add(this.scene_.postRender,e.prototype.updateTrackedEntity_,this),Cesium.Camera.enableSuspendTerrainAdjustment=!1}var t=e.prototype;return t.render_=function(){void 0!==this.renderId_&&(cancelAnimationFrame(this.renderId_),this.renderId_=void 0),!this.enabled_&&!this.warmingUp_||this.blockCesiumRendering_||(this.renderId_=requestAnimationFrame(this.onAnimationFrame_.bind(this)))},t.onAnimationFrame_=function(e){this.renderId_=void 0;var t=1e3/this.targetFrameRate_;if(e-this.lastFrameTime_<t)this.render_();else{this.lastFrameTime_=e;var i=this.time_();if(this.scene_.initializeFrame(),this.handleResize_(),this.dataSourceDisplay_.update(i),this.entityView_){var r=this.trackedEntity_;this.dataSourceDisplay_.getBoundingSphere(r,!1,this.boundingSphereScratch_)===Cesium.BoundingSphereState.DONE&&(this.boundingSphereScratch_.radius=1,this.entityView_.update(i,this.boundingSphereScratch_))}this.scene_.render(i),this.camera_.checkCameraChange(),this.render_()}},t.updateTrackedEntity_=function(){if(this.needTrackedEntityUpdate_){var e=this.trackedEntity_,t=this.scene_,i=this.dataSourceDisplay_.getBoundingSphere(e,!1,this.boundingSphereScratch_);if(i!==Cesium.BoundingSphereState.PENDING){t.screenSpaceCameraController.enableTilt=!1;var r=i!==Cesium.BoundingSphereState.FAILED?this.boundingSphereScratch_:void 0;r&&(r.radius=1),this.entityView_=new Cesium.EntityView(e,t,t.mapProjection.ellipsoid),this.entityView_.update(this.time_(),r),this.needTrackedEntityUpdate_=!1}}},t.handleResize_=function(){var e=this.canvas_.clientWidth,t=this.canvas_.clientHeight;if(!(0===e|0===t)&&(e!==this.canvasClientWidth_||t!==this.canvasClientHeight_||this.resolutionScaleChanged_)){var i=this.resolutionScale_;l.supportsImageRenderingPixelated()||(i*=window.devicePixelRatio||1),this.resolutionScaleChanged_=!1,this.canvasClientWidth_=e,this.canvasClientHeight_=t,e*=i,t*=i,this.canvas_.width=e,this.canvas_.height=t,this.scene_.camera.frustum.aspectRatio=e/t}},t.getCamera=function(){return this.camera_},t.getOlMap=function(){return this.map_},t.getOlView=function(){return this.map_.getView()},t.getCesiumScene=function(){return this.scene_},t.getDataSources=function(){return this.dataSourceCollection_},t.getDataSourceDisplay=function(){return this.dataSourceDisplay_},t.getEnabled=function(){return this.enabled_},t.setEnabled=function(e){var t,i=this;if(this.enabled_!==e)if(this.enabled_=e,this.container_.style.visibility=this.enabled_?"visible":"hidden",this.enabled_){if(this.throwOnUnitializedMap_(),this.isOverMap_){(t=this.map_.getInteractions()).forEach(function(e,t,r){i.pausedInteractions_.push(e)}),t.clear(),this.map_.addInteraction=function(e){return i.pausedInteractions_.push(e)},this.map_.removeInteraction=function(e){return i.pausedInteractions_=i.pausedInteractions_.filter(function(t){return t!==e})};var r=this.map_.getLayerGroup();r.getVisible()&&(this.hiddenRootGroup_=r,this.hiddenRootGroup_.setVisible(!1)),this.map_.getOverlayContainer().classList.add("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.add("olcs-hideoverlay")}this.camera_.readFromView(),this.render_()}else this.isOverMap_&&(t=this.map_.getInteractions(),this.pausedInteractions_.forEach(function(e){t.push(e)}),this.pausedInteractions_.length=0,this.map_.addInteraction=function(e){return i.map_.getInteractions().push(e)},this.map_.removeInteraction=function(e){return i.map_.getInteractions().remove(e)},this.map_.getOverlayContainer().classList.remove("olcs-hideoverlay"),this.map_.getOverlayContainerStopEvent().classList.remove("olcs-hideoverlay"),this.hiddenRootGroup_&&(this.hiddenRootGroup_.setVisible(!0),this.hiddenRootGroup_=null)),this.camera_.updateView()},t.warmUp=function(e,t){var i=this;if(!this.enabled_){this.throwOnUnitializedMap_(),this.camera_.readFromView();var r=this.globe_.ellipsoid,n=this.scene_.camera,o=r.cartesianToCartographic(n.position);o.height<e&&(o.height=e,n.position=r.cartographicToCartesian(o)),this.warmingUp_=!0,this.render_(),setTimeout(function(){i.warmingUp_=!1},t)}},t.setBlockCesiumRendering=function(e){this.blockCesiumRendering_!==e&&(this.blockCesiumRendering_=e,this.render_())},t.enableAutoRenderLoop=function(){this.autoRenderLoop_||(this.autoRenderLoop_=new R(this))},t.getAutoRenderLoop=function(){return this.autoRenderLoop_},t.setResolutionScale=function(e){(e=Math.max(0,e))!==this.resolutionScale_&&(this.resolutionScale_=Math.max(0,e),this.resolutionScaleChanged_=!0,this.autoRenderLoop_&&this.autoRenderLoop_.restartRenderLoop())},t.setTargetFrameRate=function(e){this.targetFrameRate_!==e&&(this.targetFrameRate_=e,this.render_())},t.throwOnUnitializedMap_=function(){var e=this.map_.getView(),t=e.getCenter();if(!e.isDef()||isNaN(t[0])||isNaN(t[1]))throw new Error("The OpenLayers map is not properly initialized: "+t+" / "+e.getResolution())},e}();Object.defineProperties(ae.prototype,{trackedFeature:{get:function(){return this.trackedFeature_},set:function(e){if(this.trackedFeature_!==e){var t=this.scene_;if(!e||!e.getGeometry())return this.needTrackedEntityUpdate_=!1,t.screenSpaceCameraController.enableTilt=!0,this.trackedEntity_&&this.dataSourceDisplay_.defaultDataSource.entities.remove(this.trackedEntity_),this.trackedEntity_=null,this.trackedFeature_=null,this.entityView_=null,void t.camera.lookAtTransform(Cesium.Matrix4.IDENTITY);this.trackedFeature_=e,this.needTrackedEntityUpdate_=!0;var i=this.to4326Transform_,r={position:new Cesium.CallbackProperty(function(t,r){return n=e.getGeometry().getCoordinates(),o=i(n,void 0,n.length),O.ol4326CoordinateToCesiumCartesian(o);var n,o},!1),point:{pixelSize:1,color:Cesium.Color.TRANSPARENT}};this.trackedEntity_=this.dataSourceDisplay_.defaultDataSource.entities.add(r)}}}});var se=ae;var ue=function(e){var t,i;function r(t,i,r){var n;return(n=e.call(this,t,i)||this).dataSources_=r,n}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.createSingleLayerCounterparts=function(e){var t,i=e.layer,r=i.getCesiumDataSource;if(r&&(t=r(this.scene)),!t){var n=i.id,o=i.url;if(!(i instanceof D.a)||!n||!/^KML/.test(n)||!o||/:\/\/public\./.test(o))return null;var a=o,u=""+(i.getSource().get("rawData")||"");u&&(a=(new DOMParser).parseFromString(u,"text/xml")),t=Cesium.KmlDataSource.load(a,{camera:this.scene.camera,canvas:this.scene.canvas,clampToGround:!0})}var l=this;return t.then(function(e){var t;e.show=i.getVisible();var r=s(i).toString(),n=[];n.push(i.on("change:visible",function(t){e.show=t.target.getVisible()})),(t=l.olLayerListenKeys[r]).push.apply(t,n),i instanceof H.a&&i.getSource().getFeatures().forEach(function(t){if(e.entities.getById){var r=e.entities.getById(t.getId());r&&(r.olFeature=t,r.olLayer=i)}})}),[t]},n.addCesiumObject=function(e){this.dataSources_.add(e)},n.destroyCesiumObject=function(e){var t=this;e.then(function(e){t.dataSources_.remove(e,!0)})},n.removeSingleCesiumObject=function(e,t){var i=this;e.then(function(e){i.dataSources_.remove(e,t)})},n.removeAllCesiumObjects=function(e){this.dataSources_.removeAll(e)},r}(F);var le=function(e){var t,i;function r(){return e.apply(this,arguments)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.prototype.convertLayerToCesiumImageries=function(e,t){if(e instanceof D.a&&e.getSource()instanceof V.a)return null;var i,r=e.getCesiumImageryProvider;return r&&(i=r())?(Array.isArray(i)?i:[i]).map(function(e){return new Cesium.ImageryLayer(e)}):null},r}(j);var ce=function(e){var t,i;function r(t,i){var r;return(r=e.call(this,t,i)||this).primitives_=new Cesium.PrimitiveCollection,i.primitives.add(r.primitives_),r}i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i;var n=r.prototype;return n.createSingleLayerCounterparts=function(e){var t,i=e.layer,r=i.getCesiumTileset3d;if(r&&(t=r(this.scene)),!t)return null;if(t){var n;t.show=i.getVisible();var o=s(i).toString(),a=[];a.push(i.on(["change:visible"],function(e){t.show=i.getVisible()})),(n=this.olLayerListenKeys[o]).push.apply(n,a)}return[t]},n.addCesiumObject=function(e){this.primitives_.contains(e)||this.primitives_.add(e)},n.destroyCesiumObject=function(e){this.primitives_.contains(e)&&this.primitives_.remove(e)},n.removeSingleCesiumObject=function(e,t){this.primitives_.contains(e)&&this.primitives_.remove(e)},n.removeAllCesiumObjects=function(e){this.primitives_.removeAll()},r}(F);var he=function(e){var t,i;function r(){return e.apply(this,arguments)||this}return i=e,(t=r).prototype=Object.create(i.prototype),t.prototype.constructor=t,t.__proto__=i,r.prototype.createSingleLayerCounterparts=function(t){var i=t.layer,r=i.id,n=i.url;return/^KML/.test(r)&&n&&!/:\/\/public\./.test(n)?null:e.prototype.createSingleLayerCounterparts.call(this,t)},r}(te),me=(t.default=se,window.olcs={});me.OLCesium=se,me.AbstractSynchronizer=F,me.RasterSynchronizer=j,me.VectorSynchronizer=te,me.core=O,me.GaKmlSynchronizer=ue,me.GaRasterSynchronizer=le,me.GaTileset3dSynchronizer=ce,me.GaVectorSynchronizer=he}]);
//# sourceMappingURL=olcesium.js.map